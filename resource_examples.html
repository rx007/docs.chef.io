<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    
    <title>Resource Code Examples &mdash; Chef Docs</title>
    <link rel="stylesheet" href="_static/chefv2.css" type="text/css" />
<link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
    URL_ROOT:    './',
    VERSION:     '',
    COLLAPSE_INDEX: false,
    FILE_SUFFIX: '.html',
    HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="_static/jquery.js"></script>
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>
<script type="text/javascript" src="_static/script.js"></script>

    <link rel="top" title="Chef Docs" href="index.html" />
    <link rel="next" title="execute" href="resource_execute.html" />
    <link rel="prev" title="erl_call" href="resource_erlang_call.html" /> 
  </head>
  <body role="document">
    <div class="body-wrap">

  <nav class="nav-main" role="navigation" data-topbar>
    <div class="nav-inner">
      <div class="left">
        <h1>
          <a href="https://learn.chef.io">
            <span>Learn Chef</span>
          </a>
        </h1>
      </div>

      <i id="nav-icon" class="fa fa-bars"></i>
      <a href="https://www.chef.io/">
        <img id="logo" src="_static/chef_logo_v2.svg" onerror="_static/chef_logo_v2.png"/>
      </a>

      <ul class="nav-links links-main">
        <li class="nav-link">
          <a href="https://learn.chef.io/tutorials">Tutorials</a>
        </li>
        <li class="nav-link">
          <a href="https://learn.chef.io/skills/">Skills Library</a>
        </li>
        <li class="nav-link is-active">
          <a href="https://docs.chef.io/">Docs</a>
        </li>
        <li class="nav-link">
          <a href="https://www.chef.io/training/">Training</a>
        </li>
      </ul>
    </div>
  </nav>





    <div class="document chef-docs">
    <nav class="nav-docs">
  <ul class="nav-docs-items" id="nav-docs-list">
    <li class="main-item dark-item docs-search">
      <form action="/search.html" method="get">
        <input type="text" placeholder="Search" id="docs-search" name="q">
        <input type="submit" class="submit-button" value="">
        <i class="fa fa-search icon-search"></i>
      </form>
   

    </li>
    
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="Overview"> <!-- else item does not have custom image and should use FontAwesome icon -->

        <i class="fa fa-home icon-left"></i> Overview <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items"> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/platform_overview.html" title="Platform Overview">
            Platform Overview
          </a>
        </li>

         <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Community">
            Community
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/community.html" title="About the Community">
                About the Community
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/community_contributions.html" title="Contributing">
                Contributing
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/community_guidelines.html" title="Guidelines">
                Guidelines
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/style_guide.html" title="Docs Style Guide">
                Docs Style Guide
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Packages &amp; Platforms">
            Packages &amp; Platforms
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/packages.html" title="Packages">
                Packages
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/platforms.html" title="Platforms">
                Platforms
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/api_omnitruck.html" title="Omnitruck API">
                Omnitruck API
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_license.html" title="Licensing">
                Licensing
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li>
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="Chef"> <!-- else item does not have custom image and should use FontAwesome icon -->

        <i class="fa fa-tasks icon-left"></i> Chef <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items">

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Getting Started">
            Getting Started
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_overview.html" title="Chef Overview">
                Chef Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/quick_start.html" title="Quick Start">
                Quick Start
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_system_requirements.html" title="System Requirements">
                System Requirements
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Release Notes">
                Release Notes
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/release_notes.html" title="Chef Client">
                    Chef Client
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/release_notes_chefdk.html" title="Chef Development Kit">
                    Chef Development Kit
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/release_notes_server.html" title="Chef Server">
                    Chef Server
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/release_notes_push_jobs.html" title="Chef Push Jobs">
                    Chef Push Jobs
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/release_notes_ohai.html" title="Ohai">
                    Ohai
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_deprecations_client.html" title="Deprecations">
                Deprecations
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Tutorials">
            Tutorials
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/learn-the-basics/" title="Learn the Basics">
                Learn the Basics
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/manage-a-node/" title="Manage a Node">
                Manage a Node
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/local-development/" title="Get started with Test Kitchen">
                Get started with Test Kitchen
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/manage-a-web-app/" title="Develop a web app cookbook">
                Develop a web app cookbook
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/inspec/" title="Verify with InSpec">
                Verify with InSpec
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/chefspec/" title="Unit test with ChefSpec">
                Unit test with ChefSpec
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/verify-style/" title="Verify code style">
                Verify code style
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/refactor-web-app-cookbook/" title="Refactor the web app cookbook">
                Refactor the web app cookbook
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Concepts">
            Concepts
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/workstation.html" title="Workstation">
                Workstation
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_repo.html" title="chef-repo">
                chef-repo
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/nodes.html" title="Nodes">
                Nodes
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_client.html" title="chef-client">
                chef-client
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_components.html" title="Server">
                Server
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_search.html" title="Search">
                Search
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/cookbooks.html" title="Cookbooks">
                Cookbooks
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/handlers.html" title="Handlers">
                Handlers
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/manage.html" title="Management Console">
                Management Console
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Policy">
                Policy
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/policy.html" title="About Policy">
                    About Policy
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/data_bags.html" title="Data Bags">
                    Data Bags
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/environments.html" title="Environments">
                    Environments
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/roles.html" title="Roles">
                    Roles
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/push_jobs.html" title="Push Jobs">
                Push Jobs
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/run_lists.html" title="Run-lists">
                Run-lists
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Security">
                Security
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/auth.html#authentication" title="Authentication">
                    Authentication
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/auth.html#authorization" title="Authorization">
                    Authorization
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/chef_private_keys.html" title="Private Keys">
                    Private Keys
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef_client.html#run-in-fips-mode" title="FIPS-mode">
                    FIPS-mode
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Supermarket">
                Supermarket
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/supermarket.html#public-supermarket" title="Public Supermarket">
                    Public Supermarket
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/supermarket.html#private-supermarket" title="Private Supermarket">
                    Private Supermarket
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/windows.html" title="Microsoft Windows">
                Microsoft Windows
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Appendix">
                Appendix
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/environment_variables.html" title="Env Variables">
                    Env Variables
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/errors.html" title="Troubleshooting">
                    Troubleshooting
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/glossary.html" title="Glossary">
                    Glossary
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Setup">
            Setup
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/proxies.html" title="Proxies">
                Proxies
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/install_dk.html" title="Workstation">
                Workstation
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Nodes">
                Nodes
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/install_bootstrap.html" title="Install via Bootstrap">
                    Install via Bootstrap
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_omnibus.html" title="Install via URL">
                    Install via URL
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_windows.html" title="Install on Windows">
                    Install on Windows
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/junos.html" title="Install on Junos OS">
                    Install on Junos OS
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef_client.html" title="chef-client (executable)">
                    chef-client (executable)
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_client.html" title="client.rb">
                    client.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/upgrade_client.html" title="Upgrades">
                    Upgrades
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/chef_client_security.html" title="Security">
                    Security
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Server">
                Server
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="https://manage.chef.io/signup" title="Hosted Chef Server">
                    Hosted Chef Server
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_server.html#standalone" title="Install Standalone">
                    Install Standalone
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_server_ha.html" title="Install High Availability">
                    Install High Availability
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/aws_marketplace.html" title="AWS Marketplace">
                    AWS Marketplace
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/azure_portal.html" title="Microsoft Azure">
                    Microsoft Azure
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/openstack.html" title="Openstack">
                    Openstack
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Supermarket">
                Supermarket
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="https://supermarket.chef.io" title="Public Supermarket">
                    Public Supermarket
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_supermarket.html" title="Install Private Supermarket">
                    Install Private Supermarket
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_supermarket.html#customize-supermarket" title="Customize Supermarket">
                    Customize Supermarket
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_supermarket.html#run-supermarket-in-kitchen" title="Run in Test Kitchen">
                    Run in Test Kitchen
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_chef_server.html#install" title="Management Console">
                Management Console
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/install_push_jobs.html" title="Push Jobs">
                Push Jobs
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Integrations">
                Integrations
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/integrate_compliance_chef_server.html" title="w/Chef Compliance">
                    w/Chef Compliance
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/uninstall.html" title="Uninstall">
                Uninstall
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Cookbook Reference">
            Cookbook Reference
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/cookbooks.html" title="About Cookbooks">
                About Cookbooks
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/attributes.html" title="Attributes">
                Attributes
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/definitions.html" title="Definitions">
                Definitions
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/files.html" title="Files">
                Files
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/libraries.html" title="Libraries">
                Libraries
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Recipes">
                Recipes
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/recipes.html" title="About Recipes">
                    About Recipes
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/debug.html" title="Debug Recipes, Client Runs">
                    Debug Recipes, Client Runs
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Recipe DSL">
                Recipe DSL
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#attribute" title="attribute?">
                    attribute?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#control" title="control">
                    control
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#control-group" title="control_group">
                    control_group
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#cookbook-name" title="cookbook_name">
                    cookbook_name
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#data-bag" title="data_bag">
                    data_bag
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#data-bag-item" title="data_bag_item">
                    data_bag_item
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#platform" title="platform?">
                    platform?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#platform-family" title="platform_family?">
                    platform_family?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#reboot-pending" title="reboot_pending?">
                    reboot_pending?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#recipe-name" title="recipe_name">
                    recipe_name
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#registry-data-exists" title="registry_data_exists?">
                    registry_data_exists?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#registry-get-subkeys" title="registry_get_subkeys">
                    registry_get_subkeys
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#registry-get-values" title="registry_get_values">
                    registry_get_values
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#registry-has-subkeys" title="registry_has_subkeys?">
                    registry_has_subkeys?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#registry-key-exists" title="registry_key_exists?">
                    registry_key_exists?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#registry-value-exists" title="registry_value_exists?">
                    registry_value_exists?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#resources" title="resources">
                    resources
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#search" title="search">
                    search
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#shell-out" title="shell_out">
                    shell_out
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#shell-out-bang" title="shell_out!">
                    shell_out!
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#shell-out-with-systems-locale" title="shell_out_with_systems_locale">
                    shell_out_with_systems_locale
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#tag-tagged-untag" title="tag">
                    tag
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#tag-tagged-untag" title="tagged?">
                    tagged?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#tag-tagged-untag" title="untag">
                    untag
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#value-for-platform" title="value_for_platform">
                    value_for_platform
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#value-for-platform-family" title="value_for_platform_family">
                    value_for_platform_family
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#helpers" title="Windows Platform Helpers">
                    Windows Platform Helpers
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Resources">
                Resources
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/resource.html" title="About Resources">
                    About Resources
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_common.html" title="Common Functionality">
                    Common Functionality
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/custom_resources.html" title="Custom Resources">
                    Custom Resources
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resources.html" title="All Resources (Single Page)">
                    All Resources (Single Page)
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_apt_package.html" title="apt_package">
                    apt_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_apt_repository.html" title="apt_repository">
                    apt_repository
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_apt_update.html" title="apt_update">
                    apt_update
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_bash.html" title="bash">
                    bash
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_batch.html" title="batch">
                    batch
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_bff_package.html" title="bff_package">
                    bff_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_breakpoint.html" title="breakpoint">
                    breakpoint
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_cab_package.html" title="cab_package">
                    cab_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_gem.html" title="chef_gem">
                    chef_gem
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_acl.html" title="chef_acl">
                    chef_acl
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_client.html" title="chef_client">
                    chef_client
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_container.html" title="chef_container">
                    chef_container
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_data_bag_item.html" title="chef_data_bag_item">
                    chef_data_bag_item
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_data_bag.html" title="chef_data_bag">
                    chef_data_bag
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_environment.html" title="chef_environment">
                    chef_environment
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_group.html" title="chef_group">
                    chef_group
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_handler.html" title="chef_handler">
                    chef_handler
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_mirror.html" title="chef_mirror">
                    chef_mirror
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_node.html" title="chef_node">
                    chef_node
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_organization.html" title="chef_organization">
                    chef_organization
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_role.html" title="chef_role">
                    chef_role
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_user.html" title="chef_user">
                    chef_user
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chocolatey_package.html" title="chocolatey_package">
                    chocolatey_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_cookbook_file.html" title="cookbook_file">
                    cookbook_file
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_cron.html" title="cron">
                    cron
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_csh.html" title="csh">
                    csh
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_deploy.html" title="deploy">
                    deploy
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_directory.html" title="directory">
                    directory
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_dpkg_package.html" title="dpkg_package">
                    dpkg_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_dsc_resource.html" title="dsc_resource">
                    dsc_resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_dsc_script.html" title="dsc_script">
                    dsc_script
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_easy_install_package.html" title="easy_install_package">
                    easy_install_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_env.html" title="env">
                    env
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_erlang_call.html" title="erl_call">
                    erl_call
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_execute.html" title="execute">
                    execute
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_file.html" title="file">
                    file
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_freebsd_package.html" title="freebsd_package">
                    freebsd_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_gem_package.html" title="gem_package">
                    gem_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_git.html" title="git">
                    git
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_group.html" title="group">
                    group
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_homebrew_package.html" title="homebrew_package">
                    homebrew_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_http_request.html" title="http_request">
                    http_request
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_ifconfig.html" title="ifconfig">
                    ifconfig
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_ips_package.html" title="ips_package">
                    ips_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_ksh.html" title="ksh">
                    ksh
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_launchd.html" title="launchd">
                    launchd
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_link.html" title="link">
                    link
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_log.html" title="log">
                    log
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_macports_package.html" title="macports_package">
                    macports_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_mdadm.html" title="mdadm">
                    mdadm
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_mount.html" title="mount">
                    mount
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_msu_package.html" title="msu_package">
                    msu_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_ohai.html" title="ohai">
                    ohai
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_openbsd_package.html" title="openbsd_package">
                    openbsd_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_osx_profile.html" title="osx_profile">
                    osx_profile
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_package.html" title="package">
                    package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_pacman_package.html" title="pacman_package">
                    pacman_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_paludis_package.html" title="paludis_package">
                    paludis_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_perl.html" title="perl">
                    perl
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_portage_package.html" title="portage_package">
                    portage_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_powershell_script.html" title="powershell_script">
                    powershell_script
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_private_key.html" title="private_key">
                    private_key
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_public_key.html" title="public_key">
                    public_key
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_python.html" title="python">
                    python
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_reboot.html" title="reboot">
                    reboot
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_registry_key.html" title="registry_key">
                    registry_key
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_remote_directory.html" title="remote_directory">
                    remote_directory
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_remote_file.html" title="remote_file">
                    remote_file
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_route.html" title="route">
                    route
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_rpm_package.html" title="rpm_package">
                    rpm_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_ruby.html" title="ruby">
                    ruby
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_ruby_block.html" title="ruby_block">
                    ruby_block
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_script.html" title="script">
                    script
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_service.html" title="service">
                    service
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_smartos_package.html" title="smartos_package">
                    smartos_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_solaris_package.html" title="solaris_package">
                    solaris_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_subversion.html" title="subversion">
                    subversion
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_systemd_unit.html" title="systemd_unit">
                    systemd_unit
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_template.html" title="template">
                    template
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_user.html" title="user">
                    user
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_windows_package.html" title="windows_package">
                    windows_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_windows_service.html" title="windows_service">
                    windows_service
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_yum.html" title="yum_package">
                    yum_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_yum_repository.html" title="yum_repository">
                    yum_repository
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_examples.html" title="Examples (by Resource)">
                    Examples (by Resource)
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/templates.html" title="Templates">
                Templates
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/cookbook_repo.html" title="Cookbook Repo">
                Cookbook Repo
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_rb_metadata.html" title="metadata.rb">
                metadata.rb
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/cookbook_versions.html" title="Cookbook Versions">
                Cookbook Versions
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ruby.html" title="Ruby">
                Ruby
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Chef DK">
            Chef DK
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/about_chefdk.html" title="About the ChefDK">
                About the ChefDK
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/berkshelf.html" title="Berkshelf">
                Berkshelf
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_chef_apply.html" title="chef-apply (executable)">
                chef-apply (executable)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_shell.html" title="chef-shell (executable)">
                chef-shell (executable)
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="chef (executable)">
                chef (executable)
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-env" title="chef env">
                    chef env
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-exec" title="chef exec">
                    chef exec
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-gem" title="chef gem">
                    chef gem
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-app" title="chef generate app">
                    chef generate app
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-attribute" title="chef generate attribute">
                    chef generate attribute
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-cookbook" title="chef generate cookbook">
                    chef generate cookbook
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-file" title="chef generate file">
                    chef generate file
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-lwrp" title="chef generate lwrp">
                    chef generate lwrp
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-recipe" title="chef generate recipe">
                    chef generate recipe
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-repo" title="chef generate repo">
                    chef generate repo
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-template" title="chef generate template">
                    chef generate template
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-provision" title="chef provision">
                    chef provision
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-shell-init" title="chef shell-init">
                    chef shell-init
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-verify" title="chef verify">
                    chef verify
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Chef Solo">
                Chef Solo
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/chef_solo.html" title="About Chef Solo">
                    About Chef Solo
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef_solo.html" title="chef-solo (executable)">
                    chef-solo (executable)
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_solo.html" title="solo.rb">
                    solo.rb
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_chef_shell.html" title="chef-shell (executable)">
                chef-shell (executable)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_chef_client.html#run-in-local-mode" title="chef-zero (local mode)">
                chef-zero (local mode)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_vault.html" title="chef-vault">
                chef-vault
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chefspec.html" title="ChefSpec">
                ChefSpec
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Configuration">
                Configuration
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/config_rb.html" title="config.rb">
                    config.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_client.html#d-directories" title="Multiple Config Files">
                    Multiple Config Files
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/cookstyle.html" title="cookstyle">
                cookstyle
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_delivery.html" title="Delivery CLI">
                Delivery CLI
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/foodcritic.html" title="Foodcritic">
                Foodcritic
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Test Kitchen">
                Test Kitchen
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/kitchen.html" title="About Test Kitchen">
                    About Test Kitchen
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_kitchen.html" title="kitchen (executable)">
                    kitchen (executable)
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_yml_kitchen.html" title=".kitchen.yml">
                    .kitchen.yml
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_kitchen_vagrant.html" title="kitchen-vagrant">
                    kitchen-vagrant
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Knife">
                Knife
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/knife.html" title="About Knife">
                    About Knife
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_common_options.html" title="Common Options">
                    Common Options
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_using.html" title="Using Knife">
                    Using Knife
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_knife.html" title="knife.rb">
                    knife.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_bootstrap.html" title="knife bootstrap">
                    knife bootstrap
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_client.html" title="knife client">
                    knife client
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_configure.html" title="knife configure">
                    knife configure
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_cookbook.html" title="knife cookbook">
                    knife cookbook
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_cookbook_site.html" title="knife cookbook site">
                    knife cookbook site
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_data_bag.html" title="knife data bag">
                    knife data bag
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_delete.html" title="knife delete">
                    knife delete
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_deps.html" title="knife deps">
                    knife deps
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_diff.html" title="knife diff">
                    knife diff
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_download.html" title="knife download">
                    knife download
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_edit.html" title="knife edit">
                    knife edit
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_environment.html" title="knife environment">
                    knife environment
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_exec.html" title="knife exec">
                    knife exec
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_list.html" title="knife list">
                    knife list
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_node.html" title="knife node">
                    knife node
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_raw.html" title="knife raw">
                    knife raw
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_recipe_list.html" title="knife recipe list">
                    knife recipe list
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_role.html" title="knife role">
                    knife role
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_search.html" title="knife search">
                    knife search
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_serve.html" title="knife serve">
                    knife serve
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_show.html" title="knife show">
                    knife show
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_ssh.html" title="knife ssh">
                    knife ssh
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_ssl_check.html" title="knife ssl_check">
                    knife ssl_check
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_ssl_fetch.html" title="knife ssl_fetch">
                    knife ssl_fetch
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_status.html" title="knife status">
                    knife status
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_tag.html" title="knife tag">
                    knife tag
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_upload.html" title="knife upload">
                    knife upload
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_user.html" title="knife user">
                    knife user
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_xargs.html" title="knife xargs">
                    knife xargs
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="knife opc">
                knife opc
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html" title="About knife opc">
                    About knife opc
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#knife-rb-configuration" title="knife.rb Configuration">
                    knife.rb Configuration
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-user-list" title="opc user list">
                    opc user list
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-user-show" title="opc user show">
                    opc user show
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-user-create" title="opc user create">
                    opc user create
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-user-delete" title="opc user delete">
                    opc user delete
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-user-edit" title="opc user edit">
                    opc user edit
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-user-password" title="opc user password">
                    opc user password
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-org-list" title="opc org list">
                    opc org list
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-org-show" title="opc org show">
                    opc org show
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-org-create" title="opc org create">
                    opc org create
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-org-delete" title="opc org delete">
                    opc org delete
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-org-user-add" title="opc org user add">
                    opc org user add
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-org-user-remove" title="opc org user remove">
                    opc org user remove
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_knife_spork.html" title="knife spork">
                knife spork
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="knife supermarket">
                knife supermarket
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html" title="About knife supermarket">
                    About knife supermarket
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#download" title="supermarket download">
                    supermarket download
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#install" title="supermarket install">
                    supermarket install
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#list" title="supermarket list">
                    supermarket list
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#search" title="supermarket search">
                    supermarket search
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#share" title="supermarket share">
                    supermarket share
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#show" title="supermarket show">
                    supermarket show
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#unshare" title="supermarket unshare">
                    supermarket unshare
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Ohai">
                Ohai
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/ohai.html" title="About Ohai">
                    About Ohai
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_ohai.html" title="ohai (executable)">
                    ohai (executable)
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Policyfile">
                Policyfile
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/policyfile.html" title="About Policyfile">
                    About Policyfile
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_policyfile.html" title="Policyfile.rb">
                    Policyfile.rb
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Provisioning">
                Provisioning
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/provisioning.html" title="About Provisioning">
                    About Provisioning
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_load_balancer.html" title="load_balancer resource">
                    load_balancer resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_machine.html" title="machine resource">
                    machine resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_machine_batch.html" title="machine_batch resource">
                    machine_batch resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_machine_execute.html" title="machine_execute resource">
                    machine_execute resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_machine_file.html" title="machine_file resource">
                    machine_file resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_machine_image.html" title="machine_image resource">
                    machine_image resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/provisioning_aws.html" title="AWS Driver Resources">
                    AWS Driver Resources
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/provisioning_fog.html" title="Fog Driver Resources">
                    Fog Driver Resources
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/provisioning_vagrant.html" title="Vagrant Driver Resources">
                    Vagrant Driver Resources
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_push_jobs_client.html" title="push-jobs-client (executable)">
                push-jobs-client (executable)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/rubocop.html" title="Rubocop">
                Rubocop
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Managing the Server">
            Managing the Server
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/runbook.html" title="Runbook (Single Page)">
                Runbook (Single Page)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_backup_restore.html" title="Backup &amp; Restore">
                Backup &amp; Restore
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_data.html" title="Data Storage">
                Data Storage
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_firewalls_and_ports.html" title="Firewalls &amp; Ports">
                Firewalls &amp; Ports
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_ldap.html" title="Active Directory &amp; LDAP">
                Active Directory &amp; LDAP
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_logs.html" title="Log Files">
                Log Files
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_monitor.html" title="Monitor">
                Monitor
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_orgs.html" title="Organizations &amp; Groups">
                Organizations &amp; Groups
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/secrets.html" title="Secrets">
                Secrets
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_security.html" title="Security">
                Security
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_services.html" title="Services">
                Services
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_tuning.html" title="Tuning">
                Tuning
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/upgrade_server.html" title="Upgrades">
                Upgrades
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/upgrade_server_ha_v2.html" title="Upgrade HA Cluster">
                Upgrade HA Cluster
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_users.html" title="Users">
                Users
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_chef_server.html" title="chef-server-ctl">
                chef-server-ctl
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_chef_backend.html" title="chef-backend-ctl">
                chef-backend-ctl
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_rb_server.html" title="chef-server.rb">
                chef-server.rb
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_opscode_expander.html" title="opscode-expander-ctl">
                opscode-expander-ctl
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/api_chef_server.html" title="Chef Server API">
                Chef Server API
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Push Jobs">
                Push Jobs
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_push_jobs.html" title="knife push jobs">
                    knife push jobs
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_push_jobs_client.html" title="push-jobs-client">
                    push-jobs-client
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_push_jobs_client.html" title="push-jobs-client.rb">
                    push-jobs-client.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_push_jobs_server.html" title="push-jobs-server.rb">
                    push-jobs-server.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/api_push_jobs.html" title="Push Jobs API">
                    Push Jobs API
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_sent_events.html" title="Server Sent Events">
                    Server Sent Events
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Supermarket">
                Supermarket
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/supermarket_logs.html" title="Log Files">
                    Log Files
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/supermarket_monitor.html" title="Monitoring">
                    Monitoring
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_supermarket.html" title="supermarket.rb">
                    supermarket.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html" title="knife supermarket">
                    knife supermarket
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_supermarket.html" title="supermarket-ctl">
                    supermarket-ctl
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/supermarket_api.html" title="Supermarket API">
                    Supermarket API
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Management Console">
                Management Console
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/server_configure_saml.html" title="Configure SAML">
                    Configure SAML
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_manage_clients.html" title="Clients">
                    Clients
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_manage_cookbooks.html" title="Cookbooks">
                    Cookbooks
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_manage_data_bags.html" title="Data Bags">
                    Data Bags
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_manage_environments.html" title="Environments">
                    Environments
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_manage_nodes.html" title="Nodes">
                    Nodes
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_manage_roles.html" title="Roles">
                    Roles
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_users.html#chef-manage" title="Users">
                    Users
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_manage.html" title="manage.rb">
                    manage.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_manage.html" title="chef-manage-ctl">
                    chef-manage-ctl
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li>
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="Habitat"> <!-- if item has custom image -->

        <img class="icon-left" src="./_static/habitat-mark.png"></img> Habitat <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items"> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/habitat.html" title="Habitat Overview">
            Habitat Overview
          </a>
        </li>

         <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Tutorials">
            Tutorials
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://www.habitat.sh/tutorials/getting-started-overview" title="Getting started">
                Getting started
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li>
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="InSpec"> <!-- if item has custom image -->

        <img class="icon-left" src="./_static/inspec_logo.png"></img> InSpec <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items"> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/inspec.html" title="InSpec Overview">
            InSpec Overview
          </a>
        </li>

         <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li>
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="Chef Automate"> <!-- else item does not have custom image and should use FontAwesome icon -->

        <i class="fa fa-cogs icon-left"></i> Chef Automate <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items">

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Getting Started">
            Getting Started
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_automate.html" title="Chef Automate Overview">
                Chef Automate Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/install_chef_automate.html" title="Installation Guide">
                Installation Guide
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Tutorials">
            Tutorials
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/automate/install" title="Get Started">
                Get Started
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/automate/visibility" title="Visibility into Infrastructure">
                Visibility into Infrastructure
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/automate/deploy-cookbook/" title="Deploy with Chef Automate">
                Deploy with Chef Automate
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/compliance-assess" title="Assess for Compliance">
                Assess for Compliance
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/compliance-remediate" title="Remediate Compliance Failures">
                Remediate Compliance Failures
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Setup">
            Setup
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_pipeline.html" title="Configure a Pipeline">
                Configure a Pipeline
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_json_delivery.html" title="Configure a Project">
                Configure a Project
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/setup_visibility_chef_automate.html" title="Configure Data Collection">
                Configure Data Collection
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Concepts">
            Concepts
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2">

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Workflow">
                Workflow
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/workflow.html" title="Workflow Overview">
                    Workflow Overview
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/delivery_manage_dependencies.html" title="Manage Dependencies">
                    Manage Dependencies
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/visibility.html" title="Visibility Overview">
                Visibility Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/compliance.html" title="Compliance Overview">
                Compliance Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/ctl_delivery.html" title="Delivery CLI">
            Delivery CLI
          </a>
        </li>

         <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Integrations">
            Integrations
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_delivery_bitbucket.html" title="w/Bitbucket">
                w/Bitbucket
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_delivery_smtp.html" title="w/Email (SMTP)">
                w/Email (SMTP)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_delivery_github.html" title="w/GitHub">
                w/GitHub
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_delivery_ldap.html" title="w/LDAP">
                w/LDAP
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_chef_automate_saml.html" title="w/SAML">
                w/SAML
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_delivery_slack.html" title="w/Slack">
                w/Slack
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Cookbooks">
            Cookbooks
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_build_cookbook.html" title="build-cookbook (cookbook)">
                build-cookbook (cookbook)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_truck.html" title="delivery-truck (cookbook)">
                delivery-truck (cookbook)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/publish_cookbooks_multiple_servers.html" title="Publish to Multiple Chef Servers">
                Publish to Multiple Chef Servers
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/dsl_delivery.html" title="Workflow DSL">
            Workflow DSL
          </a>
        </li>

         <!-- /if subItem2.hasSubItems --> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/job_dispatch.html" title="Job Dispatch">
            Job Dispatch
          </a>
        </li>

         <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Managing the Server">
            Managing the Server
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2">

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Backups">
                Backups
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/delivery_server_backup.html#configuration" title="Configuration">
                    Configuration
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/delivery_server_backup.html#create-backups" title="Create Backups">
                    Create Backups
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/delivery_server_backup.html#list-backups" title="List Backups">
                    List Backups
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/delivery_server_backup.html#delete-backups" title="Delete Backups">
                    Delete Backups
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/delivery_server_backup.html#restore-backups" title="Restore Backups">
                    Restore Backups
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/scaling_capacity_planning_chef_automate.html" title="Capacity Planning">
                Capacity Planning
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/api_delivery.html" title="Chef Automate API">
                Chef Automate API
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="automate-ctl">
                automate-ctl
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#cleanse" title="cleanse">
                    cleanse
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#create-enterprise" title="create-enterprise">
                    create-enterprise
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#create-user" title="create-user">
                    create-user
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#delete-application" title="delete-application">
                    delete-application
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#delete-enterprise" title="delete-enterprise">
                    delete-enterprise
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#delete-project" title="delete-project">
                    delete-project
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#delete-user" title="delete-user">
                    delete-user
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#delete-visibility-node" title="delete-visibility-node">
                    delete-visibility-node
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#delete-visibility-node-by-id" title="delete-visibility-node-by-id">
                    delete-visibility-node-by-id
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#gather-logs" title="gather-logs">
                    gather-logs
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#help" title="help">
                    help
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#install-runner" title="install-runner">
                    install-runner
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#list-applications" title="list-applications">
                    list-applications
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#list-enterprises" title="list-enterprises">
                    list-enterprises
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#list-users" title="list-users">
                    list-users
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#migrate-change-description" title="migrate-change-description">
                    migrate-change-description
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#migrate-patchset-diffs" title="migrate-patchset-diffs">
                    migrate-patchset-diffs
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#preflight-check" title="preflight-check">
                    preflight-check
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#reconfigure" title="reconfigure">
                    reconfigure
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#rename-enterprise" title="rename-enterprise">
                    rename-enterprise
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#reset-password" title="reset-password">
                    reset-password
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#restore-backup" title="restore-backup">
                    restore-backup
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#revoke-token" title="revoke-token">
                    revoke-token
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#show-config" title="show-config">
                    show-config
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#uninstall" title="uninstall">
                    uninstall
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#update-project-hooks" title="update-project-hooks">
                    update-project-hooks
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_rb_delivery.html" title="delivery.rb">
                delivery.rb
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_server_disaster_recovery.html" title="Disaster Recovery">
                Disaster Recovery
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/elasticsearch_and_kibana_auth.html" title="Elasticsearch &amp; Kibana Auth">
                Elasticsearch &amp; Kibana Auth
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/manage_indices_chef_automate.html" title="Manage Elasticsearch Indices">
                Manage Elasticsearch Indices
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/search_query_chef_automate.html" title="Node Search Reference">
                Node Search Reference
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_manage_secrets.html" title="Secrets">
                Secrets
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/stream_data_chef_automate.html" title="Stream Data">
                Stream Data
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_server_tuning.html" title="Tuning">
                Tuning
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/upgrade_chef_automate.html" title="Upgrades">
                Upgrades
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_users_and_roles.html" title="Users &amp; Roles">
                Users &amp; Roles
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Compliance scanner">
            Compliance scanner
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/compliance.html" title="Overview">
                Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/release_notes_compliance.html" title="Release Notes">
                Release Notes
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/install_compliance.html" title="Installation Guide">
                Installation Guide
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_compliance_chef_server.html" title="Integrate w/Chef Server">
                Integrate w/Chef Server
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_compliance_chef_automate.html" title="Integrate w/Chef Automate">
                Integrate w/Chef Automate
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/upgrade_compliance.html" title="Upgrade Compliance">
                Upgrade Compliance
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_rb_compliance.html" title="chef-compliance.rb">
                chef-compliance.rb
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/api_compliance.html" title="Chef Compliance API">
                Chef Compliance API
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/aws_opsworks_chef_automate.html" title="AWS OpsWorks for Chef Automate">
            AWS OpsWorks for Chef Automate
          </a>
        </li>

         <!-- /if subItem2.hasSubItems --> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/troubleshooting_chef_automate.html" title="Troubleshooting">
            Troubleshooting
          </a>
        </li>

         <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li>
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="Legacy"> <!-- else item does not have custom image and should use FontAwesome icon -->

        <i class="fa fa-hdd-o icon-left"></i> Legacy <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items">

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Analytics">
            Analytics
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics.html" title="Overview">
                Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/release_notes_analytics.html" title="Release Notes">
                Release Notes
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/install_analytics.html" title="Install Standalone">
                Install Standalone
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/actions.html" title="Web UI">
                Web UI
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics_webui_tasks.html" title="Management Console">
                Management Console
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics_nodes_view.html" title="Nodes View">
                Nodes View
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics.html#integrations" title="Integrations">
                Integrations
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics_splunk.html" title="Splunk">
                Splunk
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics_rules.html" title="Rules">
                Rules
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics_monitor.html" title="Monitor">
                Monitor
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/upgrade_analytics.html" title="Upgrades">
                Upgrades
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_client_analytics.html" title="Chef Client for Analytics">
                Chef Client for Analytics
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_analytics.html" title="opscode-analytics-ctl">
                opscode-analytics-ctl
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_rb_analytics.html" title="opscode-analytics.rb">
                opscode-analytics.rb
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_knife_analytics.html" title="knife-analytics">
                knife-analytics
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/api_analytics.html" title="Analytics API">
                Analytics API
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/dsl_recipe_analytics.html" title="Recipe DSL for Analytics">
                Recipe DSL for Analytics
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Reporting">
            Reporting
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/reporting.html" title="Overview">
                Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/install_reporting.html" title="Install Reporting">
                Install Reporting
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_manage_reports.html" title="View Reports">
                View Reports
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_knife_reporting.html" title="knife reporting">
                knife reporting
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_reporting.html" title="opscode-reporting-ctl">
                opscode-reporting-ctl
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_rb_reporting.html" title="opscode-reporting.rb">
                opscode-reporting.rb
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/api_reporting.html" title="Reporting API">
                Reporting API
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li>
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="Extension APIs"> <!-- else item does not have custom image and should use FontAwesome icon -->

        <i class="fa fa-clone icon-left"></i> Extension APIs <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items"> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/dsl_compliance.html" title="Compliance DSL">
            Compliance DSL
          </a>
        </li>

         <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Handlers">
            Handlers
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/handlers.html#custom-handlers" title="Custom Handlers">
                Custom Handlers
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/dsl_handler.html" title="Handler DSL">
                Handler DSL
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_community.html#handlers" title="Community Handlers">
                Community Handlers
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Knife Plugins">
            Knife Plugins
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_knife.html" title="About Cloud Plugins">
                About Cloud Plugins
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_knife_custom.html" title="Custom Plugins">
                Custom Plugins
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_community.html#knife" title="Community Plugins">
                Community Plugins
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Ohai Plugins">
            Ohai Plugins
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ohai_custom.html" title="Custom Plugins">
                Custom Plugins
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_community.html#ohai" title="Community Plugins">
                Community Plugins
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/plugin_community.html#chef-client" title="Chef Client Plugins">
            Chef Client Plugins
          </a>
        </li>

         <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li> <!-- /for item in navItems -->
    
    <li class="main-item dark-item">
      <a href="https://github.com/chef/chef-web-docs" title="Available on GitHub">
        <i class="fa fa-github icon-left"></i>
        Available on GitHub
      </a>
    </li>
    <li class="main-item dark-item">
      <a href="https://www.chef.io/chef/get-chef">
        <i class="fa fa-download icon-left"></i>
        Get Chef
      </a>
    </li>
    <li class="main-item dark-item">
      <a href="https://docs.chef.io/feedback.html">
        <i class="fa fa-commenting icon-left"></i>
        Send Feedback
      </a>
    </li>
    <li class="main-item dark-item">
      <a href="https://www.chef.io/support/">
        <i class="fa fa-support icon-left"></i>
        Support
      </a>
    </li>
    <li class="main-item dark-item">
      <a href="https://docs.chef.io/index.html">
        <i class="fa fa-map-o icon-left"></i>
        Site Map
      </a>
    </li>
    <li class="main-item dark-item">
      <a href="https://docs-archive.chef.io/">
        <i class="fa fa-archive icon-left"></i>
        Archive
      </a>
    </li>
  </ul>
</nav>
      <div class="documentwrapper"><div class="sphinxsidebar" role="navigation" aria-label="main navigation">
  <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Resource Code Examples</a><ul>
<li><a class="reference internal" href="#common-examples">Common Examples</a></li>
<li><a class="reference internal" href="#apt-package">apt_package</a></li>
<li><a class="reference internal" href="#apt-update">apt_update</a></li>
<li><a class="reference internal" href="#bash">bash</a></li>
<li><a class="reference internal" href="#batch">batch</a></li>
<li><a class="reference internal" href="#bff-package">bff_package</a></li>
<li><a class="reference internal" href="#breakpoint">breakpoint</a></li>
<li><a class="reference internal" href="#chef-gem">chef_gem</a></li>
<li><a class="reference internal" href="#chef-handler">chef_handler</a></li>
<li><a class="reference internal" href="#chocolatey-package">chocolatey_package</a></li>
<li><a class="reference internal" href="#cookbook-file">cookbook_file</a></li>
<li><a class="reference internal" href="#cron">cron</a></li>
<li><a class="reference internal" href="#csh">csh</a></li>
<li><a class="reference internal" href="#deploy">deploy</a></li>
<li><a class="reference internal" href="#directory">directory</a></li>
<li><a class="reference internal" href="#dpkg-package">dpkg_package</a></li>
<li><a class="reference internal" href="#dsc-resource">dsc_resource</a></li>
<li><a class="reference internal" href="#dsc-script">dsc_script</a></li>
<li><a class="reference internal" href="#easy-install-package">easy_install_package</a></li>
<li><a class="reference internal" href="#env">env</a></li>
<li><a class="reference internal" href="#erl-call">erl_call</a></li>
<li><a class="reference internal" href="#execute">execute</a></li>
<li><a class="reference internal" href="#file">file</a></li>
<li><a class="reference internal" href="#freebsd-package">freebsd_package</a></li>
<li><a class="reference internal" href="#gem-package">gem_package</a></li>
<li><a class="reference internal" href="#git">git</a></li>
<li><a class="reference internal" href="#group">group</a></li>
<li><a class="reference internal" href="#homebrew-package">homebrew_package</a></li>
<li><a class="reference internal" href="#http-request">http_request</a></li>
<li><a class="reference internal" href="#ifconfig">ifconfig</a></li>
<li><a class="reference internal" href="#ips-package">ips_package</a></li>
<li><a class="reference internal" href="#ksh">ksh</a></li>
<li><a class="reference internal" href="#link">link</a></li>
<li><a class="reference internal" href="#log">log</a></li>
<li><a class="reference internal" href="#macports-package">macports_package</a></li>
<li><a class="reference internal" href="#mdadm">mdadm</a></li>
<li><a class="reference internal" href="#mount">mount</a></li>
<li><a class="reference internal" href="#ohai">ohai</a></li>
<li><a class="reference internal" href="#openbsd-package">openbsd_package</a></li>
<li><a class="reference internal" href="#osx-profile">osx_profile</a></li>
<li><a class="reference internal" href="#package">package</a></li>
<li><a class="reference internal" href="#pacman-package">pacman_package</a></li>
<li><a class="reference internal" href="#paludis-package">paludis_package</a></li>
<li><a class="reference internal" href="#perl">perl</a></li>
<li><a class="reference internal" href="#portage-package">portage_package</a></li>
<li><a class="reference internal" href="#powershell-script">powershell_script</a></li>
<li><a class="reference internal" href="#python">python</a></li>
<li><a class="reference internal" href="#reboot">reboot</a></li>
<li><a class="reference internal" href="#registry-key">registry_key</a></li>
<li><a class="reference internal" href="#remote-directory">remote_directory</a></li>
<li><a class="reference internal" href="#remote-file">remote_file</a></li>
<li><a class="reference internal" href="#route">route</a></li>
<li><a class="reference internal" href="#rpm-package">rpm_package</a></li>
<li><a class="reference internal" href="#ruby">ruby</a></li>
<li><a class="reference internal" href="#ruby-block">ruby_block</a></li>
<li><a class="reference internal" href="#script">script</a></li>
<li><a class="reference internal" href="#service">service</a></li>
<li><a class="reference internal" href="#smartos-package">smartos_package</a></li>
<li><a class="reference internal" href="#solaris-package">solaris_package</a></li>
<li><a class="reference internal" href="#subversion">subversion</a></li>
<li><a class="reference internal" href="#template">template</a></li>
<li><a class="reference internal" href="#user">user</a></li>
<li><a class="reference internal" href="#windows-package">windows_package</a></li>
<li><a class="reference internal" href="#windows-service">windows_service</a></li>
<li><a class="reference internal" href="#yum-package">yum_package</a></li>
</ul>
</li>
</ul>

  </div>
</div>
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="resource-code-examples">
<h1>Resource Code Examples<a class="headerlink" href="#resource-code-examples" title="Permalink to this headline"></a></h1>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_examples.rst">[edit on GitHub]</a></p>
<p>This reference contains code examples for many of the core resources that are built in to the chef-client, sorted by resource. This topic is a subset of the topic that contains a <a class="reference external" href="https://docs.chef.io/chef/resources.html">complete description of all resources</a>, including actions, properties, and providers (in addition to these examples).</p>
<div class="section" id="common-examples">
<h2>Common Examples<a class="headerlink" href="#common-examples" title="Permalink to this headline"></a></h2>
<p>The examples in this section show functionality that is common across all resources.</p>
<p><strong>Use the :nothing action</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;memcached&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:stop</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the ignore_failure common attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;syntax&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">ignore_failure</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the provider common attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;some_package&#39;</span> <span class="k">do</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rubygems</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the supports common attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;apache&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the supports and providers common attributes</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;some_service&#39;</span> <span class="k">do</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Upstart</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file, but not if an attribute has a specific value</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and using the presence of an attribute value on the node to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="n">node</span><span class="o">[</span><span class="ss">:some_value</span><span class="o">]</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file with a Ruby block, but not if &#8220;/etc/passwd&#8221; exists</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and then Ruby code to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="k">do</span>
    <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file with Ruby block that has curly braces, but not if &#8220;/etc/passwd&#8221; exists</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and using a Ruby block (with curly braces) to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span> <span class="p">)}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file using a string, but not if &#8220;/etc/passwd&#8221; exists</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and using a string to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;test -f /etc/passwd&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a file from a remote location using bash</strong></p>
<p>The following is an example of how to install the <tt class="docutils literal"><span class="pre">foo123</span></tt> module for Nginx. This module adds shell-style functionality to an Nginx configuration file and does the following:</p>
<ul class="simple">
<li>Declares three variables</li>
<li>Gets the Nginx file from a remote location</li>
<li>Installs the file using Bash to the path specified by the <tt class="docutils literal"><span class="pre">src_filepath</span></tt> variable</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample is similar to the ``upload_progress_module``</span>
<span class="c1"># recipe in the ``nginx`` cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/nginx</span>

<span class="n">src_filename</span> <span class="o">=</span> <span class="s2">&quot;foo123-nginx-module-v</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">.tar.gz&quot;</span>
<span class="n">src_filepath</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">src_filename</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">extract_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span>
  <span class="si">}</span><span class="s2">/nginx_foo123_module/</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s1">&#39;src_filepath&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;extract_module&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    mkdir -p #{extract_path}</span>
<span class="sh">    tar xzf #{src_filename} -C #{extract_path}</span>
<span class="sh">    mv #{extract_path}/*/* #{extract_path}/</span>
<span class="no">    EOH</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file, but only if an attribute has a specific value</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">only_if</span></tt> condition to create a file based on a template and using the presence of an attribute on the node to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">only_if</span> <span class="p">{</span> <span class="n">node</span><span class="o">[</span><span class="ss">:some_value</span><span class="o">]</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file with a Ruby block, but only if &#8220;/etc/passwd&#8221; does not exist</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">only_if</span></tt> condition to create a file based on a template, and then use Ruby to specify a condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">only_if</span> <span class="k">do</span> <span class="o">!</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">)</span> <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file using a string, but only if &#8220;/etc/passwd&#8221; exists</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">only_if</span></tt> condition to create a file based on a template and using a string to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">only_if</span> <span class="s1">&#39;test -f /etc/passwd&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delay notifications</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/nagios3/configures-nagios.conf&#39;</span> <span class="k">do</span>
  <span class="c1"># other parameters</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test-nagios-config]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Notify immediately</strong></p>
<p>By default, notifications are <tt class="docutils literal"><span class="pre">:delayed</span></tt>, that is they are queued up as they are triggered, and then executed at the very end of a chef-client run. To run an action immediately, use <tt class="docutils literal"><span class="pre">:immediately</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/nagios3/configures-nagios.conf&#39;</span> <span class="k">do</span>
  <span class="c1"># other parameters</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test-nagios-config]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the chef-client would immediately run the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test-nagios-config&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;nagios3 --verify-config&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Enable a service after a restart or reload</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;apache&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Notify multiple resources</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/chef/server.rb&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;server.rb.erb&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[chef-solr]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[chef-solr-indexer]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[chef-server]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Notify in a specific order</strong></p>
<p>To notify multiple resources, and then have these resources run in a certain order, do something like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;...&#39;</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;template[baz]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:install</span><span class="p">,</span> <span class="s1">&#39;package[bar]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[final]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;baz&#39;</span> <span class="k">do</span>
  <span class="o">...</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[restart_baz]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">package</span> <span class="s1">&#39;bar&#39;</span>

<span class="n">execute</span> <span class="s1">&#39;restart_baz&#39;</span>

<span class="n">execute</span> <span class="s1">&#39;final&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;...&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the sequencing will be in the same order as the resources are listed in the recipe: <tt class="docutils literal"><span class="pre">execute</span> <span class="pre">'foo'</span></tt>, <tt class="docutils literal"><span class="pre">template</span> <span class="pre">'baz'</span></tt>, <tt class="docutils literal"><span class="pre">execute</span> <span class="pre">[restart_baz]</span></tt>, <tt class="docutils literal"><span class="pre">package</span> <span class="pre">'bar'</span></tt>, and <tt class="docutils literal"><span class="pre">execute</span> <span class="pre">'final'</span></tt>.</p>
<p><strong>Reload a service</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;service[apache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Restart a service when a template is modified</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/www/configures-apache.conf&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[apache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Send notifications to multiple resources</strong></p>
<p>To send notifications to multiple resources, just use multiple attributes. Multiple attributes will get sent to the notified resources in the order specified.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/netatalk/netatalk.conf&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[afpd]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[cnid]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">service</span> <span class="s1">&#39;afpd&#39;</span>
<span class="n">service</span> <span class="s1">&#39;cnid&#39;</span>
</pre></div>
</div>
<p><strong>Execute a command using a template</strong></p>
<p>The following example shows how to set up IPv4 packet forwarding using the <strong>execute</strong> resource to run a command named <tt class="docutils literal"><span class="pre">forward_ipv4</span></tt> that uses a template defined by the <strong>template</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;forward_ipv4&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;echo &gt; /proc/.../ipv4/ip_forward&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/etc/file_name.conf&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;routing/file_name.conf.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[forward_ipv4]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">command</span></tt> property for the <strong>execute</strong> resource contains the command that is to be run and the <tt class="docutils literal"><span class="pre">source</span></tt> property for the <strong>template</strong> resource specifies which template to use. The <tt class="docutils literal"><span class="pre">notifies</span></tt> property for the <strong>template</strong> specifies that the <tt class="docutils literal"><span class="pre">execute[forward_ipv4]</span></tt> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of the chef-client run.</p>
<p><strong>Restart a service, and then notify a different service</strong></p>
<p>The following example shows how start a service named <tt class="docutils literal"><span class="pre">example_service</span></tt> and immediately notify the Nginx service to restart.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;example_service&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Init</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[nginx]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where by using the default <tt class="docutils literal"><span class="pre">provider</span></tt> for the <strong>service</strong>, the recipe is telling the chef-client to determine the specific provider to be used during the chef-client run based on the platform of the node on which the recipe will run.</p>
<p><strong>Notify when a remote source changes</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/tmp/couch.png&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://couchdb.apache.org/img/sketch.png&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">http_request</span> <span class="s1">&#39;HEAD http://couchdb.apache.org/img/sketch.png&#39;</span> <span class="k">do</span>
  <span class="n">message</span> <span class="s1">&#39;&#39;</span>
  <span class="n">url</span> <span class="s1">&#39;http://couchdb.apache.org/img/sketch.png&#39;</span>
  <span class="n">action</span> <span class="ss">:head</span>
  <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/tmp/couch.png&#39;</span><span class="p">)</span>
    <span class="n">headers</span> <span class="s1">&#39;If-Modified-Since&#39;</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">mtime</span><span class="p">(</span><span class="s1">&#39;/tmp/couch.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">httpdate</span>
  <span class="k">end</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;remote_file[/tmp/couch.png]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Prevent restart and reconfigure if configuration is broken</strong></p>
<p>Use the <tt class="docutils literal"><span class="pre">:nothing</span></tt> action (common to all resources) to prevent an application from restarting, and then use the <tt class="docutils literal"><span class="pre">subscribes</span></tt> notification to ask the broken configuration to be reconfigured immediately:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test-nagios-config&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;nagios3 --verify-config&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">subscribes</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;template[/etc/nagios3/configures-nagios.conf]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reload a service using a template</strong></p>
<p>To reload a service based on a template, use the <strong>template</strong> and <strong>service</strong> resources together in the same recipe, similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
<span class="k">end</span>

<span class="n">service</span> <span class="s1">&#39;apache&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
  <span class="n">subscribes</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;template[/tmp/somefile]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">subscribes</span></tt> notification is used to reload the service using the template specified by the <strong>template</strong> resource.</p>
<p><strong>Stash a file in a data bag</strong></p>
<p>The following example shows how to use the <strong>ruby_block</strong> resource to stash a BitTorrent file in a data bag so that it can be distributed to nodes in the organization.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``seed`` recipe</span>
<span class="c1"># in the following cookbook: https://github.com/mattray/bittorrent-cookbook</span>

<span class="n">ruby_block</span> <span class="s1">&#39;share the torrent file&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;bittorrent&#39;</span><span class="o">][</span><span class="s1">&#39;torrent&#39;</span><span class="o">]</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="c1">#read the .torrent file and base64 encode it</span>
    <span class="n">enc</span> <span class="o">=</span> <span class="no">Base64</span><span class="o">.</span><span class="n">encode64</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;id&#39;</span><span class="o">=&gt;</span><span class="n">bittorrent_item_id</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;bittorrent&#39;</span><span class="o">][</span><span class="s1">&#39;file&#39;</span><span class="o">]</span><span class="p">),</span>
      <span class="s1">&#39;seed&#39;</span><span class="o">=&gt;</span><span class="n">node</span><span class="o">.</span><span class="n">ipaddress</span><span class="p">,</span>
      <span class="s1">&#39;torrent&#39;</span><span class="o">=&gt;</span><span class="n">enc</span>
    <span class="p">}</span>
    <span class="n">item</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">DataBagItem</span><span class="o">.</span><span class="n">new</span>
    <span class="n">item</span><span class="o">.</span><span class="n">data_bag</span><span class="p">(</span><span class="s1">&#39;bittorrent&#39;</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">subscribes</span> <span class="ss">:create</span><span class="p">,</span> <span class="s2">&quot;bittorrent_torrent[</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;bittorrent&#39;</span><span class="o">][</span><span class="s1">&#39;torrent&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Relative Paths</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;HOME&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/chef-getting-started.txt&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;chef-getting-started.txt.erb&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="apt-package">
<h2>apt_package<a class="headerlink" href="#apt-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>apt_package</strong> resource to manage packages for the Debian and Ubuntu platforms.</p>
<p><strong>Install a package using package manager</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package using local file</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_package</span> <span class="s1">&#39;jwhois&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">source</span> <span class="s1">&#39;/path/to/jwhois.deb&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install without using recommend packages as a dependency</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;apache2&#39;</span> <span class="k">do</span>
  <span class="n">options</span> <span class="s1">&#39;--no-install-recommends&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="apt-update">
<h2>apt_update<a class="headerlink" href="#apt-update" title="Permalink to this headline"></a></h2>
<p>Use the <strong>apt_update</strong> resource to manage Apt repository updates on Debian and Ubuntu platforms.</p>
<p><strong>Update the Apt repository at a specified interval</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_update</span> <span class="s1">&#39;all platforms&#39;</span> <span class="k">do</span>
  <span class="n">frequency</span> <span class="mi">86400</span>
  <span class="n">action</span> <span class="ss">:periodic</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Update the Apt repository at the start of a chef-client run</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_update</span> <span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform_family&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;debian&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:update</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="bash">
<h2>bash<a class="headerlink" href="#bash" title="Permalink to this headline"></a></h2>
<p>Use the <strong>bash</strong> resource to execute scripts using the Bash interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>bash</strong> script resource (which is based on the <strong>script</strong> resource) is different from the <strong>ruby_block</strong> resource because Ruby code that is run with this resource is created as a temporary file and executed like other script resources, rather than run inline.</p>
</div>
<p><strong>Use a named provider to run a script</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;install_something&#39;</span> <span class="k">do</span>
  <span class="n">user</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">cwd</span> <span class="s1">&#39;/tmp&#39;</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  wget http://www.example.com/tarball.tar.gz</span>
<span class="sh">  tar -zxf tarball.tar.gz</span>
<span class="sh">  cd tarball</span>
<span class="sh">  ./configure</span>
<span class="sh">  make</span>
<span class="sh">  make install</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a file from a remote location using bash</strong></p>
<p>The following is an example of how to install the <tt class="docutils literal"><span class="pre">foo123</span></tt> module for Nginx. This module adds shell-style functionality to an Nginx configuration file and does the following:</p>
<ul class="simple">
<li>Declares three variables</li>
<li>Gets the Nginx file from a remote location</li>
<li>Installs the file using Bash to the path specified by the <tt class="docutils literal"><span class="pre">src_filepath</span></tt> variable</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample is similar to the ``upload_progress_module``</span>
<span class="c1"># recipe in the ``nginx`` cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/nginx</span>

<span class="n">src_filename</span> <span class="o">=</span> <span class="s2">&quot;foo123-nginx-module-v</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">.tar.gz&quot;</span>
<span class="n">src_filepath</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">src_filename</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">extract_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span>
  <span class="si">}</span><span class="s2">/nginx_foo123_module/</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s1">&#39;src_filepath&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;extract_module&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    mkdir -p #{extract_path}</span>
<span class="sh">    tar xzf #{src_filename} -C #{extract_path}</span>
<span class="sh">    mv #{extract_path}/*/* #{extract_path}/</span>
<span class="no">    EOH</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install an application from git using bash</strong></p>
<p>The following example shows how Bash can be used to install a plug-in for rbenv named <tt class="docutils literal"><span class="pre">ruby-build</span></tt>, which is located in git version source control. First, the application is synchronized, and then Bash changes its working directory to the location in which <tt class="docutils literal"><span class="pre">ruby-build</span></tt> is located, and then runs a command.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span> <span class="n">git</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/ruby-build&quot;</span> <span class="k">do</span>
   <span class="n">repository</span> <span class="s1">&#39;git://github.com/sstephenson/ruby-build.git&#39;</span>
   <span class="n">reference</span> <span class="s1">&#39;master&#39;</span>
   <span class="n">action</span> <span class="ss">:sync</span>
 <span class="k">end</span>

 <span class="n">bash</span> <span class="s1">&#39;install_ruby_build&#39;</span> <span class="k">do</span>
   <span class="n">cwd</span> <span class="s1">&#39;#{Chef::Config[:file_cache_path]}/ruby-build&#39;</span>
   <span class="n">user</span> <span class="s1">&#39;rbenv&#39;</span>
   <span class="n">group</span> <span class="s1">&#39;rbenv&#39;</span>
   <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">     ./install.sh</span>
<span class="no">     EOH</span>
   <span class="n">environment</span> <span class="s1">&#39;PREFIX&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/local&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>To read more about <tt class="docutils literal"><span class="pre">ruby-build</span></tt>, see here: <a class="reference external" href="https://github.com/sstephenson/ruby-build">https://github.com/sstephenson/ruby-build</a>.</p>
<p><strong>Store certain settings</strong></p>
<p>The following recipe shows how an attributes file can be used to store certain settings. An attributes file is located in the <tt class="docutils literal"><span class="pre">attributes/</span></tt> directory in the same cookbook as the recipe which calls the attributes file. In this example, the attributes file specifies certain settings for Python that are then used across all nodes against which this recipe will run.</p>
<p>Python packages have versions, installation directories, URLs, and checksum files. An attributes file that exists to support this type of recipe would include settings like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;2.7.1&#39;</span>

<span class="k">if</span> <span class="n">python</span><span class="o">[</span><span class="s1">&#39;install_method&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;package&#39;</span>
  <span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/usr&#39;</span>
<span class="k">else</span>
  <span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/usr/local&#39;</span>
<span class="k">end</span>

<span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;http://www.python.org/ftp/python&#39;</span>
<span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;80e387...85fd61&#39;</span>
</pre></div>
</div>
<p>and then the methods in the recipe may refer to these values. A recipe that is used to install Python will need to do the following:</p>
<ul class="simple">
<li>Identify each package to be installed (implied in this example, not shown)</li>
<li>Define variables for the package <tt class="docutils literal"><span class="pre">version</span></tt> and the <tt class="docutils literal"><span class="pre">install_path</span></tt></li>
<li>Get the package from a remote location, but only if the package does not already exist on the target system</li>
<li>Use the <strong>bash</strong> resource to install the package on the node, but only when the package is not already installed</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#  the following code sample comes from the ``oc-nginx`` cookbook on |github|: https://github.com/cookbooks/oc-nginx</span>

<span class="n">version</span> <span class="o">=</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="n">install_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/lib/python</span><span class="si">#{</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/(^\d+\.\d+)/</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/Python-</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">.tar.bz2&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">/Python-</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">.tar.bz2&quot;</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">install_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;build-and-install-python&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span>
<span class="sh">    tar -jxvf Python-#{version}.tar.bz2</span>
<span class="sh">    (cd Python-#{version} &amp;&amp; ./configure #{configure_options})</span>
<span class="sh">    (cd Python-#{version} &amp;&amp; make &amp;&amp; make install)</span>
<span class="no">  EOF</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">install_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="batch">
<h2>batch<a class="headerlink" href="#batch" title="Permalink to this headline"></a></h2>
<p>Use the <strong>batch</strong> resource to execute a batch script using the cmd.exe interpreter. The <strong>batch</strong> resource creates and executes a temporary file (similar to how the <strong>script</strong> resource behaves), rather than running the command inline. This resource inherits actions (<tt class="docutils literal"><span class="pre">:run</span></tt> and <tt class="docutils literal"><span class="pre">:nothing</span></tt>) and properties (<tt class="docutils literal"><span class="pre">creates</span></tt>, <tt class="docutils literal"><span class="pre">cwd</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">user</span></tt>) from the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<p><strong>Unzip a file, and then move it</strong></p>
<p>To run a batch file that unzips and then moves Ruby, do something like:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="s1">&#39;unzip_and_move_ruby&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    7z.exe x #{Chef::Config[:file_cache_path]}/ruby-1.8.7-p352-i386-mingw32.7z</span>
<span class="sh">      -oC:\\source -r -y</span>
<span class="sh">    xcopy C:\\source\\ruby-1.8.7-p352-i386-mingw32 C:\\ruby /e /y</span>
<span class="no">    EOH</span>
<span class="k">end</span>

<span class="n">batch</span> <span class="s1">&#39;echo some env vars&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    echo %TEMP%</span>
<span class="sh">    echo %SYSTEMDRIVE%</span>
<span class="sh">    echo %PATH%</span>
<span class="sh">    echo %WINDIR%</span>
<span class="no">    EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="s1">&#39;unzip_and_move_ruby&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    7z.exe x #{Chef::Config[:file_cache_path]}/ruby-1.8.7-p352-i386-mingw32.7z</span>
<span class="sh">      -oC:\\source -r -y</span>
<span class="sh">    xcopy C:\\source\\ruby-1.8.7-p352-i386-mingw32 C:\\ruby /e /y</span>
<span class="no">    EOH</span>
<span class="k">end</span>

<span class="n">batch</span> <span class="s1">&#39;echo some env vars&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="s1">&#39;echo %TEMP%\\necho %SYSTEMDRIVE%\\necho %PATH%\\necho %WINDIR%&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="bff-package">
<h2>bff_package<a class="headerlink" href="#bff-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>bff_package</strong> resource to manage packages for the AIX platform using the installp utility. When a package is installed from a local file, it must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A Backup File Format (BFF) package may not have a <tt class="docutils literal"><span class="pre">.bff</span></tt> file extension. The chef-client will still identify the correct provider to use based on the platform, regardless of the file extension.</p>
</div>
<p><strong>Install a package</strong></p>
<p>The <strong>bff_package</strong> resource is the default package provider on the AIX platform. The base <strong>package</strong> resource may be used, and then when the platform is AIX, the chef-client will identify the correct package provider. The following examples show how to install part of the IBM XL C/C++ compiler.</p>
<p>Using the base <strong>package</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;xlccmp.13.1.0&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;/var/tmp/IBM_XL_C_13.1.0/usr/sys/inst.images/xlccmp.13.1.0&#39;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Using the <strong>bff_package</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bff_package</span> <span class="s1">&#39;xlccmp.13.1.0&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;/var/tmp/IBM_XL_C_13.1.0/usr/sys/inst.images/xlccmp.13.1.0&#39;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="breakpoint">
<h2>breakpoint<a class="headerlink" href="#breakpoint" title="Permalink to this headline"></a></h2>
<p>Use the <strong>breakpoint</strong> resource to add breakpoints to recipes. Run the chef-shell in chef-client mode, and then use those breakpoints to debug recipes. Breakpoints are ignored by the chef-client during an actual chef-client run. That said, breakpoints are typically used to debug recipes only when running them in a non-production environment, after which they are removed from those recipes before the parent cookbook is uploaded to the Chef server.</p>
<p><strong>A recipe without a breakpoint</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_key</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">url</span>  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;key_url&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:add</span>
<span class="k">end</span>

<span class="n">yum_repository</span> <span class="s1">&#39;elrepo&#39;</span> <span class="k">do</span>
  <span class="n">description</span> <span class="s1">&#39;ELRepo.org Community Enterprise Linux Extras Repository&#39;</span>
  <span class="n">key</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">]</span>
  <span class="n">mirrorlist</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">includepkgs</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;includepkgs&#39;</span><span class="o">]</span>
  <span class="n">exclude</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;exclude&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>The same recipe with breakpoints</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">breakpoint</span> <span class="s2">&quot;before yum_key node[&#39;yum&#39;][&#39;repo_name&#39;][&#39;key&#39;]&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>

<span class="n">yum_key</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">url</span>  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;key_url&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:add</span>
<span class="k">end</span>

<span class="n">breakpoint</span> <span class="s2">&quot;after yum_key node[&#39;yum&#39;][&#39;repo_name&#39;][&#39;key&#39;]&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>

<span class="n">breakpoint</span> <span class="s2">&quot;before yum_repository &#39;repo_name&#39;&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>

<span class="n">yum_repository</span> <span class="s1">&#39;repo_name&#39;</span> <span class="k">do</span>
  <span class="n">description</span> <span class="s1">&#39;description&#39;</span>
  <span class="n">key</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">]</span>
  <span class="n">mirrorlist</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">includepkgs</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;includepkgs&#39;</span><span class="o">]</span>
  <span class="n">exclude</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;exclude&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>

<span class="n">breakpoint</span> <span class="s2">&quot;after yum_repository &#39;repo_name&#39;&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the name of each breakpoint is an arbitrary string. In the previous examples, the names are used to indicate if the breakpoint is before or after a resource, and then also to specify which resource.</p>
</div>
<div class="section" id="chef-gem">
<h2>chef_gem<a class="headerlink" href="#chef-gem" title="Permalink to this headline"></a></h2>
<p>Use the <strong>chef_gem</strong> resource to install a gem only for the instance of Ruby that is dedicated to the chef-client. When a gem is installed from a local file, it must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p>
<p>The <strong>chef_gem</strong> resource works with all of the same properties and options as the <strong>gem_package</strong> resource, but does not accept the <tt class="docutils literal"><span class="pre">gem_binary</span></tt> property because it always uses the <tt class="docutils literal"><span class="pre">CurrentGemEnvironment</span></tt> under which the chef-client is running. In addition to performing actions similar to the <strong>gem_package</strong> resource, the <strong>chef_gem</strong> resource does the following:</p>
<ul class="simple">
<li>Runs its actions immediately, before convergence, allowing a gem to be used in a recipe immediately after it is installed</li>
<li>Runs <tt class="docutils literal"><span class="pre">Gem.clear_paths</span></tt> after the action, ensuring that gem is aware of changes so that it can be required immediately after it is installed</li>
</ul>
<p><strong>Install a gems file for use in recipes</strong></p>
<p>To install a gem while the chef-client is configuring the node (the converge phase), set the <tt class="docutils literal"><span class="pre">compile_time</span></tt> property to <tt class="docutils literal"><span class="pre">false</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_gem</span> <span class="s1">&#39;right_aws&#39;</span> <span class="k">do</span>
  <span class="n">compile_time</span> <span class="kp">false</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p>To install a gem while the resource collection is being built (the compile phase), set the <tt class="docutils literal"><span class="pre">compile_time</span></tt> property to <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_gem</span> <span class="s1">&#39;right_aws&#39;</span> <span class="k">do</span>
  <span class="n">compile_time</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install MySQL for Chef</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;apt-get update&#39;</span> <span class="k">do</span>
  <span class="n">ignore_failure</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span><span class="o">.</span><span class="n">run_action</span><span class="p">(</span><span class="ss">:run</span><span class="p">)</span> <span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform_family&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;debian&#39;</span>

<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="o">[</span><span class="s1">&#39;build_essential&#39;</span><span class="o">][</span><span class="s1">&#39;compiletime&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">include_recipe</span> <span class="s1">&#39;build-essential&#39;</span>
<span class="n">include_recipe</span> <span class="s1">&#39;mysql::client&#39;</span>

<span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;client&#39;</span><span class="o">][</span><span class="s1">&#39;packages&#39;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">mysql_pack</span><span class="o">|</span>
  <span class="n">resources</span><span class="p">(</span><span class="s2">&quot;package[</span><span class="si">#{</span><span class="n">mysql_pack</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">run_action</span><span class="p">(</span><span class="ss">:install</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">chef_gem</span> <span class="s1">&#39;mysql&#39;</span>
</pre></div>
</div>
</div>
<div class="section" id="chef-handler">
<h2>chef_handler<a class="headerlink" href="#chef-handler" title="Permalink to this headline"></a></h2>
<p>Use the <strong>chef_handler</strong> resource to enable handlers during a chef-client run. The resource allows arguments to be passed to the chef-client, which then applies the conditions defined by the custom handler to the node attribute data collected during the chef-client run, and then processes the handler based on that data.</p>
<p>The <strong>chef_handler</strong> resource is typically defined early in a node&#8217;s run-list (often being the first item). This ensures that all of the handlers will be available for the entire chef-client run.</p>
<p>The <strong>chef_handler</strong> resource <a class="reference external" href="https://github.com/chef-cookbooks/chef_handler">is included with the chef_handler cookbook</a>. This cookbook defines the the resource itself and also provides the location in which the chef-client looks for custom handlers. All custom handlers should be added to the <tt class="docutils literal"><span class="pre">files/default/handlers</span></tt> directory in the <strong>chef_handler</strong> cookbook.</p>
<p><strong>Enable the CloudkickHandler handler</strong></p>
<p>The following example shows how to enable the <tt class="docutils literal"><span class="pre">CloudkickHandler</span></tt> handler, which adds it to the default handler path and passes the <tt class="docutils literal"><span class="pre">oauth</span></tt> key/secret to the handler&#8217;s initializer:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s2">&quot;CloudkickHandler&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_handler&#39;</span><span class="o">][</span><span class="s1">&#39;handler_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/cloudkick_handler.rb&quot;</span>
  <span class="n">arguments</span> <span class="o">[</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;cloudkick&#39;</span><span class="o">][</span><span class="s1">&#39;oauth_key&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;cloudkick&#39;</span><span class="o">][</span><span class="s1">&#39;oauth_secret&#39;</span><span class="o">]]</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Enable handlers during the compile phase</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s2">&quot;Chef::Handler::JsonFile&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;chef/handler/json_file&quot;</span>
  <span class="n">arguments</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/chef/reports&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span><span class="o">.</span><span class="n">run_action</span><span class="p">(</span><span class="ss">:enable</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Handle only exceptions</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s2">&quot;Chef::Handler::JsonFile&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;chef/handler/json_file&quot;</span>
  <span class="n">arguments</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/chef/reports&#39;</span>
  <span class="n">supports</span> <span class="ss">:exception</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Cookbook Versions (a custom handler)</strong></p>
<p>Community member <tt class="docutils literal"><span class="pre">juliandunn</span></tt> created a custom <a class="reference external" href="https://github.com/juliandunn/cookbook_versions_handler">report handler that logs all of the cookbooks and cookbook versions</a> that were used during the chef-client run, and then reports after the run is complete. This handler requires the <strong>chef_handler</strong> resource (which is available from the <strong>chef_handler</strong> cookbook).</p>
<p>cookbook_versions.rb:</p>
<p>The following custom handler defines how cookbooks and cookbook versions that are used during the chef-client run will be compiled into a report using the <tt class="docutils literal"><span class="pre">Chef::Log</span></tt> class in the chef-client:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;chef/log&#39;</span>

<span class="k">module</span> <span class="nn">Opscode</span>
  <span class="k">class</span> <span class="nc">CookbookVersionsHandler</span> <span class="o">&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span>

    <span class="k">def</span> <span class="nf">report</span>
      <span class="n">cookbooks</span> <span class="o">=</span> <span class="n">run_context</span><span class="o">.</span><span class="n">cookbook_collection</span>
      <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Cookbooks and versions run: #{cookbooks.keys.map {|x| cookbooks[x].name.to_s + &#39;</span> <span class="s1">&#39; + cookbooks[x].version} }&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>default.rb:</p>
<p>The following recipe is added to the run-list for every node on which a list of cookbooks and versions will be generated as report output after every chef-client run.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">include_recipe</span> <span class="s1">&#39;chef_handler&#39;</span>

<span class="n">cookbook_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_handler&#39;</span><span class="o">][</span><span class="s1">&#39;handler_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/cookbook_versions.rb&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;cookbook_versions.rb&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>

<span class="n">chef_handler</span> <span class="s1">&#39;Opscode::CookbookVersionsHandler&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_handler&#39;</span><span class="o">][</span><span class="s1">&#39;handler_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/cookbook_versions.rb&quot;</span>
  <span class="n">supports</span> <span class="ss">:report</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This recipe will generate report output similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="o">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">26</span><span class="ss">T03</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mo">06</span><span class="o">+</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="o">]</span> <span class="ss">INFO</span><span class="p">:</span> <span class="no">Chef</span> <span class="no">Run</span> <span class="n">complete</span> <span class="k">in</span> <span class="mi">0</span><span class="o">.</span><span class="mi">300029878</span> <span class="n">seconds</span>
<span class="o">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">26</span><span class="ss">T03</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mo">06</span><span class="o">+</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="o">]</span> <span class="ss">INFO</span><span class="p">:</span> <span class="no">Running</span> <span class="n">report</span> <span class="n">handlers</span>
<span class="o">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">26</span><span class="ss">T03</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mo">06</span><span class="o">+</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="o">]</span> <span class="ss">INFO</span><span class="p">:</span> <span class="no">Cookbooks</span> <span class="ow">and</span> <span class="n">versions</span> <span class="ss">run</span><span class="p">:</span> <span class="o">[</span><span class="s2">&quot;chef_handler 1.1.4&quot;</span><span class="p">,</span> <span class="s2">&quot;cookbook_versions_handler 1.0.0&quot;</span><span class="o">]</span>
<span class="o">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">26</span><span class="ss">T03</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mo">06</span><span class="o">+</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="o">]</span> <span class="ss">INFO</span><span class="p">:</span> <span class="no">Report</span> <span class="n">handlers</span> <span class="n">complete</span>
</pre></div>
</div>
<p><strong>JsonFile Handler</strong></p>
<p>The <a class="reference external" href="https://github.com/chef/chef/blob/master/lib/chef/handler/json_file.rb">json_file</a> handler is available from the <strong>chef_handler</strong> cookbook and can be used with exceptions and reports. It serializes run status data to a JSON file. This handler may be enabled in one of the following ways.</p>
<p>By adding the following lines of Ruby code to either the client.rb file or the solo.rb file, depending on how the chef-client is being run:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;chef/handler/json_file&#39;</span>
<span class="n">report_handlers</span> <span class="o">&lt;&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span><span class="o">::</span><span class="no">JsonFile</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/chef/reports&#39;</span><span class="p">)</span>
<span class="n">exception_handlers</span> <span class="o">&lt;&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span><span class="o">::</span><span class="no">JsonFile</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/chef/reports&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>By using the <strong>chef_handler</strong> resource in a recipe, similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s1">&#39;Chef::Handler::JsonFile&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;chef/handler/json_file&#39;</span>
  <span class="n">arguments</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/chef/reports&#39;</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p>After it has run, the run status data can be loaded and inspected via Interactive Ruby (IRb):</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">002</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="nb">require</span> <span class="s1">&#39;json&#39;</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">003</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="nb">require</span> <span class="s1">&#39;chef&#39;</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">004</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">IO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/var/chef/reports/chef-run-report-20110322060731.json&#39;</span><span class="p">))</span> <span class="o">=&gt;</span> <span class="o">...</span> <span class="n">output</span> <span class="n">truncated</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">005</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">keys</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_resources&#39;</span><span class="p">,</span> <span class="s1">&#39;exception&#39;</span><span class="p">,</span> <span class="s1">&#39;all_resources&#39;</span><span class="p">,</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;elapsed_time&#39;</span><span class="p">,</span> <span class="s1">&#39;start_time&#39;</span><span class="p">,</span> <span class="s1">&#39;backtrace&#39;</span><span class="o">]</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">006</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">r</span><span class="o">[</span><span class="s1">&#39;elapsed_time&#39;</span><span class="o">]</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="mo">00246</span>
</pre></div>
</div>
<p><strong>Register the JsonFile handler</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s2">&quot;Chef::Handler::JsonFile&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;chef/handler/json_file&quot;</span>
  <span class="n">arguments</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/chef/reports&#39;</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>ErrorReport Handler</strong></p>
<p>The <a class="reference external" href="https://github.com/chef/chef/blob/master/lib/chef/handler/error_report.rb">error_report</a> handler is built into the chef-client and can be used for both exceptions and reports. It serializes error report data to a JSON file. This handler may be enabled in one of the following ways.</p>
<p>By adding the following lines of Ruby code to either the client.rb file or the solo.rb file, depending on how the chef-client is being run:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;chef/handler/error_report&#39;</span>
<span class="n">report_handlers</span> <span class="o">&lt;&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span><span class="o">::</span><span class="no">ErrorReport</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
<span class="n">exception_handlers</span> <span class="o">&lt;&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span><span class="o">::</span><span class="no">ErrorReport</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
</pre></div>
</div>
<p>By using the <a class="reference external" href="https://docs.chef.io/resource_chef_handler.html">chef_handler</a> resource in a recipe, similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s1">&#39;Chef::Handler::ErrorReport&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;chef/handler/error_report&#39;</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="chocolatey-package">
<h2>chocolatey_package<a class="headerlink" href="#chocolatey-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>chocolatey_package</strong> resource to manage packages using Chocolatey for the Microsoft Windows platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chocolatey_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="cookbook-file">
<h2>cookbook_file<a class="headerlink" href="#cookbook-file" title="Permalink to this headline"></a></h2>
<p>Use the <strong>cookbook_file</strong> resource to transfer files from a sub-directory of <tt class="docutils literal"><span class="pre">COOKBOOK_NAME/files/</span></tt> to a specified path located on a host that is running the chef-client. The file is selected according to file specificity, which allows different source files to be used based on the hostname, host platform (operating system, distro, or as appropriate), or platform version. Files that are located in the <tt class="docutils literal"><span class="pre">COOKBOOK_NAME/files/default</span></tt> sub-directory may be used on any platform.</p>
<p><strong>Transfer a file</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;file.txt&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Handle cookbook_file and yum_package resources in the same recipe</strong></p>
<p>When a <strong>cookbook_file</strong> resource and a <strong>yum_package</strong> resource are both called from within the same recipe, use the <tt class="docutils literal"><span class="pre">flush_cache</span></tt> attribute to dump the in-memory Yum cache, and then use the repository immediately to ensure that the correct package is installed:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;/etc/yum.repos.d/custom.repo&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;custom&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">yum_package</span> <span class="s1">&#39;only-in-custom-repo&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">flush_cache</span> <span class="o">[</span> <span class="ss">:before</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install repositories from a file, trigger a command, and force the internal cache to reload</strong></p>
<p>The following example shows how to install new Yum repositories from a file, where the installation of the repository triggers a creation of the Yum cache that forces the internal cache for the chef-client to reload:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;create-yum-cache&#39;</span> <span class="k">do</span>
 <span class="n">command</span> <span class="s1">&#39;yum -q makecache&#39;</span>
 <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;reload-internal-yum-cache&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Yum</span><span class="o">::</span><span class="no">YumCache</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">reload</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">cookbook_file</span> <span class="s1">&#39;/etc/yum.repos.d/custom.repo&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;custom&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[create-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload-internal-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a case statement</strong></p>
<p>The following example shows how a case statement can be used to handle a situation where an application needs to be installed on multiple platforms, but where the install directories are different paths, depending on the platform:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;application.pm&#39;</span> <span class="k">do</span>
  <span class="n">path</span> <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span>
    <span class="k">when</span> <span class="s1">&#39;centos&#39;</span><span class="p">,</span><span class="s1">&#39;redhat&#39;</span>
      <span class="s1">&#39;/usr/lib/version/1.2.3/dir/application.pm&#39;</span>
    <span class="k">when</span> <span class="s1">&#39;arch&#39;</span>
      <span class="s1">&#39;/usr/share/version/core_version/dir/application.pm&#39;</span>
    <span class="k">else</span>
      <span class="s1">&#39;/etc/version/dir/application.pm&#39;</span>
    <span class="k">end</span>
  <span class="n">source</span> <span class="s2">&quot;application-</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;languages&#39;</span><span class="o">][</span><span class="s1">&#39;perl&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">.pm&quot;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Manage dotfiles</strong></p>
<p>The following example shows using the <strong>directory</strong> and <strong>cookbook_file</strong> resources to manage dotfiles. The dotfiles are defined by a JSON data structure similar to:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="s2">&quot;files&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;.zshrc&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;mode&quot;</span><span class="o">:</span> <span class="s1">&#39;0755&#39;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;dot-zshrc&quot;</span>
    <span class="p">},</span>
  <span class="s2">&quot;.bashrc&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;mode&quot;</span><span class="o">:</span> <span class="s1">&#39;0755&#39;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;dot-bashrc&quot;</span>
     <span class="p">},</span>
  <span class="s2">&quot;.bash_profile&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;mode&quot;</span><span class="o">:</span> <span class="s1">&#39;0755&#39;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;dot-bash_profile&quot;</span>
    <span class="p">},</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>and then the following resources manage the dotfiles:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">has_key?</span><span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">)</span>
  <span class="n">u</span><span class="o">[</span><span class="s1">&#39;files&#39;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">filename</span><span class="p">,</span> <span class="n">file_data</span><span class="o">|</span>

  <span class="n">directory</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">home_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">recursive</span> <span class="kp">true</span>
    <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="k">end</span> <span class="k">if</span> <span class="n">file_data</span><span class="o">[</span><span class="s1">&#39;subdir&#39;</span><span class="o">]</span>

  <span class="n">cookbook_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">home_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">file_data</span><span class="o">[</span><span class="s1">&#39;source&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">owner</span> <span class="s1">&#39;u[&#39;</span><span class="nb">id</span><span class="s1">&#39;]&#39;</span>
    <span class="n">group</span> <span class="s1">&#39;group_id&#39;</span>
    <span class="n">mode</span> <span class="s1">&#39;file_data[&#39;</span><span class="n">mode</span><span class="s1">&#39;]&#39;</span>
    <span class="n">ignore_failure</span> <span class="kp">true</span>
    <span class="n">backup</span> <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="cron">
<h2>cron<a class="headerlink" href="#cron" title="Permalink to this headline"></a></h2>
<p>Use the <strong>cron</strong> resource to manage cron entries for time-based job scheduling. Properties for a schedule will default to <tt class="docutils literal"><span class="pre">*</span></tt> if not provided. The <strong>cron</strong> resource requires access to a crontab program, typically cron.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>cron</strong> resource should only be used to modify an entry in a crontab file. Use the <strong>cookbook_file</strong> or <strong>template</strong> resources to add a crontab file to the cron.d directory. The <tt class="docutils literal"><span class="pre">cron_d</span></tt> lightweight resource (found in the <a class="reference external" href="https://github.com/chef-cookbooks/cron">cron</a> cookbook) is another option for managing crontab files.</p>
</div>
<p><strong>Run a program at a specified interval</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cron</span> <span class="s1">&#39;noop&#39;</span> <span class="k">do</span>
  <span class="n">hour</span> <span class="s1">&#39;5&#39;</span>
  <span class="n">minute</span> <span class="s1">&#39;0&#39;</span>
  <span class="n">command</span> <span class="s1">&#39;/bin/true&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run an entry if a folder exists</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cron</span> <span class="s1">&#39;ganglia_tomcat_thread_max&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s2">&quot;/usr/bin/gmetric</span>
<span class="s2">    -n &#39;tomcat threads max&#39;</span>
<span class="s2">    -t uint32</span>
<span class="s2">    -v &#39;/usr/local/bin/tomcat-stat</span>
<span class="s2">    --thread-max&#39;&quot;</span>
  <span class="n">only_if</span> <span class="k">do</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/home/jboss&#39;</span><span class="p">)</span> <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run every Saturday, 8:00 AM</strong></p>
<p>The following example shows a schedule that will run every hour at 8:00 each Saturday morning, and will then send an email to &#8220;<a class="reference external" href="mailto:admin&#37;&#52;&#48;example&#46;com">admin<span>&#64;</span>example<span>&#46;</span>com</a>&#8221; after each run.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cron</span> <span class="s1">&#39;name_of_cron_entry&#39;</span> <span class="k">do</span>
  <span class="n">minute</span> <span class="s1">&#39;0&#39;</span>
  <span class="n">hour</span> <span class="s1">&#39;8&#39;</span>
  <span class="n">weekday</span> <span class="s1">&#39;6&#39;</span>
  <span class="n">mailto</span> <span class="s1">&#39;admin@example.com&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run only in November</strong></p>
<p>The following example shows a schedule that will run at 8:00 PM, every weekday (Monday through Friday), but only in November:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cron</span> <span class="s1">&#39;name_of_cron_entry&#39;</span> <span class="k">do</span>
  <span class="n">minute</span> <span class="s1">&#39;0&#39;</span>
  <span class="n">hour</span> <span class="s1">&#39;20&#39;</span>
  <span class="n">day</span> <span class="s1">&#39;*&#39;</span>
  <span class="n">month</span> <span class="s1">&#39;11&#39;</span>
  <span class="n">weekday</span> <span class="s1">&#39;1-5&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="csh">
<h2>csh<a class="headerlink" href="#csh" title="Permalink to this headline"></a></h2>
<p>Use the <strong>csh</strong> resource to execute scripts using the csh interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>csh</strong> script resource (which is based on the <strong>script</strong> resource) is different from the <strong>ruby_block</strong> resource because Ruby code that is run with this resource is created as a temporary file and executed like other script resources, rather than run inline.</p>
</div>
<p>No examples.</p>
</div>
<div class="section" id="deploy">
<h2>deploy<a class="headerlink" href="#deploy" title="Permalink to this headline"></a></h2>
<p>Use the <strong>deploy</strong> resource to manage and control deployments. This is a popular resource, but is also complex, having the most properties, multiple providers, the added complexity of callbacks, plus four attributes that support layout modifications from within a recipe.</p>
<p><strong>Modify the layout of a Ruby on Rails application</strong></p>
<p>The layout of the <strong>deploy</strong> resource matches a Ruby on Rails app by default, but this can be customized. To customize the layout, do something like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;/my/apps/dir/deploy&#39;</span> <span class="k">do</span>
  <span class="c1"># Use a local repo if you prefer</span>
  <span class="n">repo</span> <span class="s1">&#39;/path/to/gitrepo/typo/&#39;</span>
  <span class="n">environment</span> <span class="s1">&#39;RAILS_ENV&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;production&#39;</span>
  <span class="n">revision</span> <span class="s1">&#39;HEAD&#39;</span>
  <span class="n">action</span> <span class="ss">:deploy</span>
  <span class="n">migration_command</span> <span class="s1">&#39;rake db:migrate --trace&#39;</span>
  <span class="n">migrate</span> <span class="kp">true</span>
  <span class="n">restart_command</span> <span class="s1">&#39;touch tmp/restart.txt&#39;</span>
  <span class="n">create_dirs_before_symlink</span>  <span class="sx">%w{tmp public config deploy}</span>

  <span class="c1"># You can use this to customize if your app has extra configuration files</span>
  <span class="c1"># such as amqp.yml or app_config.yml</span>
  <span class="n">symlink_before_migrate</span>  <span class="s1">&#39;config/database.yml&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;config/database.yml&#39;</span>

  <span class="c1"># If your app has extra files in the shared folder, specify them here</span>
  <span class="n">symlinks</span>  <span class="s1">&#39;system&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;public/system&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pids&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;tmp/pids&#39;</span><span class="p">,</span>
            <span class="s1">&#39;log&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span>
            <span class="s1">&#39;deploy/before_migrate.rb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;deploy/before_migrate.rb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;deploy/before_symlink.rb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;deploy/before_symlink.rb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;deploy/before_restart.rb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;deploy/before_restart.rb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;deploy/after_restart.rb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;deploy/after_restart.rb&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use resources within callbacks</strong></p>
<p>Using resources from within your callbacks as blocks or within callback files distributed with your application&#8217;s source code. To use embedded recipes for callbacks:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;tmpdir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/deploy&quot;</span> <span class="k">do</span>
  <span class="n">repo</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;tmpdir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/gitrepo/typo/&quot;</span>
  <span class="n">environment</span> <span class="s1">&#39;RAILS_ENV&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;production&#39;</span>
  <span class="n">revision</span> <span class="s1">&#39;HEAD&#39;</span>
  <span class="n">action</span> <span class="ss">:deploy</span>
  <span class="n">migration_command</span> <span class="s1">&#39;rake db:migrate --trace&#39;</span>
  <span class="n">migrate</span> <span class="kp">true</span>

  <span class="c1"># Callback awesomeness:</span>
  <span class="n">before_migrate</span> <span class="k">do</span>
    <span class="n">current_release</span> <span class="o">=</span> <span class="n">release_path</span>

    <span class="n">directory</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">current_release</span><span class="si">}</span><span class="s2">/deploy&quot;</span> <span class="k">do</span>
      <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
    <span class="k">end</span>

    <span class="c1"># creates a callback for before_symlink</span>
    <span class="n">template</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">current_release</span><span class="si">}</span><span class="s2">/deploy/before_symlink_callback.rb&quot;</span> <span class="k">do</span>
      <span class="n">source</span> <span class="s1">&#39;embedded_recipe_before_symlink.rb.erb&#39;</span>
      <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
    <span class="k">end</span>

  <span class="k">end</span>

  <span class="c1"># This file can contain Chef recipe code, plain ruby also works</span>
  <span class="n">before_symlink</span> <span class="s1">&#39;deploy/before_symlink_callback.rb&#39;</span>

  <span class="n">restart</span> <span class="k">do</span>
    <span class="n">current_release</span> <span class="o">=</span> <span class="n">release_path</span>
    <span class="n">file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">/tmp/restart.txt&quot;</span> <span class="k">do</span>
      <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div>
<p><strong>Deploy from a private git repository without using the application cookbook</strong></p>
<p>To deploy from a private git repository without using the <tt class="docutils literal"><span class="pre">application</span></tt> cookbook, first ensure that:</p>
<ul class="simple">
<li>the private key does not have a passphrase, as this will pause a chef-client run to wait for input</li>
<li>an SSH wrapper is being used</li>
<li>a private key has been added to the node</li>
</ul>
<p>and then remove a passphrase from a private key by using code similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ssh-keygen -p -P <span class="s1">&#39;PASSPHRASE&#39;</span> -N <span class="s1">&#39;&#39;</span> -f id_deploy
</pre></div>
</div>
<p><strong>Use an SSH wrapper</strong></p>
<p>To write a recipe that uses an SSH wrapper:</p>
<ol class="arabic">
<li><p class="first">Create a file in the <tt class="docutils literal"><span class="pre">cookbooks/COOKBOOK_NAME/files/default</span></tt> directory that is named <tt class="docutils literal"><span class="pre">wrap-ssh4git.sh</span></tt> and which contains the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="sr">/usr/</span><span class="n">bin</span><span class="o">/</span><span class="n">env</span> <span class="n">ssh</span> <span class="o">-</span><span class="n">o</span> <span class="s2">&quot;StrictHostKeyChecking=no&quot;</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;/tmp/private_code/.ssh/id_deploy&quot;</span> <span class="vg">$1</span> <span class="vg">$2</span>
</pre></div>
</div>
</li>
<li><p class="first">Set up the cookbook file.</p>
</li>
<li><p class="first">Add a recipe to the cookbook file similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;/tmp/private_code/.ssh&#39;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;ubuntu&#39;</span>
  <span class="n">recursive</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">cookbook_file</span> <span class="s1">&#39;/tmp/private_code/wrap-ssh4git.sh&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;wrap-ssh4git.sh&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;ubuntu&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">deploy</span> <span class="s1">&#39;private_repo&#39;</span> <span class="k">do</span>
  <span class="n">repo</span> <span class="s1">&#39;git@github.com:acctname/private-repo.git&#39;</span>
  <span class="n">user</span> <span class="s1">&#39;ubuntu&#39;</span>
  <span class="n">deploy_to</span> <span class="s1">&#39;/tmp/private_code&#39;</span>
  <span class="n">action</span> <span class="ss">:deploy</span>
  <span class="n">ssh_wrapper</span> <span class="s1">&#39;/tmp/private_code/wrap-ssh4git.sh&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This will deploy the git repository at <tt class="docutils literal"><span class="pre">git&#64;github.com:acctname/private-repo.git</span></tt> in the <tt class="docutils literal"><span class="pre">/tmp/private_code</span></tt> directory.</p>
</li>
</ol>
<p><strong>Use a callback to include a file that will be passed as a code block</strong></p>
<p>The code in a file that is included in a recipe using a callback is evaluated exactly as if the code had been put in the recipe as a block. Files are searched relative to the current release.</p>
<p>To specify a file that contains code to be used as a block:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;/deploy/dir/&#39;</span> <span class="k">do</span>
  <span class="c1"># ...</span>

  <span class="n">before_migrate</span> <span class="s1">&#39;callbacks/do_this_before_migrate.rb&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a callback to pass a code block</strong></p>
<p>To pass a block of Python code before a migration is run:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy_revision</span> <span class="s1">&#39;/deploy/dir/&#39;</span> <span class="k">do</span>
  <span class="c1"># other attributes</span>
  <span class="c1"># ...</span>

  <span class="n">before_migrate</span> <span class="k">do</span>
    <span class="c1"># release_path is the path to the timestamp dir</span>
    <span class="c1"># for the current release</span>
    <span class="n">current_release</span> <span class="o">=</span> <span class="n">release_path</span>

    <span class="c1"># Create a local variable for the node so we&#39;ll have access to</span>
    <span class="c1"># the attributes</span>
    <span class="n">deploy_node</span> <span class="o">=</span> <span class="n">node</span>

    <span class="c1"># A local variable with the deploy resource.</span>
    <span class="n">deploy_resource</span> <span class="o">=</span> <span class="n">new_resource</span>

    <span class="n">python</span> <span class="k">do</span>
      <span class="n">cwd</span> <span class="n">current_release</span>
      <span class="n">user</span> <span class="s1">&#39;myappuser&#39;</span>
      <span class="n">code</span><span class="o">&lt;&lt;-</span><span class="no">PYCODE</span>
        <span class="c1"># Woah, callbacks in python!</span>
        <span class="c1"># ...</span>
        <span class="c1"># current_release, deploy_node, and deploy_resource are all available</span>
        <span class="c1"># within the deploy hook now.</span>
      <span class="no">PYCODE</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the same API for all recipes using the same gem</strong></p>
<p>Any recipes using the <tt class="docutils literal"><span class="pre">git-deploy</span></tt> gem can continue using the same API. To include this behavior in a recipe, do something like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s2">&quot;/srv/</span><span class="si">#{</span><span class="n">appname</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
  <span class="n">repo</span> <span class="s1">&#39;git://github.com/radiant/radiant.git&#39;</span>
  <span class="n">revision</span> <span class="s1">&#39;HEAD&#39;</span>
  <span class="n">user</span> <span class="s1">&#39;railsdev&#39;</span>
  <span class="n">enable_submodules</span> <span class="kp">false</span>
  <span class="n">migrate</span> <span class="kp">true</span>
  <span class="n">migration_command</span> <span class="s1">&#39;rake db:migrate&#39;</span>
  <span class="c1"># Giving a string for environment sets RAILS_ENV, MERB_ENV, RACK_ENV</span>
  <span class="n">environment</span> <span class="s1">&#39;production&#39;</span>
  <span class="n">shallow_clone</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:deploy</span>
  <span class="n">restart_command</span> <span class="s1">&#39;touch tmp/restart.txt&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Deploy without creating symbolic links to a shared folder</strong></p>
<p>To deploy without creating symbolic links to a shared folder:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;/my/apps/dir/deploy&#39;</span> <span class="k">do</span>
  <span class="n">symlinks</span> <span class="p">{}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>When deploying code that is not Ruby on Rails and symbolic links to a shared folder are not wanted, use parentheses <tt class="docutils literal"><span class="pre">()</span></tt> or <tt class="docutils literal"><span class="pre">Hash.new</span></tt> to avoid ambiguity. For example, using parentheses:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;/my/apps/dir/deploy&#39;</span> <span class="k">do</span>
  <span class="n">symlinks</span><span class="p">({})</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or using <tt class="docutils literal"><span class="pre">Hash.new</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;/my/apps/dir/deploy&#39;</span> <span class="k">do</span>
  <span class="n">symlinks</span> <span class="no">Hash</span><span class="o">.</span><span class="n">new</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Clear a layout modifier attribute</strong></p>
<p>Using the default property values for the various resources is the recommended starting point when working with recipes. Then, depending on what each node requires, these default values can be overridden with node-, role-, environment-, and cookbook-specific values. The <strong>deploy</strong> resource has four layout modifiers: <tt class="docutils literal"><span class="pre">create_dirs_before_symlink</span></tt>, <tt class="docutils literal"><span class="pre">purge_before_symlink</span></tt>, <tt class="docutils literal"><span class="pre">symlink_before_migrate</span></tt>, and <tt class="docutils literal"><span class="pre">symlinks</span></tt>. Each of these is a Hash that behaves as a property of the <strong>deploy</strong> resource. When these layout modifiers are used in a recipe, they appear similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="o">...</span>
  <span class="n">symlink_before_migrate</span>       <span class="p">{</span><span class="s1">&#39;config/database.yml&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;config/database.yml&#39;</span><span class="p">}</span>
  <span class="n">create_dirs_before_symlink</span>   <span class="sx">%w{tmp public config}</span>
  <span class="n">purge_before_symlink</span>         <span class="sx">%w{log tmp/pids public/system}</span>
  <span class="n">symlinks</span>                     <span class="p">{</span> <span class="s1">&#39;system&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;public/system&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;pids&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;tmp/pids&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;log&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;log&#39;</span>
                               <span class="p">}</span>
  <span class="o">...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then what these layout modifiers look like if they were empty:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="o">...</span>
  <span class="n">symlink_before_migrate</span>       <span class="kp">nil</span>
  <span class="n">create_dirs_before_symlink</span>   <span class="o">[]</span>
  <span class="n">purge_before_symlink</span>         <span class="o">[]</span>
  <span class="n">symlinks</span>                     <span class="kp">nil</span>
  <span class="o">...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>In most cases, using the empty values for the layout modifiers will prevent the chef-client from passing symbolic linking information to a node during the chef-client run. However, in some cases, it may be preferable to ensure that one (or more) of these layout modifiers do not pass any symbolic linking information to a node during the chef-client run at all. Because each of these layout modifiers are a Hash, the <tt class="docutils literal"><span class="pre">clear</span></tt> instance method can be used to clear out these values.</p>
<p>To clear the default values for a layout modifier:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="o">...</span>
  <span class="n">symlink_before_migrate</span><span class="o">.</span><span class="n">clear</span>
  <span class="n">create_dirs_before_symlink</span><span class="o">.</span><span class="n">clear</span>
  <span class="n">purge_before_symlink</span><span class="o">.</span><span class="n">clear</span>
  <span class="n">symlinks</span><span class="o">.</span><span class="n">clear</span>
  <span class="o">...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>In general, use this approach carefully and only after it is determined that nil or empty values won&#8217;t provide the expected result.</p>
</div>
<div class="section" id="directory">
<h2>directory<a class="headerlink" href="#directory" title="Permalink to this headline"></a></h2>
<p>Use the <strong>directory</strong> resource to manage a directory, which is a hierarchy of folders that comprises all of the information stored on a computer. The root directory is the top-level, under which the rest of the directory is organized. The <strong>directory</strong> resource uses the <tt class="docutils literal"><span class="pre">name</span></tt> property to specify the path to a location in a directory. Typically, permission to access that location in the directory is required.</p>
<p><strong>Create a directory</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;/tmp/something&#39;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a directory in Microsoft Windows</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">tmp</span><span class="se">\\</span><span class="s2">something.txt&quot;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s2">&quot;DOMAIN</span><span class="se">\\</span><span class="s2">User&quot;</span>
  <span class="n">inherits</span> <span class="kp">false</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\tmp\something.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;DOMAIN\User&#39;</span>
  <span class="n">inherits</span> <span class="kp">false</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The difference between the two previous examples is the single- versus double-quoted strings, where if the double quotes are used, the backslash character (<tt class="docutils literal"><span class="pre">\</span></tt>) must be escaped using the Ruby escape character (which is a backslash).</p>
</div>
<p><strong>Create a directory recursively</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="sx">%w{dir1 dir2 dir3}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
  <span class="n">directory</span> <span class="s2">&quot;/tmp/mydirs/</span><span class="si">#{</span><span class="n">dir</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
    <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
    <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
    <span class="n">action</span> <span class="ss">:create</span>
    <span class="n">recursive</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delete a directory</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;/tmp/something&#39;</span> <span class="k">do</span>
  <span class="n">recursive</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:delete</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set directory permissions using a variable</strong></p>
<p>The following example shows how read/write/execute permissions can be set using a variable named <tt class="docutils literal"><span class="pre">user_home</span></tt>, and then for owners and groups on any matching node:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user_home</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:user</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">directory</span> <span class="n">user_home</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;node[:matching_node][:user]&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;node[:matching_node][:group]&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">matching_node</span></tt> represents a type of node. For example, if the <tt class="docutils literal"><span class="pre">user_home</span></tt> variable specified <tt class="docutils literal"><span class="pre">{node[:nginx]...}</span></tt>, a recipe might look similar to:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user_home</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:nginx</span><span class="o">][</span><span class="ss">:user</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">directory</span> <span class="n">user_home</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;node[:nginx][:user]&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;node[:nginx][:group]&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set directory permissions for a specific type of node</strong></p>
<p>The following example shows how permissions can be set for the <tt class="docutils literal"><span class="pre">/certificates</span></tt> directory on any node that is running Nginx. In this example, permissions are being set for the <tt class="docutils literal"><span class="pre">owner</span></tt> and <tt class="docutils literal"><span class="pre">group</span></tt> properties as <tt class="docutils literal"><span class="pre">root</span></tt>, and then read/write permissions are granted to the root.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:nginx</span><span class="o">][</span><span class="ss">:dir</span><span class="o">]</span><span class="si">}</span><span class="s2">/shared/certificates&quot;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">recursive</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reload the configuration</strong></p>
<p>The following example shows how to reload the configuration of a chef-client using the <strong>remote_file</strong> resource to:</p>
<ul class="simple">
<li>using an if statement to check whether the plugins on a node are the latest versions</li>
<li>identify the location from which Ohai plugins are stored</li>
<li>using the <tt class="docutils literal"><span class="pre">notifies</span></tt> property and a <strong>ruby_block</strong> resource to trigger an update (if required) and to then reload the client.rb file.</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;node[:ohai][:plugin_path]&#39;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;chef&#39;</span>
  <span class="n">recursive</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;reload_config&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;/etc/chef/client.rb&#39;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="ss">:ohai</span><span class="o">].</span><span class="n">key?</span><span class="p">(</span><span class="ss">:plugins</span><span class="p">)</span>
  <span class="n">node</span><span class="o">[</span><span class="ss">:ohai</span><span class="o">][</span><span class="ss">:plugins</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">plugin</span><span class="o">|</span>
    <span class="n">remote_file</span> <span class="n">node</span><span class="o">[</span><span class="ss">:ohai</span><span class="o">][</span><span class="ss">:plugin_path</span><span class="o">]</span> <span class="o">+</span><span class="s2">&quot;/</span><span class="si">#{</span><span class="n">plugin</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
      <span class="n">source</span> <span class="n">plugin</span>
      <span class="n">owner</span> <span class="s1">&#39;chef&#39;</span>
              <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload_config]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Manage dotfiles</strong></p>
<p>The following example shows using the <strong>directory</strong> and <strong>cookbook_file</strong> resources to manage dotfiles. The dotfiles are defined by a JSON data structure similar to:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="s2">&quot;files&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;.zshrc&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;mode&quot;</span><span class="o">:</span> <span class="s1">&#39;0755&#39;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;dot-zshrc&quot;</span>
    <span class="p">},</span>
  <span class="s2">&quot;.bashrc&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;mode&quot;</span><span class="o">:</span> <span class="s1">&#39;0755&#39;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;dot-bashrc&quot;</span>
     <span class="p">},</span>
  <span class="s2">&quot;.bash_profile&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;mode&quot;</span><span class="o">:</span> <span class="s1">&#39;0755&#39;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;dot-bash_profile&quot;</span>
    <span class="p">},</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>and then the following resources manage the dotfiles:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">has_key?</span><span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">)</span>
  <span class="n">u</span><span class="o">[</span><span class="s1">&#39;files&#39;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">filename</span><span class="p">,</span> <span class="n">file_data</span><span class="o">|</span>

  <span class="n">directory</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">home_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">recursive</span> <span class="kp">true</span>
    <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="k">end</span> <span class="k">if</span> <span class="n">file_data</span><span class="o">[</span><span class="s1">&#39;subdir&#39;</span><span class="o">]</span>

  <span class="n">cookbook_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">home_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">file_data</span><span class="o">[</span><span class="s1">&#39;source&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">owner</span> <span class="s1">&#39;u[&#39;</span><span class="nb">id</span><span class="s1">&#39;]&#39;</span>
    <span class="n">group</span> <span class="s1">&#39;group_id&#39;</span>
    <span class="n">mode</span> <span class="s1">&#39;file_data[&#39;</span><span class="n">mode</span><span class="s1">&#39;]&#39;</span>
    <span class="n">ignore_failure</span> <span class="kp">true</span>
    <span class="n">backup</span> <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="dpkg-package">
<h2>dpkg_package<a class="headerlink" href="#dpkg-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>dpkg_package</strong> resource to manage packages for the dpkg platform. When a package is installed from a local file, it must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dpkg_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="dsc-resource">
<h2>dsc_resource<a class="headerlink" href="#dsc-resource" title="Permalink to this headline"></a></h2>
<p>The <strong>dsc_resource</strong> resource allows any DSC resource to be used in a Chef recipe, as well as any custom resources that have been added to your Windows PowerShell environment. Microsoft <a class="reference external" href="https://github.com/powershell/DscResources">frequently adds new resources</a> to the DSC resource collection.</p>
<p><strong>Open a Zip file</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_resource</span> <span class="s1">&#39;example&#39;</span> <span class="k">do</span>
   <span class="n">resource</span> <span class="ss">:archive</span>
   <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;Present&#39;</span>
   <span class="n">property</span> <span class="ss">:path</span><span class="p">,</span> <span class="s1">&#39;C:\Users\Public\Documents\example.zip&#39;</span>
   <span class="n">property</span> <span class="ss">:destination</span><span class="p">,</span> <span class="s1">&#39;C:\Users\Public\Documents\ExtractionPath&#39;</span>
 <span class="k">end</span>
</pre></div>
</div>
<p><strong>Manage users and groups</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_resource</span> <span class="s1">&#39;demogroupadd&#39;</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:group</span>
  <span class="n">property</span> <span class="ss">:groupname</span><span class="p">,</span> <span class="s1">&#39;demo1&#39;</span>
  <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;present&#39;</span>
<span class="k">end</span>

<span class="n">dsc_resource</span> <span class="s1">&#39;useradd&#39;</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:user</span>
  <span class="n">property</span> <span class="ss">:username</span><span class="p">,</span> <span class="s1">&#39;Foobar1&#39;</span>
  <span class="n">property</span> <span class="ss">:fullname</span><span class="p">,</span> <span class="s1">&#39;Foobar1&#39;</span>
  <span class="n">property</span> <span class="ss">:password</span><span class="p">,</span> <span class="n">ps_credential</span><span class="p">(</span><span class="s1">&#39;P@assword!&#39;</span><span class="p">)</span>
  <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;present&#39;</span>
<span class="k">end</span>

<span class="n">dsc_resource</span> <span class="s1">&#39;AddFoobar1ToUsers&#39;</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:Group</span>
  <span class="n">property</span> <span class="ss">:GroupName</span><span class="p">,</span> <span class="s1">&#39;demo1&#39;</span>
  <span class="n">property</span> <span class="ss">:MembersToInclude</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Foobar1&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a test message queue</strong></p>
<p>The following example creates a file on a node (based on one that is located in a cookbook), unpacks the <tt class="docutils literal"><span class="pre">MessageQueue.zip</span></tt> Windows PowerShell module, and then uses the <strong>dsc_resource</strong> to ensure that Message Queuing (MSMQ) sub-features are installed, a test queue is created, and that permissions are set on the test queue:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;cMessageQueue.zip&#39;</span> <span class="k">do</span>
  <span class="n">path</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="se">\\</span><span class="s2">MessageQueue.zip&quot;</span>
  <span class="n">action</span> <span class="ss">:create_if_missing</span>
<span class="k">end</span>

<span class="n">windows_zipfile</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PROGRAMW6432&#39;</span><span class="o">]</span><span class="si">}</span><span class="se">\\</span><span class="s2">WindowsPowerShell</span><span class="se">\\</span><span class="s2">Modules&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="se">\\</span><span class="s2">MessageQueue.zip&quot;</span>
  <span class="n">action</span> <span class="ss">:unzip</span>
<span class="k">end</span>

<span class="n">dsc_resource</span> <span class="s1">&#39;install-sub-features&#39;</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:windowsfeature</span>
  <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;Present&#39;</span>
  <span class="n">property</span> <span class="ss">:name</span><span class="p">,</span> <span class="s1">&#39;msmq&#39;</span>
  <span class="n">property</span> <span class="ss">:IncludeAllSubFeature</span><span class="p">,</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">dsc_resource</span> <span class="s1">&#39;create-test-queue&#39;</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:cPrivateMsmqQueue</span>
  <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;Present&#39;</span>
  <span class="n">property</span> <span class="ss">:name</span><span class="p">,</span> <span class="s1">&#39;Test_Queue&#39;</span>
<span class="k">end</span>

<span class="n">dsc_resource</span> <span class="s1">&#39;set-permissions&#39;</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:cPrivateMsmqQueuePermissions</span>
  <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;Present&#39;</span>
  <span class="n">property</span> <span class="ss">:name</span><span class="p">,</span> <span class="s1">&#39;Test_Queue_Permissions&#39;</span>
  <span class="n">property</span> <span class="ss">:QueueNames</span><span class="p">,</span> <span class="s1">&#39;Test_Queue&#39;</span>
  <span class="n">property</span> <span class="ss">:ReadUsers</span><span class="p">,</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;msmq&#39;</span><span class="o">][</span><span class="s1">&#39;read_user&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="dsc-script">
<h2>dsc_script<a class="headerlink" href="#dsc-script" title="Permalink to this headline"></a></h2>
<p>Many DSC resources are comparable to built-in Chef resources. For example, both DSC and Chef have <strong>file</strong>, <strong>package</strong>, and <strong>service</strong> resources. The <strong>dsc_script</strong> resource is most useful for those DSC resources that do not have a direct comparison to a resource in Chef, such as the <tt class="docutils literal"><span class="pre">Archive</span></tt> resource, a custom DSC resource, an existing DSC script that performs an important task, and so on. Use the <strong>dsc_script</strong> resource to embed the code that defines a DSC configuration directly within a Chef recipe.</p>
<p><strong>Specify DSC code directly</strong></p>
<p>DSC data can be specified directly in a recipe:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_script</span> <span class="s1">&#39;emacs&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  Environment &#39;texteditor&#39;</span>
<span class="sh">  {</span>
<span class="sh">    Name = &#39;EDITOR&#39;</span>
<span class="sh">    Value = &#39;c:\\emacs\\bin\\emacs.exe&#39;</span>
<span class="sh">  }</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify DSC code using a Windows Powershell data file</strong></p>
<p>Use the <tt class="docutils literal"><span class="pre">command</span></tt> property to specify the path to a Windows PowerShell data file. For example, the following Windows PowerShell script defines the <tt class="docutils literal"><span class="pre">DefaultEditor</span></tt>:</p>
<div class="highlight-powershell"><div class="highlight"><pre><span></span><span class="n">Configuration</span> <span class="s1">&#39;DefaultEditor&#39;</span>
<span class="p">{</span>
  <span class="n">Environment</span> <span class="s1">&#39;texteditor&#39;</span>
    <span class="p">{</span>
      <span class="n">Name</span> <span class="p">=</span> <span class="s1">&#39;EDITOR&#39;</span>
      <span class="n">Value</span> <span class="p">=</span> <span class="s1">&#39;c:\emacs\bin\emacs.exe&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Use the following recipe to specify the location of that data file:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_script</span> <span class="s1">&#39;DefaultEditor&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;c:\dsc_scripts\emacs.ps1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Pass parameters to DSC configurations</strong></p>
<p>If a DSC script contains configuration data that takes parameters, those parameters may be passed using the <tt class="docutils literal"><span class="pre">flags</span></tt> property. For example, the following Windows PowerShell script takes parameters for the <tt class="docutils literal"><span class="pre">EditorChoice</span></tt> and <tt class="docutils literal"><span class="pre">EditorFlags</span></tt> settings:</p>
<div class="highlight-powershell"><div class="highlight"><pre><span></span><span class="nv">$choices</span> <span class="p">=</span> <span class="p">@{</span><span class="s1">&#39;emacs&#39;</span> <span class="p">=</span> <span class="s1">&#39;c:\emacs\bin\emacs&#39;</span><span class="p">;</span><span class="s1">&#39;vi&#39;</span> <span class="p">=</span> <span class="s1">&#39;c:\vim\vim.exe&#39;</span><span class="p">;</span><span class="s1">&#39;powershell&#39;</span> <span class="p">=</span> <span class="s1">&#39;powershell_ise.exe&#39;</span><span class="p">}</span>
  <span class="n">Configuration</span> <span class="s1">&#39;DefaultEditor&#39;</span>
    <span class="p">{</span>
      <span class="p">[</span><span class="k">CmdletBinding</span><span class="p">()]</span>
      <span class="k">param</span>
        <span class="p">(</span>
          <span class="nv">$EditorChoice</span><span class="p">,</span>
          <span class="nv">$EditorFlags</span> <span class="p">=</span> <span class="s1">&#39;&#39;</span>
        <span class="p">)</span>
      <span class="n">Environment</span> <span class="s1">&#39;TextEditor&#39;</span>
      <span class="p">{</span>
        <span class="n">Name</span> <span class="p">=</span> <span class="s1">&#39;EDITOR&#39;</span>
        <span class="n">Value</span> <span class="p">=</span>  <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$choices</span><span class="p">[</span><span class="nv">$EditorChoice</span><span class="p">])</span><span class="s2"> $EditorFlags&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Use the following recipe to set those parameters:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_script</span> <span class="s1">&#39;DefaultEditor&#39;</span> <span class="k">do</span>
  <span class="n">flags</span> <span class="p">({</span> <span class="ss">:EditorChoice</span> <span class="o">=&gt;</span> <span class="s1">&#39;emacs&#39;</span><span class="p">,</span> <span class="ss">:EditorFlags</span> <span class="o">=&gt;</span> <span class="s1">&#39;--maximized&#39;</span> <span class="p">})</span>
  <span class="n">command</span> <span class="s1">&#39;c:\dsc_scripts\editors.ps1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use custom configuration data</strong></p>
<p>Configuration data in DSC scripts may be customized from a recipe. For example, scripts are typically customized to set the behavior for Windows PowerShell credential data types. Configuration data may be specified in one of three ways:</p>
<ul class="simple">
<li>By using the <tt class="docutils literal"><span class="pre">configuration_data</span></tt> attribute</li>
<li>By using the <tt class="docutils literal"><span class="pre">configuration_data_script</span></tt> attribute</li>
<li>By specifying the path to a valid Windows PowerShell data file</li>
</ul>
<p>The following example shows how to specify custom configuration data using the <tt class="docutils literal"><span class="pre">configuration_data</span></tt> property:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_script</span> <span class="s1">&#39;BackupUser&#39;</span> <span class="k">do</span>
  <span class="n">configuration_data</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    @{</span>
<span class="sh">     AllNodes = @(</span>
<span class="sh">          @{</span>
<span class="sh">          NodeName = &quot;localhost&quot;;</span>
<span class="sh">          PSDscAllowPlainTextPassword = $true</span>
<span class="sh">          })</span>
<span class="sh">     }</span>
<span class="no">  EOH</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    $user = &#39;backup&#39;</span>
<span class="sh">    $password = ConvertTo-SecureString -String &quot;YourPass$(random)&quot; -AsPlainText -Force</span>
<span class="sh">    $cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $user, $password</span>

<span class="sh">   User $user</span>
<span class="sh">     {</span>
<span class="sh">       UserName = $user</span>
<span class="sh">       Password = $cred</span>
<span class="sh">       Description = &#39;Backup operator&#39;</span>
<span class="sh">       Ensure = &quot;Present&quot;</span>
<span class="sh">       Disabled = $false</span>
<span class="sh">       PasswordNeverExpires = $true</span>
<span class="sh">       PasswordChangeRequired = $false</span>
<span class="sh">     }</span>
<span class="no">   EOH</span>

  <span class="n">configuration_data</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    @{</span>
<span class="sh">      AllNodes = @(</span>
<span class="sh">          @{</span>
<span class="sh">          NodeName = &quot;localhost&quot;;</span>
<span class="sh">          PSDscAllowPlainTextPassword = $true</span>
<span class="sh">          })</span>
<span class="sh">      }</span>
<span class="no">    EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example shows how to specify custom configuration data using the <tt class="docutils literal"><span class="pre">configuration_name</span></tt> property. For example, the following Windows PowerShell script defines the <tt class="docutils literal"><span class="pre">vi</span></tt> configuration:</p>
<div class="highlight-powershell"><div class="highlight"><pre><span></span><span class="n">Configuration</span> <span class="s1">&#39;emacs&#39;</span>
  <span class="p">{</span>
    <span class="n">Environment</span> <span class="s1">&#39;TextEditor&#39;</span>
    <span class="p">{</span>
      <span class="n">Name</span> <span class="p">=</span> <span class="s1">&#39;EDITOR&#39;</span>
      <span class="n">Value</span> <span class="p">=</span> <span class="s1">&#39;c:\emacs\bin\emacs.exe&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">Configuration</span> <span class="s1">&#39;vi&#39;</span>
<span class="p">{</span>
    <span class="n">Environment</span> <span class="s1">&#39;TextEditor&#39;</span>
    <span class="p">{</span>
      <span class="n">Name</span> <span class="p">=</span> <span class="s1">&#39;EDITOR&#39;</span>
      <span class="n">Value</span> <span class="p">=</span> <span class="s1">&#39;c:\vim\bin\vim.exe&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Use the following recipe to specify that configuration:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_script</span> <span class="s1">&#39;EDITOR&#39;</span> <span class="k">do</span>
  <span class="n">configuration_name</span> <span class="s1">&#39;vi&#39;</span>
  <span class="n">command</span> <span class="s1">&#39;C:\dsc_scripts\editors.ps1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Using DSC with other Chef resources</strong></p>
<p>The <strong>dsc_script</strong> resource can be used with other resources. The following example shows how to download a file using the <strong>remote_file</strong> resource, and then uncompress it using the DSC <tt class="docutils literal"><span class="pre">Archive</span></tt> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="se">\\</span><span class="s2">DSCResourceKit620082014.zip&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://gallery.technet.microsoft.com/DSC-Resource-Kit-All-c449312d/file/124481/1/DSC%20Resource%20Kit%20Wave%206%2008282014.zip&#39;</span>
<span class="k">end</span>

<span class="n">dsc_script</span> <span class="s1">&#39;get-dsc-resource-kit&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    Archive reskit</span>
<span class="sh">    {</span>
<span class="sh">      ensure = &#39;Present&#39;</span>
<span class="sh">      path = &quot;#{Chef::Config[:file_cache_path]}\\DSCResourceKit620082014.zip&quot;</span>
<span class="sh">      destination = &quot;#{ENV[&#39;PROGRAMW6432&#39;]}\\WindowsPowerShell\\Modules&quot;</span>
<span class="sh">    }</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="easy-install-package">
<h2>easy_install_package<a class="headerlink" href="#easy-install-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>easy_install_package</strong> resource to manage packages for the Python platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">easy_install_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="env">
<h2>env<a class="headerlink" href="#env" title="Permalink to this headline"></a></h2>
<p>Use the <strong>env</strong> resource to manage environment keys in Microsoft Windows. After an environment key is set, Microsoft Windows must be restarted before the environment key will be available to the Task Scheduler.</p>
<p><strong>Set an environment variable</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="s1">&#39;ComSpec&#39;</span> <span class="k">do</span>
  <span class="n">value</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">system32</span><span class="se">\\</span><span class="s2">cmd.exe&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="erl-call">
<h2>erl_call<a class="headerlink" href="#erl-call" title="Permalink to this headline"></a></h2>
<p>Use the <strong>erl_call</strong> resource to connect to a node located within a distributed Erlang system. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<p><strong>Run a command</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">erl_call</span> <span class="s1">&#39;list names&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="s1">&#39;net_adm:names().&#39;</span>
  <span class="n">distributed</span> <span class="kp">true</span>
  <span class="n">node_name</span> <span class="s1">&#39;chef@latte&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="execute">
<h2>execute<a class="headerlink" href="#execute" title="Permalink to this headline"></a></h2>
<p>Use the <strong>execute</strong> resource to execute a single command. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<p><strong>Run a command upon notification</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;slapadd&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;slapadd &lt; /tmp/something.ldif&#39;</span>
  <span class="n">creates</span> <span class="s1">&#39;/var/lib/slapd/uid.bdb&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/tmp/something.ldif&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;something.ldif&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[slapadd]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run a touch file only once while running a command</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;upgrade script&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;php upgrade-application.php &amp;&amp; touch /var/application/.upgraded&#39;</span>
  <span class="n">creates</span> <span class="s1">&#39;/var/application/.upgraded&#39;</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run a command which requires an environment variable</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;slapadd&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;slapadd &lt; /tmp/something.ldif&#39;</span>
  <span class="n">creates</span> <span class="s1">&#39;/var/lib/slapd/uid.bdb&#39;</span>
  <span class="n">action</span> <span class="ss">:run</span>
  <span class="n">environment</span> <span class="p">({</span><span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/myhome&#39;</span><span class="p">})</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delete a repository using yum to scrub the cache</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample thanks to gaffneyc @ https://gist.github.com/918711</span>

<span class="n">execute</span> <span class="s1">&#39;clean-yum-cache&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;yum clean all&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">file</span> <span class="s1">&#39;/etc/yum.repos.d/bad.repo&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:delete</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[clean-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload-internal-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install repositories from a file, trigger a command, and force the internal cache to reload</strong></p>
<p>The following example shows how to install new Yum repositories from a file, where the installation of the repository triggers a creation of the Yum cache that forces the internal cache for the chef-client to reload:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;create-yum-cache&#39;</span> <span class="k">do</span>
 <span class="n">command</span> <span class="s1">&#39;yum -q makecache&#39;</span>
 <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;reload-internal-yum-cache&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Yum</span><span class="o">::</span><span class="no">YumCache</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">reload</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">cookbook_file</span> <span class="s1">&#39;/etc/yum.repos.d/custom.repo&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;custom&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[create-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload-internal-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Prevent restart and reconfigure if configuration is broken</strong></p>
<p>Use the <tt class="docutils literal"><span class="pre">:nothing</span></tt> action (common to all resources) to prevent an application from restarting, and then use the <tt class="docutils literal"><span class="pre">subscribes</span></tt> notification to ask the broken configuration to be reconfigured immediately:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test-nagios-config&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;nagios3 --verify-config&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">subscribes</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;template[/etc/nagios3/configures-nagios.conf]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Notify in a specific order</strong></p>
<p>To notify multiple resources, and then have these resources run in a certain order, do something like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;...&#39;</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;template[baz]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:install</span><span class="p">,</span> <span class="s1">&#39;package[bar]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[final]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;baz&#39;</span> <span class="k">do</span>
  <span class="o">...</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[restart_baz]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">package</span> <span class="s1">&#39;bar&#39;</span>

<span class="n">execute</span> <span class="s1">&#39;restart_baz&#39;</span>

<span class="n">execute</span> <span class="s1">&#39;final&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;...&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the sequencing will be in the same order as the resources are listed in the recipe: <tt class="docutils literal"><span class="pre">execute</span> <span class="pre">'foo'</span></tt>, <tt class="docutils literal"><span class="pre">template</span> <span class="pre">'baz'</span></tt>, <tt class="docutils literal"><span class="pre">execute</span> <span class="pre">[restart_baz]</span></tt>, <tt class="docutils literal"><span class="pre">package</span> <span class="pre">'bar'</span></tt>, and <tt class="docutils literal"><span class="pre">execute</span> <span class="pre">'final'</span></tt>.</p>
<p><strong>Execute a command using a template</strong></p>
<p>The following example shows how to set up IPv4 packet forwarding using the <strong>execute</strong> resource to run a command named <tt class="docutils literal"><span class="pre">forward_ipv4</span></tt> that uses a template defined by the <strong>template</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;forward_ipv4&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;echo &gt; /proc/.../ipv4/ip_forward&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/etc/file_name.conf&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;routing/file_name.conf.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[forward_ipv4]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">command</span></tt> property for the <strong>execute</strong> resource contains the command that is to be run and the <tt class="docutils literal"><span class="pre">source</span></tt> property for the <strong>template</strong> resource specifies which template to use. The <tt class="docutils literal"><span class="pre">notifies</span></tt> property for the <strong>template</strong> specifies that the <tt class="docutils literal"><span class="pre">execute[forward_ipv4]</span></tt> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of the chef-client run.</p>
<p><strong>Add a rule to an IP table</strong></p>
<p>The following example shows how to add a rule named <tt class="docutils literal"><span class="pre">test_rule</span></tt> to an IP table using the <strong>execute</strong> resource to run a command using a template that is defined by the <strong>template</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test_rule&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;command_to_run</span>
<span class="s1">    --option value</span>
<span class="s1">    ...</span>
<span class="s1">    --option value</span>
<span class="s1">    --source #{node[:name_of_node][:ipsec][:local][:subnet]}</span>
<span class="s1">    -j test_rule&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/etc/file_name.local&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;routing/file_name.local.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test_rule]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">command</span></tt> property for the <strong>execute</strong> resource contains the command that is to be run and the <tt class="docutils literal"><span class="pre">source</span></tt> property for the <strong>template</strong> resource specifies which template to use. The <tt class="docutils literal"><span class="pre">notifies</span></tt> property for the <strong>template</strong> specifies that the <tt class="docutils literal"><span class="pre">execute[test_rule]</span></tt> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of the chef-client run.</p>
<p><strong>Stop a service, do stuff, and then restart it</strong></p>
<p>The following example shows how to use the <strong>execute</strong>, <strong>service</strong>, and <strong>mount</strong> resources together to ensure that a node running on Amazon EC2 is running MySQL. This example does the following:</p>
<ul class="simple">
<li>Checks to see if the Amazon EC2 node has MySQL</li>
<li>If the node has MySQL, stops MySQL</li>
<li>Installs MySQL</li>
<li>Mounts the node</li>
<li>Restarts MySQL</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``server_ec2``</span>
<span class="c1"># recipe in the following cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/mysql</span>

<span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attribute?</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">))</span>

  <span class="n">service</span> <span class="s1">&#39;mysql&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:stop</span>
  <span class="k">end</span>

  <span class="n">execute</span> <span class="s1">&#39;install-mysql&#39;</span> <span class="k">do</span>
    <span class="n">command</span> <span class="s2">&quot;mv </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">not_if</span> <span class="k">do</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">)</span> <span class="k">end</span>
  <span class="k">end</span>

  <span class="o">[</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
    <span class="n">directory</span> <span class="n">dir</span> <span class="k">do</span>
      <span class="n">owner</span> <span class="s1">&#39;mysql&#39;</span>
      <span class="n">group</span> <span class="s1">&#39;mysql&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">mount</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">device</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span>
    <span class="n">fstype</span> <span class="s1">&#39;none&#39;</span>
    <span class="n">options</span> <span class="s1">&#39;bind,rw&#39;</span>
    <span class="n">action</span> <span class="o">[</span><span class="ss">:mount</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="n">service</span> <span class="s1">&#39;mysql&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:start</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li>the two <strong>service</strong> resources are used to stop, and then restart the MySQL service</li>
<li>the <strong>execute</strong> resource is used to install MySQL</li>
<li>the <strong>mount</strong> resource is used to mount the node and enable MySQL</li>
</ul>
<p><strong>Use the platform_family? method</strong></p>
<p>The following is an example of using the <tt class="docutils literal"><span class="pre">platform_family?</span></tt> method in the Recipe DSL to create a variable that can be used with other resources in the same recipe. In this example, <tt class="docutils literal"><span class="pre">platform_family?</span></tt> is being used to ensure that a specific binary is used for a specific platform before using the <strong>remote_file</strong> resource to download a file from a remote location, and then using the <strong>execute</strong> resource to install that file by running a command.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">platform_family?</span><span class="p">(</span><span class="s1">&#39;rhel&#39;</span><span class="p">)</span>
  <span class="n">pip_binary</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/pip&#39;</span>
<span class="k">else</span>
  <span class="n">pip_binary</span> <span class="o">=</span> <span class="s1">&#39;/usr/local/bin/pip&#39;</span>
<span class="k">end</span>

<span class="n">remote_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/distribute_setup.py&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://python-distribute.org/distribute_setup.py&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">pip_binary</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">execute</span> <span class="s1">&#39;install-pip&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">command</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span>
<span class="sh">    # command for installing Python goes here</span>
<span class="no">    EOF</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">pip_binary</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where a command for installing Python might look something like:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#{node[&#39;python&#39;][&#39;binary&#39;]} distribute_setup.py</span>
<span class="c1">#{::File.dirname(pip_binary)}/easy_install pip</span>
</pre></div>
</div>
<p><strong>Control a service using the execute resource</strong></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is an example of something that should NOT be done. Use the <strong>service</strong> resource to control a service, not the <strong>execute</strong> resource.</p>
</div>
<p>Do something like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;tomcat&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and NOT something like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;start-tomcat&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;/etc/init.d/tomcat6 start&#39;</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p>There is no reason to use the <strong>execute</strong> resource to control a service because the <strong>service</strong> resource exposes the <tt class="docutils literal"><span class="pre">start_command</span></tt> property directly, which gives a recipe full control over the command issued in a much cleaner, more direct manner.</p>
<p><strong>Use the search recipe DSL method to find users</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">search</span></tt> method in the Recipe DSL to search for users:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#  the following code sample comes from the openvpn cookbook: https://github.com/chef-cookbooks/openvpn</span>

<span class="n">search</span><span class="p">(</span><span class="s2">&quot;users&quot;</span><span class="p">,</span> <span class="s2">&quot;*:*&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">u</span><span class="o">|</span>
  <span class="n">execute</span> <span class="s2">&quot;generate-openvpn-</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">command</span> <span class="s2">&quot;./pkitool </span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">cwd</span> <span class="s1">&#39;/etc/openvpn/easy-rsa&#39;</span>
    <span class="n">environment</span><span class="p">(</span>
      <span class="s1">&#39;EASY_RSA&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc/openvpn/easy-rsa&#39;</span><span class="p">,</span>
      <span class="s1">&#39;KEY_CONFIG&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc/openvpn/easy-rsa/openssl.cnf&#39;</span><span class="p">,</span>
      <span class="s1">&#39;KEY_DIR&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key_dir&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="s1">&#39;CA_EXPIRE&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;ca_expire&#39;</span><span class="o">].</span><span class="n">to_s</span><span class="p">,</span>
      <span class="s1">&#39;KEY_EXPIRE&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;expire&#39;</span><span class="o">].</span><span class="n">to_s</span><span class="p">,</span>
      <span class="s1">&#39;KEY_SIZE&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;size&#39;</span><span class="o">].</span><span class="n">to_s</span><span class="p">,</span>
      <span class="s1">&#39;KEY_COUNTRY&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;country&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="s1">&#39;KEY_PROVINCE&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;province&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="s1">&#39;KEY_CITY&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;city&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="s1">&#39;KEY_ORG&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;org&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="s1">&#39;KEY_EMAIL&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;email&#39;</span><span class="o">]</span>
    <span class="p">)</span>
    <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">.crt&quot;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="sx">%w{ conf ovpn }</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">ext</span><span class="o">|</span>
    <span class="n">template</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">.</span><span class="si">#{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
      <span class="n">source</span> <span class="s1">&#39;client.conf.erb&#39;</span>
      <span class="n">variables</span> <span class="ss">:username</span> <span class="o">=&gt;</span> <span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">execute</span> <span class="s2">&quot;create-openvpn-tar-</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">cwd</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key_dir&#39;</span><span class="o">]</span>
    <span class="n">command</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">      tar zcf #{u[&#39;id&#39;]}.tar.gz \</span>
<span class="sh">      ca.crt #{u[&#39;id&#39;]}.crt #{u[&#39;id&#39;]}.key \</span>
<span class="sh">      #{u[&#39;id&#39;]}.conf #{u[&#39;id&#39;]}.ovpn \</span>
<span class="no">    EOH</span>
    <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">.tar.gz&quot;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li>the search will use both of the <strong>execute</strong> resources, unless the condition specified by the <tt class="docutils literal"><span class="pre">not_if</span></tt> commands are met</li>
<li>the <tt class="docutils literal"><span class="pre">environments</span></tt> property in the first <strong>execute</strong> resource is being used to define values that appear as variables in the OpenVPN configuration</li>
<li>the <strong>template</strong> resource tells the chef-client which template to use</li>
</ul>
<p><strong>Enable remote login for Mac OS X</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;enable ssh&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;/usr/sbin/systemsetup -setremotelogin on&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;/usr/sbin/systemsetup -getremotelogin | /usr/bin/grep On&#39;</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Execute code immediately, based on the template resource</strong></p>
<p>By default, notifications are <tt class="docutils literal"><span class="pre">:delayed</span></tt>, that is they are queued up as they are triggered, and then executed at the very end of a chef-client run. To run an action immediately, use <tt class="docutils literal"><span class="pre">:immediately</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/nagios3/configures-nagios.conf&#39;</span> <span class="k">do</span>
  <span class="c1"># other parameters</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test-nagios-config]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the chef-client would immediately run the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test-nagios-config&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;nagios3 --verify-config&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Sourcing a file</strong></p>
<p>The <strong>execute</strong> resource cannot be used to source a file (e.g. <tt class="docutils literal"><span class="pre">command</span> <span class="pre">'source</span> <span class="pre">filename'</span></tt>). The following example will fail because <tt class="docutils literal"><span class="pre">source</span></tt> is not an executable:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;source /tmp/foo.sh&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Instead, use the <strong>script</strong> resource or one of the <strong>script</strong>-based resources (<strong>bash</strong>, <strong>csh</strong>, <strong>perl</strong>, <strong>python</strong>, or <strong>ruby</strong>). For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="s1">&#39;source /tmp/foo.sh&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run a Knife command</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;create_user&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="o">&lt;&lt;-</span><span class="no">EOM</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip!</span>
<span class="sh">        knife user create #{user}</span>
<span class="sh">      --admin</span>
<span class="sh">      --password password</span>
<span class="sh">      --disable-editing</span>
<span class="sh">      --file /home/vagrant/.chef/user.pem</span>
<span class="sh">      --config /tmp/knife-admin.rb</span>
<span class="no">    EOM</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run install command into virtual environment</strong></p>
<p>The following example shows how to install a lightweight JavaScript framework into Vagrant:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s2">&quot;install q and zombiejs&quot;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="s2">&quot;/home/vagrant&quot;</span>
  <span class="n">user</span> <span class="s2">&quot;vagrant&quot;</span>
  <span class="n">environment</span> <span class="p">({</span><span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/vagrant&#39;</span><span class="p">,</span> <span class="s1">&#39;USER&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;vagrant&#39;</span><span class="p">})</span>
  <span class="n">command</span> <span class="s2">&quot;npm install -g q zombie should mocha coffee-script&quot;</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run a command as a named user</strong></p>
<p>The following example shows how to run <tt class="docutils literal"><span class="pre">bundle</span> <span class="pre">install</span></tt> from a chef-client run as a specific user. This will put the gem into the path of the user (<tt class="docutils literal"><span class="pre">vagrant</span></tt>) instead of the root user (under which the chef-client runs):</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;/opt/chefdk/embedded/bin/bundle install&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_workstation&#39;</span><span class="o">][</span><span class="s1">&#39;bundler_path&#39;</span><span class="o">]</span>
  <span class="n">user</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_workstation&#39;</span><span class="o">][</span><span class="s1">&#39;user&#39;</span><span class="o">]</span>
  <span class="n">environment</span> <span class="p">({</span>
    <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/home/</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_workstation&#39;</span><span class="o">][</span><span class="s1">&#39;user&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;USER&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_workstation&#39;</span><span class="o">][</span><span class="s1">&#39;user&#39;</span><span class="o">]</span>
  <span class="p">})</span>
  <span class="n">not_if</span> <span class="s1">&#39;bundle check&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="file">
<h2>file<a class="headerlink" href="#file" title="Permalink to this headline"></a></h2>
<p>Use the <strong>file</strong> resource to manage files directly on a node.</p>
<p><strong>Create a file</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/tmp/something&#39;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file in Microsoft Windows</strong></p>
<p>To create a file in Microsoft Windows, be sure to add an escape character&#8212;<tt class="docutils literal"><span class="pre">\</span></tt>&#8212;before the backslashes in the paths:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;C:\\tmp\\something.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;DOMAIN\\User&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Remove a file</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/tmp/something&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:delete</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set file modes</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/tmp/something&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delete a repository using yum to scrub the cache</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample thanks to gaffneyc @ https://gist.github.com/918711</span>

<span class="n">execute</span> <span class="s1">&#39;clean-yum-cache&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;yum clean all&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">file</span> <span class="s1">&#39;/etc/yum.repos.d/bad.repo&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:delete</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[clean-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload-internal-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Add the value of a data bag item to a file</strong></p>
<p>The following example shows how to get the contents of a data bag item named <tt class="docutils literal"><span class="pre">impossible_things</span></tt>, create a .pem file located at <tt class="docutils literal"><span class="pre">some/directory/path/</span></tt>, and then use the <tt class="docutils literal"><span class="pre">content</span></tt> attribute to update the contents of that file with the value of the <tt class="docutils literal"><span class="pre">impossible_things</span></tt> data bag item:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">private_key</span> <span class="o">=</span> <span class="n">data_bag_item</span><span class="p">(</span><span class="s1">&#39;impossible_things&#39;</span><span class="p">,</span> <span class="n">private_key_name</span><span class="p">)</span><span class="o">[</span><span class="s1">&#39;private_key&#39;</span><span class="o">]</span>

<span class="n">file</span> <span class="s2">&quot;some/directory/path/</span><span class="si">#{</span><span class="n">private_key_name</span><span class="si">}</span><span class="s2">.pem&quot;</span> <span class="k">do</span>
  <span class="n">content</span> <span class="n">private_key</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;group&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Write a YAML file</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">content</span></tt> property to write a YAML file:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">app</span><span class="o">[</span><span class="s1">&#39;deploy_to&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/shared/config/settings.yml&quot;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s2">&quot;app[&#39;owner&#39;]&quot;</span>
  <span class="n">group</span> <span class="s2">&quot;app[&#39;group&#39;]&quot;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">content</span> <span class="n">app</span><span class="o">.</span><span class="n">to_yaml</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Write a string to a file</strong></p>
<p>The following example specifies a directory, and then uses the <tt class="docutils literal"><span class="pre">content</span></tt> property to add a string to the file created in that directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">status_file</span> <span class="o">=</span> <span class="s1">&#39;/path/to/file/status_file&#39;</span>

<span class="n">file</span> <span class="n">status_file</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">content</span> <span class="s1">&#39;My favourite foremost coastal Antarctic shelf, oh Larsen B!&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file from a copy</strong></p>
<p>The following example shows how to copy a file from one directory to another, locally on a node:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/root/1.txt&#39;</span> <span class="k">do</span>
  <span class="n">content</span> <span class="no">IO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/tmp/1.txt&#39;</span><span class="p">)</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">content</span></tt> attribute uses the Ruby <tt class="docutils literal"><span class="pre">IO.read</span></tt> method to get the contents of the <tt class="docutils literal"><span class="pre">/tmp/1.txt</span></tt> file.</p>
</div>
<div class="section" id="freebsd-package">
<h2>freebsd_package<a class="headerlink" href="#freebsd-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>freebsd_package</strong> resource to manage packages for the FreeBSD platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">freebsd_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="gem-package">
<h2>gem_package<a class="headerlink" href="#gem-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>gem_package</strong> resource to manage gem packages that are only included in recipes. When a package is installed from a local file, it must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p>
<p><strong>Install a gems file from the local file system</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;right_aws&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;/tmp/right_aws-1.11.0.gem&#39;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the ignore_failure common attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;syntax&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">ignore_failure</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="git">
<h2>git<a class="headerlink" href="#git" title="Permalink to this headline"></a></h2>
<p>Use the <strong>git</strong> resource to manage source control resources that exist in a git repository. git version 1.6.5 (or higher) is required to use all of the functionality in the <strong>git</strong> resource.</p>
<p><strong>Use the git mirror</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="s1">&#39;/opt/mysources/couch&#39;</span> <span class="k">do</span>
  <span class="n">repository</span> <span class="s1">&#39;git://git.apache.org/couchdb.git&#39;</span>
  <span class="n">revision</span> <span class="s1">&#39;master&#39;</span>
  <span class="n">action</span> <span class="ss">:sync</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use different branches</strong></p>
<p>To use different branches, depending on the environment of the node:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">chef_environment</span> <span class="o">==</span> <span class="s1">&#39;QA&#39;</span>
   <span class="n">branch_name</span> <span class="o">=</span> <span class="s1">&#39;staging&#39;</span>
<span class="k">else</span>
   <span class="n">branch_name</span> <span class="o">=</span> <span class="s1">&#39;master&#39;</span>
<span class="k">end</span>

<span class="n">git</span> <span class="s1">&#39;/home/user/deployment&#39;</span> <span class="k">do</span>
   <span class="n">repository</span> <span class="s1">&#39;git@github.com:gitsite/deployment.git&#39;</span>
   <span class="n">revision</span> <span class="n">branch_name</span>
   <span class="n">action</span> <span class="ss">:sync</span>
   <span class="n">user</span> <span class="s1">&#39;user&#39;</span>
   <span class="n">group</span> <span class="s1">&#39;test&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">branch_name</span></tt> variable is set to <tt class="docutils literal"><span class="pre">staging</span></tt> or <tt class="docutils literal"><span class="pre">master</span></tt>, depending on the environment of the node. Once this is determined, the <tt class="docutils literal"><span class="pre">branch_name</span></tt> variable is used to set the revision for the repository. If the <tt class="docutils literal"><span class="pre">git</span> <span class="pre">status</span></tt> command is used after running the example above, it will return the branch name as <tt class="docutils literal"><span class="pre">deploy</span></tt>, as this is the default value. Run the chef-client in debug mode to verify that the correct branches are being checked out:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ sudo chef-client -l debug
</pre></div>
</div>
<p><strong>Install an application from git using bash</strong></p>
<p>The following example shows how Bash can be used to install a plug-in for rbenv named <tt class="docutils literal"><span class="pre">ruby-build</span></tt>, which is located in git version source control. First, the application is synchronized, and then Bash changes its working directory to the location in which <tt class="docutils literal"><span class="pre">ruby-build</span></tt> is located, and then runs a command.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span> <span class="n">git</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/ruby-build&quot;</span> <span class="k">do</span>
   <span class="n">repository</span> <span class="s1">&#39;git://github.com/sstephenson/ruby-build.git&#39;</span>
   <span class="n">reference</span> <span class="s1">&#39;master&#39;</span>
   <span class="n">action</span> <span class="ss">:sync</span>
 <span class="k">end</span>

 <span class="n">bash</span> <span class="s1">&#39;install_ruby_build&#39;</span> <span class="k">do</span>
   <span class="n">cwd</span> <span class="s1">&#39;#{Chef::Config[:file_cache_path]}/ruby-build&#39;</span>
   <span class="n">user</span> <span class="s1">&#39;rbenv&#39;</span>
   <span class="n">group</span> <span class="s1">&#39;rbenv&#39;</span>
   <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">     ./install.sh</span>
<span class="no">     EOH</span>
   <span class="n">environment</span> <span class="s1">&#39;PREFIX&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/local&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>To read more about <tt class="docutils literal"><span class="pre">ruby-build</span></tt>, see here: <a class="reference external" href="https://github.com/sstephenson/ruby-build">https://github.com/sstephenson/ruby-build</a>.</p>
<p><strong>Upgrade packages from git</strong></p>
<p>The following example uses the <strong>git</strong> resource to upgrade packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``source`` recipe</span>
<span class="c1"># in the ``libvpx-cookbook`` cookbook:</span>
<span class="c1"># https://github.com/enmasse-entertainment/libvpx-cookbook</span>

<span class="n">git</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/libvpx&quot;</span> <span class="k">do</span>
  <span class="n">repository</span> <span class="n">node</span><span class="o">[</span><span class="ss">:libvpx</span><span class="o">][</span><span class="ss">:git_repository</span><span class="o">]</span>
  <span class="n">revision</span> <span class="n">node</span><span class="o">[</span><span class="ss">:libvpx</span><span class="o">][</span><span class="ss">:git_revision</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:sync</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;bash[compile_libvpx]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Pass in environment variables</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="s1">&#39;/opt/mysources/couch&#39;</span> <span class="k">do</span>
  <span class="n">repository</span> <span class="s1">&#39;git://git.apache.org/couchdb.git&#39;</span>
  <span class="n">revision</span> <span class="s1">&#39;master&#39;</span>
  <span class="n">environment</span>  <span class="p">{</span> <span class="s1">&#39;VAR&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;whatever&#39;</span> <span class="p">}</span>
  <span class="n">action</span> <span class="ss">:sync</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="group">
<h2>group<a class="headerlink" href="#group" title="Permalink to this headline"></a></h2>
<p>Use the <strong>group</strong> resource to manage a local group.</p>
<p><strong>Append users to groups</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">group</span> <span class="s1">&#39;www-data&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:modify</span>
  <span class="n">members</span> <span class="s1">&#39;maintenance&#39;</span>
  <span class="n">append</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Add a user to group on the Windows platform</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">group</span> <span class="s1">&#39;Administrators&#39;</span> <span class="k">do</span>
  <span class="n">members</span> <span class="o">[</span><span class="s1">&#39;domain\foo&#39;</span><span class="o">]</span>
  <span class="n">append</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:modify</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="homebrew-package">
<h2>homebrew_package<a class="headerlink" href="#homebrew-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>homebrew_package</strong> resource to manage packages for the Mac OS X platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">homebrew_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify the Homebrew user with a UUID</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">homebrew_package</span> <span class="s1">&#39;emacs&#39;</span> <span class="k">do</span>
  <span class="n">homebrew_user</span> <span class="mi">1001</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify the Homebrew user with a string</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">homebrew_package</span> <span class="s1">&#39;vim&#39;</span> <span class="k">do</span>
  <span class="n">homebrew_user</span> <span class="s1">&#39;user1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="http-request">
<h2>http_request<a class="headerlink" href="#http-request" title="Permalink to this headline"></a></h2>
<p>Use the <strong>http_request</strong> resource to send an HTTP request (<tt class="docutils literal"><span class="pre">GET</span></tt>, <tt class="docutils literal"><span class="pre">PUT</span></tt>, <tt class="docutils literal"><span class="pre">POST</span></tt>, <tt class="docutils literal"><span class="pre">DELETE</span></tt>, <tt class="docutils literal"><span class="pre">HEAD</span></tt>, or <tt class="docutils literal"><span class="pre">OPTIONS</span></tt>) with an arbitrary message. This resource is often useful when custom callbacks are necessary.</p>
<p><strong>Send a GET request</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">http_request</span> <span class="s1">&#39;some_message&#39;</span> <span class="k">do</span>
  <span class="n">url</span> <span class="s1">&#39;http://example.com/check_in&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The message is sent as <tt class="docutils literal"><span class="pre">http://example.com/check_in?message=some_message</span></tt>.</p>
<p><strong>Send a POST request</strong></p>
<p>To send a <tt class="docutils literal"><span class="pre">POST</span></tt> request as JSON data, convert the message to JSON and include the correct content-type header. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">http_request</span> <span class="s1">&#39;posting data&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:post</span>
  <span class="n">url</span> <span class="s1">&#39;http://example.com/check_in&#39;</span>
  <span class="n">message</span> <span class="p">({</span><span class="ss">:some</span> <span class="o">=&gt;</span> <span class="s1">&#39;data&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">to_json</span><span class="p">)</span>
  <span class="n">headers</span><span class="p">({</span><span class="s1">&#39;AUTHORIZATION&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Basic </span><span class="si">#{</span>
    <span class="no">Base64</span><span class="o">.</span><span class="n">encode64</span><span class="p">(</span><span class="s1">&#39;username:password&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/data&#39;</span>
  <span class="p">})</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Transfer a file only when the remote source changes</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/tmp/couch.png&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://couchdb.apache.org/img/sketch.png&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">http_request</span> <span class="s1">&#39;HEAD http://couchdb.apache.org/img/sketch.png&#39;</span> <span class="k">do</span>
  <span class="n">message</span> <span class="s1">&#39;&#39;</span>
  <span class="n">url</span> <span class="s1">&#39;http://couchdb.apache.org/img/sketch.png&#39;</span>
  <span class="n">action</span> <span class="ss">:head</span>
  <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/tmp/couch.png&#39;</span><span class="p">)</span>
    <span class="n">headers</span> <span class="s1">&#39;If-Modified-Since&#39;</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">mtime</span><span class="p">(</span><span class="s1">&#39;/tmp/couch.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">httpdate</span>
  <span class="k">end</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;remote_file[/tmp/couch.png]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="ifconfig">
<h2>ifconfig<a class="headerlink" href="#ifconfig" title="Permalink to this headline"></a></h2>
<p>Use the <strong>ifconfig</strong> resource to manage interfaces.</p>
<p><strong>Configure a network interface</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="s2">&quot;33.33.33.80&quot;</span> <span class="k">do</span>
  <span class="n">bootproto</span> <span class="s2">&quot;dhcp&quot;</span>
  <span class="n">device</span> <span class="s2">&quot;eth1&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>will create the following interface:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>vagrant@default-ubuntu-1204:~$ cat /etc/network/interfaces.d/ifcfg-eth1
iface eth1 inet dhcp
</pre></div>
</div>
<p><strong>Specify a boot protocol</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="s1">&#39;192.186.0.1&#39;</span> <span class="k">do</span>
  <span class="n">device</span> <span class="s1">&#39;eth0&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify a static IP address</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="s2">&quot;33.33.33.80&quot;</span> <span class="k">do</span>
  <span class="n">device</span> <span class="s2">&quot;eth1&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>will create the following interface:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>iface eth1 inet static
  address 33.33.33.80
</pre></div>
</div>
<p><strong>Update a static IP address with a boot protocol</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="s2">&quot;33.33.33.80&quot;</span> <span class="k">do</span>
  <span class="n">bootproto</span> <span class="s2">&quot;dhcp&quot;</span>
  <span class="n">device</span> <span class="s2">&quot;eth1&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>will update the interface from <tt class="docutils literal"><span class="pre">static</span></tt> to <tt class="docutils literal"><span class="pre">dhcp</span></tt>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>iface eth1 inet dhcp
  address 33.33.33.80
</pre></div>
</div>
</div>
<div class="section" id="ips-package">
<h2>ips_package<a class="headerlink" href="#ips-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>ips_package</strong> resource to manage packages (using Image Packaging System (IPS)) on the Solaris 11 platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ips_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="ksh">
<h2>ksh<a class="headerlink" href="#ksh" title="Permalink to this headline"></a></h2>
<p>Use the <strong>ksh</strong> resource to execute scripts using the Korn shell (ksh) interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>ksh</strong> script resource (which is based on the <strong>script</strong> resource) is different from the <strong>ruby_block</strong> resource because Ruby code that is run with this resource is created as a temporary file and executed like other script resources, rather than run inline.</p>
</div>
<p>No examples.</p>
</div>
<div class="section" id="link">
<h2>link<a class="headerlink" href="#link" title="Permalink to this headline"></a></h2>
<p>Use the <strong>link</strong> resource to create symbolic or hard links.</p>
<p><strong>Create symbolic links</strong></p>
<p>The following example will create a symbolic link from <tt class="docutils literal"><span class="pre">/tmp/file</span></tt> to <tt class="docutils literal"><span class="pre">/etc/file</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="s1">&#39;/tmp/file&#39;</span> <span class="k">do</span>
  <span class="n">to</span> <span class="s1">&#39;/etc/file&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create hard links</strong></p>
<p>The following example will create a hard link from <tt class="docutils literal"><span class="pre">/tmp/file</span></tt> to <tt class="docutils literal"><span class="pre">/etc/file</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="s1">&#39;/tmp/file&#39;</span> <span class="k">do</span>
  <span class="n">to</span> <span class="s1">&#39;/etc/file&#39;</span>
  <span class="n">link_type</span> <span class="ss">:hard</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delete links</strong></p>
<p>The following example will delete the <tt class="docutils literal"><span class="pre">/tmp/file</span></tt> symbolic link and uses the <tt class="docutils literal"><span class="pre">only_if</span></tt> guard to run the <tt class="docutils literal"><span class="pre">test</span> <span class="pre">-L</span></tt> command, which verifies that <tt class="docutils literal"><span class="pre">/tmp/file</span></tt> is a symbolic link, and then only deletes <tt class="docutils literal"><span class="pre">/tmp/file</span></tt> if the test passes:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="s1">&#39;/tmp/file&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:delete</span>
  <span class="n">only_if</span> <span class="s1">&#39;test -L /tmp/file&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create multiple symbolic links</strong></p>
<p>The following example creates symbolic links from two files in the <tt class="docutils literal"><span class="pre">/vol/webserver/cert/</span></tt> directory to files located in the <tt class="docutils literal"><span class="pre">/etc/ssl/certs/</span></tt> directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="s1">&#39;/vol/webserver/cert/server.crt&#39;</span> <span class="k">do</span>
  <span class="n">to</span> <span class="s1">&#39;/etc/ssl/certs/ssl-cert-name.pem&#39;</span>
<span class="k">end</span>

<span class="n">link</span> <span class="s1">&#39;/vol/webserver/cert/server.key&#39;</span> <span class="k">do</span>
  <span class="n">to</span> <span class="s1">&#39;/etc/ssl/certs/ssl-cert-name.key&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create platform-specific symbolic links</strong></p>
<p>The following example shows installing a filter module on Apache. The package name is different for different platforms, and for the Red Hat Enterprise Linux family, a symbolic link is required:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">include_recipe</span> <span class="s1">&#39;apache2::default&#39;</span>

<span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform_family&#39;</span><span class="o">]</span>
<span class="k">when</span> <span class="s1">&#39;debian&#39;</span>
  <span class="o">...</span>
<span class="k">when</span> <span class="s1">&#39;suse&#39;</span>
  <span class="o">...</span>
<span class="k">when</span> <span class="s1">&#39;rhel&#39;</span><span class="p">,</span> <span class="s1">&#39;fedora&#39;</span>
  <span class="o">...</span>

  <span class="n">link</span> <span class="s1">&#39;/usr/lib64/httpd/modules/mod_apreq.so&#39;</span> <span class="k">do</span>
    <span class="n">to</span>      <span class="s1">&#39;/usr/lib64/httpd/modules/mod_apreq2.so&#39;</span>
    <span class="n">only_if</span> <span class="s1">&#39;test -f /usr/lib64/httpd/modules/mod_apreq2.so&#39;</span>
  <span class="k">end</span>

  <span class="n">link</span> <span class="s1">&#39;/usr/lib/httpd/modules/mod_apreq.so&#39;</span> <span class="k">do</span>
    <span class="n">to</span>      <span class="s1">&#39;/usr/lib/httpd/modules/mod_apreq2.so&#39;</span>
    <span class="n">only_if</span> <span class="s1">&#39;test -f /usr/lib/httpd/modules/mod_apreq2.so&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="o">...</span>
</pre></div>
</div>
<p>For the entire recipe, see <a class="reference external" href="https://github.com/onehealth-cookbooks/apache2/blob/68bdfba4680e70b3e90f77e40223dd535bf22c17/recipes/mod_apreq2.rb">https://github.com/onehealth-cookbooks/apache2/blob/68bdfba4680e70b3e90f77e40223dd535bf22c17/recipes/mod_apreq2.rb</a>.</p>
</div>
<div class="section" id="log">
<h2>log<a class="headerlink" href="#log" title="Permalink to this headline"></a></h2>
<p>Use the <strong>log</strong> resource to create log entries. The <strong>log</strong> resource behaves like any other resource: built into the resource collection during the compile phase, and then run during the execution phase. (To create a log entry that is not built into the resource collection, use <tt class="docutils literal"><span class="pre">Chef::Log</span></tt> instead of the <strong>log</strong> resource.)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, every log resource that executes will count as an updated resource in the updated resource count at the end of a Chef run. You can disable this behavior by adding <tt class="docutils literal"><span class="pre">count_log_resource_updates</span> <span class="pre">false</span></tt> to your Chef <tt class="docutils literal"><span class="pre">client.rb</span></tt> configuration file.</p>
</div>
<p><strong>Set default logging level</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="s1">&#39;a string to log&#39;</span>
</pre></div>
</div>
<p><strong>Set debug logging level</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="s1">&#39;a debug string&#39;</span> <span class="k">do</span>
  <span class="n">level</span> <span class="ss">:debug</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Add a message to a log file</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="s1">&#39;message&#39;</span> <span class="k">do</span>
  <span class="n">message</span> <span class="s1">&#39;This is the message that will be added to the log.&#39;</span>
  <span class="n">level</span> <span class="ss">:info</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="macports-package">
<h2>macports_package<a class="headerlink" href="#macports-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>macports_package</strong> resource to manage packages for the Mac OS X platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">macports_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="mdadm">
<h2>mdadm<a class="headerlink" href="#mdadm" title="Permalink to this headline"></a></h2>
<p>Use the <strong>mdadm</strong> resource to manage RAID devices in a Linux environment using the mdadm utility. The <strong>mdadm</strong> provider will create and assemble an array, but it will not create the config file that is used to persist the array upon reboot. If the config file is required, it must be done by specifying a template with the correct array layout, and then by using the <strong>mount</strong> provider to create a file systems table (fstab) entry.</p>
<p><strong>Create and assemble a RAID 0 array</strong></p>
<p>The mdadm command can be used to create RAID arrays. For example, a RAID 0 array named <tt class="docutils literal"><span class="pre">/dev/md0</span></tt> with 10 devices would have a command similar to the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mdadm --create /dev/md0 --level<span class="o">=</span><span class="m">0</span> --raid-devices<span class="o">=</span><span class="m">10</span> /dev/s01.../dev/s10
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">/dev/s01</span> <span class="pre">..</span> <span class="pre">/dev/s10</span></tt> represents 10 devices (01, 02, 03, and so on). This same command, when expressed as a recipe using the <strong>mdadm</strong> resource, would be similar to:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mdadm</span> <span class="s1">&#39;/dev/md0&#39;</span> <span class="k">do</span>
  <span class="n">devices</span> <span class="o">[</span> <span class="s1">&#39;/dev/s01&#39;</span><span class="p">,</span> <span class="o">...</span> <span class="s1">&#39;/dev/s10&#39;</span> <span class="o">]</span>
  <span class="n">level</span> <span class="mi">0</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>(again, where <tt class="docutils literal"><span class="pre">/dev/s01</span> <span class="pre">..</span> <span class="pre">/dev/s10</span></tt> represents devices /dev/s01, /dev/s02, /dev/s03, and so on).</p>
<p><strong>Create and assemble a RAID 1 array</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mdadm</span> <span class="s1">&#39;/dev/md0&#39;</span> <span class="k">do</span>
  <span class="n">devices</span> <span class="o">[</span> <span class="s1">&#39;/dev/sda&#39;</span><span class="p">,</span> <span class="s1">&#39;/dev/sdb&#39;</span> <span class="o">]</span>
  <span class="n">level</span> <span class="mi">1</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:assemble</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create and assemble a RAID 5 array</strong></p>
<p>The mdadm command can be used to create RAID arrays. For example, a RAID 5 array named <tt class="docutils literal"><span class="pre">/dev/sd0</span></tt> with 4, and a superblock type of <tt class="docutils literal"><span class="pre">0.90</span></tt> would be similar to:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mdadm</span> <span class="s1">&#39;/dev/sd0&#39;</span> <span class="k">do</span>
  <span class="n">devices</span> <span class="o">[</span> <span class="s1">&#39;/dev/s1&#39;</span><span class="p">,</span> <span class="s1">&#39;/dev/s2&#39;</span><span class="p">,</span> <span class="s1">&#39;/dev/s3&#39;</span><span class="p">,</span> <span class="s1">&#39;/dev/s4&#39;</span> <span class="o">]</span>
  <span class="n">level</span> <span class="mi">5</span>
  <span class="n">metadata</span> <span class="s1">&#39;0.90&#39;</span>
  <span class="n">chunk</span> <span class="mi">32</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="mount">
<h2>mount<a class="headerlink" href="#mount" title="Permalink to this headline"></a></h2>
<p>Use the <strong>mount</strong> resource to manage a mounted file system.</p>
<p><strong>Mount a labeled file system</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;/mnt/volume1&#39;</span> <span class="k">do</span>
  <span class="n">device</span> <span class="s1">&#39;volume1&#39;</span>
  <span class="n">device_type</span> <span class="ss">:label</span>
  <span class="n">fstype</span> <span class="s1">&#39;xfs&#39;</span>
  <span class="n">options</span> <span class="s1">&#39;rw&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Mount a local block drive</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;/mnt/local&#39;</span> <span class="k">do</span>
  <span class="n">device</span> <span class="s1">&#39;/dev/sdb1&#39;</span>
  <span class="n">fstype</span> <span class="s1">&#39;ext3&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Mount a non-block file system</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;/mount/tmp&#39;</span> <span class="k">do</span>
  <span class="n">pass</span>     <span class="mi">0</span>
  <span class="n">fstype</span>   <span class="s1">&#39;tmpfs&#39;</span>
  <span class="n">device</span>   <span class="s1">&#39;/dev/null&#39;</span>
  <span class="n">options</span>  <span class="s1">&#39;nr_inodes=999k,mode=755,size=500m&#39;</span>
  <span class="n">action</span>   <span class="o">[</span><span class="ss">:mount</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Mount and add to the file systems table</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;/export/www&#39;</span> <span class="k">do</span>
  <span class="n">device</span> <span class="s1">&#39;nas1prod:/export/web_sites&#39;</span>
  <span class="n">fstype</span> <span class="s1">&#39;nfs&#39;</span>
  <span class="n">options</span> <span class="s1">&#39;rw&#39;</span>
  <span class="n">action</span> <span class="o">[</span><span class="ss">:mount</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Mount a remote file system</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;/export/www&#39;</span> <span class="k">do</span>
  <span class="n">device</span> <span class="s1">&#39;nas1prod:/export/web_sites&#39;</span>
  <span class="n">fstype</span> <span class="s1">&#39;nfs&#39;</span>
  <span class="n">options</span> <span class="s1">&#39;rw&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Mount a remote folder in Microsoft Windows</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;T:&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:mount</span>
  <span class="n">device</span> <span class="s1">&#39;\\\\hostname.example.com\\folder&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Unmount a remote folder in Microsoft Windows</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;T:&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:umount</span>
  <span class="n">device</span> <span class="s1">&#39;\\\\hostname.example.com\\D$&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Stop a service, do stuff, and then restart it</strong></p>
<p>The following example shows how to use the <strong>execute</strong>, <strong>service</strong>, and <strong>mount</strong> resources together to ensure that a node running on Amazon EC2 is running MySQL. This example does the following:</p>
<ul class="simple">
<li>Checks to see if the Amazon EC2 node has MySQL</li>
<li>If the node has MySQL, stops MySQL</li>
<li>Installs MySQL</li>
<li>Mounts the node</li>
<li>Restarts MySQL</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``server_ec2``</span>
<span class="c1"># recipe in the following cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/mysql</span>

<span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attribute?</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">))</span>

  <span class="n">service</span> <span class="s1">&#39;mysql&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:stop</span>
  <span class="k">end</span>

  <span class="n">execute</span> <span class="s1">&#39;install-mysql&#39;</span> <span class="k">do</span>
    <span class="n">command</span> <span class="s2">&quot;mv </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">not_if</span> <span class="k">do</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">)</span> <span class="k">end</span>
  <span class="k">end</span>

  <span class="o">[</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
    <span class="n">directory</span> <span class="n">dir</span> <span class="k">do</span>
      <span class="n">owner</span> <span class="s1">&#39;mysql&#39;</span>
      <span class="n">group</span> <span class="s1">&#39;mysql&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">mount</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">device</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span>
    <span class="n">fstype</span> <span class="s1">&#39;none&#39;</span>
    <span class="n">options</span> <span class="s1">&#39;bind,rw&#39;</span>
    <span class="n">action</span> <span class="o">[</span><span class="ss">:mount</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="n">service</span> <span class="s1">&#39;mysql&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:start</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li>the two <strong>service</strong> resources are used to stop, and then restart the MySQL service</li>
<li>the <strong>execute</strong> resource is used to install MySQL</li>
<li>the <strong>mount</strong> resource is used to mount the node and enable MySQL</li>
</ul>
</div>
<div class="section" id="ohai">
<h2>ohai<a class="headerlink" href="#ohai" title="Permalink to this headline"></a></h2>
<p>Use the <strong>ohai</strong> resource to reload the Ohai configuration on a node. This allows recipes that change system attributes (like a recipe that adds a user) to refer to those attributes later on during the chef-client run.</p>
<p><strong>Reload Ohai</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ohai</span> <span class="s1">&#39;reload&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:reload</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reload Ohai after a new user is created</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ohai</span> <span class="s1">&#39;reload_passwd&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">plugin</span> <span class="s1">&#39;etc&#39;</span>
<span class="k">end</span>

<span class="n">user</span> <span class="s1">&#39;daemonuser&#39;</span> <span class="k">do</span>
  <span class="n">home</span> <span class="s1">&#39;/dev/null&#39;</span>
  <span class="n">shell</span> <span class="s1">&#39;/sbin/nologin&#39;</span>
  <span class="nb">system</span> <span class="kp">true</span>
  <span class="n">notifies</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;ohai[reload_passwd]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;just an example&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="c1"># These variables will now have the new values</span>
    <span class="nb">puts</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;etc&#39;</span><span class="o">][</span><span class="s1">&#39;passwd&#39;</span><span class="o">][</span><span class="s1">&#39;daemonuser&#39;</span><span class="o">][</span><span class="s1">&#39;uid&#39;</span><span class="o">]</span>
    <span class="nb">puts</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;etc&#39;</span><span class="o">][</span><span class="s1">&#39;passwd&#39;</span><span class="o">][</span><span class="s1">&#39;daemonuser&#39;</span><span class="o">][</span><span class="s1">&#39;gid&#39;</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="openbsd-package">
<h2>openbsd_package<a class="headerlink" href="#openbsd-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>openbsd_package</strong> resource to manage packages for the OpenBSD platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">openbsd_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="osx-profile">
<h2>osx_profile<a class="headerlink" href="#osx-profile" title="Permalink to this headline"></a></h2>
<p>Use the <strong>osx_profile</strong> resource to manage configuration profiles (<tt class="docutils literal"><span class="pre">.mobileconfig</span></tt> files) on the Mac OS X platform. The <strong>osx_profile</strong> resource installs profiles by using the <tt class="docutils literal"><span class="pre">uuidgen</span></tt> library to generate a unique <tt class="docutils literal"><span class="pre">ProfileUUID</span></tt>, and then using the <tt class="docutils literal"><span class="pre">profiles</span></tt> command to install the profile on the system.</p>
<p><strong>One liner to install profile from cookbook file</strong></p>
<p>The <tt class="docutils literal"><span class="pre">profiles</span></tt> command will be used to install the specified configuration profile.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">osx_profile</span> <span class="s1">&#39;com.company.screensaver.mobileconfig&#39;</span>
</pre></div>
</div>
<p><strong>Install profile from cookbook file</strong></p>
<p>The <tt class="docutils literal"><span class="pre">profiles</span></tt> command will be used to install the specified configuration profile. It can be in sub-directory within a cookbook.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">osx_profile</span> <span class="s1">&#39;Install screensaver profile&#39;</span> <span class="k">do</span>
  <span class="n">profile</span> <span class="s1">&#39;screensaver/com.company.screensaver.mobileconfig&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install profile from a hash</strong></p>
<p>The <tt class="docutils literal"><span class="pre">profiles</span></tt> command will be used to install the configuration profile, which is provided as a hash.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">profile_hash</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;PayloadIdentifier&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;com.company.screensaver&#39;</span><span class="p">,</span>
  <span class="s1">&#39;PayloadRemovalDisallowed&#39;</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span>
  <span class="s1">&#39;PayloadScope&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;System&#39;</span><span class="p">,</span>
  <span class="s1">&#39;PayloadType&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Configuration&#39;</span><span class="p">,</span>
  <span class="s1">&#39;PayloadUUID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1781fbec-3325-565f-9022-8aa28135c3cc&#39;</span><span class="p">,</span>
  <span class="s1">&#39;PayloadOrganization&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Chef&#39;</span><span class="p">,</span>
  <span class="s1">&#39;PayloadVersion&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s1">&#39;PayloadDisplayName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Screensaver Settings&#39;</span><span class="p">,</span>
  <span class="s1">&#39;PayloadContent&#39;</span><span class="o">=&gt;</span> <span class="o">[</span>
    <span class="p">{</span>
      <span class="s1">&#39;PayloadType&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;com.apple.ManagedClient.preferences&#39;</span><span class="p">,</span>
      <span class="s1">&#39;PayloadVersion&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s1">&#39;PayloadIdentifier&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;com.company.screensaver&#39;</span><span class="p">,</span>
      <span class="s1">&#39;PayloadUUID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;73fc30e0-1e57-0131-c32d-000c2944c108&#39;</span><span class="p">,</span>
      <span class="s1">&#39;PayloadEnabled&#39;</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
      <span class="s1">&#39;PayloadDisplayName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;com.apple.screensaver&#39;</span><span class="p">,</span>
      <span class="s1">&#39;PayloadContent&#39;</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s1">&#39;com.apple.screensaver&#39;</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="s1">&#39;Forced&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span>
            <span class="p">{</span>
              <span class="s1">&#39;mcx_preference_settings&#39;</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="s1">&#39;idleTime&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="o">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="o">]</span>
<span class="p">}</span>

<span class="n">osx_profile</span> <span class="s1">&#39;Install screensaver profile&#39;</span> <span class="k">do</span>
  <span class="n">profile</span> <span class="n">profile_hash</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Remove profile using identifier in resource name</strong></p>
<p>The <tt class="docutils literal"><span class="pre">profiles</span></tt> command will be used to remove the configuration profile specified by the provided <tt class="docutils literal"><span class="pre">identifier</span></tt> property.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">osx_profile</span> <span class="s1">&#39;com.company.screensaver&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:remove</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Remove profile by identifier and user friendly resource name</strong></p>
<p>The <tt class="docutils literal"><span class="pre">profiles</span></tt> command will be used to remove the configuration profile specified by the provided <tt class="docutils literal"><span class="pre">identifier</span></tt> property.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">osx_profile</span> <span class="s1">&#39;Remove screensaver profile&#39;</span> <span class="k">do</span>
  <span class="n">identifier</span> <span class="s1">&#39;com.company.screensaver&#39;</span>
  <span class="n">action</span> <span class="ss">:remove</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="package">
<h2>package<a class="headerlink" href="#package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>package</strong> resource to manage packages. When the package is installed from a local file (such as with RubyGems, dpkg, or RPM Package Manager), the file must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p>
<p><strong>Install a gems file for use in recipes</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_gem</span> <span class="s1">&#39;right_aws&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>

<span class="nb">require</span> <span class="s1">&#39;right_aws&#39;</span>
</pre></div>
</div>
<p><strong>Install a gems file from the local file system</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;right_aws&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;/tmp/right_aws-1.11.0.gem&#39;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;tar&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package version</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;tar&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="s1">&#39;1.16.1-1&#39;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package with options</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;debian-archive-keyring&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">options</span> <span class="s1">&#39;--force-yes&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package with a response_file</strong></p>
<p>Use of a <tt class="docutils literal"><span class="pre">response_file</span></tt> is only supported on Debian and Ubuntu at this time. Custom resources must be written to support the use of a <tt class="docutils literal"><span class="pre">response_file</span></tt>, which contains debconf answers to questions normally asked by the package manager on installation. Put the file in <tt class="docutils literal"><span class="pre">/files/default</span></tt> of the cookbook where the package is specified and the chef-client will use the <strong>cookbook_file</strong> resource to retrieve it.</p>
<p>To install a package with a <tt class="docutils literal"><span class="pre">response_file</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;sun-java6-jdk&#39;</span> <span class="k">do</span>
  <span class="n">response_file</span> <span class="s1">&#39;java.seed&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package using a specific provider</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;tar&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">source</span> <span class="s1">&#39;/tmp/tar-1.16.1-1.rpm&#39;</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rpm</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a specified architecture using a named provider</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;glibc-devel&#39;</span> <span class="k">do</span>
  <span class="n">arch</span> <span class="s1">&#39;i386&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Purge a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;tar&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:purge</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Remove a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;tar&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:remove</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Upgrade a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;tar&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:upgrade</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the ignore_failure common attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;syntax&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">ignore_failure</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the provider common attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;some_package&#39;</span> <span class="k">do</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rubygems</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Avoid unnecessary string interpolation</strong></p>
<p>Do this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;mysql-server&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and not this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;mysql-server&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package in a platform</strong></p>
<p>The following example shows how to use the <strong>package</strong> resource to install an application named <tt class="docutils literal"><span class="pre">app</span></tt> and ensure that the correct packages are installed for the correct platform:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;app_name&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>

<span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="ss">:platform</span><span class="o">]</span>
<span class="k">when</span> <span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span><span class="s1">&#39;debian&#39;</span>
  <span class="n">package</span> <span class="s1">&#39;app_name-doc&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:install</span>
  <span class="k">end</span>
<span class="k">when</span> <span class="s1">&#39;centos&#39;</span>
  <span class="n">package</span> <span class="s1">&#39;app_name-html&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:install</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install sudo, then configure /etc/sudoers/ file</strong></p>
<p>The following example shows how to install sudo and then configure the <tt class="docutils literal"><span class="pre">/etc/sudoers</span></tt> file:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#  the following code sample comes from the ``default`` recipe in the ``sudo`` cookbook: https://github.com/chef-cookbooks/sudo</span>

<span class="n">package</span> <span class="s1">&#39;sudo&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>

<span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;authorization&#39;</span><span class="o">][</span><span class="s1">&#39;sudo&#39;</span><span class="o">][</span><span class="s1">&#39;include_sudoers_d&#39;</span><span class="o">]</span>
  <span class="n">directory</span> <span class="s1">&#39;/etc/sudoers.d&#39;</span> <span class="k">do</span>
    <span class="n">mode</span>        <span class="s1">&#39;0755&#39;</span>
    <span class="n">owner</span>       <span class="s1">&#39;root&#39;</span>
    <span class="n">group</span>       <span class="s1">&#39;root&#39;</span>
    <span class="n">action</span>      <span class="ss">:create</span>
  <span class="k">end</span>

  <span class="n">cookbook_file</span> <span class="s1">&#39;/etc/sudoers.d/README&#39;</span> <span class="k">do</span>
    <span class="n">source</span>      <span class="s1">&#39;README&#39;</span>
    <span class="n">mode</span>        <span class="s1">&#39;0440&#39;</span>
    <span class="n">owner</span>       <span class="s1">&#39;root&#39;</span>
    <span class="n">group</span>       <span class="s1">&#39;root&#39;</span>
    <span class="n">action</span>      <span class="ss">:create</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/etc/sudoers&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;sudoers.erb&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0440&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="n">platform?</span><span class="p">(</span><span class="s1">&#39;freebsd&#39;</span><span class="p">)</span> <span class="p">?</span> <span class="s1">&#39;wheel&#39;</span> <span class="p">:</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="ss">:sudoers_groups</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;authorization&#39;</span><span class="o">][</span><span class="s1">&#39;sudo&#39;</span><span class="o">][</span><span class="s1">&#39;groups&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:sudoers_users</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;authorization&#39;</span><span class="o">][</span><span class="s1">&#39;sudo&#39;</span><span class="o">][</span><span class="s1">&#39;users&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:passwordless</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;authorization&#39;</span><span class="o">][</span><span class="s1">&#39;sudo&#39;</span><span class="o">][</span><span class="s1">&#39;passwordless&#39;</span><span class="o">]</span>
  <span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li>the <strong>package</strong> resource is used to install sudo</li>
<li>the <tt class="docutils literal"><span class="pre">if</span></tt> statement is used to ensure availability of the <tt class="docutils literal"><span class="pre">/etc/sudoers.d</span></tt> directory</li>
<li>the <strong>template</strong> resource tells the chef-client where to find the <tt class="docutils literal"><span class="pre">sudoers</span></tt> template</li>
<li>the <tt class="docutils literal"><span class="pre">variables</span></tt> property is a hash that passes values to template files (that are located in the <tt class="docutils literal"><span class="pre">templates/</span></tt> directory for the cookbook</li>
</ul>
<p><strong>Use a case statement to specify the platform</strong></p>
<p>The following example shows how to use a case statement to tell the chef-client which platforms and packages to install using cURL.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;curl&#39;</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="ss">:platform</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">&#39;redhat&#39;</span><span class="p">,</span> <span class="s1">&#39;centos&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;package_1&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;package_2&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;package_3&#39;</span>
  <span class="k">when</span> <span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span> <span class="s1">&#39;debian&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;package_a&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;package_b&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;package_c&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">node[:platform]</span></tt> for each node is identified by Ohai during every chef-client run. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;curl&#39;</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="ss">:platform</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">&#39;redhat&#39;</span><span class="p">,</span> <span class="s1">&#39;centos&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;zlib-devel&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;openssl-devel&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;libc6-dev&#39;</span>
  <span class="k">when</span> <span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span> <span class="s1">&#39;debian&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;openssl&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;pkg-config&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;subversion&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use symbols to reference attributes</strong></p>
<p>Symbols may be used to reference attributes:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;mysql-server&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="n">node</span><span class="o">[</span><span class="ss">:mysql</span><span class="o">][</span><span class="ss">:version</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p>instead of strings:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;mysql-server&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a whitespace array to simplify a recipe</strong></p>
<p>The following examples show different ways of doing the same thing. The first shows a series of packages that will be upgraded:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;package-a&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:upgrade</span>
<span class="k">end</span>

<span class="n">package</span> <span class="s1">&#39;package-b&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:upgrade</span>
<span class="k">end</span>

<span class="n">package</span> <span class="s1">&#39;package-c&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:upgrade</span>
<span class="k">end</span>

<span class="n">package</span> <span class="s1">&#39;package-d&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:upgrade</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and the next uses a single <strong>package</strong> resource and a whitespace array (<tt class="docutils literal"><span class="pre">%w</span></tt>):</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="sx">%w{package-a package-b package-c package-d}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">pkg</span><span class="o">|</span>
  <span class="n">package</span> <span class="n">pkg</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:upgrade</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">|pkg|</span></tt> is used to define the name of the resource, but also to ensure that each item in the whitespace array has its own name.</p>
<p><strong>Specify the Homebrew user with a UUID</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">homebrew_package</span> <span class="s1">&#39;emacs&#39;</span> <span class="k">do</span>
  <span class="n">homebrew_user</span> <span class="mi">1001</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify the Homebrew user with a string</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">homebrew_package</span> <span class="s1">&#39;vim&#39;</span> <span class="k">do</span>
  <span class="n">homebrew_user</span> <span class="s1">&#39;user1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="pacman-package">
<h2>pacman_package<a class="headerlink" href="#pacman-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>pacman_package</strong> resource to manage packages (using pacman) on the Arch Linux platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">pacman_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="paludis-package">
<h2>paludis_package<a class="headerlink" href="#paludis-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>paludis_package</strong> resource to manage packages for the Paludis platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">paludis_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="perl">
<h2>perl<a class="headerlink" href="#perl" title="Permalink to this headline"></a></h2>
<p>Use the <strong>perl</strong> resource to execute scripts using the Perl interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>perl</strong> script resource (which is based on the <strong>script</strong> resource) is different from the <strong>ruby_block</strong> resource because Ruby code that is run with this resource is created as a temporary file and executed like other script resources, rather than run inline.</p>
</div>
<p>No examples.</p>
</div>
<div class="section" id="portage-package">
<h2>portage_package<a class="headerlink" href="#portage-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>portage_package</strong> resource to manage packages for the Gentoo platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">portage_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="powershell-script">
<h2>powershell_script<a class="headerlink" href="#powershell-script" title="Permalink to this headline"></a></h2>
<p>Use the <strong>powershell_script</strong> resource to execute a script using the Windows PowerShell interpreter, much like how the <strong>script</strong> and <strong>script</strong>-based resources&#8212;<strong>bash</strong>, <strong>csh</strong>, <strong>perl</strong>, <strong>python</strong>, and <strong>ruby</strong>&#8212;are used. The <strong>powershell_script</strong> is specific to the Microsoft Windows platform and the Windows PowerShell interpreter.</p>
<p>The <strong>powershell_script</strong> resource creates and executes a temporary file (similar to how the <strong>script</strong> resource behaves), rather than running the command inline. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<p><strong>Write to an interpolated path</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;write-to-interpolated-path&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  $stream = [System.IO.StreamWriter] &quot;#{Chef::Config[:file_cache_path]}/powershell-test.txt&quot;</span>
<span class="sh">  $stream.WriteLine(&quot;In #{Chef::Config[:file_cache_path]}...word.&quot;)</span>
<span class="sh">  $stream.close()</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Change the working directory</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;cwd-then-write&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  $stream = [System.IO.StreamWriter] &quot;C:/powershell-test2.txt&quot;</span>
<span class="sh">  $pwd = pwd</span>
<span class="sh">  $stream.WriteLine(&quot;This is the contents of: $pwd&quot;)</span>
<span class="sh">  $dirs = dir</span>
<span class="sh">  foreach ($dir in $dirs) {</span>
<span class="sh">    $stream.WriteLine($dir.fullname)</span>
<span class="sh">  }</span>
<span class="sh">  $stream.close()</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Change the working directory in Microsoft Windows</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;cwd-to-win-env-var&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="s1">&#39;%TEMP%&#39;</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  $stream = [System.IO.StreamWriter] &quot;./temp-write-from-chef.txt&quot;</span>
<span class="sh">  $stream.WriteLine(&quot;chef on windows rox yo!&quot;)</span>
<span class="sh">  $stream.close()</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Pass an environment variable to a script</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;read-env-var&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">environment</span> <span class="p">({</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;BAZ&#39;</span><span class="p">})</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  $stream = [System.IO.StreamWriter] &quot;./test-read-env-var.txt&quot;</span>
<span class="sh">  $stream.WriteLine(&quot;FOO is $env:foo&quot;)</span>
<span class="sh">  $stream.close()</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Evaluate for true and/or false</strong></p>
<p>Use the <tt class="docutils literal"><span class="pre">convert_boolean_return</span></tt> attribute to raise an exception when certain conditions are met. For example, the following fragments will run successfully without error:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;false&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="s1">&#39;$false&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;true&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="s1">&#39;$true&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>whereas the following will raise an exception:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;false&#39;</span> <span class="k">do</span>
  <span class="n">convert_boolean_return</span> <span class="kp">true</span>
  <span class="n">code</span> <span class="s1">&#39;$false&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the flags attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;Install IIS&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  Import-Module ServerManager</span>
<span class="sh">  Add-WindowsFeature Web-Server</span>
<span class="no">  EOH</span>
  <span class="n">flags</span> <span class="s1">&#39;-NoLogo, -NonInteractive, -NoProfile, -ExecutionPolicy Unrestricted, -InputFormat None, -File&#39;</span>
  <span class="n">guard_interpreter</span> <span class="ss">:powershell_script</span>
  <span class="n">not_if</span> <span class="s1">&#39;(Get-WindowsFeature -Name Web-Server).Installed&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Rename computer, join domain, reboot</strong></p>
<p>The following example shows how to rename a computer, join a domain, and then reboot the computer:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">reboot</span> <span class="s1">&#39;Restart Computer&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">powershell_script</span> <span class="s1">&#39;Rename and Join Domain&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    ...your rename and domain join logic here...</span>
<span class="no">  EOH</span>
  <span class="n">not_if</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    $ComputerSystem = gwmi win32_computersystem</span>
<span class="sh">    ($ComputerSystem.Name -like &#39;#{node[&#39;some_attribute_that_has_the_new_name&#39;]}&#39;) -and</span>
<span class="sh">      $ComputerSystem.partofdomain)</span>
<span class="no">  EOH</span>
  <span class="n">notifies</span> <span class="ss">:reboot_now</span><span class="p">,</span> <span class="s1">&#39;reboot[Restart Computer]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li>The <strong>powershell_script</strong> resource block renames a computer, and then joins a domain</li>
<li>The <strong>reboot</strong> resource restarts the computer</li>
<li>The <tt class="docutils literal"><span class="pre">not_if</span></tt> guard prevents the Windows PowerShell script from running when the settings in the <tt class="docutils literal"><span class="pre">not_if</span></tt> guard match the desired state</li>
<li>The <tt class="docutils literal"><span class="pre">notifies</span></tt> statement tells the <strong>reboot</strong> resource block to run if the <strong>powershell_script</strong> block was executed during the chef-client run</li>
</ul>
</div>
<div class="section" id="python">
<h2>python<a class="headerlink" href="#python" title="Permalink to this headline"></a></h2>
<p>Use the <strong>python</strong> resource to execute scripts using the Python interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>python</strong> script resource (which is based on the <strong>script</strong> resource) is different from the <strong>ruby_block</strong> resource because Ruby code that is run with this resource is created as a temporary file and executed like other script resources, rather than run inline.</p>
</div>
<p>No examples.</p>
</div>
<div class="section" id="reboot">
<h2>reboot<a class="headerlink" href="#reboot" title="Permalink to this headline"></a></h2>
<p>Use the <strong>reboot</strong> resource to reboot a node, a necessary step with some installations on certain platforms. This resource is supported for use on the Microsoft Windows, Mac OS X, and Linux platforms.</p>
<p><strong>Reboot a node immediately</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">reboot</span> <span class="s1">&#39;now&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">reason</span> <span class="s1">&#39;Cannot continue Chef run without a reboot.&#39;</span>
  <span class="n">delay_mins</span> <span class="mi">2</span>
<span class="k">end</span>

<span class="n">execute</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;...&#39;</span>
  <span class="n">notifies</span> <span class="ss">:reboot_now</span><span class="p">,</span> <span class="s1">&#39;reboot[now]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reboot a node at the end of a chef-client run</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">reboot</span> <span class="s1">&#39;app_requires_reboot&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:request_reboot</span>
  <span class="n">reason</span> <span class="s1">&#39;Need to reboot when the run completes successfully.&#39;</span>
  <span class="n">delay_mins</span> <span class="mi">5</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Cancel a reboot</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">reboot</span> <span class="s1">&#39;cancel_reboot_request&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:cancel</span>
  <span class="n">reason</span> <span class="s1">&#39;Cancel a previous end-of-run reboot request.&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Rename computer, join domain, reboot</strong></p>
<p>The following example shows how to rename a computer, join a domain, and then reboot the computer:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">reboot</span> <span class="s1">&#39;Restart Computer&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">powershell_script</span> <span class="s1">&#39;Rename and Join Domain&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    ...your rename and domain join logic here...</span>
<span class="no">  EOH</span>
  <span class="n">not_if</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    $ComputerSystem = gwmi win32_computersystem</span>
<span class="sh">    ($ComputerSystem.Name -like &#39;#{node[&#39;some_attribute_that_has_the_new_name&#39;]}&#39;) -and</span>
<span class="sh">      $ComputerSystem.partofdomain)</span>
<span class="no">  EOH</span>
  <span class="n">notifies</span> <span class="ss">:reboot_now</span><span class="p">,</span> <span class="s1">&#39;reboot[Restart Computer]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li>The <strong>powershell_script</strong> resource block renames a computer, and then joins a domain</li>
<li>The <strong>reboot</strong> resource restarts the computer</li>
<li>The <tt class="docutils literal"><span class="pre">not_if</span></tt> guard prevents the Windows PowerShell script from running when the settings in the <tt class="docutils literal"><span class="pre">not_if</span></tt> guard match the desired state</li>
<li>The <tt class="docutils literal"><span class="pre">notifies</span></tt> statement tells the <strong>reboot</strong> resource block to run if the <strong>powershell_script</strong> block was executed during the chef-client run</li>
</ul>
</div>
<div class="section" id="registry-key">
<h2>registry_key<a class="headerlink" href="#registry-key" title="Permalink to this headline"></a></h2>
<p>Use the <strong>registry_key</strong> resource to create and delete registry keys in Microsoft Windows.</p>
<p><strong>Create a registry key</strong></p>
<p>Use a double-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s2">&quot;HKEY_LOCAL_MACHINE</span><span class="se">\\</span><span class="s2">path-to-key</span><span class="se">\\</span><span class="s2">Policies</span><span class="se">\\</span><span class="s2">System&quot;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span>
    <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;EnableLUA&#39;</span><span class="p">,</span>
    <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:dword</span><span class="p">,</span>
    <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="mi">0</span>
  <span class="p">}</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or a single-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s1">&#39;HKEY_LOCAL_MACHINE\path-to-key\Policies\System&#39;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span>
    <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;EnableLUA&#39;</span><span class="p">,</span>
    <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:dword</span><span class="p">,</span>
    <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="mi">0</span>
  <span class="p">}</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delete a registry key value</strong></p>
<p>Use a double-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s2">&quot;HKEY_LOCAL_MACHINE</span><span class="se">\\</span><span class="s2">SOFTWARE</span><span class="se">\\</span><span class="s2">path</span><span class="se">\\</span><span class="s2">to</span><span class="se">\\</span><span class="s2">key</span><span class="se">\\</span><span class="s2">AU&quot;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span>
    <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;NoAutoRebootWithLoggedOnUsers&#39;</span><span class="p">,</span>
    <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:dword</span><span class="p">,</span>
    <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:delete</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or a single-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s1">&#39;HKEY_LOCAL_MACHINE\SOFTWARE\path\to\key\AU&#39;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span>
    <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;NoAutoRebootWithLoggedOnUsers&#39;</span><span class="p">,</span>
    <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:dword</span><span class="p">,</span>
    <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:delete</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If <tt class="docutils literal"><span class="pre">:data</span></tt> is not specified, you get an error: <tt class="docutils literal"><span class="pre">Missing</span> <span class="pre">data</span> <span class="pre">key</span> <span class="pre">in</span> <span class="pre">RegistryKey</span> <span class="pre">values</span> <span class="pre">hash</span></tt></p>
</div>
<p><strong>Delete a registry key and its subkeys, recursively</strong></p>
<p>Use a double-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s2">&quot;HKCU</span><span class="se">\\</span><span class="s2">SOFTWARE</span><span class="se">\\</span><span class="s2">Policies</span><span class="se">\\</span><span class="s2">path</span><span class="se">\\</span><span class="s2">to</span><span class="se">\\</span><span class="s2">key</span><span class="se">\\</span><span class="s2">Themes&quot;</span> <span class="k">do</span>
  <span class="n">recursive</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:delete_key</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or a single-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s1">&#39;HKCU\SOFTWARE\Policies\path\to\key\Themes&#39;</span> <span class="k">do</span>
  <span class="n">recursive</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:delete_key</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be careful when using the <tt class="docutils literal"><span class="pre">:delete_key</span></tt> action with the <tt class="docutils literal"><span class="pre">recursive</span></tt> attribute. This will delete the registry key, all of its values and all of the names, types, and data associated with them. This cannot be undone by the chef-client.</p>
</div>
<p><strong>Use re-directed keys</strong></p>
<p>In 64-bit versions of Microsoft Windows, <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE\SOFTWARE\Example</span></tt> is a re-directed key. In the following examples, because <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE\SOFTWARE\Example</span></tt> is a 32-bit key, the output will be &#8220;Found 32-bit key&#8221; if they are run on a version of Microsoft Windows that is 64-bit:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s2">&quot;HKEY_LOCAL_MACHINE</span><span class="se">\\</span><span class="s2">SOFTWARE</span><span class="se">\\</span><span class="s2">Example&quot;</span> <span class="k">do</span>
  <span class="n">architecture</span> <span class="ss">:i386</span>
  <span class="n">recursive</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s2">&quot;HKEY_LOCAL_MACHINE</span><span class="se">\\</span><span class="s2">SOFTWARE</span><span class="se">\\</span><span class="s2">Example&quot;</span> <span class="k">do</span>
  <span class="n">architecture</span> <span class="ss">:x86_64</span>
  <span class="n">recursive</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:delete_key</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ruby_block</span> <span class="s1">&#39;check 32-bit&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s1">&#39;Found 32-bit key&#39;</span>
  <span class="k">end</span>
  <span class="n">only_if</span> <span class="p">{</span>
    <span class="n">registry_key_exists?</span><span class="p">(</span><span class="s2">&quot;HKEY_LOCAL_MACHINE\SOFTWARE</span><span class="se">\\</span><span class="s2">Example&quot;</span><span class="p">,</span>
    <span class="ss">:i386</span><span class="p">)</span>
  <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ruby_block</span> <span class="s1">&#39;check 64-bit&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s1">&#39;Found 64-bit key&#39;</span>
  <span class="k">end</span>
  <span class="n">only_if</span> <span class="p">{</span>
    <span class="n">registry_key_exists?</span><span class="p">(</span><span class="s2">&quot;HKEY_LOCAL_MACHINE</span><span class="se">\\</span><span class="s2">SOFTWARE</span><span class="se">\\</span><span class="s2">Example&quot;</span><span class="p">,</span>
    <span class="ss">:x86_64</span><span class="p">)</span>
  <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set proxy settings to be the same as those used by the chef-client</strong></p>
<p>Use a double-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">proxy</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:http_proxy</span><span class="o">]</span><span class="p">)</span>
<span class="n">registry_key</span> <span class="s2">&quot;HKCU\Software\Microsoft\path</span><span class="se">\t</span><span class="s2">o\key\Internet Settings&quot;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;ProxyEnable&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:reg_dword</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">},</span>
          <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;ProxyServer&#39;</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">proxy</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">proxy</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;ProxyOverride&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:reg_string</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="n">local</span><span class="o">&gt;</span><span class="p">},</span>
         <span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or a single-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">proxy</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:http_proxy</span><span class="o">]</span><span class="p">)</span>
<span class="n">registry_key</span> <span class="s1">&#39;HKCU\Software\Microsoft\path\to\key\Internet Settings&#39;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;ProxyEnable&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:reg_dword</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">},</span>
          <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;ProxyServer&#39;</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">proxy</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">proxy</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;ProxyOverride&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:reg_string</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="n">local</span><span class="o">&gt;</span><span class="p">},</span>
         <span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set the name of a registry key to &#8220;(Default)&#8221;</strong></p>
<p>Use a double-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s1">&#39;Set (Default) value&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:create</span>
  <span class="n">key</span> <span class="s2">&quot;HKLM</span><span class="se">\\</span><span class="s2">Software</span><span class="se">\\</span><span class="s2">Test</span><span class="se">\\</span><span class="s2">Key</span><span class="se">\\</span><span class="s2">Path&quot;</span>
  <span class="n">values</span> <span class="o">[</span>
    <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:string</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="s1">&#39;test&#39;</span><span class="p">},</span>
  <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or a single-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s1">&#39;Set (Default) value&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:create</span>
  <span class="n">key</span> <span class="s1">&#39;HKLM\Software\Test\Key\Path&#39;</span>
  <span class="n">values</span> <span class="o">[</span>
    <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:string</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="s1">&#39;test&#39;</span><span class="p">},</span>
  <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">:name</span> <span class="pre">=&gt;</span> <span class="pre">''</span></tt> contains an empty string, which will set the name of the registry key to <tt class="docutils literal"><span class="pre">(Default)</span></tt>.</p>
</div>
<div class="section" id="remote-directory">
<h2>remote_directory<a class="headerlink" href="#remote-directory" title="Permalink to this headline"></a></h2>
<p>Use the <strong>remote_directory</strong> resource to incrementally transfer a directory from a cookbook to a node. The directory that is copied from the cookbook should be located under <tt class="docutils literal"><span class="pre">COOKBOOK_NAME/files/default/REMOTE_DIRECTORY</span></tt>. The <strong>remote_directory</strong> resource will obey file specificity.</p>
<p><strong>Recursively transfer a directory from a remote location</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># create up to 10 backups of the files</span>
<span class="c1"># set the files owner different from the directory</span>
<span class="n">remote_directory</span> <span class="s1">&#39;/tmp/remote_something&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;something&#39;</span>
  <span class="n">files_backup</span> <span class="mi">10</span>
  <span class="n">files_owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">files_group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">files_mode</span> <span class="s1">&#39;0644&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;nobody&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;nobody&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use with the chef_handler lightweight resource</strong></p>
<p>The following example shows how to use the <strong>remote_directory</strong> resource and the <strong>chef_handler</strong> resource to reboot a handler named <tt class="docutils literal"><span class="pre">WindowsRebootHandler</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the</span>
<span class="c1"># ``reboot_handler`` recipe in the ``windows`` cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/windows</span>

<span class="n">remote_directory</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_handler&#39;</span><span class="o">][</span><span class="s1">&#39;handler_path&#39;</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;handlers&#39;</span>
  <span class="n">recursive</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>

<span class="n">chef_handler</span> <span class="s1">&#39;WindowsRebootHandler&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_handler&#39;</span><span class="o">][</span><span class="s1">&#39;handler_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/windows_reboot_handler.rb&quot;</span>
  <span class="n">arguments</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;windows&#39;</span><span class="o">][</span><span class="s1">&#39;allow_pending_reboots&#39;</span><span class="o">]</span>
  <span class="n">supports</span> <span class="ss">:report</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:exception</span> <span class="o">=&gt;</span> <span class="kp">false</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="remote-file">
<h2>remote_file<a class="headerlink" href="#remote-file" title="Permalink to this headline"></a></h2>
<p>Use the <strong>remote_file</strong> resource to transfer a file from a remote location using file specificity. This resource is similar to the <strong>file</strong> resource.</p>
<p><strong>Transfer a file from a URL</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/tmp/testfile&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://www.example.com/tempfiles/testfile&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">checksum</span> <span class="s1">&#39;3a7dac00b1&#39;</span> <span class="c1"># A SHA256 (or portion thereof) of the file.</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a file from a remote location using bash</strong></p>
<p>The following is an example of how to install the <tt class="docutils literal"><span class="pre">foo123</span></tt> module for Nginx. This module adds shell-style functionality to an Nginx configuration file and does the following:</p>
<ul class="simple">
<li>Declares three variables</li>
<li>Gets the Nginx file from a remote location</li>
<li>Installs the file using Bash to the path specified by the <tt class="docutils literal"><span class="pre">src_filepath</span></tt> variable</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample is similar to the ``upload_progress_module``</span>
<span class="c1"># recipe in the ``nginx`` cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/nginx</span>

<span class="n">src_filename</span> <span class="o">=</span> <span class="s2">&quot;foo123-nginx-module-v</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">.tar.gz&quot;</span>
<span class="n">src_filepath</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">src_filename</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">extract_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span>
  <span class="si">}</span><span class="s2">/nginx_foo123_module/</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s1">&#39;src_filepath&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;extract_module&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    mkdir -p #{extract_path}</span>
<span class="sh">    tar xzf #{src_filename} -C #{extract_path}</span>
<span class="sh">    mv #{extract_path}/*/* #{extract_path}/</span>
<span class="no">    EOH</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Store certain settings</strong></p>
<p>The following recipe shows how an attributes file can be used to store certain settings. An attributes file is located in the <tt class="docutils literal"><span class="pre">attributes/</span></tt> directory in the same cookbook as the recipe which calls the attributes file. In this example, the attributes file specifies certain settings for Python that are then used across all nodes against which this recipe will run.</p>
<p>Python packages have versions, installation directories, URLs, and checksum files. An attributes file that exists to support this type of recipe would include settings like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;2.7.1&#39;</span>

<span class="k">if</span> <span class="n">python</span><span class="o">[</span><span class="s1">&#39;install_method&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;package&#39;</span>
  <span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/usr&#39;</span>
<span class="k">else</span>
  <span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/usr/local&#39;</span>
<span class="k">end</span>

<span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;http://www.python.org/ftp/python&#39;</span>
<span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;80e387...85fd61&#39;</span>
</pre></div>
</div>
<p>and then the methods in the recipe may refer to these values. A recipe that is used to install Python will need to do the following:</p>
<ul class="simple">
<li>Identify each package to be installed (implied in this example, not shown)</li>
<li>Define variables for the package <tt class="docutils literal"><span class="pre">version</span></tt> and the <tt class="docutils literal"><span class="pre">install_path</span></tt></li>
<li>Get the package from a remote location, but only if the package does not already exist on the target system</li>
<li>Use the <strong>bash</strong> resource to install the package on the node, but only when the package is not already installed</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#  the following code sample comes from the ``oc-nginx`` cookbook on |github|: https://github.com/cookbooks/oc-nginx</span>

<span class="n">version</span> <span class="o">=</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="n">install_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/lib/python</span><span class="si">#{</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/(^\d+\.\d+)/</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/Python-</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">.tar.bz2&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">/Python-</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">.tar.bz2&quot;</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">install_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;build-and-install-python&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span>
<span class="sh">    tar -jxvf Python-#{version}.tar.bz2</span>
<span class="sh">    (cd Python-#{version} &amp;&amp; ./configure #{configure_options})</span>
<span class="sh">    (cd Python-#{version} &amp;&amp; make &amp;&amp; make install)</span>
<span class="no">  EOF</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">install_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the platform_family? method</strong></p>
<p>The following is an example of using the <tt class="docutils literal"><span class="pre">platform_family?</span></tt> method in the Recipe DSL to create a variable that can be used with other resources in the same recipe. In this example, <tt class="docutils literal"><span class="pre">platform_family?</span></tt> is being used to ensure that a specific binary is used for a specific platform before using the <strong>remote_file</strong> resource to download a file from a remote location, and then using the <strong>execute</strong> resource to install that file by running a command.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">platform_family?</span><span class="p">(</span><span class="s1">&#39;rhel&#39;</span><span class="p">)</span>
  <span class="n">pip_binary</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/pip&#39;</span>
<span class="k">else</span>
  <span class="n">pip_binary</span> <span class="o">=</span> <span class="s1">&#39;/usr/local/bin/pip&#39;</span>
<span class="k">end</span>

<span class="n">remote_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/distribute_setup.py&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://python-distribute.org/distribute_setup.py&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">pip_binary</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">execute</span> <span class="s1">&#39;install-pip&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">command</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span>
<span class="sh">    # command for installing Python goes here</span>
<span class="no">    EOF</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">pip_binary</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where a command for installing Python might look something like:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#{node[&#39;python&#39;][&#39;binary&#39;]} distribute_setup.py</span>
<span class="c1">#{::File.dirname(pip_binary)}/easy_install pip</span>
</pre></div>
</div>
<p><strong>Specify local Windows file path as a valid URI</strong></p>
<p>When specifying a local Microsoft Windows file path as a valid file URI, an additional forward slash (<tt class="docutils literal"><span class="pre">/</span></tt>) is required. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;file:///c:/path/to/file&#39;</span> <span class="k">do</span>
  <span class="o">...</span>       <span class="c1"># other attributes</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="route">
<h2>route<a class="headerlink" href="#route" title="Permalink to this headline"></a></h2>
<p>Use the <strong>route</strong> resource to manage the system routing table in a Linux environment.</p>
<p><strong>Add a host route</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">route</span> <span class="s1">&#39;10.0.1.10/32&#39;</span> <span class="k">do</span>
  <span class="n">gateway</span> <span class="s1">&#39;10.0.0.20&#39;</span>
  <span class="n">device</span> <span class="s1">&#39;eth1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delete a network route</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">route</span> <span class="s1">&#39;10.1.1.0/24&#39;</span> <span class="k">do</span>
  <span class="n">gateway</span> <span class="s1">&#39;10.0.0.20&#39;</span>
  <span class="n">action</span> <span class="ss">:delete</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="rpm-package">
<h2>rpm_package<a class="headerlink" href="#rpm-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>rpm_package</strong> resource to manage packages for the RPM Package Manager platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rpm_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="ruby">
<h2>ruby<a class="headerlink" href="#ruby" title="Permalink to this headline"></a></h2>
<p>Use the <strong>ruby</strong> resource to execute scripts using the Ruby interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>ruby</strong> script resource (which is based on the <strong>script</strong> resource) is different from the <strong>ruby_block</strong> resource because Ruby code that is run with this resource is created as a temporary file and executed like other script resources, rather than run inline.</p>
</div>
<p>No examples.</p>
</div>
<div class="section" id="ruby-block">
<h2>ruby_block<a class="headerlink" href="#ruby-block" title="Permalink to this headline"></a></h2>
<p>Use the <strong>ruby_block</strong> resource to execute Ruby code during a chef-client run. Ruby code in the <tt class="docutils literal"><span class="pre">ruby_block</span></tt> resource is evaluated with other resources during convergence, whereas Ruby code outside of a <tt class="docutils literal"><span class="pre">ruby_block</span></tt> resource is evaluated before other resources, as the recipe is compiled.</p>
<p><strong>Re-read configuration data</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ruby_block</span> <span class="s1">&#39;reload_client_config&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;/etc/chef/client.rb&#39;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install repositories from a file, trigger a command, and force the internal cache to reload</strong></p>
<p>The following example shows how to install new Yum repositories from a file, where the installation of the repository triggers a creation of the Yum cache that forces the internal cache for the chef-client to reload:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;create-yum-cache&#39;</span> <span class="k">do</span>
 <span class="n">command</span> <span class="s1">&#39;yum -q makecache&#39;</span>
 <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;reload-internal-yum-cache&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Yum</span><span class="o">::</span><span class="no">YumCache</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">reload</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">cookbook_file</span> <span class="s1">&#39;/etc/yum.repos.d/custom.repo&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;custom&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[create-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload-internal-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use an if statement with the platform recipe DSL method</strong></p>
<p>The following example shows how an if statement can be used with the <tt class="docutils literal"><span class="pre">platform?</span></tt> method in the Recipe DSL to run code specific to Microsoft Windows. The code is defined using the <strong>ruby_block</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``client`` recipe</span>
<span class="c1"># in the following cookbook: https://github.com/chef-cookbooks/mysql</span>

<span class="k">if</span> <span class="n">platform?</span><span class="p">(</span><span class="s1">&#39;windows&#39;</span><span class="p">)</span>
  <span class="n">ruby_block</span> <span class="s1">&#39;copy libmysql.dll into ruby path&#39;</span> <span class="k">do</span>
    <span class="n">block</span> <span class="k">do</span>
      <span class="nb">require</span> <span class="s1">&#39;fileutils&#39;</span>
      <span class="no">FileUtils</span><span class="o">.</span><span class="n">cp</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;client&#39;</span><span class="o">][</span><span class="s1">&#39;lib_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="se">\\</span><span class="s2">libmysql.dll&quot;</span><span class="p">,</span>
        <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;client&#39;</span><span class="o">][</span><span class="s1">&#39;ruby_dir&#39;</span><span class="o">]</span>
    <span class="k">end</span>
    <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;client&#39;</span><span class="o">][</span><span class="s1">&#39;ruby_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="se">\\</span><span class="s2">libmysql.dll&quot;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Stash a file in a data bag</strong></p>
<p>The following example shows how to use the <strong>ruby_block</strong> resource to stash a BitTorrent file in a data bag so that it can be distributed to nodes in the organization.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``seed`` recipe</span>
<span class="c1"># in the following cookbook: https://github.com/mattray/bittorrent-cookbook</span>

<span class="n">ruby_block</span> <span class="s1">&#39;share the torrent file&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;bittorrent&#39;</span><span class="o">][</span><span class="s1">&#39;torrent&#39;</span><span class="o">]</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="c1">#read the .torrent file and base64 encode it</span>
    <span class="n">enc</span> <span class="o">=</span> <span class="no">Base64</span><span class="o">.</span><span class="n">encode64</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;id&#39;</span><span class="o">=&gt;</span><span class="n">bittorrent_item_id</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;bittorrent&#39;</span><span class="o">][</span><span class="s1">&#39;file&#39;</span><span class="o">]</span><span class="p">),</span>
      <span class="s1">&#39;seed&#39;</span><span class="o">=&gt;</span><span class="n">node</span><span class="o">.</span><span class="n">ipaddress</span><span class="p">,</span>
      <span class="s1">&#39;torrent&#39;</span><span class="o">=&gt;</span><span class="n">enc</span>
    <span class="p">}</span>
    <span class="n">item</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">DataBagItem</span><span class="o">.</span><span class="n">new</span>
    <span class="n">item</span><span class="o">.</span><span class="n">data_bag</span><span class="p">(</span><span class="s1">&#39;bittorrent&#39;</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">subscribes</span> <span class="ss">:create</span><span class="p">,</span> <span class="s2">&quot;bittorrent_torrent[</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;bittorrent&#39;</span><span class="o">][</span><span class="s1">&#39;torrent&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Update the /etc/hosts file</strong></p>
<p>The following example shows how the <strong>ruby_block</strong> resource can be used to update the <tt class="docutils literal"><span class="pre">/etc/hosts</span></tt> file:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``ec2`` recipe</span>
<span class="c1"># in the following cookbook: https://github.com/chef-cookbooks/dynect</span>

<span class="n">ruby_block</span> <span class="s1">&#39;edit etc hosts&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Util</span><span class="o">::</span><span class="no">FileEdit</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;/etc/hosts&#39;</span><span class="p">)</span>
    <span class="n">rc</span><span class="o">.</span><span class="n">search_file_replace_line</span><span class="p">(</span><span class="sr">/^127\.0\.0\.1 localhost$/</span><span class="p">,</span>
       <span class="s1">&#39;127.0.0.1 #{new_fqdn} #{new_hostname} localhost&#39;</span><span class="p">)</span>
    <span class="n">rc</span><span class="o">.</span><span class="n">write_file</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set environment variables</strong></p>
<p>The following example shows how to use variables within a Ruby block to set environment variables using rbenv.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="o">[</span><span class="ss">:rbenv</span><span class="o">][</span><span class="ss">:root</span><span class="o">]</span> <span class="o">=</span> <span class="n">rbenv_root</span>
<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="o">[</span><span class="ss">:ruby_build</span><span class="o">][</span><span class="ss">:bin_path</span><span class="o">]</span> <span class="o">=</span> <span class="n">rbenv_binary_path</span>

<span class="n">ruby_block</span> <span class="s1">&#39;initialize&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;RBENV_ROOT&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">[</span><span class="ss">:rbenv</span><span class="o">][</span><span class="ss">:root</span><span class="o">]</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PATH&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:rbenv</span><span class="o">][</span><span class="ss">:root</span><span class="o">]</span><span class="si">}</span><span class="s2">/bin:</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:ruby_build</span><span class="o">][</span><span class="ss">:bin_path</span><span class="o">]</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PATH&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set JAVA_HOME</strong></p>
<p>The following example shows how to use a variable within a Ruby block to set the <tt class="docutils literal"><span class="pre">java_home</span></tt> environment variable:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ruby_block</span> <span class="s1">&#39;set-env-java-home&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;JAVA_HOME&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="n">java_home</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reload the configuration</strong></p>
<p>The following example shows how to reload the configuration of a chef-client using the <strong>remote_file</strong> resource to:</p>
<ul class="simple">
<li>using an if statement to check whether the plugins on a node are the latest versions</li>
<li>identify the location from which Ohai plugins are stored</li>
<li>using the <tt class="docutils literal"><span class="pre">notifies</span></tt> property and a <strong>ruby_block</strong> resource to trigger an update (if required) and to then reload the client.rb file.</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;node[:ohai][:plugin_path]&#39;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;chef&#39;</span>
  <span class="n">recursive</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;reload_config&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;/etc/chef/client.rb&#39;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="ss">:ohai</span><span class="o">].</span><span class="n">key?</span><span class="p">(</span><span class="ss">:plugins</span><span class="p">)</span>
  <span class="n">node</span><span class="o">[</span><span class="ss">:ohai</span><span class="o">][</span><span class="ss">:plugins</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">plugin</span><span class="o">|</span>
    <span class="n">remote_file</span> <span class="n">node</span><span class="o">[</span><span class="ss">:ohai</span><span class="o">][</span><span class="ss">:plugin_path</span><span class="o">]</span> <span class="o">+</span><span class="s2">&quot;/</span><span class="si">#{</span><span class="n">plugin</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
      <span class="n">source</span> <span class="n">plugin</span>
      <span class="n">owner</span> <span class="s1">&#39;chef&#39;</span>
              <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload_config]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="script">
<h2>script<a class="headerlink" href="#script" title="Permalink to this headline"></a></h2>
<p>Use the <strong>script</strong> resource to execute scripts using a specified interpreter, such as Bash, csh, Perl, Python, or Ruby. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>script</strong> resource is different from the <strong>ruby_block</strong> resource because Ruby code that is run with this resource is created as a temporary file and executed like other script resources, rather than run inline.</p>
</div>
<p><strong>Use a named provider to run a script</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;install_something&#39;</span> <span class="k">do</span>
  <span class="n">user</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">cwd</span> <span class="s1">&#39;/tmp&#39;</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  wget http://www.example.com/tarball.tar.gz</span>
<span class="sh">  tar -zxf tarball.tar.gz</span>
<span class="sh">  cd tarball</span>
<span class="sh">  ./configure</span>
<span class="sh">  make</span>
<span class="sh">  make install</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run a script</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">script</span> <span class="s1">&#39;install_something&#39;</span> <span class="k">do</span>
  <span class="n">interpreter</span> <span class="s1">&#39;bash&#39;</span>
  <span class="n">user</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">cwd</span> <span class="s1">&#39;/tmp&#39;</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  wget http://www.example.com/tarball.tar.gz</span>
<span class="sh">  tar -zxf tarball.tar.gz</span>
<span class="sh">  cd tarball</span>
<span class="sh">  ./configure</span>
<span class="sh">  make</span>
<span class="sh">  make install</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or something like:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;openvpn-server-key&#39;</span> <span class="k">do</span>
  <span class="n">environment</span><span class="p">(</span><span class="s1">&#39;KEY_CN&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;server&#39;</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span>
<span class="sh">    openssl req -batch -days #{node[&#39;openvpn&#39;][&#39;key&#39;][&#39;expire&#39;]} \</span>
<span class="sh">      -nodes -new -newkey rsa:#{key_size} -keyout #{key_dir}/server.key \</span>
<span class="sh">      -out #{key_dir}/server.csr -extensions server \</span>
<span class="sh">      -config #{key_dir}/openssl.cnf</span>
<span class="no">  EOF</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;#{key_dir}/server.crt&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">code</span></tt> contains the OpenSSL command to be run. The <tt class="docutils literal"><span class="pre">not_if</span></tt> property tells the chef-client not to run the command if the file already exists.</p>
<p><strong>Install a file from a remote location using bash</strong></p>
<p>The following is an example of how to install the <tt class="docutils literal"><span class="pre">foo123</span></tt> module for Nginx. This module adds shell-style functionality to an Nginx configuration file and does the following:</p>
<ul class="simple">
<li>Declares three variables</li>
<li>Gets the Nginx file from a remote location</li>
<li>Installs the file using Bash to the path specified by the <tt class="docutils literal"><span class="pre">src_filepath</span></tt> variable</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample is similar to the ``upload_progress_module``</span>
<span class="c1"># recipe in the ``nginx`` cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/nginx</span>

<span class="n">src_filename</span> <span class="o">=</span> <span class="s2">&quot;foo123-nginx-module-v</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">.tar.gz&quot;</span>
<span class="n">src_filepath</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">src_filename</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">extract_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span>
  <span class="si">}</span><span class="s2">/nginx_foo123_module/</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s1">&#39;src_filepath&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;extract_module&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    mkdir -p #{extract_path}</span>
<span class="sh">    tar xzf #{src_filename} -C #{extract_path}</span>
<span class="sh">    mv #{extract_path}/*/* #{extract_path}/</span>
<span class="no">    EOH</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install an application from git using bash</strong></p>
<p>The following example shows how Bash can be used to install a plug-in for rbenv named <tt class="docutils literal"><span class="pre">ruby-build</span></tt>, which is located in git version source control. First, the application is synchronized, and then Bash changes its working directory to the location in which <tt class="docutils literal"><span class="pre">ruby-build</span></tt> is located, and then runs a command.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span> <span class="n">git</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/ruby-build&quot;</span> <span class="k">do</span>
   <span class="n">repository</span> <span class="s1">&#39;git://github.com/sstephenson/ruby-build.git&#39;</span>
   <span class="n">reference</span> <span class="s1">&#39;master&#39;</span>
   <span class="n">action</span> <span class="ss">:sync</span>
 <span class="k">end</span>

 <span class="n">bash</span> <span class="s1">&#39;install_ruby_build&#39;</span> <span class="k">do</span>
   <span class="n">cwd</span> <span class="s1">&#39;#{Chef::Config[:file_cache_path]}/ruby-build&#39;</span>
   <span class="n">user</span> <span class="s1">&#39;rbenv&#39;</span>
   <span class="n">group</span> <span class="s1">&#39;rbenv&#39;</span>
   <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">     ./install.sh</span>
<span class="no">     EOH</span>
   <span class="n">environment</span> <span class="s1">&#39;PREFIX&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/local&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>To read more about <tt class="docutils literal"><span class="pre">ruby-build</span></tt>, see here: <a class="reference external" href="https://github.com/sstephenson/ruby-build">https://github.com/sstephenson/ruby-build</a>.</p>
<p><strong>Store certain settings</strong></p>
<p>The following recipe shows how an attributes file can be used to store certain settings. An attributes file is located in the <tt class="docutils literal"><span class="pre">attributes/</span></tt> directory in the same cookbook as the recipe which calls the attributes file. In this example, the attributes file specifies certain settings for Python that are then used across all nodes against which this recipe will run.</p>
<p>Python packages have versions, installation directories, URLs, and checksum files. An attributes file that exists to support this type of recipe would include settings like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;2.7.1&#39;</span>

<span class="k">if</span> <span class="n">python</span><span class="o">[</span><span class="s1">&#39;install_method&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;package&#39;</span>
  <span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/usr&#39;</span>
<span class="k">else</span>
  <span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/usr/local&#39;</span>
<span class="k">end</span>

<span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;http://www.python.org/ftp/python&#39;</span>
<span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;80e387...85fd61&#39;</span>
</pre></div>
</div>
<p>and then the methods in the recipe may refer to these values. A recipe that is used to install Python will need to do the following:</p>
<ul class="simple">
<li>Identify each package to be installed (implied in this example, not shown)</li>
<li>Define variables for the package <tt class="docutils literal"><span class="pre">version</span></tt> and the <tt class="docutils literal"><span class="pre">install_path</span></tt></li>
<li>Get the package from a remote location, but only if the package does not already exist on the target system</li>
<li>Use the <strong>bash</strong> resource to install the package on the node, but only when the package is not already installed</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#  the following code sample comes from the ``oc-nginx`` cookbook on |github|: https://github.com/cookbooks/oc-nginx</span>

<span class="n">version</span> <span class="o">=</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="n">install_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/lib/python</span><span class="si">#{</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/(^\d+\.\d+)/</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/Python-</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">.tar.bz2&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">/Python-</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">.tar.bz2&quot;</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">install_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;build-and-install-python&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span>
<span class="sh">    tar -jxvf Python-#{version}.tar.bz2</span>
<span class="sh">    (cd Python-#{version} &amp;&amp; ./configure #{configure_options})</span>
<span class="sh">    (cd Python-#{version} &amp;&amp; make &amp;&amp; make install)</span>
<span class="no">  EOF</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">install_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="service">
<h2>service<a class="headerlink" href="#service" title="Permalink to this headline"></a></h2>
<p>Use the <strong>service</strong> resource to manage a service.</p>
<p><strong>Start a service</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;example_service&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Start a service, enable it</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;example_service&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a pattern</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;samba&#39;</span> <span class="k">do</span>
  <span class="n">pattern</span> <span class="s1">&#39;smbd&#39;</span>
  <span class="n">action</span> <span class="o">[</span><span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the :nothing common action</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;memcached&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:stop</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the supports common attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;apache&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the supports and providers common attributes</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;some_service&#39;</span> <span class="k">do</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Upstart</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Manage a service, depending on the node platform</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;example_service&#39;</span> <span class="k">do</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">&#39;centos&#39;</span><span class="p">,</span><span class="s1">&#39;redhat&#39;</span><span class="p">,</span><span class="s1">&#39;fedora&#39;</span>
    <span class="n">service_name</span> <span class="s1">&#39;redhat_name&#39;</span>
  <span class="k">else</span>
    <span class="n">service_name</span> <span class="s1">&#39;other_name&#39;</span>
  <span class="k">end</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Change a service provider, depending on the node platform</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;example_service&#39;</span> <span class="k">do</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">&#39;ubuntu&#39;</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform_version&#39;</span><span class="o">].</span><span class="n">to_f</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="o">.</span><span class="mi">10</span>
      <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Upstart</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="o">[</span><span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reload a service using a template</strong></p>
<p>To reload a service based on a template, use the <strong>template</strong> and <strong>service</strong> resources together in the same recipe, similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
<span class="k">end</span>

<span class="n">service</span> <span class="s1">&#39;apache&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
  <span class="n">subscribes</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;template[/tmp/somefile]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">subscribes</span></tt> notification is used to reload the service using the template specified by the <strong>template</strong> resource.</p>
<p><strong>Enable a service after a restart or reload</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;apache&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set an IP address using variables and a template</strong></p>
<p>The following example shows how the <strong>template</strong> resource can be used in a recipe to combine settings stored in an attributes file, variables within a recipe, and a template to set the IP addresses that are used by the Nginx service. The attributes file contains the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/etc/nginx&#39;</span>
</pre></div>
</div>
<p>The recipe then does the following to:</p>
<ul class="simple">
<li>Declare two variables at the beginning of the recipe, one for the remote IP address and the other for the authorized IP address</li>
<li>Use the <strong>service</strong> resource to restart and reload the Nginx service</li>
<li>Load a template named <tt class="docutils literal"><span class="pre">authorized_ip.erb</span></tt> from the <tt class="docutils literal"><span class="pre">/templates</span></tt> directory that is used to set the IP address values based on the variables specified in the recipe</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;remote_ip_var&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;remote_addr&#39;</span>
<span class="n">node</span><span class="o">.</span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;authorized_ips&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;127.0.0.1/32&#39;</span><span class="o">]</span>

<span class="n">service</span> <span class="s1">&#39;nginx&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;authorized_ip&#39;</span> <span class="k">do</span>
  <span class="n">path</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/authorized_ip&quot;</span>
  <span class="n">source</span> <span class="s1">&#39;modules/authorized_ip.erb&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="ss">:remote_ip_var</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;remote_ip_var&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:authorized_ips</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;authorized_ips&#39;</span><span class="o">]</span>
  <span class="p">)</span>

  <span class="n">notifies</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;service[nginx]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">variables</span></tt> property tells the template to use the variables set at the beginning of the recipe and the <tt class="docutils literal"><span class="pre">source</span></tt> property is used to call a template file located in the cookbook&#8217;s <tt class="docutils literal"><span class="pre">/templates</span></tt> directory. The template file looks similar to:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">geo</span> <span class="vg">$&lt;</span><span class="sx">%= @remote_ip_var %&gt; $authorized_ip {</span>
<span class="sx">  default no;</span>
<span class="sx">  &lt;% @authorized_ips.each do |ip| %&gt;</span>
<span class="sx">  &lt;%=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> yes;&quot;</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;% end %&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Use a cron timer to manage a service</strong></p>
<p>The following example shows how to install the crond application using two resources and a variable:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``cron`` cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/cron</span>

<span class="n">cron_package</span> <span class="o">=</span> <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">&#39;redhat&#39;</span><span class="p">,</span> <span class="s1">&#39;centos&#39;</span><span class="p">,</span> <span class="s1">&#39;scientific&#39;</span><span class="p">,</span> <span class="s1">&#39;fedora&#39;</span><span class="p">,</span> <span class="s1">&#39;amazon&#39;</span>
    <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform_version&#39;</span><span class="o">].</span><span class="n">to_f</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="o">.</span><span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;cronie&#39;</span> <span class="p">:</span> <span class="s1">&#39;vixie-cron&#39;</span>
  <span class="k">else</span>
    <span class="s1">&#39;cron&#39;</span>
  <span class="k">end</span>

<span class="n">package</span> <span class="n">cron_package</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>

<span class="n">service</span> <span class="s1">&#39;crond&#39;</span> <span class="k">do</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">&#39;redhat&#39;</span><span class="p">,</span> <span class="s1">&#39;centos&#39;</span><span class="p">,</span> <span class="s1">&#39;scientific&#39;</span><span class="p">,</span> <span class="s1">&#39;fedora&#39;</span><span class="p">,</span> <span class="s1">&#39;amazon&#39;</span>
    <span class="n">service_name</span> <span class="s1">&#39;crond&#39;</span>
  <span class="k">when</span> <span class="s1">&#39;debian&#39;</span><span class="p">,</span> <span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span> <span class="s1">&#39;suse&#39;</span>
    <span class="n">service_name</span> <span class="s1">&#39;cron&#39;</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="o">[</span><span class="ss">:start</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">cron_package</span></tt> is a variable that is used to identify which platforms apply to which install packages</li>
<li>the <strong>package</strong> resource uses the <tt class="docutils literal"><span class="pre">cron_package</span></tt> variable to determine how to install the crond application on various nodes (with various platforms)</li>
<li>the <strong>service</strong> resource enables the crond application on nodes that have Red Hat, CentOS, Red Hat Enterprise Linux, Fedora, or Amazon Web Services (AWS), and the cron service on nodes that run Debian, Ubuntu, or openSUSE</li>
</ul>
<p><strong>Restart a service, and then notify a different service</strong></p>
<p>The following example shows how start a service named <tt class="docutils literal"><span class="pre">example_service</span></tt> and immediately notify the Nginx service to restart.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;example_service&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Init</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[nginx]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where by using the default <tt class="docutils literal"><span class="pre">provider</span></tt> for the <strong>service</strong>, the recipe is telling the chef-client to determine the specific provider to be used during the chef-client run based on the platform of the node on which the recipe will run.</p>
<p><strong>Stop a service, do stuff, and then restart it</strong></p>
<p>The following example shows how to use the <strong>execute</strong>, <strong>service</strong>, and <strong>mount</strong> resources together to ensure that a node running on Amazon EC2 is running MySQL. This example does the following:</p>
<ul class="simple">
<li>Checks to see if the Amazon EC2 node has MySQL</li>
<li>If the node has MySQL, stops MySQL</li>
<li>Installs MySQL</li>
<li>Mounts the node</li>
<li>Restarts MySQL</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``server_ec2``</span>
<span class="c1"># recipe in the following cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/mysql</span>

<span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attribute?</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">))</span>

  <span class="n">service</span> <span class="s1">&#39;mysql&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:stop</span>
  <span class="k">end</span>

  <span class="n">execute</span> <span class="s1">&#39;install-mysql&#39;</span> <span class="k">do</span>
    <span class="n">command</span> <span class="s2">&quot;mv </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">not_if</span> <span class="k">do</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">)</span> <span class="k">end</span>
  <span class="k">end</span>

  <span class="o">[</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
    <span class="n">directory</span> <span class="n">dir</span> <span class="k">do</span>
      <span class="n">owner</span> <span class="s1">&#39;mysql&#39;</span>
      <span class="n">group</span> <span class="s1">&#39;mysql&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">mount</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">device</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span>
    <span class="n">fstype</span> <span class="s1">&#39;none&#39;</span>
    <span class="n">options</span> <span class="s1">&#39;bind,rw&#39;</span>
    <span class="n">action</span> <span class="o">[</span><span class="ss">:mount</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="n">service</span> <span class="s1">&#39;mysql&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:start</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li>the two <strong>service</strong> resources are used to stop, and then restart the MySQL service</li>
<li>the <strong>execute</strong> resource is used to install MySQL</li>
<li>the <strong>mount</strong> resource is used to mount the node and enable MySQL</li>
</ul>
<p><strong>Control a service using the execute resource</strong></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is an example of something that should NOT be done. Use the <strong>service</strong> resource to control a service, not the <strong>execute</strong> resource.</p>
</div>
<p>Do something like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;tomcat&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and NOT something like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;start-tomcat&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;/etc/init.d/tomcat6 start&#39;</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p>There is no reason to use the <strong>execute</strong> resource to control a service because the <strong>service</strong> resource exposes the <tt class="docutils literal"><span class="pre">start_command</span></tt> property directly, which gives a recipe full control over the command issued in a much cleaner, more direct manner.</p>
<p><strong>Enable a service on AIX using the mkitab command</strong></p>
<p>The <strong>service</strong> resource does not support using the <tt class="docutils literal"><span class="pre">:enable</span></tt> and <tt class="docutils literal"><span class="pre">:disable</span></tt> actions with resources that are managed using System Resource Controller (SRC). This is because System Resource Controller (SRC) does not have a standard mechanism for enabling and disabling services on system boot.</p>
<p>One approach for enabling or disabling services that are managed by System Resource Controller (SRC) is to use the <strong>execute</strong> resource to invoke <tt class="docutils literal"><span class="pre">mkitab</span></tt>, and then use that command to enable or disable the service.</p>
<p>The following example shows how to install a service:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s2">&quot;install </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> in SRC&quot;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s2">&quot;mkssys -s </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"></span>
<span class="s2">                  -p </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;bin&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"></span>
<span class="s2">                  -u root</span>
<span class="s2">                  -S</span>
<span class="s2">                  -n 15</span>
<span class="s2">                  -f 9</span>
<span class="s2">                  -o </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;log_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/client.log</span>
<span class="s2">                  -e </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;log_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/client.log -a &#39;</span>
<span class="s2">                  -i </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;interval&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"></span>
<span class="s2">                  -s </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;splay&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
  <span class="n">not_if</span> <span class="s2">&quot;lssrc -s </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then enable it using the <tt class="docutils literal"><span class="pre">mkitab</span></tt> command:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s2">&quot;enable </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s2">&quot;mkitab &#39;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">:2:once:/usr/bin/startsrc</span>
<span class="s2">                  -s </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> &gt; /dev/console 2&gt;&amp;1&#39;&quot;</span>
  <span class="n">not_if</span> <span class="s2">&quot;lsitab </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="smartos-package">
<h2>smartos_package<a class="headerlink" href="#smartos-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>smartos_package</strong> resource to manage packages for the SmartOS platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">smartos_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="solaris-package">
<h2>solaris_package<a class="headerlink" href="#solaris-package" title="Permalink to this headline"></a></h2>
<p>The <strong>solaris_package</strong> resource is used to manage packages for the Solaris platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">solaris_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="subversion">
<h2>subversion<a class="headerlink" href="#subversion" title="Permalink to this headline"></a></h2>
<p>Use the <strong>subversion</strong> resource to manage source control resources that exist in a Subversion repository.</p>
<p><strong>Get the latest version of an application</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subversion</span> <span class="s1">&#39;CouchDB Edge&#39;</span> <span class="k">do</span>
  <span class="n">repository</span> <span class="s1">&#39;http://svn.apache.org/repos/asf/couchdb/trunk&#39;</span>
  <span class="n">revision</span> <span class="s1">&#39;HEAD&#39;</span>
  <span class="n">destination</span> <span class="s1">&#39;/opt/mysources/couch&#39;</span>
  <span class="n">action</span> <span class="ss">:sync</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="template">
<h2>template<a class="headerlink" href="#template" title="Permalink to this headline"></a></h2>
<p>Use the <strong>template</strong> resource to manage the contents of a file using an Embedded Ruby (ERB) template by transferring files from a sub-directory of <tt class="docutils literal"><span class="pre">COOKBOOK_NAME/templates/</span></tt> to a specified path located on a host that is running the chef-client. This resource includes actions and properties from the <strong>file</strong> resource. Template files managed by the <strong>template</strong> resource follow the same file specificity rules as the <strong>remote_file</strong> and <strong>file</strong> resources.</p>
<p><strong>Configure a file from a template</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/config.conf&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;config.conf.erb&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Configure a file from a local template</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/config.conf&#39;</span> <span class="k">do</span>
  <span class="n">local</span> <span class="kp">true</span>
  <span class="n">source</span> <span class="s1">&#39;/tmp/config.conf.erb&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Configure a file using a variable map</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/config.conf&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;config.conf.erb&#39;</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="ss">:config_var</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;configs&#39;</span><span class="o">][</span><span class="s1">&#39;config_var&#39;</span><span class="o">]</span>
  <span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the not_if condition</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and using the presence of an attribute value on the node to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="n">node</span><span class="o">[</span><span class="ss">:some_value</span><span class="o">]</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and then Ruby code to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="k">do</span>
    <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and using a Ruby block (with curly braces) to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span> <span class="p">)}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and using a string to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;test -f /etc/passwd&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the only_if condition</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">only_if</span></tt> condition to create a file based on a template and using the presence of an attribute on the node to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">only_if</span> <span class="p">{</span> <span class="n">node</span><span class="o">[</span><span class="ss">:some_value</span><span class="o">]</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">only_if</span></tt> condition to create a file based on a template, and then use Ruby to specify a condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">only_if</span> <span class="k">do</span> <span class="o">!</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">)</span> <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">only_if</span></tt> condition to create a file based on a template and using a string to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">only_if</span> <span class="s1">&#39;test -f /etc/passwd&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a whitespace array (%w)</strong></p>
<p>The following example shows how to use a Ruby whitespace array to define a list of configuration tools, and then use that list of tools within the <strong>template</strong> resource to ensure that all of these configuration tools are using the same RSA key:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="sx">%w{openssl.cnf pkitool vars Rakefile}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
  <span class="n">template</span> <span class="s2">&quot;/etc/openvpn/easy-rsa/</span><span class="si">#{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">f</span><span class="si">}</span><span class="s2">.erb&quot;</span>
    <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
    <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
    <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a relative path</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;HOME&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/chef-getting-started.txt&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;chef-getting-started.txt.erb&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delay notifications</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/nagios3/configures-nagios.conf&#39;</span> <span class="k">do</span>
  <span class="c1"># other parameters</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test-nagios-config]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Notify immediately</strong></p>
<p>By default, notifications are <tt class="docutils literal"><span class="pre">:delayed</span></tt>, that is they are queued up as they are triggered, and then executed at the very end of a chef-client run. To run an action immediately, use <tt class="docutils literal"><span class="pre">:immediately</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/nagios3/configures-nagios.conf&#39;</span> <span class="k">do</span>
  <span class="c1"># other parameters</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test-nagios-config]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the chef-client would immediately run the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test-nagios-config&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;nagios3 --verify-config&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Notify multiple resources</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/chef/server.rb&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;server.rb.erb&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[chef-solr]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[chef-solr-indexer]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[chef-server]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reload a service</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;service[apache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Restart a service when a template is modified</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/www/configures-apache.conf&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[apache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Send notifications to multiple resources</strong></p>
<p>To send notifications to multiple resources, just use multiple attributes. Multiple attributes will get sent to the notified resources in the order specified.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/netatalk/netatalk.conf&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[afpd]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[cnid]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">service</span> <span class="s1">&#39;afpd&#39;</span>
<span class="n">service</span> <span class="s1">&#39;cnid&#39;</span>
</pre></div>
</div>
<p><strong>Execute a command using a template</strong></p>
<p>The following example shows how to set up IPv4 packet forwarding using the <strong>execute</strong> resource to run a command named <tt class="docutils literal"><span class="pre">forward_ipv4</span></tt> that uses a template defined by the <strong>template</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;forward_ipv4&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;echo &gt; /proc/.../ipv4/ip_forward&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/etc/file_name.conf&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;routing/file_name.conf.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[forward_ipv4]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">command</span></tt> property for the <strong>execute</strong> resource contains the command that is to be run and the <tt class="docutils literal"><span class="pre">source</span></tt> property for the <strong>template</strong> resource specifies which template to use. The <tt class="docutils literal"><span class="pre">notifies</span></tt> property for the <strong>template</strong> specifies that the <tt class="docutils literal"><span class="pre">execute[forward_ipv4]</span></tt> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of the chef-client run.</p>
<p><strong>Set an IP address using variables and a template</strong></p>
<p>The following example shows how the <strong>template</strong> resource can be used in a recipe to combine settings stored in an attributes file, variables within a recipe, and a template to set the IP addresses that are used by the Nginx service. The attributes file contains the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/etc/nginx&#39;</span>
</pre></div>
</div>
<p>The recipe then does the following to:</p>
<ul class="simple">
<li>Declare two variables at the beginning of the recipe, one for the remote IP address and the other for the authorized IP address</li>
<li>Use the <strong>service</strong> resource to restart and reload the Nginx service</li>
<li>Load a template named <tt class="docutils literal"><span class="pre">authorized_ip.erb</span></tt> from the <tt class="docutils literal"><span class="pre">/templates</span></tt> directory that is used to set the IP address values based on the variables specified in the recipe</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;remote_ip_var&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;remote_addr&#39;</span>
<span class="n">node</span><span class="o">.</span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;authorized_ips&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;127.0.0.1/32&#39;</span><span class="o">]</span>

<span class="n">service</span> <span class="s1">&#39;nginx&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;authorized_ip&#39;</span> <span class="k">do</span>
  <span class="n">path</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/authorized_ip&quot;</span>
  <span class="n">source</span> <span class="s1">&#39;modules/authorized_ip.erb&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="ss">:remote_ip_var</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;remote_ip_var&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:authorized_ips</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;authorized_ips&#39;</span><span class="o">]</span>
  <span class="p">)</span>

  <span class="n">notifies</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;service[nginx]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">variables</span></tt> property tells the template to use the variables set at the beginning of the recipe and the <tt class="docutils literal"><span class="pre">source</span></tt> property is used to call a template file located in the cookbook&#8217;s <tt class="docutils literal"><span class="pre">/templates</span></tt> directory. The template file looks similar to:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">geo</span> <span class="vg">$&lt;</span><span class="sx">%= @remote_ip_var %&gt; $authorized_ip {</span>
<span class="sx">  default no;</span>
<span class="sx">  &lt;% @authorized_ips.each do |ip| %&gt;</span>
<span class="sx">  &lt;%=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> yes;&quot;</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;% end %&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Add a rule to an IP table</strong></p>
<p>The following example shows how to add a rule named <tt class="docutils literal"><span class="pre">test_rule</span></tt> to an IP table using the <strong>execute</strong> resource to run a command using a template that is defined by the <strong>template</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test_rule&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;command_to_run</span>
<span class="s1">    --option value</span>
<span class="s1">    ...</span>
<span class="s1">    --option value</span>
<span class="s1">    --source #{node[:name_of_node][:ipsec][:local][:subnet]}</span>
<span class="s1">    -j test_rule&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/etc/file_name.local&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;routing/file_name.local.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test_rule]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">command</span></tt> property for the <strong>execute</strong> resource contains the command that is to be run and the <tt class="docutils literal"><span class="pre">source</span></tt> property for the <strong>template</strong> resource specifies which template to use. The <tt class="docutils literal"><span class="pre">notifies</span></tt> property for the <strong>template</strong> specifies that the <tt class="docutils literal"><span class="pre">execute[test_rule]</span></tt> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of the chef-client run.</p>
<p><strong>Apply proxy settings consistently across a Chef organization</strong></p>
<p>The following example shows how a template can be used to apply consistent proxy settings for all nodes of the same type:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:dir</span><span class="o">]</span><span class="si">}</span><span class="s2">/sites-available/site_proxy.conf&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;site_proxy.matching_node.conf.erb&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="ss">:ssl_certificate</span> <span class="o">=&gt;</span>    <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:dir</span><span class="o">]</span><span class="si">}</span><span class="s2">/shared/certificates/site_proxy.crt&quot;</span><span class="p">,</span>
    <span class="ss">:ssl_key</span> <span class="o">=&gt;</span>            <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:dir</span><span class="o">]</span><span class="si">}</span><span class="s2">/shared/certificates/site_proxy.key&quot;</span><span class="p">,</span>
    <span class="ss">:listen_port</span> <span class="o">=&gt;</span>        <span class="n">node</span><span class="o">[</span><span class="ss">:site</span><span class="o">][</span><span class="ss">:matching_node_proxy</span><span class="o">][</span><span class="ss">:listen_port</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:server_name</span> <span class="o">=&gt;</span>        <span class="n">node</span><span class="o">[</span><span class="ss">:site</span><span class="o">][</span><span class="ss">:matching_node_proxy</span><span class="o">][</span><span class="ss">:server_name</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:fqdn</span> <span class="o">=&gt;</span>               <span class="n">node</span><span class="o">[</span><span class="ss">:fqdn</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:server_options</span> <span class="o">=&gt;</span>     <span class="n">node</span><span class="o">[</span><span class="ss">:site</span><span class="o">][</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:server</span><span class="o">][</span><span class="ss">:options</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:proxy_options</span> <span class="o">=&gt;</span>      <span class="n">node</span><span class="o">[</span><span class="ss">:site</span><span class="o">][</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:proxy</span><span class="o">][</span><span class="ss">:options</span><span class="o">]</span>
  <span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">matching_node</span></tt> represents a type of node (like Nginx) and <tt class="docutils literal"><span class="pre">site_proxy</span></tt> represents the type of proxy being used for that type of node (like Nexus).</p>
<p><strong>Get template settings from a local file</strong></p>
<p>The <strong>template</strong> resource can be used to render a template based on settings contained in a local file on disk or to get the settings from a template in a cookbook. Most of the time, the settings are retrieved from a template in a cookbook. The following example shows how the <strong>template</strong> resource can be used to retrieve these settings from a local file.</p>
<p>The following example is based on a few assumptions:</p>
<ul class="simple">
<li>The environment is a Ruby on Rails application that needs render a file named <tt class="docutils literal"><span class="pre">database.yml</span></tt></li>
<li>Information about the application&#8212;the user, their password, the server&#8212;is stored in a data bag on the Chef server</li>
<li>The application is already deployed to the system and that only requirement in this example is to render the <tt class="docutils literal"><span class="pre">database.yml</span></tt> file</li>
</ul>
<p>The application source tree looks something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>myapp/
-&gt; config/
   -&gt; database.yml.erb
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There should not be a file named <tt class="docutils literal"><span class="pre">database.yml</span></tt> (without the <tt class="docutils literal"><span class="pre">.erb</span></tt>), as the <tt class="docutils literal"><span class="pre">database.yml</span></tt> file is what will be rendered using the <strong>template</strong> resource.</p>
</div>
<p>The deployment of the app will end up in <tt class="docutils literal"><span class="pre">/srv</span></tt>, so the full path to this template would be something like <tt class="docutils literal"><span class="pre">/srv/myapp/current/config/database.yml.erb</span></tt>.</p>
<p>The content of the template itself may look like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="sx">%= @rails_env %&gt;:</span>
<span class="sx">   adapter: &lt;%=</span> <span class="vi">@adapter</span> <span class="sx">%&gt;</span>
<span class="sx">   host: &lt;%= @host %&gt;</span>
   <span class="ss">database</span><span class="p">:</span> <span class="o">&lt;</span><span class="sx">%= @database %&gt;</span>
<span class="sx">   username: &lt;%=</span> <span class="vi">@username</span> <span class="sx">%&gt;</span>
<span class="sx">   password: &lt;%= @password %&gt;</span>
   <span class="ss">encoding</span><span class="p">:</span> <span class="s1">&#39;utf8&#39;</span>
   <span class="ss">reconnect</span><span class="p">:</span> <span class="kp">true</span>
</pre></div>
</div>
<p>The recipe will be similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="ss">:node</span><span class="p">,</span> <span class="s2">&quot;role:myapp_database_master AND chef_environment:</span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">chef_environment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">db_master</span> <span class="o">=</span> <span class="n">results</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>

<span class="n">template</span> <span class="s1">&#39;/srv/myapp/shared/database.yml&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;/srv/myapp/current/config/database.yml.erb&#39;</span>
  <span class="n">local</span> <span class="kp">true</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="ss">:rails_env</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">.</span><span class="n">chef_environment</span><span class="p">,</span>
    <span class="ss">:adapter</span> <span class="o">=&gt;</span> <span class="n">db_master</span><span class="o">[</span><span class="s1">&#39;myapp&#39;</span><span class="o">][</span><span class="s1">&#39;db_adapter&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:host</span> <span class="o">=&gt;</span> <span class="n">db_master</span><span class="o">[</span><span class="s1">&#39;fqdn&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:database</span> <span class="o">=&gt;</span> <span class="s2">&quot;myapp_</span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">chef_environment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="ss">:username</span> <span class="o">=&gt;</span> <span class="s2">&quot;myapp&quot;</span><span class="p">,</span>
    <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="s2">&quot;SUPERSECRET&quot;</span><span class="p">,</span>
  <span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li>the <tt class="docutils literal"><span class="pre">search</span></tt> method in the Recipe DSL is used to find the first node that is the database master (of which there should only be one)</li>
<li>the <tt class="docutils literal"><span class="pre">:adapter</span></tt> variable property may also require an attribute to have been set on a role, which then determines the correct adapter</li>
</ul>
<p>The template will render similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="ss">production</span><span class="p">:</span>
  <span class="ss">adapter</span><span class="p">:</span> <span class="n">mysql</span>
  <span class="ss">host</span><span class="p">:</span> <span class="n">domU</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span><span class="o">-</span><span class="mi">39</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="no">F1</span><span class="o">-</span><span class="no">C3</span><span class="o">.</span><span class="n">compute</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">internal</span>
  <span class="ss">database</span><span class="p">:</span> <span class="n">myapp_production</span>
  <span class="ss">username</span><span class="p">:</span> <span class="n">myapp</span>
  <span class="ss">password</span><span class="p">:</span> <span class="no">SUPERSECRET</span>
  <span class="ss">encoding</span><span class="p">:</span> <span class="n">utf8</span>
  <span class="ss">reconnect</span><span class="p">:</span> <span class="kp">true</span>
</pre></div>
</div>
<p>This example showed how to use the <strong>template</strong> resource to render a template based on settings contained in a local file. Some other issues that should be considered when using this type of approach include:</p>
<ul class="simple">
<li>Should the <tt class="docutils literal"><span class="pre">database.yml</span></tt> file be in a <tt class="docutils literal"><span class="pre">.gitignore</span></tt> file?</li>
<li>How do developers run the application locally?</li>
<li>Does this work with chef-solo?</li>
</ul>
<p><strong>Pass values from recipe to template</strong></p>
<p>The following example shows how pass a value to a template using the <tt class="docutils literal"><span class="pre">variables</span></tt> property in the <strong>template</strong> resource. The template file is similar to:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="o">[</span><span class="n">tcpout</span><span class="o">]</span>
<span class="n">defaultGroup</span> <span class="o">=</span> <span class="n">splunk_indexers_</span><span class="o">&lt;</span><span class="sx">%= node[&#39;splunk&#39;][&#39;receiver_port&#39;] %&gt;</span>
<span class="sx">disabled=</span><span class="kp">false</span>

<span class="o">[</span><span class="ss">tcpout</span><span class="p">:</span><span class="n">splunk_indexers_</span><span class="o">&lt;</span><span class="sx">%= node[&#39;splunk&#39;][&#39;receiver_port&#39;] %&gt;]</span>
<span class="sx">server=</span><span class="o">&lt;</span><span class="sx">% @splunk_servers.map </span><span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span> <span class="o">-</span><span class="sx">%&gt;&lt;%= s[&#39;ipaddress&#39;] %&gt;</span><span class="ss">:&lt;</span><span class="sx">%= s[&#39;splunk&#39;][&#39;receiver_port&#39;] %&gt; &lt;% end.join(&#39;, &#39;) -%&gt;</span>
<span class="sx">&lt;% @outputs_conf.each_pair do |name, value| -%&gt;</span>
<span class="sx">&lt;%=</span> <span class="nb">name</span> <span class="sx">%&gt; = &lt;%= value %&gt;</span>
<span class="o">&lt;</span><span class="sx">% end </span><span class="o">-%&gt;</span>
</pre></div>
</div>
<p>The recipe then uses the <tt class="docutils literal"><span class="pre">variables</span></tt> attribute to find the values for <tt class="docutils literal"><span class="pre">splunk_servers</span></tt> and <tt class="docutils literal"><span class="pre">outputs_conf</span></tt>, before passing them into the template:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">splunk_dir</span><span class="si">}</span><span class="s2">/etc/system/local/outputs.conf&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;outputs.conf.erb&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">variables</span> <span class="ss">:splunk_servers</span> <span class="o">=&gt;</span> <span class="n">splunk_servers</span><span class="p">,</span> <span class="ss">:outputs_conf</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;splunk&#39;</span><span class="o">][</span><span class="s1">&#39;outputs_conf&#39;</span><span class="o">]</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[splunk]&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This example can be found in the <tt class="docutils literal"><span class="pre">client.rb</span></tt> recipe and the <tt class="docutils literal"><span class="pre">outputs.conf.erb</span></tt> template files that are located in the <a class="reference external" href="https://github.com/chef-cookbooks/chef-splunk/">chef-splunk cookbook</a>  that is maintained by Chef.</p>
</div>
<div class="section" id="user">
<h2>user<a class="headerlink" href="#user" title="Permalink to this headline"></a></h2>
<p>Use the <strong>user</strong> resource to add users, update existing users, remove users, and to lock/unlock user passwords.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">System attributes are collected by Ohai at the start of every chef-client run. By design, the actions available to the <strong>user</strong> resource are processed <strong>after</strong> the start of the chef-client run. This means that system attributes added or modified by the <strong>user</strong> resource during the chef-client run must be reloaded before they can be available to the chef-client. These system attributes can be reloaded in two ways: by picking up the values at the start of the (next) chef-client run or by using the <a class="reference external" href="https://docs.chef.io/resource_ohai.html">ohai resource</a> to reload the system attributes during the current chef-client run.</p>
</div>
<p><strong>Create a user named &#8220;random&#8221;</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="s1">&#39;random&#39;</span> <span class="k">do</span>
  <span class="n">manage_home</span> <span class="kp">true</span>
  <span class="n">comment</span> <span class="s1">&#39;User Random&#39;</span>
  <span class="n">uid</span> <span class="s1">&#39;1234&#39;</span>
  <span class="n">gid</span> <span class="s1">&#39;1234&#39;</span>
  <span class="n">home</span> <span class="s1">&#39;/home/random&#39;</span>
  <span class="n">shell</span> <span class="s1">&#39;/bin/bash&#39;</span>
  <span class="n">password</span> <span class="s1">&#39;$1$JJsvHslV$szsCjVEroftprNn4JHtDi&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a system user</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="s1">&#39;systemguy&#39;</span> <span class="k">do</span>
  <span class="n">comment</span> <span class="s1">&#39;system guy&#39;</span>
  <span class="nb">system</span> <span class="kp">true</span>
  <span class="n">shell</span> <span class="s1">&#39;/bin/false&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a system user with a variable</strong></p>
<p>The following example shows how to create a system user. In this instance, the <tt class="docutils literal"><span class="pre">home</span></tt> value is calculated and stored in a variable called <tt class="docutils literal"><span class="pre">user_home</span></tt> which sets the user&#8217;s <tt class="docutils literal"><span class="pre">home</span></tt> attribute.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user_home</span> <span class="o">=</span> <span class="s2">&quot;/home/</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;cookbook_name&#39;</span><span class="o">][</span><span class="s1">&#39;user&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">user</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;cookbook_name&#39;</span><span class="o">][</span><span class="s1">&#39;user&#39;</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">gid</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;cookbook_name&#39;</span><span class="o">][</span><span class="s1">&#39;group&#39;</span><span class="o">]</span>
  <span class="n">shell</span> <span class="s1">&#39;/bin/bash&#39;</span>
  <span class="n">home</span> <span class="n">user_home</span>
  <span class="nb">system</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use SALTED-SHA512 passwords</strong></p>
<p>Mac OS X 10.7 calculates the password shadow hash using SALTED-SHA512. The length of the shadow hash value is 68 bytes, the salt value is the first 4 bytes, with the remaining 64 being the shadow hash itself. The following code will calculate password shadow hashes for Mac OS X 10.7:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;my_awesome_password&#39;</span>
<span class="n">salt</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Random</span><span class="o">.</span><span class="n">random_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">encoded_password</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Digest</span><span class="o">::</span><span class="no">SHA512</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(</span><span class="n">salt</span> <span class="o">+</span> <span class="n">password</span><span class="p">)</span>
<span class="n">shadow_hash</span> <span class="o">=</span> <span class="n">salt</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span> <span class="o">+</span> <span class="n">encoded_password</span>
</pre></div>
</div>
<p>Use the calculated password shadow hash with the <strong>user</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="s1">&#39;my_awesome_user&#39;</span> <span class="k">do</span>
  <span class="n">password</span> <span class="s1">&#39;c9b3bd....d843&#39;</span>  <span class="c1"># Length: 136</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use SALTED-SHA512-PBKDF2 passwords</strong></p>
<p>Mac OS X 10.8 (and higher) calculates the password shadow hash using SALTED-SHA512-PBKDF2. The length of the shadow hash value is 128 bytes, the salt value is 32 bytes, and an integer specifies the number of iterations. The following code will calculate password shadow hashes for Mac OS X 10.8 (and higher):</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;my_awesome_password&#39;</span>
<span class="n">salt</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Random</span><span class="o">.</span><span class="n">random_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="mi">25000</span> <span class="c1"># Any value above 20k should be fine.</span>

<span class="n">shadow_hash</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKCS5</span><span class="o">::</span><span class="n">pbkdf2_hmac</span><span class="p">(</span>
  <span class="n">password</span><span class="p">,</span>
  <span class="n">salt</span><span class="p">,</span>
  <span class="n">iterations</span><span class="p">,</span>
  <span class="mi">128</span><span class="p">,</span>
  <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Digest</span><span class="o">::</span><span class="no">SHA512</span><span class="o">.</span><span class="n">new</span>
<span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
<span class="n">salt_value</span> <span class="o">=</span> <span class="n">salt</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
</pre></div>
</div>
<p>Use the calculated password shadow hash with the <strong>user</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="s1">&#39;my_awesome_user&#39;</span> <span class="k">do</span>
  <span class="n">password</span> <span class="s1">&#39;cbd1a....fc843&#39;</span>  <span class="c1"># Length: 256</span>
  <span class="n">salt</span> <span class="s1">&#39;bd1a....fc83&#39;</span>        <span class="c1"># Length: 64</span>
  <span class="n">iterations</span> <span class="mi">25000</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="windows-package">
<h2>windows_package<a class="headerlink" href="#windows-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>windows_package</strong> resource to manage Microsoft Installer Package (MSI) packages for the Microsoft Windows platform.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;7zip&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">source</span> <span class="s1">&#39;C:\7z920.msi&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify a URL for the source attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;7zip&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://www.7-zip.org/a/7z938-x64.msi&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify path and checksum</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;7zip&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://www.7-zip.org/a/7z938-x64.msi&#39;</span>
  <span class="n">checksum</span> <span class="s1">&#39;7c8e873991c82ad9cfc123415254ea6101e9a645e12977dcd518979e50fdedf3&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Modify remote_file resource attributes</strong></p>
<p>The <strong>windows_package</strong> resource may specify a package at a remote location using the <tt class="docutils literal"><span class="pre">remote_file_attributes</span></tt> property. This uses the <strong>remote_file</strong> resource to download the contents at the specified URL and passes in a Hash that modifes the properties of the <a class="reference external" href="https://docs.chef.io/resource_remote_file.html">remote_file resource</a>.</p>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;7zip&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://www.7-zip.org/a/7z938-x64.msi&#39;</span>
  <span class="n">remote_file_attributes</span> <span class="p">({</span>
    <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;C:\\7zip.msi&#39;</span><span class="p">,</span>
    <span class="ss">:checksum</span> <span class="o">=&gt;</span> <span class="s1">&#39;7c8e873991c82ad9cfc123415254ea6101e9a645e12977dcd518979e50fdedf3&#39;</span>
  <span class="p">})</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Download a nsis (Nullsoft) package resource</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;Mercurial 3.6.1 (64-bit)&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://mercurial.selenic.com/release/windows/Mercurial-3.6.1-x64.exe&#39;</span>
  <span class="n">checksum</span> <span class="s1">&#39;febd29578cb6736163d232708b834a2ddd119aa40abc536b2c313fc5e1b5831d&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Download a custom package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;Microsoft Visual C++ 2005 Redistributable&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;https://download.microsoft.com/download/6/B/B/6BB661D6-A8AE-4819-B79F-236472F6070C/vcredist_x86.exe&#39;</span>
  <span class="n">installer_type</span> <span class="ss">:custom</span>
  <span class="n">options</span> <span class="s1">&#39;/Q&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="windows-service">
<h2>windows_service<a class="headerlink" href="#windows-service" title="Permalink to this headline"></a></h2>
<p>Use the <strong>windows_service</strong> resource to manage a service on the Microsoft Windows platform.</p>
<p><strong>Start a service manually</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_service</span> <span class="s1">&#39;BITS&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:configure_startup</span>
  <span class="n">startup_type</span> <span class="ss">:manual</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="yum-package">
<h2>yum_package<a class="headerlink" href="#yum-package" title="Permalink to this headline"></a></h2>
<p>Use the <strong>yum_package</strong> resource to install, upgrade, and remove packages with Yum for the Red Hat and CentOS platforms. The <strong>yum_package</strong> resource is able to resolve <tt class="docutils literal"><span class="pre">provides</span></tt> data for packages much like Yum can do when it is run from the command line. This allows a variety of options for installing packages, like minimum versions, virtual provides, and library names.</p>
<p><strong>Install an exact version</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm = 10.35.58-8.el5&#39;</span>
</pre></div>
</div>
<p><strong>Install a minimum version</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm &gt;= 10.35.58-8.el5&#39;</span>
</pre></div>
</div>
<p><strong>Install a minimum version using the default action</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm&#39;</span>
</pre></div>
</div>
<p><strong>To install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>To install a partial minimum version</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm &gt;= 10&#39;</span>
</pre></div>
</div>
<p><strong>To install a specific architecture</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm&#39;</span> <span class="k">do</span>
  <span class="n">arch</span> <span class="s1">&#39;i386&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm.x86_64&#39;</span>
</pre></div>
</div>
<p><strong>To install a specific version-release</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="s1">&#39;10.35.58-8.el5&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>To install a specific version (even when older than the current)</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;tzdata&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="s1">&#39;2011b-1.el5&#39;</span>
  <span class="n">allow_downgrade</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Handle cookbook_file and yum_package resources in the same recipe</strong></p>
<p>When a <strong>cookbook_file</strong> resource and a <strong>yum_package</strong> resource are both called from within the same recipe, use the <tt class="docutils literal"><span class="pre">flush_cache</span></tt> attribute to dump the in-memory Yum cache, and then use the repository immediately to ensure that the correct package is installed:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;/etc/yum.repos.d/custom.repo&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;custom&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">yum_package</span> <span class="s1">&#39;only-in-custom-repo&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">flush_cache</span> <span class="o">[</span> <span class="ss">:before</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>


          </div>


          <div class="footer" role="contentinfo">
                &copy; Copyright: This work is licensed under a Creative Commons Attribution 3.0 Unported License.
              This page is about: current version of Chef.
            <a href="/feedback.html">Provide feedback on Chef documentation</a>.
            </div>

<!-- Start of Async Google Analytics Code -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6369228-7', 'auto', {'legacyCookieDomain': '.chef.io', 'allowLinker': true});
  ga('send', 'pageview');

  var trackOutboundLink = function(url) {
    if (ga.q) {
     document.location = url;
    } else {
      ga('send', 'event', 'outbound', 'click', url, {'hitCallback':
        function () {
          document.location = url;
        }
      });
    }
  };
</script>
<!-- End of Async Google Analytics Code -->

<!-- Start of Marketo Analytics Code -->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('255-VFB-268');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End of Marketo Analytics Code -->

<!-- Start of DemandBase Analytics Code -->
<script type="text/javascript">
	(function(d,b,a,s,e){ var t = b.createElement(a),
		fs = b.getElementsByTagName(a)[0]; t.async=1; t.id=e;
		t.src=('https:'==document.location.protocol ? 'https://' : 'http://') + s;
		fs.parentNode.insertBefore(t, fs); })
	(window,document,'script','scripts.demandbase.com/zH7sZrWR.min.js','demandbase_js_lib');
</script>
<!-- End of DemandBase Analytics Code -->

<!-- Start of Segment Analytics Code -->
<script type="text/javascript">
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
  analytics.load("RtyoRfLf1ZETiJcIfkKND3Wq1K1LhYHx");
  analytics.page();
  }}();
</script>
<!-- End of Segment Analytics Code -->


        </div>
      </div>

      <div class="clearer"></div>
    </div>

  </div>
  </body>
</html>