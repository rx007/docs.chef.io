<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    
    <title>Resources Reference &mdash; Chef Docs</title>
    <link rel="stylesheet" href="_static/chefv2.css" type="text/css" />
<link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
    URL_ROOT:    './',
    VERSION:     '',
    COLLAPSE_INDEX: false,
    FILE_SUFFIX: '.html',
    HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="_static/jquery.js"></script>
<script type="text/javascript" src="_static/underscore.js"></script>
<script type="text/javascript" src="_static/doctools.js"></script>
<script type="text/javascript" src="_static/script.js"></script>

    <link rel="top" title="Chef Docs" href="index.html" />
    <link rel="next" title="About Roles" href="roles.html" />
    <link rel="prev" title="yum_repository" href="resource_yum_repository.html" /> 
  </head>
  <body role="document">
    <div class="body-wrap">

  <nav class="nav-main" role="navigation" data-topbar>
    <div class="nav-inner">
      <div class="left">
        <h1>
          <a href="https://learn.chef.io">
            <span>Learn Chef</span>
          </a>
        </h1>
      </div>

      <i id="nav-icon" class="fa fa-bars"></i>
      <a href="https://www.chef.io/">
        <img id="logo" src="_static/chef_logo_v2.svg" onerror="_static/chef_logo_v2.png"/>
      </a>

      <ul class="nav-links links-main">
        <li class="nav-link">
          <a href="https://learn.chef.io/tutorials">Tutorials</a>
        </li>
        <li class="nav-link">
          <a href="https://learn.chef.io/skills/">Skills Library</a>
        </li>
        <li class="nav-link is-active">
          <a href="https://docs.chef.io/">Docs</a>
        </li>
        <li class="nav-link">
          <a href="https://www.chef.io/training/">Training</a>
        </li>
      </ul>
    </div>
  </nav>





    <div class="document chef-docs">
    <nav class="nav-docs">
  <ul class="nav-docs-items" id="nav-docs-list">
    <li class="main-item dark-item docs-search">
      <form action="/search.html" method="get">
        <input type="text" placeholder="Search" id="docs-search" name="q">
        <input type="submit" class="submit-button" value="">
        <i class="fa fa-search icon-search"></i>
      </form>
   

    </li>
    
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="Overview"> <!-- else item does not have custom image and should use FontAwesome icon -->

        <i class="fa fa-home icon-left"></i> Overview <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items"> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/platform_overview.html" title="Platform Overview">
            Platform Overview
          </a>
        </li>

         <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Community">
            Community
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/community.html" title="About the Community">
                About the Community
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/community_contributions.html" title="Contributing">
                Contributing
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/community_guidelines.html" title="Guidelines">
                Guidelines
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/style_guide.html" title="Docs Style Guide">
                Docs Style Guide
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Packages &amp; Platforms">
            Packages &amp; Platforms
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/packages.html" title="Packages">
                Packages
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/platforms.html" title="Platforms">
                Platforms
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/api_omnitruck.html" title="Omnitruck API">
                Omnitruck API
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_license.html" title="Licensing">
                Licensing
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li>
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="Chef"> <!-- else item does not have custom image and should use FontAwesome icon -->

        <i class="fa fa-tasks icon-left"></i> Chef <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items">

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Getting Started">
            Getting Started
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_overview.html" title="Chef Overview">
                Chef Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/quick_start.html" title="Quick Start">
                Quick Start
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_system_requirements.html" title="System Requirements">
                System Requirements
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Release Notes">
                Release Notes
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/release_notes.html" title="Chef Client">
                    Chef Client
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/release_notes_chefdk.html" title="Chef Development Kit">
                    Chef Development Kit
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/release_notes_server.html" title="Chef Server">
                    Chef Server
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/release_notes_push_jobs.html" title="Chef Push Jobs">
                    Chef Push Jobs
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/release_notes_ohai.html" title="Ohai">
                    Ohai
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_deprecations_client.html" title="Deprecations">
                Deprecations
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Tutorials">
            Tutorials
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/learn-the-basics/" title="Learn the Basics">
                Learn the Basics
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/manage-a-node/" title="Manage a Node">
                Manage a Node
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/local-development/" title="Get started with Test Kitchen">
                Get started with Test Kitchen
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/manage-a-web-app/" title="Develop a web app cookbook">
                Develop a web app cookbook
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/inspec/" title="Verify with InSpec">
                Verify with InSpec
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/chefspec/" title="Unit test with ChefSpec">
                Unit test with ChefSpec
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/verify-style/" title="Verify code style">
                Verify code style
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/refactor-web-app-cookbook/" title="Refactor the web app cookbook">
                Refactor the web app cookbook
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Concepts">
            Concepts
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/workstation.html" title="Workstation">
                Workstation
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_repo.html" title="chef-repo">
                chef-repo
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/nodes.html" title="Nodes">
                Nodes
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_client.html" title="chef-client">
                chef-client
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_components.html" title="Server">
                Server
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_search.html" title="Search">
                Search
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/cookbooks.html" title="Cookbooks">
                Cookbooks
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/handlers.html" title="Handlers">
                Handlers
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/manage.html" title="Management Console">
                Management Console
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Policy">
                Policy
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/policy.html" title="About Policy">
                    About Policy
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/data_bags.html" title="Data Bags">
                    Data Bags
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/environments.html" title="Environments">
                    Environments
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/roles.html" title="Roles">
                    Roles
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/push_jobs.html" title="Push Jobs">
                Push Jobs
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/run_lists.html" title="Run-lists">
                Run-lists
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Security">
                Security
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/auth.html#authentication" title="Authentication">
                    Authentication
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/auth.html#authorization" title="Authorization">
                    Authorization
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/chef_private_keys.html" title="Private Keys">
                    Private Keys
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef_client.html#run-in-fips-mode" title="FIPS-mode">
                    FIPS-mode
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Supermarket">
                Supermarket
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/supermarket.html#public-supermarket" title="Public Supermarket">
                    Public Supermarket
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/supermarket.html#private-supermarket" title="Private Supermarket">
                    Private Supermarket
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/windows.html" title="Microsoft Windows">
                Microsoft Windows
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Appendix">
                Appendix
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/environment_variables.html" title="Env Variables">
                    Env Variables
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/errors.html" title="Troubleshooting">
                    Troubleshooting
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/glossary.html" title="Glossary">
                    Glossary
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Setup">
            Setup
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/proxies.html" title="Proxies">
                Proxies
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/install_dk.html" title="Workstation">
                Workstation
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Nodes">
                Nodes
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/install_bootstrap.html" title="Install via Bootstrap">
                    Install via Bootstrap
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_omnibus.html" title="Install via URL">
                    Install via URL
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_windows.html" title="Install on Windows">
                    Install on Windows
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/junos.html" title="Install on Junos OS">
                    Install on Junos OS
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef_client.html" title="chef-client (executable)">
                    chef-client (executable)
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_client.html" title="client.rb">
                    client.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/upgrade_client.html" title="Upgrades">
                    Upgrades
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/chef_client_security.html" title="Security">
                    Security
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Server">
                Server
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="https://manage.chef.io/signup" title="Hosted Chef Server">
                    Hosted Chef Server
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_server.html#standalone" title="Install Standalone">
                    Install Standalone
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_server_ha.html" title="Install High Availability">
                    Install High Availability
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/aws_marketplace.html" title="AWS Marketplace">
                    AWS Marketplace
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/azure_portal.html" title="Microsoft Azure">
                    Microsoft Azure
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/openstack.html" title="Openstack">
                    Openstack
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Supermarket">
                Supermarket
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="https://supermarket.chef.io" title="Public Supermarket">
                    Public Supermarket
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_supermarket.html" title="Install Private Supermarket">
                    Install Private Supermarket
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_supermarket.html#customize-supermarket" title="Customize Supermarket">
                    Customize Supermarket
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/install_supermarket.html#run-supermarket-in-kitchen" title="Run in Test Kitchen">
                    Run in Test Kitchen
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_chef_server.html#install" title="Management Console">
                Management Console
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/install_push_jobs.html" title="Push Jobs">
                Push Jobs
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Integrations">
                Integrations
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/integrate_compliance_chef_server.html" title="w/Chef Compliance">
                    w/Chef Compliance
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/uninstall.html" title="Uninstall">
                Uninstall
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Cookbook Reference">
            Cookbook Reference
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/cookbooks.html" title="About Cookbooks">
                About Cookbooks
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/attributes.html" title="Attributes">
                Attributes
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/definitions.html" title="Definitions">
                Definitions
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/files.html" title="Files">
                Files
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/libraries.html" title="Libraries">
                Libraries
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Recipes">
                Recipes
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/recipes.html" title="About Recipes">
                    About Recipes
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/debug.html" title="Debug Recipes, Client Runs">
                    Debug Recipes, Client Runs
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Recipe DSL">
                Recipe DSL
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#attribute" title="attribute?">
                    attribute?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#control" title="control">
                    control
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#control-group" title="control_group">
                    control_group
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#cookbook-name" title="cookbook_name">
                    cookbook_name
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#data-bag" title="data_bag">
                    data_bag
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#data-bag-item" title="data_bag_item">
                    data_bag_item
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#platform" title="platform?">
                    platform?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#platform-family" title="platform_family?">
                    platform_family?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#reboot-pending" title="reboot_pending?">
                    reboot_pending?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#recipe-name" title="recipe_name">
                    recipe_name
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#registry-data-exists" title="registry_data_exists?">
                    registry_data_exists?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#registry-get-subkeys" title="registry_get_subkeys">
                    registry_get_subkeys
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#registry-get-values" title="registry_get_values">
                    registry_get_values
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#registry-has-subkeys" title="registry_has_subkeys?">
                    registry_has_subkeys?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#registry-key-exists" title="registry_key_exists?">
                    registry_key_exists?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#registry-value-exists" title="registry_value_exists?">
                    registry_value_exists?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#resources" title="resources">
                    resources
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#search" title="search">
                    search
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#shell-out" title="shell_out">
                    shell_out
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#shell-out-bang" title="shell_out!">
                    shell_out!
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#shell-out-with-systems-locale" title="shell_out_with_systems_locale">
                    shell_out_with_systems_locale
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#tag-tagged-untag" title="tag">
                    tag
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#tag-tagged-untag" title="tagged?">
                    tagged?
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#tag-tagged-untag" title="untag">
                    untag
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#value-for-platform" title="value_for_platform">
                    value_for_platform
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#value-for-platform-family" title="value_for_platform_family">
                    value_for_platform_family
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/dsl_recipe.html#helpers" title="Windows Platform Helpers">
                    Windows Platform Helpers
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Resources">
                Resources
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/resource.html" title="About Resources">
                    About Resources
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_common.html" title="Common Functionality">
                    Common Functionality
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/custom_resources.html" title="Custom Resources">
                    Custom Resources
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resources.html" title="All Resources (Single Page)">
                    All Resources (Single Page)
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_apt_package.html" title="apt_package">
                    apt_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_apt_repository.html" title="apt_repository">
                    apt_repository
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_apt_update.html" title="apt_update">
                    apt_update
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_bash.html" title="bash">
                    bash
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_batch.html" title="batch">
                    batch
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_bff_package.html" title="bff_package">
                    bff_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_breakpoint.html" title="breakpoint">
                    breakpoint
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_cab_package.html" title="cab_package">
                    cab_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_gem.html" title="chef_gem">
                    chef_gem
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_acl.html" title="chef_acl">
                    chef_acl
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_client.html" title="chef_client">
                    chef_client
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_container.html" title="chef_container">
                    chef_container
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_data_bag_item.html" title="chef_data_bag_item">
                    chef_data_bag_item
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_data_bag.html" title="chef_data_bag">
                    chef_data_bag
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_environment.html" title="chef_environment">
                    chef_environment
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_group.html" title="chef_group">
                    chef_group
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_handler.html" title="chef_handler">
                    chef_handler
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_mirror.html" title="chef_mirror">
                    chef_mirror
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_node.html" title="chef_node">
                    chef_node
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_organization.html" title="chef_organization">
                    chef_organization
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_role.html" title="chef_role">
                    chef_role
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chef_user.html" title="chef_user">
                    chef_user
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_chocolatey_package.html" title="chocolatey_package">
                    chocolatey_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_cookbook_file.html" title="cookbook_file">
                    cookbook_file
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_cron.html" title="cron">
                    cron
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_csh.html" title="csh">
                    csh
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_deploy.html" title="deploy">
                    deploy
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_directory.html" title="directory">
                    directory
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_dpkg_package.html" title="dpkg_package">
                    dpkg_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_dsc_resource.html" title="dsc_resource">
                    dsc_resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_dsc_script.html" title="dsc_script">
                    dsc_script
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_easy_install_package.html" title="easy_install_package">
                    easy_install_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_env.html" title="env">
                    env
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_erlang_call.html" title="erl_call">
                    erl_call
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_execute.html" title="execute">
                    execute
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_file.html" title="file">
                    file
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_freebsd_package.html" title="freebsd_package">
                    freebsd_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_gem_package.html" title="gem_package">
                    gem_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_git.html" title="git">
                    git
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_group.html" title="group">
                    group
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_homebrew_package.html" title="homebrew_package">
                    homebrew_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_http_request.html" title="http_request">
                    http_request
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_ifconfig.html" title="ifconfig">
                    ifconfig
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_ips_package.html" title="ips_package">
                    ips_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_ksh.html" title="ksh">
                    ksh
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_launchd.html" title="launchd">
                    launchd
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_link.html" title="link">
                    link
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_log.html" title="log">
                    log
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_macports_package.html" title="macports_package">
                    macports_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_mdadm.html" title="mdadm">
                    mdadm
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_mount.html" title="mount">
                    mount
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_msu_package.html" title="msu_package">
                    msu_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_ohai.html" title="ohai">
                    ohai
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_openbsd_package.html" title="openbsd_package">
                    openbsd_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_osx_profile.html" title="osx_profile">
                    osx_profile
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_package.html" title="package">
                    package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_pacman_package.html" title="pacman_package">
                    pacman_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_paludis_package.html" title="paludis_package">
                    paludis_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_perl.html" title="perl">
                    perl
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_portage_package.html" title="portage_package">
                    portage_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_powershell_script.html" title="powershell_script">
                    powershell_script
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_private_key.html" title="private_key">
                    private_key
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_public_key.html" title="public_key">
                    public_key
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_python.html" title="python">
                    python
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_reboot.html" title="reboot">
                    reboot
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_registry_key.html" title="registry_key">
                    registry_key
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_remote_directory.html" title="remote_directory">
                    remote_directory
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_remote_file.html" title="remote_file">
                    remote_file
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_route.html" title="route">
                    route
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_rpm_package.html" title="rpm_package">
                    rpm_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_ruby.html" title="ruby">
                    ruby
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_ruby_block.html" title="ruby_block">
                    ruby_block
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_script.html" title="script">
                    script
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_service.html" title="service">
                    service
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_smartos_package.html" title="smartos_package">
                    smartos_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_solaris_package.html" title="solaris_package">
                    solaris_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_subversion.html" title="subversion">
                    subversion
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_systemd_unit.html" title="systemd_unit">
                    systemd_unit
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_template.html" title="template">
                    template
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_user.html" title="user">
                    user
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_windows_package.html" title="windows_package">
                    windows_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_windows_service.html" title="windows_service">
                    windows_service
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_yum.html" title="yum_package">
                    yum_package
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_yum_repository.html" title="yum_repository">
                    yum_repository
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_examples.html" title="Examples (by Resource)">
                    Examples (by Resource)
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/templates.html" title="Templates">
                Templates
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/cookbook_repo.html" title="Cookbook Repo">
                Cookbook Repo
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_rb_metadata.html" title="metadata.rb">
                metadata.rb
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/cookbook_versions.html" title="Cookbook Versions">
                Cookbook Versions
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ruby.html" title="Ruby">
                Ruby
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Chef DK">
            Chef DK
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/about_chefdk.html" title="About the ChefDK">
                About the ChefDK
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/berkshelf.html" title="Berkshelf">
                Berkshelf
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_chef_apply.html" title="chef-apply (executable)">
                chef-apply (executable)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_shell.html" title="chef-shell (executable)">
                chef-shell (executable)
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="chef (executable)">
                chef (executable)
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-env" title="chef env">
                    chef env
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-exec" title="chef exec">
                    chef exec
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-gem" title="chef gem">
                    chef gem
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-app" title="chef generate app">
                    chef generate app
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-attribute" title="chef generate attribute">
                    chef generate attribute
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-cookbook" title="chef generate cookbook">
                    chef generate cookbook
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-file" title="chef generate file">
                    chef generate file
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-lwrp" title="chef generate lwrp">
                    chef generate lwrp
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-recipe" title="chef generate recipe">
                    chef generate recipe
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-repo" title="chef generate repo">
                    chef generate repo
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-generate-template" title="chef generate template">
                    chef generate template
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-provision" title="chef provision">
                    chef provision
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-shell-init" title="chef shell-init">
                    chef shell-init
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef.html#chef-verify" title="chef verify">
                    chef verify
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Chef Solo">
                Chef Solo
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/chef_solo.html" title="About Chef Solo">
                    About Chef Solo
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_chef_solo.html" title="chef-solo (executable)">
                    chef-solo (executable)
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_solo.html" title="solo.rb">
                    solo.rb
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_chef_shell.html" title="chef-shell (executable)">
                chef-shell (executable)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_chef_client.html#run-in-local-mode" title="chef-zero (local mode)">
                chef-zero (local mode)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_vault.html" title="chef-vault">
                chef-vault
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chefspec.html" title="ChefSpec">
                ChefSpec
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Configuration">
                Configuration
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/config_rb.html" title="config.rb">
                    config.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_client.html#d-directories" title="Multiple Config Files">
                    Multiple Config Files
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/cookstyle.html" title="cookstyle">
                cookstyle
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_delivery.html" title="Delivery CLI">
                Delivery CLI
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/foodcritic.html" title="Foodcritic">
                Foodcritic
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Test Kitchen">
                Test Kitchen
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/kitchen.html" title="About Test Kitchen">
                    About Test Kitchen
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_kitchen.html" title="kitchen (executable)">
                    kitchen (executable)
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_yml_kitchen.html" title=".kitchen.yml">
                    .kitchen.yml
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_kitchen_vagrant.html" title="kitchen-vagrant">
                    kitchen-vagrant
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Knife">
                Knife
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/knife.html" title="About Knife">
                    About Knife
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_common_options.html" title="Common Options">
                    Common Options
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_using.html" title="Using Knife">
                    Using Knife
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_knife.html" title="knife.rb">
                    knife.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_bootstrap.html" title="knife bootstrap">
                    knife bootstrap
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_client.html" title="knife client">
                    knife client
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_configure.html" title="knife configure">
                    knife configure
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_cookbook.html" title="knife cookbook">
                    knife cookbook
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_cookbook_site.html" title="knife cookbook site">
                    knife cookbook site
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_data_bag.html" title="knife data bag">
                    knife data bag
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_delete.html" title="knife delete">
                    knife delete
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_deps.html" title="knife deps">
                    knife deps
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_diff.html" title="knife diff">
                    knife diff
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_download.html" title="knife download">
                    knife download
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_edit.html" title="knife edit">
                    knife edit
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_environment.html" title="knife environment">
                    knife environment
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_exec.html" title="knife exec">
                    knife exec
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_list.html" title="knife list">
                    knife list
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_node.html" title="knife node">
                    knife node
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_raw.html" title="knife raw">
                    knife raw
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_recipe_list.html" title="knife recipe list">
                    knife recipe list
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_role.html" title="knife role">
                    knife role
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_search.html" title="knife search">
                    knife search
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_serve.html" title="knife serve">
                    knife serve
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_show.html" title="knife show">
                    knife show
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_ssh.html" title="knife ssh">
                    knife ssh
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_ssl_check.html" title="knife ssl_check">
                    knife ssl_check
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_ssl_fetch.html" title="knife ssl_fetch">
                    knife ssl_fetch
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_status.html" title="knife status">
                    knife status
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_tag.html" title="knife tag">
                    knife tag
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_upload.html" title="knife upload">
                    knife upload
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_user.html" title="knife user">
                    knife user
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/knife_xargs.html" title="knife xargs">
                    knife xargs
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="knife opc">
                knife opc
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html" title="About knife opc">
                    About knife opc
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#knife-rb-configuration" title="knife.rb Configuration">
                    knife.rb Configuration
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-user-list" title="opc user list">
                    opc user list
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-user-show" title="opc user show">
                    opc user show
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-user-create" title="opc user create">
                    opc user create
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-user-delete" title="opc user delete">
                    opc user delete
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-user-edit" title="opc user edit">
                    opc user edit
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-user-password" title="opc user password">
                    opc user password
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-org-list" title="opc org list">
                    opc org list
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-org-show" title="opc org show">
                    opc org show
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-org-create" title="opc org create">
                    opc org create
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-org-delete" title="opc org delete">
                    opc org delete
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-org-user-add" title="opc org user add">
                    opc org user add
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_opc.html#opc-org-user-remove" title="opc org user remove">
                    opc org user remove
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_knife_spork.html" title="knife spork">
                knife spork
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="knife supermarket">
                knife supermarket
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html" title="About knife supermarket">
                    About knife supermarket
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#download" title="supermarket download">
                    supermarket download
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#install" title="supermarket install">
                    supermarket install
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#list" title="supermarket list">
                    supermarket list
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#search" title="supermarket search">
                    supermarket search
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#share" title="supermarket share">
                    supermarket share
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#show" title="supermarket show">
                    supermarket show
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html#unshare" title="supermarket unshare">
                    supermarket unshare
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Ohai">
                Ohai
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/ohai.html" title="About Ohai">
                    About Ohai
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_ohai.html" title="ohai (executable)">
                    ohai (executable)
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Policyfile">
                Policyfile
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/policyfile.html" title="About Policyfile">
                    About Policyfile
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_policyfile.html" title="Policyfile.rb">
                    Policyfile.rb
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Provisioning">
                Provisioning
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/provisioning.html" title="About Provisioning">
                    About Provisioning
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_load_balancer.html" title="load_balancer resource">
                    load_balancer resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_machine.html" title="machine resource">
                    machine resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_machine_batch.html" title="machine_batch resource">
                    machine_batch resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_machine_execute.html" title="machine_execute resource">
                    machine_execute resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_machine_file.html" title="machine_file resource">
                    machine_file resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/resource_machine_image.html" title="machine_image resource">
                    machine_image resource
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/provisioning_aws.html" title="AWS Driver Resources">
                    AWS Driver Resources
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/provisioning_fog.html" title="Fog Driver Resources">
                    Fog Driver Resources
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/provisioning_vagrant.html" title="Vagrant Driver Resources">
                    Vagrant Driver Resources
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_push_jobs_client.html" title="push-jobs-client (executable)">
                push-jobs-client (executable)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/rubocop.html" title="Rubocop">
                Rubocop
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Managing the Server">
            Managing the Server
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/runbook.html" title="Runbook (Single Page)">
                Runbook (Single Page)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_backup_restore.html" title="Backup &amp; Restore">
                Backup &amp; Restore
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_data.html" title="Data Storage">
                Data Storage
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_firewalls_and_ports.html" title="Firewalls &amp; Ports">
                Firewalls &amp; Ports
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_ldap.html" title="Active Directory &amp; LDAP">
                Active Directory &amp; LDAP
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_logs.html" title="Log Files">
                Log Files
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_monitor.html" title="Monitor">
                Monitor
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_orgs.html" title="Organizations &amp; Groups">
                Organizations &amp; Groups
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/secrets.html" title="Secrets">
                Secrets
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_security.html" title="Security">
                Security
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_services.html" title="Services">
                Services
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_tuning.html" title="Tuning">
                Tuning
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/upgrade_server.html" title="Upgrades">
                Upgrades
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/upgrade_server_ha_v2.html" title="Upgrade HA Cluster">
                Upgrade HA Cluster
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_users.html" title="Users">
                Users
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_chef_server.html" title="chef-server-ctl">
                chef-server-ctl
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_chef_backend.html" title="chef-backend-ctl">
                chef-backend-ctl
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_rb_server.html" title="chef-server.rb">
                chef-server.rb
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_opscode_expander.html" title="opscode-expander-ctl">
                opscode-expander-ctl
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/api_chef_server.html" title="Chef Server API">
                Chef Server API
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Push Jobs">
                Push Jobs
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_push_jobs.html" title="knife push jobs">
                    knife push jobs
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_push_jobs_client.html" title="push-jobs-client">
                    push-jobs-client
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_push_jobs_client.html" title="push-jobs-client.rb">
                    push-jobs-client.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_push_jobs_server.html" title="push-jobs-server.rb">
                    push-jobs-server.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/api_push_jobs.html" title="Push Jobs API">
                    Push Jobs API
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_sent_events.html" title="Server Sent Events">
                    Server Sent Events
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Supermarket">
                Supermarket
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/supermarket_logs.html" title="Log Files">
                    Log Files
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/supermarket_monitor.html" title="Monitoring">
                    Monitoring
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_supermarket.html" title="supermarket.rb">
                    supermarket.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/plugin_knife_supermarket.html" title="knife supermarket">
                    knife supermarket
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_supermarket.html" title="supermarket-ctl">
                    supermarket-ctl
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/supermarket_api.html" title="Supermarket API">
                    Supermarket API
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Management Console">
                Management Console
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/server_configure_saml.html" title="Configure SAML">
                    Configure SAML
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_manage_clients.html" title="Clients">
                    Clients
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_manage_cookbooks.html" title="Cookbooks">
                    Cookbooks
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_manage_data_bags.html" title="Data Bags">
                    Data Bags
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_manage_environments.html" title="Environments">
                    Environments
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_manage_nodes.html" title="Nodes">
                    Nodes
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_manage_roles.html" title="Roles">
                    Roles
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/server_users.html#chef-manage" title="Users">
                    Users
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/config_rb_manage.html" title="manage.rb">
                    manage.rb
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_manage.html" title="chef-manage-ctl">
                    chef-manage-ctl
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li>
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="Habitat"> <!-- if item has custom image -->

        <img class="icon-left" src="./_static/habitat-mark.png"></img> Habitat <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items"> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/habitat.html" title="Habitat Overview">
            Habitat Overview
          </a>
        </li>

         <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Tutorials">
            Tutorials
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://www.habitat.sh/tutorials/getting-started-overview" title="Getting started">
                Getting started
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li>
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="InSpec"> <!-- if item has custom image -->

        <img class="icon-left" src="./_static/inspec_logo.png"></img> InSpec <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items"> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/inspec.html" title="InSpec Overview">
            InSpec Overview
          </a>
        </li>

         <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li>
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="Chef Automate"> <!-- else item does not have custom image and should use FontAwesome icon -->

        <i class="fa fa-cogs icon-left"></i> Chef Automate <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items">

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Getting Started">
            Getting Started
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_automate.html" title="Chef Automate Overview">
                Chef Automate Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/install_chef_automate.html" title="Installation Guide">
                Installation Guide
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Tutorials">
            Tutorials
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/automate/install" title="Get Started">
                Get Started
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/automate/visibility" title="Visibility into Infrastructure">
                Visibility into Infrastructure
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/automate/deploy-cookbook/" title="Deploy with Chef Automate">
                Deploy with Chef Automate
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/compliance-assess" title="Assess for Compliance">
                Assess for Compliance
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="https://learn.chef.io/tutorials/compliance-remediate" title="Remediate Compliance Failures">
                Remediate Compliance Failures
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Setup">
            Setup
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_pipeline.html" title="Configure a Pipeline">
                Configure a Pipeline
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_json_delivery.html" title="Configure a Project">
                Configure a Project
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/setup_visibility_chef_automate.html" title="Configure Data Collection">
                Configure Data Collection
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Concepts">
            Concepts
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2">

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Workflow">
                Workflow
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/workflow.html" title="Workflow Overview">
                    Workflow Overview
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/delivery_manage_dependencies.html" title="Manage Dependencies">
                    Manage Dependencies
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/visibility.html" title="Visibility Overview">
                Visibility Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/compliance.html" title="Compliance Overview">
                Compliance Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/ctl_delivery.html" title="Delivery CLI">
            Delivery CLI
          </a>
        </li>

         <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Integrations">
            Integrations
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_delivery_bitbucket.html" title="w/Bitbucket">
                w/Bitbucket
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_delivery_smtp.html" title="w/Email (SMTP)">
                w/Email (SMTP)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_delivery_github.html" title="w/GitHub">
                w/GitHub
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_delivery_ldap.html" title="w/LDAP">
                w/LDAP
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_chef_automate_saml.html" title="w/SAML">
                w/SAML
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_delivery_slack.html" title="w/Slack">
                w/Slack
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Cookbooks">
            Cookbooks
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_build_cookbook.html" title="build-cookbook (cookbook)">
                build-cookbook (cookbook)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_truck.html" title="delivery-truck (cookbook)">
                delivery-truck (cookbook)
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/publish_cookbooks_multiple_servers.html" title="Publish to Multiple Chef Servers">
                Publish to Multiple Chef Servers
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/dsl_delivery.html" title="Workflow DSL">
            Workflow DSL
          </a>
        </li>

         <!-- /if subItem2.hasSubItems --> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/job_dispatch.html" title="Job Dispatch">
            Job Dispatch
          </a>
        </li>

         <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Managing the Server">
            Managing the Server
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2">

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="Backups">
                Backups
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/delivery_server_backup.html#configuration" title="Configuration">
                    Configuration
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/delivery_server_backup.html#create-backups" title="Create Backups">
                    Create Backups
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/delivery_server_backup.html#list-backups" title="List Backups">
                    List Backups
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/delivery_server_backup.html#delete-backups" title="Delete Backups">
                    Delete Backups
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/delivery_server_backup.html#restore-backups" title="Restore Backups">
                    Restore Backups
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/scaling_capacity_planning_chef_automate.html" title="Capacity Planning">
                Capacity Planning
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/api_delivery.html" title="Chef Automate API">
                Chef Automate API
              </a>
            </li> <!-- /if subItem2.hasSubItems -->

            <li class="has-sub-items">
              <div class="has-sub-items-content" title="automate-ctl">
                automate-ctl
                <i class="fa fa-chevron-down"></i>
              </div>
              <ul class="sub-items level-3">

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#cleanse" title="cleanse">
                    cleanse
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#create-enterprise" title="create-enterprise">
                    create-enterprise
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#create-user" title="create-user">
                    create-user
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#delete-application" title="delete-application">
                    delete-application
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#delete-enterprise" title="delete-enterprise">
                    delete-enterprise
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#delete-project" title="delete-project">
                    delete-project
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#delete-user" title="delete-user">
                    delete-user
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#delete-visibility-node" title="delete-visibility-node">
                    delete-visibility-node
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#delete-visibility-node-by-id" title="delete-visibility-node-by-id">
                    delete-visibility-node-by-id
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#gather-logs" title="gather-logs">
                    gather-logs
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#help" title="help">
                    help
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#install-runner" title="install-runner">
                    install-runner
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#list-applications" title="list-applications">
                    list-applications
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#list-enterprises" title="list-enterprises">
                    list-enterprises
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#list-users" title="list-users">
                    list-users
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#migrate-change-description" title="migrate-change-description">
                    migrate-change-description
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#migrate-patchset-diffs" title="migrate-patchset-diffs">
                    migrate-patchset-diffs
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#preflight-check" title="preflight-check">
                    preflight-check
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#reconfigure" title="reconfigure">
                    reconfigure
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#rename-enterprise" title="rename-enterprise">
                    rename-enterprise
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#reset-password" title="reset-password">
                    reset-password
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#restore-backup" title="restore-backup">
                    restore-backup
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#revoke-token" title="revoke-token">
                    revoke-token
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#show-config" title="show-config">
                    show-config
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#uninstall" title="uninstall">
                    uninstall
                  </a>
                </li>

                <li>
                  <a class="nav-docs-link" href="/ctl_delivery_server.html#update-project-hooks" title="update-project-hooks">
                    update-project-hooks
                  </a>
                </li> <!-- /for subItem3 in subItem2.subItems -->

              </ul>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_rb_delivery.html" title="delivery.rb">
                delivery.rb
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_server_disaster_recovery.html" title="Disaster Recovery">
                Disaster Recovery
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/elasticsearch_and_kibana_auth.html" title="Elasticsearch &amp; Kibana Auth">
                Elasticsearch &amp; Kibana Auth
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/manage_indices_chef_automate.html" title="Manage Elasticsearch Indices">
                Manage Elasticsearch Indices
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/search_query_chef_automate.html" title="Node Search Reference">
                Node Search Reference
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_manage_secrets.html" title="Secrets">
                Secrets
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/stream_data_chef_automate.html" title="Stream Data">
                Stream Data
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_server_tuning.html" title="Tuning">
                Tuning
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/upgrade_chef_automate.html" title="Upgrades">
                Upgrades
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/delivery_users_and_roles.html" title="Users &amp; Roles">
                Users &amp; Roles
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Compliance scanner">
            Compliance scanner
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/compliance.html" title="Overview">
                Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/release_notes_compliance.html" title="Release Notes">
                Release Notes
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/install_compliance.html" title="Installation Guide">
                Installation Guide
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_compliance_chef_server.html" title="Integrate w/Chef Server">
                Integrate w/Chef Server
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/integrate_compliance_chef_automate.html" title="Integrate w/Chef Automate">
                Integrate w/Chef Automate
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/upgrade_compliance.html" title="Upgrade Compliance">
                Upgrade Compliance
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_rb_compliance.html" title="chef-compliance.rb">
                chef-compliance.rb
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/api_compliance.html" title="Chef Compliance API">
                Chef Compliance API
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/aws_opsworks_chef_automate.html" title="AWS OpsWorks for Chef Automate">
            AWS OpsWorks for Chef Automate
          </a>
        </li>

         <!-- /if subItem2.hasSubItems --> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/troubleshooting_chef_automate.html" title="Troubleshooting">
            Troubleshooting
          </a>
        </li>

         <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li>
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="Legacy"> <!-- else item does not have custom image and should use FontAwesome icon -->

        <i class="fa fa-hdd-o icon-left"></i> Legacy <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items">

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Analytics">
            Analytics
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics.html" title="Overview">
                Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/release_notes_analytics.html" title="Release Notes">
                Release Notes
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/install_analytics.html" title="Install Standalone">
                Install Standalone
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/actions.html" title="Web UI">
                Web UI
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics_webui_tasks.html" title="Management Console">
                Management Console
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics_nodes_view.html" title="Nodes View">
                Nodes View
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics.html#integrations" title="Integrations">
                Integrations
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics_splunk.html" title="Splunk">
                Splunk
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics_rules.html" title="Rules">
                Rules
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/analytics_monitor.html" title="Monitor">
                Monitor
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/upgrade_analytics.html" title="Upgrades">
                Upgrades
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/chef_client_analytics.html" title="Chef Client for Analytics">
                Chef Client for Analytics
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_analytics.html" title="opscode-analytics-ctl">
                opscode-analytics-ctl
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_rb_analytics.html" title="opscode-analytics.rb">
                opscode-analytics.rb
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_knife_analytics.html" title="knife-analytics">
                knife-analytics
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/api_analytics.html" title="Analytics API">
                Analytics API
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/dsl_recipe_analytics.html" title="Recipe DSL for Analytics">
                Recipe DSL for Analytics
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Reporting">
            Reporting
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/reporting.html" title="Overview">
                Overview
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/install_reporting.html" title="Install Reporting">
                Install Reporting
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/server_manage_reports.html" title="View Reports">
                View Reports
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_knife_reporting.html" title="knife reporting">
                knife reporting
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ctl_reporting.html" title="opscode-reporting-ctl">
                opscode-reporting-ctl
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/config_rb_reporting.html" title="opscode-reporting.rb">
                opscode-reporting.rb
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/api_reporting.html" title="Reporting API">
                Reporting API
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li>
    <li class="main-item has-sub-items">

      <div class="has-sub-items-content" title="Extension APIs"> <!-- else item does not have custom image and should use FontAwesome icon -->

        <i class="fa fa-clone icon-left"></i> Extension APIs <!-- endif -->

        <i class="fa fa-chevron-down"></i>
      </div>


      <ul class="sub-items"> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/dsl_compliance.html" title="Compliance DSL">
            Compliance DSL
          </a>
        </li>

         <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Handlers">
            Handlers
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/handlers.html#custom-handlers" title="Custom Handlers">
                Custom Handlers
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/dsl_handler.html" title="Handler DSL">
                Handler DSL
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_community.html#handlers" title="Community Handlers">
                Community Handlers
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Knife Plugins">
            Knife Plugins
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_knife.html" title="About Cloud Plugins">
                About Cloud Plugins
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_knife_custom.html" title="Custom Plugins">
                Custom Plugins
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_community.html#knife" title="Community Plugins">
                Community Plugins
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems -->

        <li class="has-sub-items">
          <div class="has-sub-items-content" title="Ohai Plugins">
            Ohai Plugins
            <i class="fa fa-chevron-down"></i>
          </div>
          <ul class="sub-items level-2"> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/ohai_custom.html" title="Custom Plugins">
                Custom Plugins
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem2 does not have sub items -->

            <li>
              <a class="nav-docs-link" href="/plugin_community.html#ohai" title="Community Plugins">
                Community Plugins
              </a>
            </li> <!-- /if subItem2.hasSubItems --> <!-- /for subItem2 in subItem.subItems -->

          </ul>
        
        </li> <!-- /if subItem2.hasSubItems --> <!-- if subItem does not have sub items  -->

        <li>
          <a class="nav-docs-link" href="/plugin_community.html#chef-client" title="Chef Client Plugins">
            Chef Client Plugins
          </a>
        </li>

         <!-- /if subItem2.hasSubItems --> <!-- /for subItem in subItems -->

      </ul>
    </li> <!-- /for item in navItems -->
    
    <li class="main-item dark-item">
      <a href="https://github.com/chef/chef-web-docs" title="Available on GitHub">
        <i class="fa fa-github icon-left"></i>
        Available on GitHub
      </a>
    </li>
    <li class="main-item dark-item">
      <a href="https://www.chef.io/chef/get-chef">
        <i class="fa fa-download icon-left"></i>
        Get Chef
      </a>
    </li>
    <li class="main-item dark-item">
      <a href="https://docs.chef.io/feedback.html">
        <i class="fa fa-commenting icon-left"></i>
        Send Feedback
      </a>
    </li>
    <li class="main-item dark-item">
      <a href="https://www.chef.io/support/">
        <i class="fa fa-support icon-left"></i>
        Support
      </a>
    </li>
    <li class="main-item dark-item">
      <a href="https://docs.chef.io/index.html">
        <i class="fa fa-map-o icon-left"></i>
        Site Map
      </a>
    </li>
    <li class="main-item dark-item">
      <a href="https://docs-archive.chef.io/">
        <i class="fa fa-archive icon-left"></i>
        Archive
      </a>
    </li>
  </ul>
</nav>
      <div class="documentwrapper"><div class="sphinxsidebar" role="navigation" aria-label="main navigation">
  <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Resources Reference</a><ul>
<li><a class="reference internal" href="#common-functionality">Common Functionality</a><ul>
<li><a class="reference internal" href="#actions">Actions</a><ul>
<li><a class="reference internal" href="#examples">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#properties">Properties</a><ul>
<li><a class="reference internal" href="#provider">Provider</a></li>
<li><a class="reference internal" href="#id1">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#guards">Guards</a><ul>
<li><a class="reference internal" href="#attributes">Attributes</a></li>
<li><a class="reference internal" href="#arguments">Arguments</a></li>
<li><a class="reference internal" href="#not-if-examples">not_if Examples</a></li>
<li><a class="reference internal" href="#only-if-examples">only_if Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#guard-interpreters">Guard Interpreters</a><ul>
<li><a class="reference internal" href="#id2">Attributes</a></li>
<li><a class="reference internal" href="#inheritance">Inheritance</a></li>
<li><a class="reference internal" href="#id3">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#lazy-evaluation">Lazy Evaluation</a></li>
<li><a class="reference internal" href="#notifications">Notifications</a><ul>
<li><a class="reference internal" href="#timers">Timers</a></li>
<li><a class="reference internal" href="#notifies">Notifies</a><ul>
<li><a class="reference internal" href="#id4">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#subscribes">Subscribes</a><ul>
<li><a class="reference internal" href="#id5">Examples</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#relative-paths">Relative Paths</a><ul>
<li><a class="reference internal" href="#id6">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#run-in-compile-phase">Run in Compile Phase</a><ul>
<li><a class="reference internal" href="#run-action">run_action</a></li>
</ul>
</li>
<li><a class="reference internal" href="#atomic-file-updates">Atomic File Updates</a></li>
<li><a class="reference internal" href="#windows-file-security">Windows File Security</a></li>
</ul>
</li>
<li><a class="reference internal" href="#resources">Resources</a></li>
<li><a class="reference internal" href="#apt-package">apt_package</a><ul>
<li><a class="reference internal" href="#syntax">Syntax</a></li>
<li><a class="reference internal" href="#id7">Actions</a></li>
<li><a class="reference internal" href="#id8">Properties</a><ul>
<li><a class="reference internal" href="#multiple-packages">Multiple Packages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#providers">Providers</a></li>
<li><a class="reference internal" href="#id9">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#apt-repository">apt_repository</a><ul>
<li><a class="reference internal" href="#id10">Syntax</a></li>
<li><a class="reference internal" href="#id11">Actions</a></li>
<li><a class="reference internal" href="#id12">Properties</a></li>
<li><a class="reference internal" href="#id13">Providers</a></li>
<li><a class="reference internal" href="#id14">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#apt-update">apt_update</a><ul>
<li><a class="reference internal" href="#id15">Syntax</a></li>
<li><a class="reference internal" href="#id16">Actions</a></li>
<li><a class="reference internal" href="#id17">Properties</a></li>
<li><a class="reference internal" href="#id18">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bash">bash</a><ul>
<li><a class="reference internal" href="#id19">Syntax</a></li>
<li><a class="reference internal" href="#id20">Actions</a></li>
<li><a class="reference internal" href="#id21">Properties</a><ul>
<li><a class="reference internal" href="#id22">Guards</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id23">Providers</a></li>
<li><a class="reference internal" href="#id24">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#batch">batch</a><ul>
<li><a class="reference internal" href="#id25">Syntax</a></li>
<li><a class="reference internal" href="#id26">Actions</a></li>
<li><a class="reference internal" href="#id27">Properties</a><ul>
<li><a class="reference internal" href="#id28">Guards</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id29">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#bff-package">bff_package</a><ul>
<li><a class="reference internal" href="#id30">Syntax</a></li>
<li><a class="reference internal" href="#id31">Actions</a></li>
<li><a class="reference internal" href="#id32">Properties</a></li>
<li><a class="reference internal" href="#id33">Providers</a></li>
<li><a class="reference internal" href="#id34">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#breakpoint">breakpoint</a><ul>
<li><a class="reference internal" href="#id35">Syntax</a></li>
<li><a class="reference internal" href="#id36">Actions</a></li>
<li><a class="reference internal" href="#id37">Properties</a></li>
<li><a class="reference internal" href="#debug-recipes-with-chef-shell">Debug Recipes with chef-shell</a><ul>
<li><a class="reference internal" href="#modes">Modes</a></li>
<li><a class="reference internal" href="#configure">Configure</a><ul>
<li><a class="reference internal" href="#chef-shell-rb">chef-shell.rb</a></li>
<li><a class="reference internal" href="#run-as-a-chef-client">Run as a chef-client</a></li>
</ul>
</li>
<li><a class="reference internal" href="#manage">Manage</a></li>
<li><a class="reference internal" href="#use-breakpoints">Use Breakpoints</a><ul>
<li><a class="reference internal" href="#step-through-run-list">Step Through Run-list</a></li>
<li><a class="reference internal" href="#debug-existing-recipe">Debug Existing Recipe</a></li>
<li><a class="reference internal" href="#advanced-debugging">Advanced Debugging</a></li>
</ul>
</li>
<li><a class="reference internal" href="#debug-examples">Debug Examples</a><ul>
<li><a class="reference internal" href="#hello-world">&#8220;Hello World&#8221;</a></li>
<li><a class="reference internal" href="#get-specific-nodes">Get Specific Nodes</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id38">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chef-gem">chef_gem</a><ul>
<li><a class="reference internal" href="#id39">Syntax</a></li>
<li><a class="reference internal" href="#id40">Actions</a></li>
<li><a class="reference internal" href="#id41">Properties</a></li>
<li><a class="reference internal" href="#id42">Providers</a></li>
<li><a class="reference internal" href="#id43">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chef-handler">chef_handler</a><ul>
<li><a class="reference internal" href="#handler-types">Handler Types</a><ul>
<li><a class="reference internal" href="#exception-report">Exception / Report</a></li>
<li><a class="reference internal" href="#start">Start</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id44">Syntax</a></li>
<li><a class="reference internal" href="#id45">Actions</a></li>
<li><a class="reference internal" href="#id46">Properties</a></li>
<li><a class="reference internal" href="#custom-handlers">Custom Handlers</a><ul>
<li><a class="reference internal" href="#id47">Syntax</a></li>
<li><a class="reference internal" href="#report-interface">report Interface</a></li>
<li><a class="reference internal" href="#optional-interfaces">Optional Interfaces</a><ul>
<li><a class="reference internal" href="#data">data</a></li>
<li><a class="reference internal" href="#run-report-safely">run_report_safely</a></li>
<li><a class="reference internal" href="#run-report-unsafe">run_report_unsafe</a></li>
</ul>
</li>
<li><a class="reference internal" href="#run-status-object">run_status Object</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id48">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#chocolatey-package">chocolatey_package</a><ul>
<li><a class="reference internal" href="#id52">Syntax</a></li>
<li><a class="reference internal" href="#id53">Actions</a></li>
<li><a class="reference internal" href="#id54">Properties</a></li>
<li><a class="reference internal" href="#id55">Providers</a></li>
<li><a class="reference internal" href="#id56">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cookbook-file">cookbook_file</a><ul>
<li><a class="reference internal" href="#id57">Syntax</a></li>
<li><a class="reference internal" href="#id58">Actions</a></li>
<li><a class="reference internal" href="#id59">Properties</a><ul>
<li><a class="reference internal" href="#id60">Atomic File Updates</a></li>
<li><a class="reference internal" href="#id61">Windows File Security</a></li>
</ul>
</li>
<li><a class="reference internal" href="#file-specificity">File Specificity</a></li>
<li><a class="reference internal" href="#id62">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cron">cron</a><ul>
<li><a class="reference internal" href="#id63">Syntax</a></li>
<li><a class="reference internal" href="#id64">Actions</a></li>
<li><a class="reference internal" href="#id65">Properties</a></li>
<li><a class="reference internal" href="#id66">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#csh">csh</a><ul>
<li><a class="reference internal" href="#id67">Syntax</a></li>
<li><a class="reference internal" href="#id68">Actions</a></li>
<li><a class="reference internal" href="#id69">Properties</a><ul>
<li><a class="reference internal" href="#id70">Guards</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id71">Providers</a></li>
<li><a class="reference internal" href="#id72">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deploy">deploy</a><ul>
<li><a class="reference internal" href="#id73">Syntax</a></li>
<li><a class="reference internal" href="#deploy-strategies">Deploy Strategies</a><ul>
<li><a class="reference internal" href="#deploy-phases">Deploy Phases</a><ul>
<li><a class="reference internal" href="#deploy-cache-file">Deploy Cache File</a></li>
</ul>
</li>
<li><a class="reference internal" href="#callbacks">Callbacks</a></li>
<li><a class="reference internal" href="#layout-modifiers">Layout Modifiers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id74">Actions</a><ul>
<li><a class="reference internal" href="#naming-resources">Naming Resources</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id75">Properties</a></li>
<li><a class="reference internal" href="#id76">Providers</a><ul>
<li><a class="reference internal" href="#deploy-branch">deploy_branch</a></li>
<li><a class="reference internal" href="#deploy-revision">deploy_revision</a></li>
<li><a class="reference internal" href="#timestamped-deploy">timestamped_deploy</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id77">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#directory">directory</a><ul>
<li><a class="reference internal" href="#id78">Syntax</a></li>
<li><a class="reference internal" href="#id79">Actions</a></li>
<li><a class="reference internal" href="#id80">Properties</a><ul>
<li><a class="reference internal" href="#recursive-directories">Recursive Directories</a></li>
<li><a class="reference internal" href="#id81">Windows File Security</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id82">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dpkg-package">dpkg_package</a><ul>
<li><a class="reference internal" href="#id83">Syntax</a></li>
<li><a class="reference internal" href="#id84">Actions</a></li>
<li><a class="reference internal" href="#id85">Properties</a></li>
<li><a class="reference internal" href="#id86">Providers</a></li>
<li><a class="reference internal" href="#id87">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dsc-resource">dsc_resource</a><ul>
<li><a class="reference internal" href="#id88">Syntax</a></li>
<li><a class="reference internal" href="#id89">Actions</a></li>
<li><a class="reference internal" href="#id90">Properties</a></li>
<li><a class="reference internal" href="#id91">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#dsc-script">dsc_script</a><ul>
<li><a class="reference internal" href="#id94">Syntax</a></li>
<li><a class="reference internal" href="#id95">Actions</a></li>
<li><a class="reference internal" href="#id96">Properties</a><ul>
<li><a class="reference internal" href="#ps-credential-helper">ps_credential Helper</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id97">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#easy-install-package">easy_install_package</a><ul>
<li><a class="reference internal" href="#id98">Syntax</a></li>
<li><a class="reference internal" href="#id99">Actions</a></li>
<li><a class="reference internal" href="#id100">Properties</a></li>
<li><a class="reference internal" href="#id101">Providers</a></li>
<li><a class="reference internal" href="#id102">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#env">env</a><ul>
<li><a class="reference internal" href="#id103">Syntax</a></li>
<li><a class="reference internal" href="#id104">Actions</a></li>
<li><a class="reference internal" href="#id105">Properties</a><ul>
<li><a class="reference internal" href="#id106">Guards</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id107">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#erl-call">erl_call</a><ul>
<li><a class="reference internal" href="#id108">Syntax</a></li>
<li><a class="reference internal" href="#id109">Actions</a></li>
<li><a class="reference internal" href="#id110">Properties</a><ul>
<li><a class="reference internal" href="#id111">Guards</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id112">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#execute">execute</a><ul>
<li><a class="reference internal" href="#id113">Syntax</a></li>
<li><a class="reference internal" href="#id114">Actions</a></li>
<li><a class="reference internal" href="#id115">Properties</a><ul>
<li><a class="reference internal" href="#id116">Guards</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id117">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#file">file</a><ul>
<li><a class="reference internal" href="#id118">Syntax</a></li>
<li><a class="reference internal" href="#id119">Actions</a></li>
<li><a class="reference internal" href="#id120">Properties</a><ul>
<li><a class="reference internal" href="#id121">Atomic File Updates</a></li>
<li><a class="reference internal" href="#id122">Windows File Security</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id123">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#freebsd-package">freebsd_package</a><ul>
<li><a class="reference internal" href="#id124">Syntax</a></li>
<li><a class="reference internal" href="#id125">Actions</a></li>
<li><a class="reference internal" href="#id126">Properties</a></li>
<li><a class="reference internal" href="#id127">Providers</a></li>
<li><a class="reference internal" href="#id128">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#gem-package">gem_package</a><ul>
<li><a class="reference internal" href="#id129">Syntax</a></li>
<li><a class="reference internal" href="#gem-package-options">Gem Package Options</a><ul>
<li><a class="reference internal" href="#specify-with-hash">Specify with Hash</a></li>
<li><a class="reference internal" href="#specify-with-string">Specify with String</a></li>
<li><a class="reference internal" href="#specify-with-gemrc-file">Specify with .gemrc File</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id130">Actions</a></li>
<li><a class="reference internal" href="#id131">Properties</a></li>
<li><a class="reference internal" href="#id132">Providers</a></li>
<li><a class="reference internal" href="#id133">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#git">git</a><ul>
<li><a class="reference internal" href="#id134">Syntax</a></li>
<li><a class="reference internal" href="#id135">Actions</a></li>
<li><a class="reference internal" href="#id136">Properties</a></li>
<li><a class="reference internal" href="#id137">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#group">group</a><ul>
<li><a class="reference internal" href="#id138">Syntax</a></li>
<li><a class="reference internal" href="#id139">Actions</a></li>
<li><a class="reference internal" href="#id140">Properties</a></li>
<li><a class="reference internal" href="#id141">Providers</a></li>
<li><a class="reference internal" href="#id142">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#homebrew-package">homebrew_package</a><ul>
<li><a class="reference internal" href="#id143">Syntax</a></li>
<li><a class="reference internal" href="#id144">Actions</a></li>
<li><a class="reference internal" href="#id145">Properties</a></li>
<li><a class="reference internal" href="#id146">Providers</a></li>
<li><a class="reference internal" href="#id147">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#http-request">http_request</a><ul>
<li><a class="reference internal" href="#id148">Syntax</a></li>
<li><a class="reference internal" href="#id149">Actions</a></li>
<li><a class="reference internal" href="#id150">Properties</a></li>
<li><a class="reference internal" href="#id151">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ifconfig">ifconfig</a><ul>
<li><a class="reference internal" href="#id152">Syntax</a></li>
<li><a class="reference internal" href="#id153">Actions</a></li>
<li><a class="reference internal" href="#id154">Properties</a></li>
<li><a class="reference internal" href="#id155">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ips-package">ips_package</a><ul>
<li><a class="reference internal" href="#id156">Syntax</a></li>
<li><a class="reference internal" href="#id157">Actions</a></li>
<li><a class="reference internal" href="#id158">Properties</a></li>
<li><a class="reference internal" href="#id159">Providers</a></li>
<li><a class="reference internal" href="#id160">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#link">link</a><ul>
<li><a class="reference internal" href="#id161">Syntax</a></li>
<li><a class="reference internal" href="#id162">Actions</a></li>
<li><a class="reference internal" href="#id163">Properties</a></li>
<li><a class="reference internal" href="#id164">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#log">log</a><ul>
<li><a class="reference internal" href="#id165">Syntax</a></li>
<li><a class="reference internal" href="#id166">Actions</a></li>
<li><a class="reference internal" href="#id167">Properties</a></li>
<li><a class="reference internal" href="#chef-log-entries">Chef::Log Entries</a></li>
<li><a class="reference internal" href="#id168">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#macports-package">macports_package</a><ul>
<li><a class="reference internal" href="#id169">Syntax</a></li>
<li><a class="reference internal" href="#id170">Actions</a></li>
<li><a class="reference internal" href="#id171">Properties</a></li>
<li><a class="reference internal" href="#id172">Providers</a></li>
<li><a class="reference internal" href="#id173">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mdadm">mdadm</a><ul>
<li><a class="reference internal" href="#id174">Syntax</a></li>
<li><a class="reference internal" href="#id175">Actions</a></li>
<li><a class="reference internal" href="#id176">Properties</a></li>
<li><a class="reference internal" href="#id177">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mount">mount</a><ul>
<li><a class="reference internal" href="#id178">Syntax</a></li>
<li><a class="reference internal" href="#id179">Actions</a></li>
<li><a class="reference internal" href="#id180">Properties</a></li>
<li><a class="reference internal" href="#id181">Providers</a></li>
<li><a class="reference internal" href="#id182">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ohai">ohai</a><ul>
<li><a class="reference internal" href="#id183">Syntax</a></li>
<li><a class="reference internal" href="#id184">Actions</a></li>
<li><a class="reference internal" href="#id185">Properties</a></li>
<li><a class="reference internal" href="#id186">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#openbsd-package">openbsd_package</a><ul>
<li><a class="reference internal" href="#id187">Syntax</a></li>
<li><a class="reference internal" href="#id188">Actions</a></li>
<li><a class="reference internal" href="#id189">Properties</a></li>
<li><a class="reference internal" href="#id190">Providers</a></li>
<li><a class="reference internal" href="#id191">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#osx-profile">osx_profile</a><ul>
<li><a class="reference internal" href="#id192">Syntax</a></li>
<li><a class="reference internal" href="#id193">Actions</a></li>
<li><a class="reference internal" href="#id194">Properties</a></li>
<li><a class="reference internal" href="#id195">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#package">package</a><ul>
<li><a class="reference internal" href="#id196">Syntax</a><ul>
<li><a class="reference internal" href="#id197">Gem Package Options</a><ul>
<li><a class="reference internal" href="#id198">Specify with Hash</a></li>
<li><a class="reference internal" href="#id199">Specify with String</a></li>
<li><a class="reference internal" href="#id200">Specify with .gemrc File</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id201">Actions</a></li>
<li><a class="reference internal" href="#id202">Properties</a><ul>
<li><a class="reference internal" href="#id203">Multiple Packages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id204">Providers</a></li>
<li><a class="reference internal" href="#id205">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pacman-package">pacman_package</a><ul>
<li><a class="reference internal" href="#id206">Syntax</a></li>
<li><a class="reference internal" href="#id207">Actions</a></li>
<li><a class="reference internal" href="#id208">Properties</a></li>
<li><a class="reference internal" href="#id209">Providers</a></li>
<li><a class="reference internal" href="#id210">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#paludis-package">paludis_package</a><ul>
<li><a class="reference internal" href="#id211">Syntax</a></li>
<li><a class="reference internal" href="#id212">Actions</a></li>
<li><a class="reference internal" href="#id213">Properties</a></li>
<li><a class="reference internal" href="#id214">Providers</a></li>
<li><a class="reference internal" href="#id215">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#perl">perl</a><ul>
<li><a class="reference internal" href="#id216">Syntax</a></li>
<li><a class="reference internal" href="#id217">Actions</a></li>
<li><a class="reference internal" href="#id218">Properties</a><ul>
<li><a class="reference internal" href="#id219">Guards</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id220">Providers</a></li>
<li><a class="reference internal" href="#id221">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#portage-package">portage_package</a><ul>
<li><a class="reference internal" href="#id222">Syntax</a></li>
<li><a class="reference internal" href="#id223">Actions</a></li>
<li><a class="reference internal" href="#id224">Properties</a></li>
<li><a class="reference internal" href="#id225">Providers</a></li>
<li><a class="reference internal" href="#id226">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#powershell-script">powershell_script</a><ul>
<li><a class="reference internal" href="#id227">Syntax</a></li>
<li><a class="reference internal" href="#id228">Actions</a></li>
<li><a class="reference internal" href="#id229">Properties</a><ul>
<li><a class="reference internal" href="#id230">Guards</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id231">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#python">python</a><ul>
<li><a class="reference internal" href="#id232">Syntax</a></li>
<li><a class="reference internal" href="#id233">Actions</a></li>
<li><a class="reference internal" href="#id234">Properties</a><ul>
<li><a class="reference internal" href="#id235">Guards</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id236">Providers</a></li>
<li><a class="reference internal" href="#id237">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#reboot">reboot</a><ul>
<li><a class="reference internal" href="#id238">Syntax</a></li>
<li><a class="reference internal" href="#id239">Actions</a></li>
<li><a class="reference internal" href="#id240">Properties</a></li>
<li><a class="reference internal" href="#id241">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#registry-key">registry_key</a><ul>
<li><a class="reference internal" href="#id242">Syntax</a><ul>
<li><a class="reference internal" href="#registry-key-path-separators">Registry Key Path Separators</a></li>
<li><a class="reference internal" href="#recipe-dsl-methods">Recipe DSL Methods</a><ul>
<li><a class="reference internal" href="#registry-data-exists">registry_data_exists?</a></li>
<li><a class="reference internal" href="#registry-get-subkeys">registry_get_subkeys</a></li>
<li><a class="reference internal" href="#registry-get-values">registry_get_values</a></li>
<li><a class="reference internal" href="#registry-has-subkeys">registry_has_subkeys?</a></li>
<li><a class="reference internal" href="#registry-key-exists">registry_key_exists?</a></li>
<li><a class="reference internal" href="#registry-value-exists">registry_value_exists?</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#id243">Actions</a></li>
<li><a class="reference internal" href="#id244">Properties</a></li>
<li><a class="reference internal" href="#id245">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#remote-directory">remote_directory</a><ul>
<li><a class="reference internal" href="#id246">Syntax</a></li>
<li><a class="reference internal" href="#id247">Actions</a></li>
<li><a class="reference internal" href="#id248">Properties</a><ul>
<li><a class="reference internal" href="#id249">Recursive Directories</a><ul>
<li><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id250">Windows File Security</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id251">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#remote-file">remote_file</a><ul>
<li><a class="reference internal" href="#id252">Syntax</a></li>
<li><a class="reference internal" href="#id253">Actions</a></li>
<li><a class="reference internal" href="#id254">Properties</a><ul>
<li><a class="reference internal" href="#id255">Atomic File Updates</a></li>
<li><a class="reference internal" href="#id256">Windows File Security</a></li>
<li><a class="reference internal" href="#prevent-re-downloads">Prevent Re-downloads</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id257">Providers</a></li>
<li><a class="reference internal" href="#id258">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#route">route</a><ul>
<li><a class="reference internal" href="#id259">Syntax</a></li>
<li><a class="reference internal" href="#id260">Actions</a></li>
<li><a class="reference internal" href="#id261">Properties</a></li>
<li><a class="reference internal" href="#id262">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#rpm-package">rpm_package</a><ul>
<li><a class="reference internal" href="#id263">Syntax</a></li>
<li><a class="reference internal" href="#id264">Actions</a></li>
<li><a class="reference internal" href="#id265">Properties</a></li>
<li><a class="reference internal" href="#id266">Providers</a></li>
<li><a class="reference internal" href="#id267">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ruby">ruby</a><ul>
<li><a class="reference internal" href="#id268">Syntax</a></li>
<li><a class="reference internal" href="#id269">Actions</a></li>
<li><a class="reference internal" href="#id270">Properties</a><ul>
<li><a class="reference internal" href="#id271">Guards</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id272">Providers</a></li>
<li><a class="reference internal" href="#id273">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#ruby-block">ruby_block</a><ul>
<li><a class="reference internal" href="#id274">Syntax</a></li>
<li><a class="reference internal" href="#id275">Actions</a></li>
<li><a class="reference internal" href="#id276">Properties</a></li>
<li><a class="reference internal" href="#id277">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#script">script</a><ul>
<li><a class="reference internal" href="#id278">Syntax</a></li>
<li><a class="reference internal" href="#id279">Actions</a></li>
<li><a class="reference internal" href="#id280">Properties</a><ul>
<li><a class="reference internal" href="#id281">Guards</a></li>
<li><a class="reference internal" href="#guard-interpreter">Guard Interpreter</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id282">Providers</a></li>
<li><a class="reference internal" href="#id283">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#service">service</a><ul>
<li><a class="reference internal" href="#id284">Syntax</a></li>
<li><a class="reference internal" href="#id285">Actions</a></li>
<li><a class="reference internal" href="#id286">Properties</a></li>
<li><a class="reference internal" href="#id287">Providers</a></li>
<li><a class="reference internal" href="#id288">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#smartos-package">smartos_package</a><ul>
<li><a class="reference internal" href="#id289">Syntax</a></li>
<li><a class="reference internal" href="#id290">Actions</a></li>
<li><a class="reference internal" href="#id291">Properties</a></li>
<li><a class="reference internal" href="#id292">Providers</a></li>
<li><a class="reference internal" href="#id293">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#solaris-package">solaris_package</a><ul>
<li><a class="reference internal" href="#id294">Syntax</a></li>
<li><a class="reference internal" href="#id295">Actions</a></li>
<li><a class="reference internal" href="#id296">Properties</a></li>
<li><a class="reference internal" href="#id297">Providers</a></li>
<li><a class="reference internal" href="#id298">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#subversion">subversion</a><ul>
<li><a class="reference internal" href="#id299">Syntax</a></li>
<li><a class="reference internal" href="#id300">Actions</a></li>
<li><a class="reference internal" href="#id301">Properties</a></li>
<li><a class="reference internal" href="#id302">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#systemd-unit">systemd_unit</a><ul>
<li><a class="reference internal" href="#id303">Syntax</a></li>
<li><a class="reference internal" href="#id304">Actions</a></li>
<li><a class="reference internal" href="#id305">Properties</a></li>
<li><a class="reference internal" href="#id306">Providers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#template">template</a><ul>
<li><a class="reference internal" href="#id307">Syntax</a></li>
<li><a class="reference internal" href="#id308">Actions</a></li>
<li><a class="reference internal" href="#id309">Properties</a><ul>
<li><a class="reference internal" href="#id310">Atomic File Updates</a></li>
<li><a class="reference internal" href="#id311">Windows File Security</a></li>
</ul>
</li>
<li><a class="reference internal" href="#using-templates">Using Templates</a><ul>
<li><a class="reference internal" href="#id312">File Specificity</a></li>
<li><a class="reference internal" href="#helpers">Helpers</a><ul>
<li><a class="reference internal" href="#inline-methods">Inline Methods</a></li>
<li><a class="reference internal" href="#inline-modules">Inline Modules</a></li>
<li><a class="reference internal" href="#library-modules">Library Modules</a></li>
</ul>
</li>
<li><a class="reference internal" href="#host-notation">Host Notation</a></li>
<li><a class="reference internal" href="#partial-templates">Partial Templates</a><ul>
<li><a class="reference internal" href="#render-method">render Method</a></li>
</ul>
</li>
<li><a class="reference internal" href="#transfer-frequency">Transfer Frequency</a></li>
<li><a class="reference internal" href="#variables">Variables</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id313">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#user">user</a><ul>
<li><a class="reference internal" href="#id315">Syntax</a></li>
<li><a class="reference internal" href="#id316">Actions</a></li>
<li><a class="reference internal" href="#id317">Properties</a></li>
<li><a class="reference internal" href="#password-shadow-hash">Password Shadow Hash</a></li>
<li><a class="reference internal" href="#id318">Providers</a></li>
<li><a class="reference internal" href="#id319">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#windows-package">windows_package</a><ul>
<li><a class="reference internal" href="#id320">Syntax</a></li>
<li><a class="reference internal" href="#id321">Actions</a></li>
<li><a class="reference internal" href="#id322">Properties</a></li>
<li><a class="reference internal" href="#id323">Providers</a></li>
<li><a class="reference internal" href="#id324">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#windows-service">windows_service</a><ul>
<li><a class="reference internal" href="#id325">Syntax</a></li>
<li><a class="reference internal" href="#id326">Actions</a></li>
<li><a class="reference internal" href="#id327">Properties</a></li>
<li><a class="reference internal" href="#id328">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#yum-package">yum_package</a><ul>
<li><a class="reference internal" href="#id329">Syntax</a></li>
<li><a class="reference internal" href="#id330">Actions</a></li>
<li><a class="reference internal" href="#id331">Properties</a><ul>
<li><a class="reference internal" href="#id332">Multiple Packages</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id333">Providers</a></li>
<li><a class="reference internal" href="#id334">Examples</a></li>
</ul>
</li>
<li><a class="reference internal" href="#yum-repository">yum_repository</a><ul>
<li><a class="reference internal" href="#id335">Syntax</a></li>
<li><a class="reference internal" href="#id336">Actions</a></li>
<li><a class="reference internal" href="#id337">Properties</a></li>
<li><a class="reference internal" href="#id338">Examples</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
</div>
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="resources-reference">
<h1>Resources Reference<a class="headerlink" href="#resources-reference" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resources.rst">[edit on GitHub]</a></p>
<p>A resource is a statement of configuration policy that:</p>
<ul class="simple">
<li>Describes the desired state for a configuration item</li>
<li>Declares the steps needed to bring that item to the desired state</li>
<li>Specifies a resource type&#8212;such as <tt class="docutils literal"><span class="pre">package</span></tt>, <tt class="docutils literal"><span class="pre">template</span></tt>, or <tt class="docutils literal"><span class="pre">service</span></tt></li>
<li>Lists additional details (also known as resource properties), as necessary</li>
<li>Are grouped into recipes, which describe working configurations</li>
</ul>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The <tt class="docutils literal"><span class="pre">Chef::Platform</span></tt> class maps providers to platforms (and platform versions). At the beginning of every chef-client run, Ohai verifies the <tt class="docutils literal"><span class="pre">platform</span></tt> and <tt class="docutils literal"><span class="pre">platform_version</span></tt> attributes on each node. The chef-client then uses those values to identify the correct provider, build an instance of that provider, identify the current state of the resource, do the specified action, and then mark the resource as updated (if changes were made).</p>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;/tmp/folder&#39;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The chef-client will look up the provider for the <tt class="docutils literal"><span class="pre">directory</span></tt> resource, which happens to be <tt class="docutils literal"><span class="pre">Chef::Provider::Directory</span></tt>, call <tt class="docutils literal"><span class="pre">load_current_resource</span></tt> to create a <tt class="docutils literal"><span class="pre">directory[&quot;/tmp/folder&quot;]</span></tt> resource, and then, based on the current state of the directory, do the specified action, which in this case is to create a directory called <tt class="docutils literal"><span class="pre">/tmp/folder</span></tt>. If the directory already exists, nothing will happen. If the directory was changed in any way, the resource is marked as updated.</p>
<p>This reference describes each of the resources available to the chef-client, including a list of actions, a list of properties, (when applicable) a list of providers, and examples of using each resource.</p>
<div class="section" id="common-functionality">
<h2>Common Functionality<a class="headerlink" href="#common-functionality" title="Permalink to this headline">¶</a></h2>
<p>The properties and actions in this section apply to all resources.</p>
<div class="section" id="actions">
<h3>Actions<a class="headerlink" href="#actions" title="Permalink to this headline">¶</a></h3>
<p>The following actions may be used with any resource:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
</dl>
<div class="section" id="examples">
<h4>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h4>
<p>The following examples show how to use common actions in a recipe.</p>
<p><strong>Use the :nothing action</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;memcached&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:stop</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="properties">
<h3>Properties<a class="headerlink" href="#properties" title="Permalink to this headline">¶</a></h3>
<p>The following properties are common to every resource:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. The chef-client will attempt to determine the correct provider during the chef-client run, and then choose the best/correct provider based on configuration data collected at the start of the chef-client run. In general, a provider does not need to be specified.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">sensitive</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Ensure that sensitive resource data is not logged by the chef-client. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>. This property only applies to the <strong>execute</strong>, <strong>file</strong> and <strong>template</strong> resources.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">supports</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A hash of options that contains hints about the capabilities of a resource. The chef-client may use these hints to help identify the correct provider. This property is only used by a small number of providers, including <strong>user</strong> and <strong>service</strong>.</p>
</dd>
</dl>
<div class="section" id="provider">
<h4>Provider<a class="headerlink" href="#provider" title="Permalink to this headline">¶</a></h4>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
</div>
<div class="section" id="id1">
<h4>Examples<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<p>The following examples show how to use common properties in a recipe.</p>
<p><strong>Use the ignore_failure common property</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;syntax&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">ignore_failure</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the provider common property</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;some_package&#39;</span> <span class="k">do</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rubygems</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the supports common property</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;apache&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the supports and providers common properties</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;some_service&#39;</span> <span class="k">do</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Upstart</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="guards">
<h3>Guards<a class="headerlink" href="#guards" title="Permalink to this headline">¶</a></h3>
<p>A guard property can be used to evaluate the state of a node during the execution phase of the chef-client run. Based on the results of this evaluation, a guard property is then used to tell the chef-client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p>
<ul class="simple">
<li>A string is executed as a shell command. If the command returns <tt class="docutils literal"><span class="pre">0</span></tt>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <tt class="docutils literal"><span class="pre">true</span></tt> in addition to <tt class="docutils literal"><span class="pre">0</span></tt>.</li>
<li>A block is executed as Ruby code that must return either <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. If the block returns <tt class="docutils literal"><span class="pre">true</span></tt>, the guard property is applied. If the block returns <tt class="docutils literal"><span class="pre">false</span></tt>, the guard property is not applied.</li>
</ul>
<p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for the chef-client to do nothing.</p>
<div class="section" id="attributes">
<h4>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h4>
<p>The following properties can be used to define a guard that is evaluated during the execution phase of the chef-client run:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">not_if</span></tt></dt>
<dd>Prevent a resource from executing when the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">only_if</span></tt></dt>
<dd>Allow a resource to execute only if the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
</dl>
</div>
<div class="section" id="arguments">
<h4>Arguments<a class="headerlink" href="#arguments" title="Permalink to this headline">¶</a></h4>
<p>The following arguments can be used with the <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:user</span></tt></dt>
<dd><p class="first">Specify the user that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:group</span></tt></dt>
<dd><p class="first">Specify the group that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:environment</span></tt></dt>
<dd><p class="first">Specify a Hash of environment variables to be set. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/adam&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:cwd</span></tt></dt>
<dd><p class="first">Set the current working directory before running a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam passwd&#39;</span><span class="p">,</span> <span class="ss">:cwd</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:timeout</span></tt></dt>
<dd><p class="first">Set a timeout for a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;sleep 10000&#39;</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="not-if-examples">
<h4>not_if Examples<a class="headerlink" href="#not-if-examples" title="Permalink to this headline">¶</a></h4>
<p>The following examples show how to use <tt class="docutils literal"><span class="pre">not_if</span></tt> as a condition in a recipe:</p>
<p><strong>Create a file, but not if an attribute has a specific value</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and using the presence of an attribute value on the node to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="n">node</span><span class="o">[</span><span class="ss">:some_value</span><span class="o">]</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file with a Ruby block, but not if &#8220;/etc/passwd&#8221; exists</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and then Ruby code to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="k">do</span>
    <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file with Ruby block that has curly braces, but not if &#8220;/etc/passwd&#8221; exists</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and using a Ruby block (with curly braces) to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span> <span class="p">)}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file using a string, but not if &#8220;/etc/passwd&#8221; exists</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and using a string to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;test -f /etc/passwd&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a file from a remote location using bash</strong></p>
<p>The following is an example of how to install the <tt class="docutils literal"><span class="pre">foo123</span></tt> module for Nginx. This module adds shell-style functionality to an Nginx configuration file and does the following:</p>
<ul class="simple">
<li>Declares three variables</li>
<li>Gets the Nginx file from a remote location</li>
<li>Installs the file using Bash to the path specified by the <tt class="docutils literal"><span class="pre">src_filepath</span></tt> variable</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample is similar to the ``upload_progress_module``</span>
<span class="c1"># recipe in the ``nginx`` cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/nginx</span>

<span class="n">src_filename</span> <span class="o">=</span> <span class="s2">&quot;foo123-nginx-module-v</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">.tar.gz&quot;</span>
<span class="n">src_filepath</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">src_filename</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">extract_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span>
  <span class="si">}</span><span class="s2">/nginx_foo123_module/</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s1">&#39;src_filepath&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;extract_module&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    mkdir -p #{extract_path}</span>
<span class="sh">    tar xzf #{src_filename} -C #{extract_path}</span>
<span class="sh">    mv #{extract_path}/*/* #{extract_path}/</span>
<span class="no">    EOH</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="only-if-examples">
<h4>only_if Examples<a class="headerlink" href="#only-if-examples" title="Permalink to this headline">¶</a></h4>
<p>The following examples show how to use <tt class="docutils literal"><span class="pre">only_if</span></tt> as a condition in a recipe:</p>
<p><strong>Create a file, but only if an attribute has a specific value</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">only_if</span></tt> condition to create a file based on a template and using the presence of an attribute on the node to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">only_if</span> <span class="p">{</span> <span class="n">node</span><span class="o">[</span><span class="ss">:some_value</span><span class="o">]</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file with a Ruby block, but only if &#8220;/etc/passwd&#8221; does not exist</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">only_if</span></tt> condition to create a file based on a template, and then use Ruby to specify a condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">only_if</span> <span class="k">do</span> <span class="o">!</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">)</span> <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file using a string, but only if &#8220;/etc/passwd&#8221; exists</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">only_if</span></tt> condition to create a file based on a template and using a string to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">only_if</span> <span class="s1">&#39;test -f /etc/passwd&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="guard-interpreters">
<h3>Guard Interpreters<a class="headerlink" href="#guard-interpreters" title="Permalink to this headline">¶</a></h3>
<p>Any resource that passes a string command may also specify the interpreter that will be used to evaluate that string command. This is done by using the <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property to specify a <strong>script</strong>-based resource.</p>
<div class="section" id="id2">
<h4>Attributes<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property may be set to any of the following values:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:bash</span></tt></dt>
<dd>Evaluates a string command using the <strong>bash</strong> resource.</dd>
<dt><tt class="docutils literal"><span class="pre">:batch</span></tt></dt>
<dd>Evaluates a string command using the <strong>batch</strong> resource. Default value (within a <strong>batch</strong> resource block): <tt class="docutils literal"><span class="pre">:batch</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">:csh</span></tt></dt>
<dd>Evaluates a string command using the <strong>csh</strong> resource.</dd>
<dt><tt class="docutils literal"><span class="pre">:default</span></tt></dt>
<dd>Default. Executes the default interpreter as identified by the chef-client.</dd>
<dt><tt class="docutils literal"><span class="pre">:perl</span></tt></dt>
<dd>Evaluates a string command using the <strong>perl</strong> resource.</dd>
<dt><tt class="docutils literal"><span class="pre">:powershell_script</span></tt></dt>
<dd>Evaluates a string command using the <strong>powershell_script</strong> resource. Default value (within a <strong>batch</strong> resource block): <tt class="docutils literal"><span class="pre">:powershell_script</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">:python</span></tt></dt>
<dd>Evaluates a string command using the <strong>python</strong> resource.</dd>
<dt><tt class="docutils literal"><span class="pre">:ruby</span></tt></dt>
<dd>Evaluates a string command using the <strong>ruby</strong> resource.</dd>
</dl>
</div>
<div class="section" id="inheritance">
<h4>Inheritance<a class="headerlink" href="#inheritance" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property is set to <tt class="docutils literal"><span class="pre">:default</span></tt> by default for the <strong>bash</strong>, <strong>csh</strong>, <strong>perl</strong>, <strong>python</strong>, and <strong>ruby</strong> resources. When the <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property is set to <tt class="docutils literal"><span class="pre">:default</span></tt>, <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard statements <strong>do not inherit</strong> properties that are defined by the <strong>script</strong>-based resource.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>batch</strong> and <strong>powershell_script</strong> resources inherit properties by default. The <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property is set to <tt class="docutils literal"><span class="pre">:batch</span></tt> or <tt class="docutils literal"><span class="pre">:powershell_script</span></tt> automatically when using a <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard statement within a <strong>batch</strong> or <strong>powershell_script</strong> resource, respectively.</p>
</div>
<p>For example, the <tt class="docutils literal"><span class="pre">not_if</span></tt> guard statement in the following resource example <strong>does not inherit</strong> the <tt class="docutils literal"><span class="pre">environment</span></tt> property:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;javatooling&#39;</span> <span class="k">do</span>
  <span class="n">environment</span> <span class="s1">&#39;JAVA_HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/lib/java/jdk1.7/home&#39;</span>
  <span class="n">code</span> <span class="s1">&#39;java-based-daemon-ctl.sh -start&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;java-based-daemon-ctl.sh -test-started&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and requires adding the <tt class="docutils literal"><span class="pre">environment</span></tt> property to the <tt class="docutils literal"><span class="pre">not_if</span></tt> guard statement so that it may use the <tt class="docutils literal"><span class="pre">JAVA_HOME</span></tt> path as part of its evaluation:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;javatooling&#39;</span> <span class="k">do</span>
  <span class="n">environment</span> <span class="s1">&#39;JAVA_HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/lib/java/jdk1.7/home&#39;</span>
  <span class="n">code</span> <span class="s1">&#39;java-based-daemon-ctl.sh -start&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;java-based-daemon-ctl.sh -test-started&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="s1">&#39;JAVA_HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/lib/java/jdk1.7/home&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>To inherit properties, add the <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property to the resource block and set it to the appropriate value:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">:bash</span></tt> for <strong>bash</strong></li>
<li><tt class="docutils literal"><span class="pre">:csh</span></tt> for <strong>csh</strong></li>
<li><tt class="docutils literal"><span class="pre">:perl</span></tt> for <strong>perl</strong></li>
<li><tt class="docutils literal"><span class="pre">:python</span></tt> for <strong>python</strong></li>
<li><tt class="docutils literal"><span class="pre">:ruby</span></tt> for <strong>ruby</strong></li>
</ul>
<p>For example, using the same example as from above, but this time adding the <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property and setting it to <tt class="docutils literal"><span class="pre">:bash</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;javatooling&#39;</span> <span class="k">do</span>
  <span class="n">guard_interpreter</span> <span class="ss">:bash</span>
  <span class="n">environment</span> <span class="s1">&#39;JAVA_HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/lib/java/jdk1.7/home&#39;</span>
  <span class="n">code</span> <span class="s1">&#39;java-based-daemon-ctl.sh -start&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;java-based-daemon-ctl.sh -test-started&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">not_if</span></tt> statement now inherits the <tt class="docutils literal"><span class="pre">environment</span></tt> property and will use the <tt class="docutils literal"><span class="pre">JAVA_HOME</span></tt> path as part of its evaluation.</p>
</div>
<div class="section" id="id3">
<h4>Examples<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h4>
<p>For example, the following code block will ensure the command is evaluated using the default intepreter as identified by the chef-client:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">guard_interpreter</span> <span class="ss">:default</span>
  <span class="c1"># code</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="lazy-evaluation">
<h3>Lazy Evaluation<a class="headerlink" href="#lazy-evaluation" title="Permalink to this headline">¶</a></h3>
<p>In some cases, the value for a property cannot be known until the execution phase of a chef-client run. In this situation, using lazy evaluation of property values can be helpful. Instead of a property being assigned a value, it may instead be assigned a code block. The syntax for using lazy evaluation is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">attribute_name</span> <span class="n">lazy</span> <span class="p">{</span> <span class="n">code_block</span> <span class="p">}</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">lazy</span></tt> is used to tell the chef-client to evaluate the contents of the code block later on in the resource evaluation process (instead of immediately) and <tt class="docutils literal"><span class="pre">{</span> <span class="pre">code_block</span> <span class="pre">}</span></tt> is arbitrary Ruby code that provides the value.</p>
<p>For example, a resource that is <strong>not</strong> doing lazy evaluation:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;template_name&#39;</span> <span class="k">do</span>
  <span class="c1"># some attributes</span>
  <span class="n">path</span> <span class="s1">&#39;/foo/bar&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and a resource block that is doing lazy evaluation:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;template_name&#39;</span> <span class="k">do</span>
  <span class="c1"># some attributes</span>
  <span class="n">path</span> <span class="n">lazy</span> <span class="p">{</span> <span class="s1">&#39; some Ruby code &#39;</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>In the previous examples, the first resource uses the value <tt class="docutils literal"><span class="pre">/foo/bar</span></tt> and the second resource uses the value provided by the code block, as long as the contents of that code block are a valid resource property.</p>
<p>The following example shows how to use lazy evaluation with template variables:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/canvey_island.txt&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;canvey_island.txt.erb&#39;</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="n">lazy</span> <span class="p">{</span>
      <span class="p">{</span> <span class="ss">:canvey_island</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">.</span><span class="n">run_state</span><span class="o">[</span><span class="s1">&#39;sea_power&#39;</span><span class="o">]</span> <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="notifications">
<h3>Notifications<a class="headerlink" href="#notifications" title="Permalink to this headline">¶</a></h3>
<p>A notification is a property on a resource that listens to other resources in the resource collection and then takes actions based on the notification type (<tt class="docutils literal"><span class="pre">notifies</span></tt> or <tt class="docutils literal"><span class="pre">subscribes</span></tt>).</p>
<div class="section" id="timers">
<h4>Timers<a class="headerlink" href="#timers" title="Permalink to this headline">¶</a></h4>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
</div>
<div class="section" id="notifies">
<h4>Notifies<a class="headerlink" href="#notifies" title="Permalink to this headline">¶</a></h4>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
<div class="section" id="id4">
<h5>Examples<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h5>
<p>The following examples show how to use the <tt class="docutils literal"><span class="pre">notifies</span></tt> notification in a recipe.</p>
<p><strong>Delay notifications</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/nagios3/configures-nagios.conf&#39;</span> <span class="k">do</span>
  <span class="c1"># other parameters</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test-nagios-config]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Notify immediately</strong></p>
<p>By default, notifications are <tt class="docutils literal"><span class="pre">:delayed</span></tt>, that is they are queued up as they are triggered, and then executed at the very end of a chef-client run. To run an action immediately, use <tt class="docutils literal"><span class="pre">:immediately</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/nagios3/configures-nagios.conf&#39;</span> <span class="k">do</span>
  <span class="c1"># other parameters</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test-nagios-config]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the chef-client would immediately run the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test-nagios-config&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;nagios3 --verify-config&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Notify multiple resources</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/chef/server.rb&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;server.rb.erb&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[chef-solr]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[chef-solr-indexer]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[chef-server]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Notify in a specific order</strong></p>
<p>To notify multiple resources, and then have these resources run in a certain order, do something like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;...&#39;</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;template[baz]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:install</span><span class="p">,</span> <span class="s1">&#39;package[bar]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[final]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;baz&#39;</span> <span class="k">do</span>
  <span class="o">...</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[restart_baz]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">package</span> <span class="s1">&#39;bar&#39;</span>

<span class="n">execute</span> <span class="s1">&#39;restart_baz&#39;</span>

<span class="n">execute</span> <span class="s1">&#39;final&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;...&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the sequencing will be in the same order as the resources are listed in the recipe: <tt class="docutils literal"><span class="pre">execute</span> <span class="pre">'foo'</span></tt>, <tt class="docutils literal"><span class="pre">template</span> <span class="pre">'baz'</span></tt>, <tt class="docutils literal"><span class="pre">execute</span> <span class="pre">[restart_baz]</span></tt>, <tt class="docutils literal"><span class="pre">package</span> <span class="pre">'bar'</span></tt>, and <tt class="docutils literal"><span class="pre">execute</span> <span class="pre">'final'</span></tt>.</p>
<p><strong>Reload a service</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;service[apache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Restart a service when a template is modified</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/www/configures-apache.conf&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[apache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Send notifications to multiple resources</strong></p>
<p>To send notifications to multiple resources, just use multiple attributes. Multiple attributes will get sent to the notified resources in the order specified.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/netatalk/netatalk.conf&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[afpd]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[cnid]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">service</span> <span class="s1">&#39;afpd&#39;</span>
<span class="n">service</span> <span class="s1">&#39;cnid&#39;</span>
</pre></div>
</div>
<p><strong>Execute a command using a template</strong></p>
<p>The following example shows how to set up IPv4 packet forwarding using the <strong>execute</strong> resource to run a command named <tt class="docutils literal"><span class="pre">forward_ipv4</span></tt> that uses a template defined by the <strong>template</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;forward_ipv4&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;echo &gt; /proc/.../ipv4/ip_forward&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/etc/file_name.conf&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;routing/file_name.conf.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[forward_ipv4]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">command</span></tt> property for the <strong>execute</strong> resource contains the command that is to be run and the <tt class="docutils literal"><span class="pre">source</span></tt> property for the <strong>template</strong> resource specifies which template to use. The <tt class="docutils literal"><span class="pre">notifies</span></tt> property for the <strong>template</strong> specifies that the <tt class="docutils literal"><span class="pre">execute[forward_ipv4]</span></tt> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of the chef-client run.</p>
<p><strong>Restart a service, and then notify a different service</strong></p>
<p>The following example shows how start a service named <tt class="docutils literal"><span class="pre">example_service</span></tt> and immediately notify the Nginx service to restart.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;example_service&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Init</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[nginx]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where by using the default <tt class="docutils literal"><span class="pre">provider</span></tt> for the <strong>service</strong>, the recipe is telling the chef-client to determine the specific provider to be used during the chef-client run based on the platform of the node on which the recipe will run.</p>
<p><strong>Notify when a remote source changes</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/tmp/couch.png&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://couchdb.apache.org/img/sketch.png&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">http_request</span> <span class="s1">&#39;HEAD http://couchdb.apache.org/img/sketch.png&#39;</span> <span class="k">do</span>
  <span class="n">message</span> <span class="s1">&#39;&#39;</span>
  <span class="n">url</span> <span class="s1">&#39;http://couchdb.apache.org/img/sketch.png&#39;</span>
  <span class="n">action</span> <span class="ss">:head</span>
  <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/tmp/couch.png&#39;</span><span class="p">)</span>
    <span class="n">headers</span> <span class="s1">&#39;If-Modified-Since&#39;</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">mtime</span><span class="p">(</span><span class="s1">&#39;/tmp/couch.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">httpdate</span>
  <span class="k">end</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;remote_file[/tmp/couch.png]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="subscribes">
<h4>Subscribes<a class="headerlink" href="#subscribes" title="Permalink to this headline">¶</a></h4>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
<div class="section" id="id5">
<h5>Examples<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h5>
<p>The following examples show how to use the <tt class="docutils literal"><span class="pre">subscribes</span></tt> notification in a recipe.</p>
<p><strong>Prevent restart and reconfigure if configuration is broken</strong></p>
<p>Use the <tt class="docutils literal"><span class="pre">:nothing</span></tt> action (common to all resources) to prevent an application from restarting, and then use the <tt class="docutils literal"><span class="pre">subscribes</span></tt> notification to ask the broken configuration to be reconfigured immediately:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test-nagios-config&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;nagios3 --verify-config&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">subscribes</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;template[/etc/nagios3/configures-nagios.conf]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reload a service using a template</strong></p>
<p>To reload a service based on a template, use the <strong>template</strong> and <strong>service</strong> resources together in the same recipe, similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
<span class="k">end</span>

<span class="n">service</span> <span class="s1">&#39;apache&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
  <span class="n">subscribes</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;template[/tmp/somefile]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">subscribes</span></tt> notification is used to reload the service using the template specified by the <strong>template</strong> resource.</p>
<p><strong>Stash a file in a data bag</strong></p>
<p>The following example shows how to use the <strong>ruby_block</strong> resource to stash a BitTorrent file in a data bag so that it can be distributed to nodes in the organization.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``seed`` recipe</span>
<span class="c1"># in the following cookbook: https://github.com/mattray/bittorrent-cookbook</span>

<span class="n">ruby_block</span> <span class="s1">&#39;share the torrent file&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;bittorrent&#39;</span><span class="o">][</span><span class="s1">&#39;torrent&#39;</span><span class="o">]</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="c1">#read the .torrent file and base64 encode it</span>
    <span class="n">enc</span> <span class="o">=</span> <span class="no">Base64</span><span class="o">.</span><span class="n">encode64</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;id&#39;</span><span class="o">=&gt;</span><span class="n">bittorrent_item_id</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;bittorrent&#39;</span><span class="o">][</span><span class="s1">&#39;file&#39;</span><span class="o">]</span><span class="p">),</span>
      <span class="s1">&#39;seed&#39;</span><span class="o">=&gt;</span><span class="n">node</span><span class="o">.</span><span class="n">ipaddress</span><span class="p">,</span>
      <span class="s1">&#39;torrent&#39;</span><span class="o">=&gt;</span><span class="n">enc</span>
    <span class="p">}</span>
    <span class="n">item</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">DataBagItem</span><span class="o">.</span><span class="n">new</span>
    <span class="n">item</span><span class="o">.</span><span class="n">data_bag</span><span class="p">(</span><span class="s1">&#39;bittorrent&#39;</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">subscribes</span> <span class="ss">:create</span><span class="p">,</span> <span class="s2">&quot;bittorrent_torrent[</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;bittorrent&#39;</span><span class="o">][</span><span class="s1">&#39;torrent&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="relative-paths">
<h3>Relative Paths<a class="headerlink" href="#relative-paths" title="Permalink to this headline">¶</a></h3>
<p>The following relative paths can be used with any resource:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">#{ENV['HOME']}</span></tt></dt>
<dd>Use to return the <tt class="docutils literal"><span class="pre">~</span></tt> path in Linux and Mac OS X or the <tt class="docutils literal"><span class="pre">%HOMEPATH%</span></tt> in Microsoft Windows.</dd>
</dl>
<div class="section" id="id6">
<h4>Examples<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h4>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;HOME&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/chef-getting-started.txt&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;chef-getting-started.txt.erb&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="run-in-compile-phase">
<h3>Run in Compile Phase<a class="headerlink" href="#run-in-compile-phase" title="Permalink to this headline">¶</a></h3>
<p>The chef-client processes recipes in two phases:</p>
<ol class="arabic simple">
<li>First, each resource in the node object is identified and a resource collection is built. All recipes are loaded in a specific order, and then the actions specified within each of them are identified. This is also referred to as the &#8220;compile phase&#8221;.</li>
<li>Next, the chef-client configures the system based on the order of the resources in the resource collection. Each resource is mapped to a provider, which then examines the node and performs the necessary steps to complete the action. This is also referred to as the &#8220;execution phase&#8221;.</li>
</ol>
<p>Typically, actions are processed during the execution phase of the chef-client run. However, sometimes it is necessary to run an action during the compile phase. For example, a resource can be configured to install a package during the compile phase to ensure that application is available to other resources during the execution phase.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use the <strong>chef_gem</strong> resource to install gems that are needed by the chef-client during the execution phase.</p>
</div>
<div class="section" id="run-action">
<h4>run_action<a class="headerlink" href="#run-action" title="Permalink to this headline">¶</a></h4>
<p>Use <tt class="docutils literal"><span class="pre">.run_action(:some_action)</span></tt> at the end of a resource block to run the specified action during the compile phase. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource_name</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span><span class="o">.</span><span class="n">run_action</span><span class="p">(</span><span class="ss">:some_action</span><span class="p">)</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">action</span></tt> is set to <tt class="docutils literal"><span class="pre">:nothing</span></tt> to ensure the <tt class="docutils literal"><span class="pre">run_action</span></tt> is run during the compile phase and not later during the execution phase.</p>
<p>The following examples show when (and when not) to use <tt class="docutils literal"><span class="pre">run_action</span></tt>.</p>
<p><strong>Update a package cache</strong></p>
<p>Sometimes it is necessary to ensure that an operating system&#8217;s package cache is up to date before installing packages. For example, on Debian or Ubuntu systems, the Apt cache should be updated:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;apt&#39;</span><span class="o">][</span><span class="s1">&#39;compile_time_update&#39;</span><span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="p">(</span> <span class="o">!::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/var/lib/apt/periodic/update-success-stamp&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="o">!::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">first_run_file</span><span class="p">)</span> <span class="p">)</span>
  <span class="n">e</span> <span class="o">=</span> <span class="n">bash</span> <span class="s1">&#39;apt-get-update at compile time&#39;</span> <span class="k">do</span>
    <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">      apt-get update</span>
<span class="sh">      touch #{first_run_file}</span>
<span class="no">    EOH</span>
    <span class="n">ignore_failure</span> <span class="kp">true</span>
    <span class="n">only_if</span> <span class="p">{</span> <span class="n">apt_installed?</span> <span class="p">}</span>
    <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="k">end</span>
  <span class="n">e</span><span class="o">.</span><span class="n">run_action</span><span class="p">(</span><span class="ss">:run</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">e.run_action(:run)</span></tt> tells the chef-client to run the <tt class="docutils literal"><span class="pre">apt-get</span> <span class="pre">update</span></tt> command during the compile phase. This example can be found in the <tt class="docutils literal"><span class="pre">default.rb</span></tt> recipe of the <a class="reference external" href="https://github.com/chef-cookbooks/apt">apt cookbook</a> that is maintained by Chef.</p>
<p><strong>Use the chef_gem resource for Ruby gems</strong></p>
<p>A very common use case us to install a gem during the compile phase so that it will be available to the chef-client during the execution phase. This is why the <strong>chef_gem</strong> resource exists. For example, this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_gem</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p>is effectively the same as</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span><span class="o">.</span><span class="n">run_action</span><span class="p">(</span><span class="ss">:install</span><span class="p">)</span>
<span class="no">Gem</span><span class="o">.</span><span class="n">clear_paths</span>
</pre></div>
</div>
<p>but without needing to define a <tt class="docutils literal"><span class="pre">run_action</span></tt>.</p>
<p><strong>Notifications will not work</strong></p>
<p>Resources that are executed during the compile phase cannot notify other resources. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;ifconfig&#39;</span>

<span class="nb">p</span> <span class="o">=</span> <span class="n">package</span> <span class="s1">&#39;vim-enhanced&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[ifconfig]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
<span class="nb">p</span><span class="o">.</span><span class="n">run_action</span><span class="p">(</span><span class="ss">:install</span><span class="p">)</span>
</pre></div>
</div>
<p>A better approach in this type of situation is to install the package before the resource collection is built to ensure that it is available to other resources later on.</p>
</div>
</div>
<div class="section" id="atomic-file-updates">
<h3>Atomic File Updates<a class="headerlink" href="#atomic-file-updates" title="Permalink to this headline">¶</a></h3>
<p>Atomic updates are used with <strong>file</strong>-based resources to help ensure that file updates can be made when updating a binary or if disk space runs out.</p>
<p>Atomic updates are enabled by default. They can be managed globally using the <tt class="docutils literal"><span class="pre">file_atomic_update</span></tt> setting in the client.rb file. They can be managed on a per-resource basis using the <tt class="docutils literal"><span class="pre">atomic_update</span></tt> property that is available with the <strong>cookbook_file</strong>, <strong>file</strong>, <strong>remote_file</strong>, and <strong>template</strong> resources.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On certain platforms, and after a file has been moved into place, the chef-client may modify file permissions to support features specific to those platforms. On platforms with SELinux enabled, the chef-client will fix up the security contexts after a file has been moved into the correct location by running the <tt class="docutils literal"><span class="pre">restorecon</span></tt> command. On the Microsoft Windows platform, the chef-client will create files so that ACL inheritance works as expected.</p>
</div>
</div>
<div class="section" id="windows-file-security">
<h3>Windows File Security<a class="headerlink" href="#windows-file-security" title="Permalink to this headline">¶</a></h3>
<p>To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes.</p>
<p><strong>Access Control Lists (ACLs)</strong></p>
<p>The <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used as many times as necessary; the chef-client will apply them to the file or directory as required. The syntax for the <tt class="docutils literal"><span class="pre">rights</span></tt> property is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="n">permission</span><span class="p">,</span> <span class="n">principal</span><span class="p">,</span> <span class="n">option_type</span> <span class="o">=&gt;</span> <span class="n">value</span>
</pre></div>
</div>
<p>where</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">permission</span></tt></dt>
<dd><p class="first">Use to specify which rights are granted to the <tt class="docutils literal"><span class="pre">principal</span></tt>. The possible values are: <tt class="docutils literal"><span class="pre">:read</span></tt>, <tt class="docutils literal"><span class="pre">:write</span></tt>, <tt class="docutils literal"><span class="pre">read_execute</span></tt>, <tt class="docutils literal"><span class="pre">:modify</span></tt>, and <tt class="docutils literal"><span class="pre">:full_control</span></tt>.</p>
<p>These permissions are cumulative. If <tt class="docutils literal"><span class="pre">:write</span></tt> is specified, then it includes <tt class="docutils literal"><span class="pre">:read</span></tt>. If <tt class="docutils literal"><span class="pre">:full_control</span></tt> is specified, then it includes both <tt class="docutils literal"><span class="pre">:write</span></tt> and <tt class="docutils literal"><span class="pre">:read</span></tt>.</p>
<p class="last">(For those who know the Microsoft Windows API: <tt class="docutils literal"><span class="pre">:read</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>; <tt class="docutils literal"><span class="pre">:write</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>; <tt class="docutils literal"><span class="pre">:read_execute</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt> and <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>; <tt class="docutils literal"><span class="pre">:modify</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>, and <tt class="docutils literal"><span class="pre">DELETE</span></tt>; <tt class="docutils literal"><span class="pre">:full_control</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_ALL</span></tt>, which allows a user to change the owner and other metadata about a file.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">principal</span></tt></dt>
<dd>Use to specify a group or user name. This is identical to what is entered in the login box for Microsoft Windows, such as <tt class="docutils literal"><span class="pre">user_name</span></tt>, <tt class="docutils literal"><span class="pre">domain\user_name</span></tt>, or <tt class="docutils literal"><span class="pre">user_name&#64;fully_qualified_domain_name</span></tt>. The chef-client does not need to know if a principal is a user or a group.</dd>
<dt><tt class="docutils literal"><span class="pre">option_type</span></tt></dt>
<dd><p class="first">A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">:write,</span> <span class="pre">'domain\group_name',</span> <span class="pre">:one_level_deep</span> <span class="pre">=&gt;</span> <span class="pre">true</span></tt>. Possible option types:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:applies_to_children</span></tt></td>
<td>Specify how permissions are applied to children. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to inherit both child directories and files;  <tt class="docutils literal"><span class="pre">false</span></tt> to not inherit any child directories or files; <tt class="docutils literal"><span class="pre">:containers_only</span></tt> to inherit only child directories (and not files); <tt class="docutils literal"><span class="pre">:objects_only</span></tt> to recursively inherit files (and not child directories).</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:applies_to_self</span></tt></td>
<td>Indicates whether a permission is applied to the parent directory. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply to the parent directory or file and its children; <tt class="docutils literal"><span class="pre">false</span></tt> to not apply only to child directories and files.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:one_level_deep</span></tt></td>
<td>Indicates the depth to which permissions will be applied. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply only to the first level of children; <tt class="docutils literal"><span class="pre">false</span></tt> to apply to all children.</td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Administrators&#39;</span><span class="p">,</span><span class="s1">&#39;Everyone&#39;</span><span class="o">]</span>
<span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;Users&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;Sally&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="ss">:containers_only</span><span class="p">,</span> <span class="ss">:applies_to_self</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:one_level_deep</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</pre></div>
</div>
<p>Some other important things to know when using the <tt class="docutils literal"><span class="pre">rights</span></tt> attribute:</p>
<ul class="simple">
<li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li>
<li>If rights are not specified, nothing will be changed. The chef-client does not clear out the rights on a file or directory if rights are not specified.</li>
<li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li>
</ul>
<p>Use the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> property to deny specific rights to specific users. The ordering is independent of using the <tt class="docutils literal"><span class="pre">rights</span></tt> property. For example, it doesn&#8217;t matter if rights are granted to everyone is placed before or after <tt class="docutils literal"><span class="pre">deny_rights</span> <span class="pre">:read,</span> <span class="pre">['Julian',</span> <span class="pre">'Lewis']</span></tt>, both Julian and Lewis will be unable to read the document. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Julian&#39;</span><span class="p">,</span> <span class="s1">&#39;Lewis&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deny_rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Sally&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p><strong>Inheritance</strong></p>
<p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <tt class="docutils literal"><span class="pre">inherits</span></tt> property can be used to specifically tell the chef-client to apply (or not apply) inherited rights from its parent directory.</p>
<p>For example, the following example specifies the rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">inherits</span> <span class="kp">false</span> <span class="c1"># Sauron is the only person who should have any sort of access</span>
<span class="k">end</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> permission were to be used instead, something could slip through unless all users and groups were denied.</p>
<p>Another example also shows how to specify rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;SHIRE\Frodo&#39;</span> <span class="c1"># Who put that there I didn&#39;t put that there</span>
<span class="k">end</span>
</pre></div>
</div>
<p>but then not use the <tt class="docutils literal"><span class="pre">inherits</span></tt> property to deny those rights on a child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span> <span class="c1"># Oops, not specific enough</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Because the <tt class="docutils literal"><span class="pre">inherits</span></tt> property is not specified, the chef-client will default it to <tt class="docutils literal"><span class="pre">true</span></tt>, which will ensure that security settings for existing files remain unchanged.</p>
</div>
</div>
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<p>The following resources are built-in to the chef-client:</p>
<ul class="simple">
<li>apt_package (based on the package resource)</li>
<li>apt_repository</li>
<li>apt_update</li>
<li>bash</li>
<li>batch</li>
<li>bff_package (based on the package resource)</li>
<li>breakpoint</li>
<li>chef_gem (based on the package resource)</li>
<li>chef_handler (available from the chef_handler cookbook)</li>
<li>chocolatey_package (based on the package resource)</li>
<li>cookbook_file</li>
<li>cron</li>
<li>csh</li>
<li>deploy (including git and Subversion)</li>
<li>directory</li>
<li>dpkg_package (based on the package resource)</li>
<li>dsc_resource</li>
<li>dsc_script</li>
<li>easy_install_package (based on the package resource)</li>
<li>env</li>
<li>erl_call</li>
<li>execute</li>
<li>file</li>
<li>freebsd_package (based on the package resource)</li>
<li>gem_package (based on the package resource)</li>
<li>git</li>
<li>group</li>
<li>homebrew_package (based on the package resource)</li>
<li>http_request</li>
<li>ifconfig</li>
<li>ips_package (based on the package resource)</li>
<li>ksh</li>
<li>link</li>
<li>log</li>
<li>macports_package (based on the package resource)</li>
<li>mdadm</li>
<li>mount</li>
<li>ohai</li>
<li>openbsd_package (based on the package resource)</li>
<li>osx_profile</li>
<li>package</li>
<li>pacman_package (based on the package resource)</li>
<li>paludis_package (based on the package resource)</li>
<li>perl</li>
<li>portage_package (based on the package resource)</li>
<li>powershell_script</li>
<li>python</li>
<li>reboot</li>
<li>registry_key</li>
<li>remote_directory</li>
<li>remote_file</li>
<li>route</li>
<li>rpm_package (based on the package resource)</li>
<li>ruby</li>
<li>ruby_block</li>
<li>script</li>
<li>service</li>
<li>smartos_package (based on the package resource)</li>
<li>solaris_package (based on the package resource)</li>
<li>subversion</li>
<li>template</li>
<li>user</li>
<li>windows_package</li>
<li>windows_service</li>
<li>yum (based on the package resource)</li>
<li>yum_repository</li>
</ul>
<p>See below for more information about each of these resources, their related actions and properties, and examples of how these resources can be used in recipes.</p>
</div>
<div class="section" id="apt-package">
<h2>apt_package<a class="headerlink" href="#apt-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_apt_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>apt_package</strong> resource to manage packages for the Debian and Ubuntu platforms.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="syntax">
<h3>Syntax<a class="headerlink" href="#syntax" title="Permalink to this headline">¶</a></h3>
<p>A <strong>apt_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>apt_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>apt_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">default_release</span>            <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Apt</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">apt_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">default_release</span></tt>, <tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id7">
<h3>Actions<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:lock</span></tt></dt>
<dd><p class="first">Locks the apt package to a specific version.</p>
<p class="last">New in Chef client 12.16.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:purge</span></tt></dt>
<dd>Purge a package. This action typically removes the configuration files as well as the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:reconfig</span></tt></dt>
<dd>Reconfigure a package. This action requires a response file.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:unlock</span></tt></dt>
<dd><p class="first">Unlocks the apt package so that it can be upgraded to a newer version.</p>
<p class="last">New in Chef client 12.16.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version.</dd>
</dl>
</div>
<div class="section" id="id8">
<h3>Properties<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">default_release</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The default release. For example: <tt class="docutils literal"><span class="pre">stable</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command. For example, common apt-get directives, such as <tt class="docutils literal"><span class="pre">--no-install-recommends</span></tt>. See the <a class="reference external" href="http://manpages.debian.net/cgi-bin/man.cgi?query=apt-get">apt-get man page</a> for the full list.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The direct path to a dpkg or deb package.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
<div class="section" id="multiple-packages">
<h4>Multiple Packages<a class="headerlink" href="#multiple-packages" title="Permalink to this headline">¶</a></h4>
<p>A resource may specify multiple packages and/or versions for platforms that use Yum, Apt, Zypper, or Chocolatey package managers. Specifing multiple packages and/or versions allows a single transaction to:</p>
<ul class="simple">
<li>Download the specified packages and versions via a single HTTP transaction</li>
<li>Update or install multiple packages with a single resource during the chef-client run</li>
</ul>
<p>For example, installing multiple packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p>Upgrading multiple packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>  <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:upgrade</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Removing multiple packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>  <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:remove</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Purging multiple packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>  <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:purge</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Notifications, via an implicit name:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>  <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">log</span> <span class="s1">&#39;call a notification&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span> <span class="ss">:install</span><span class="p">,</span> <span class="s1">&#39;package[package1, package2]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <tt class="docutils literal"><span class="pre">package_name</span></tt> or <tt class="docutils literal"><span class="pre">version</span></tt> properties.</p>
</div>
</div>
</div>
<div class="section" id="providers">
<h3>Providers<a class="headerlink" href="#providers" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Apt</span></tt>, <tt class="docutils literal"><span class="pre">apt_package</span></tt></dt>
<dd>The provider for the Debian and Ubuntu platforms.</dd>
</dl>
</div>
<div class="section" id="id9">
<h3>Examples<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package using package manager</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package using local file</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_package</span> <span class="s1">&#39;jwhois&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">source</span> <span class="s1">&#39;/path/to/jwhois.deb&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install without using recommend packages as a dependency</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;apache2&#39;</span> <span class="k">do</span>
  <span class="n">options</span> <span class="s1">&#39;--no-install-recommends&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="apt-repository">
<h2>apt_repository<a class="headerlink" href="#apt-repository" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_apt_repository.rst">[edit on GitHub]</a></p>
<p>Use the <strong>apt_repository</strong> resource to additional APT repositories. Adding a new repository will notify running the <tt class="docutils literal"><span class="pre">execute[apt-get-update]</span></tt> resource immediately.</p>
<p>New in Chef Client 12.9.</p>
<div class="section" id="id10">
<h3>Syntax<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>An <strong>apt_repository</strong> resource specifies APT repository information and adds an additional APT repository to the existing list of repositories:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_repository</span> <span class="s1">&#39;zenoss&#39;</span> <span class="k">do</span>
  <span class="n">uri</span>        <span class="s1">&#39;http://dev.zenoss.org/deb&#39;</span>
  <span class="n">components</span> <span class="o">[</span><span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="s1">&#39;stable&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">apt_repository</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">uri</span></tt> is a base URI for the distribution where the apt packages are located at</li>
<li><tt class="docutils literal"><span class="pre">components</span></tt> is an array of package groupings in the repository</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>apt_repository</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_repository</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
   <span class="n">repo_name</span>             <span class="nb">String</span>
   <span class="n">uri</span>                   <span class="nb">String</span>
   <span class="n">distribution</span>          <span class="nb">String</span>
   <span class="n">components</span>            <span class="nb">Array</span>
   <span class="n">arch</span>                  <span class="nb">String</span>
   <span class="n">trusted</span>               <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">deb_src</span>               <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">keyserver</span>             <span class="nb">String</span>
   <span class="n">key</span>                   <span class="nb">String</span>
   <span class="n">key_proxy</span>             <span class="nb">String</span>
   <span class="n">cookbook</span>              <span class="nb">String</span>
   <span class="n">cache_rebuild</span>         <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">sensitive</span>             <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">apt_repository</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">repo_name</span></tt>, <tt class="docutils literal"><span class="pre">uri</span></tt>, <tt class="docutils literal"><span class="pre">distribution</span></tt>, <tt class="docutils literal"><span class="pre">components</span></tt>, <tt class="docutils literal"><span class="pre">arch</span></tt>, <tt class="docutils literal"><span class="pre">trusted</span></tt>, <tt class="docutils literal"><span class="pre">deb_src</span></tt>, <tt class="docutils literal"><span class="pre">keyserver</span></tt>, <tt class="docutils literal"><span class="pre">key</span></tt>, <tt class="docutils literal"><span class="pre">key_proxy</span></tt>, <tt class="docutils literal"><span class="pre">cookbook</span></tt>, <tt class="docutils literal"><span class="pre">cache_rebuild</span></tt>, and <tt class="docutils literal"><span class="pre">sensitive</span></tt> are properties of this resource, with the Ruby type shown. See “Properties” section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id11">
<h3>Actions<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt>:add</dt>
<dd>Default. Creates a repository file at <tt class="docutils literal"><span class="pre">/etc/apt/sources.list.d/</span></tt> and builds the repository listing.</dd>
<dt>:remove</dt>
<dd>Removes the repository listing.</dd>
</dl>
</div>
<div class="section" id="id12">
<h3>Properties<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt>repo_name</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of the channel to discover.</p>
</dd>
<dt>uri</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The base of the Debian distribution.</p>
</dd>
<dt>distribution</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Usually a codename, such as something like karmic, lucid or maverick.</p>
</dd>
<dt>components</dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p class="last">Package groupings, such as &#8216;main&#8217; and &#8216;stable&#8217;. Default value: empty array.</p>
</dd>
<dt>arch</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Constrain packages to a particular CPU architecture such as <tt class="docutils literal"><span class="pre">'i386'</span></tt> or <tt class="docutils literal"><span class="pre">'amd64'</span></tt>. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</p>
</dd>
<dt>trusted</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Determines whether you should treat all packages from this repository as authenticated regardless of signature. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt>deb_src</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Determines whether or not to add the repository as a source repo as well. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt>keyserver</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The GPG keyserver where the key for the repo should be retrieved. Default value: &#8220;keyserver.ubuntu.com&#8221;.</p>
</dd>
<dt>key</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">If a keyserver is provided, this is assumed to be the fingerprint; otherwise it can be either the URI to the GPG key for the repo, or a cookbook_file. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</p>
</dd>
<dt>key_proxy</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">If set, a specified proxy is passed to GPG via <tt class="docutils literal"><span class="pre">http-proxy=</span></tt>. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</p>
</dd>
<dt>cookbook</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">If <tt class="docutils literal"><span class="pre">key</span></tt> should be a cookbook_file, specify a cookbook where the key is located for files/default. Default value is <tt class="docutils literal"><span class="pre">nil</span></tt>, so it will use the cookbook where the resource is used.</p>
</dd>
<dt>cache_rebuild</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Determines whether to rebuild the apt package cache. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt>sensitive</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Determines whether sensitive resource data (such as key information) is not logged by the chef-client. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
</dl>
</div>
<div class="section" id="id13">
<h3>Providers<a class="headerlink" href="#id13" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following provider:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::AptRepository</span></tt>, <tt class="docutils literal"><span class="pre">apt_repository</span></tt></dt>
<dd>The default provider for all platforms.</dd>
</dl>
</div>
<div class="section" id="id14">
<h3>Examples<a class="headerlink" href="#id14" title="Permalink to this headline">¶</a></h3>
<p><strong>Add repository with basic settings</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_repository</span> <span class="s1">&#39;zenoss&#39;</span> <span class="k">do</span>
  <span class="n">uri</span>        <span class="s1">&#39;http://dev.zenoss.org/deb&#39;</span>
  <span class="n">components</span> <span class="o">[</span><span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="s1">&#39;stable&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Enable Ubuntu multiverse repositories</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_repository</span> <span class="s1">&#39;security-ubuntu-multiverse&#39;</span> <span class="k">do</span>
  <span class="n">uri</span>          <span class="s1">&#39;http://security.ubuntu.com/ubuntu&#39;</span>
  <span class="n">distribution</span> <span class="s1">&#39;trusty-security&#39;</span>
  <span class="n">components</span>   <span class="o">[</span><span class="s1">&#39;multiverse&#39;</span><span class="o">]</span>
  <span class="n">deb_src</span>      <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Add the Nginx PPA, autodetect the key and repository url</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_repository</span> <span class="s1">&#39;nginx-php&#39;</span> <span class="k">do</span>
  <span class="n">uri</span>          <span class="s1">&#39;ppa:nginx/stable&#39;</span>
  <span class="n">distribution</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;lsb&#39;</span><span class="o">][</span><span class="s1">&#39;codename&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Add the JuJu PPA, grab the key from the keyserver, and add source repo</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_repository</span> <span class="s1">&#39;juju&#39;</span> <span class="k">do</span>
  <span class="n">uri</span> <span class="s1">&#39;http://ppa.launchpad.net/juju/stable/ubuntu&#39;</span>
  <span class="n">components</span> <span class="o">[</span><span class="s1">&#39;main&#39;</span><span class="o">]</span>
  <span class="n">distribution</span> <span class="s1">&#39;trusty&#39;</span>
  <span class="n">key</span> <span class="s1">&#39;C8068B11&#39;</span>
  <span class="n">keyserver</span> <span class="s1">&#39;keyserver.ubuntu.com&#39;</span>
  <span class="n">action</span> <span class="ss">:add</span>
  <span class="n">deb_src</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Add the Cloudera Repo of CDH4 packages for Ubuntu 12.04 on AMD64</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_repository</span> <span class="s1">&#39;cloudera&#39;</span> <span class="k">do</span>
  <span class="n">uri</span>          <span class="s1">&#39;http://archive.cloudera.com/cdh4/ubuntu/precise/amd64/cdh&#39;</span>
  <span class="n">arch</span>         <span class="s1">&#39;amd64&#39;</span>
  <span class="n">distribution</span> <span class="s1">&#39;precise-cdh4&#39;</span>
  <span class="n">components</span>   <span class="o">[</span><span class="s1">&#39;contrib&#39;</span><span class="o">]</span>
  <span class="n">key</span>          <span class="s1">&#39;http://archive.cloudera.com/debian/archive.key&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Remove a repository from the list</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_repository</span> <span class="s1">&#39;zenoss&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:remove</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="apt-update">
<h2>apt_update<a class="headerlink" href="#apt-update" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_apt_update.rst">[edit on GitHub]</a></p>
<p>Use the <strong>apt_update</strong> resource to manage Apt repository updates on Debian and Ubuntu platforms.</p>
<div class="section" id="id15">
<h3>Syntax<a class="headerlink" href="#id15" title="Permalink to this headline">¶</a></h3>
<p>A <strong>apt_update</strong> resource block defines the update frequency for Apt repositories:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_update</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">frequency</span>                  <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :periodic if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">apt_update</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">frequency</span></tt> is a property of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id16">
<h3>Actions<a class="headerlink" href="#id16" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:periodic</span></tt></dt>
<dd>Update the Apt repository at the interval specified by the <tt class="docutils literal"><span class="pre">frequency</span></tt> property.</dd>
<dt><tt class="docutils literal"><span class="pre">:update</span></tt></dt>
<dd>Update the Apt repository at the start of the chef-client run.</dd>
</dl>
</div>
<div class="section" id="id17">
<h3>Properties<a class="headerlink" href="#id17" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">frequency</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The frequency at which Apt repository updates are made. Use this property when the <tt class="docutils literal"><span class="pre">:periodic</span></tt> action is specified. Default value: <tt class="docutils literal"><span class="pre">86400</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="id18">
<h3>Examples<a class="headerlink" href="#id18" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Update the Apt repository at a specified interval</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_update</span> <span class="s1">&#39;all platforms&#39;</span> <span class="k">do</span>
  <span class="n">frequency</span> <span class="mi">86400</span>
  <span class="n">action</span> <span class="ss">:periodic</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Update the Apt repository at the start of a chef-client run</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">apt_update</span> <span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform_family&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;debian&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:update</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="bash">
<h2>bash<a class="headerlink" href="#bash" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_bash.rst">[edit on GitHub]</a></p>
<p>Use the <strong>bash</strong> resource to execute scripts using the Bash interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>bash</strong> script resource (which is based on the <strong>script</strong> resource) is different from the <strong>ruby_block</strong> resource because Ruby code that is run with this resource is created as a temporary file and executed like other script resources, rather than run inline.</p>
</div>
<div class="section" id="id19">
<h3>Syntax<a class="headerlink" href="#id19" title="Permalink to this headline">¶</a></h3>
<p>A <strong>bash</strong> resource block executes scripts using Bash:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;extract_module&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    mkdir -p #{extract_path}</span>
<span class="sh">    tar xzf #{src_filename} -C #{extract_path}</span>
<span class="sh">    mv #{extract_path}/*/* #{extract_path}/</span>
<span class="no">    EOH</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">cwd</span></tt> specifies the directory from which the command is run</li>
<li><tt class="docutils literal"><span class="pre">code</span></tt> specifies the command to run</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>bash</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">code</span>                       <span class="nb">String</span>
  <span class="n">creates</span>                    <span class="nb">String</span>
  <span class="n">cwd</span>                        <span class="nb">String</span>
  <span class="n">environment</span>                <span class="no">Hash</span>
  <span class="n">flags</span>                      <span class="nb">String</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">path</span>                       <span class="nb">Array</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Script</span><span class="o">::</span><span class="no">Bash</span>
  <span class="n">returns</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Float</span>
  <span class="n">user</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">umask</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :run if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">bash</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">cwd</span></tt> is the location from which the command is run</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">code</span></tt>, <tt class="docutils literal"><span class="pre">creates</span></tt>, <tt class="docutils literal"><span class="pre">cwd</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">flags</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">returns</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt>, and <tt class="docutils literal"><span class="pre">umask</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id20">
<h3>Actions<a class="headerlink" href="#id20" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Prevent a command from running. This action is used to specify that a command is run only when another resource notifies it.</dd>
<dt><tt class="docutils literal"><span class="pre">:run</span></tt></dt>
<dd>Default. Run a script.</dd>
</dl>
</div>
<div class="section" id="id21">
<h3>Properties<a class="headerlink" href="#id21" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">code</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A quoted (&#8221; &#8221;) string of code to be executed.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">creates</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Prevent a command from creating a file when that file already exists.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">cwd</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The current working directory.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">environment</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A Hash of environment variables in the form of <tt class="docutils literal"><span class="pre">({&quot;ENV_VARIABLE&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;VALUE&quot;})</span></tt>. (These variables must exist for a command to be run successfully.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">flags</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One or more command line flags that are passed to the interpreter when a command is invoked.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The group name or group ID that must be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p>An array of paths to use when searching for a command. These paths are not added to the command&#8217;s environment $PATH. The default value uses the system path.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p>For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;mycommand&#39;</span> <span class="k">do</span>
  <span class="n">environment</span> <span class="s1">&#39;PATH&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/my/path/to/bin:</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PATH&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">returns</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Array</p>
<p class="last">The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Float</p>
<p class="last">The amount of time (in seconds) a command is to wait before timing out. Default value: <tt class="docutils literal"><span class="pre">3600</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The user name or user ID that should be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">umask</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The file mode creation mask, or umask.</p>
</dd>
</dl>
<div class="section" id="id22">
<h4>Guards<a class="headerlink" href="#id22" title="Permalink to this headline">¶</a></h4>
<p>A guard property can be used to evaluate the state of a node during the execution phase of the chef-client run. Based on the results of this evaluation, a guard property is then used to tell the chef-client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p>
<ul class="simple">
<li>A string is executed as a shell command. If the command returns <tt class="docutils literal"><span class="pre">0</span></tt>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <tt class="docutils literal"><span class="pre">true</span></tt> in addition to <tt class="docutils literal"><span class="pre">0</span></tt>.</li>
<li>A block is executed as Ruby code that must return either <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. If the block returns <tt class="docutils literal"><span class="pre">true</span></tt>, the guard property is applied. If the block returns <tt class="docutils literal"><span class="pre">false</span></tt>, the guard property is not applied.</li>
</ul>
<p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for the chef-client to do nothing.</p>
<p><strong>Attributes</strong></p>
<p>The following properties can be used to define a guard that is evaluated during the execution phase of the chef-client run:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">not_if</span></tt></dt>
<dd>Prevent a resource from executing when the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">only_if</span></tt></dt>
<dd>Allow a resource to execute only if the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
</dl>
<p><strong>Arguments</strong></p>
<p>The following arguments can be used with the <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:user</span></tt></dt>
<dd><p class="first">Specify the user that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:group</span></tt></dt>
<dd><p class="first">Specify the group that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:environment</span></tt></dt>
<dd><p class="first">Specify a Hash of environment variables to be set. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/adam&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:cwd</span></tt></dt>
<dd><p class="first">Set the current working directory before running a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam passwd&#39;</span><span class="p">,</span> <span class="ss">:cwd</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:timeout</span></tt></dt>
<dd><p class="first">Set a timeout for a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;sleep 10000&#39;</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="id23">
<h3>Providers<a class="headerlink" href="#id23" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script</span></tt>, <tt class="docutils literal"><span class="pre">script</span></tt></dt>
<dd>When this short name is used, the chef-client will determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script::Bash</span></tt>, <tt class="docutils literal"><span class="pre">bash</span></tt></dt>
<dd>The provider for the Bash command interpreter.</dd>
</dl>
</div>
<div class="section" id="id24">
<h3>Examples<a class="headerlink" href="#id24" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Use a named provider to run a script</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;install_something&#39;</span> <span class="k">do</span>
  <span class="n">user</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">cwd</span> <span class="s1">&#39;/tmp&#39;</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  wget http://www.example.com/tarball.tar.gz</span>
<span class="sh">  tar -zxf tarball.tar.gz</span>
<span class="sh">  cd tarball</span>
<span class="sh">  ./configure</span>
<span class="sh">  make</span>
<span class="sh">  make install</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a file from a remote location using bash</strong></p>
<p>The following is an example of how to install the <tt class="docutils literal"><span class="pre">foo123</span></tt> module for Nginx. This module adds shell-style functionality to an Nginx configuration file and does the following:</p>
<ul class="simple">
<li>Declares three variables</li>
<li>Gets the Nginx file from a remote location</li>
<li>Installs the file using Bash to the path specified by the <tt class="docutils literal"><span class="pre">src_filepath</span></tt> variable</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample is similar to the ``upload_progress_module``</span>
<span class="c1"># recipe in the ``nginx`` cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/nginx</span>

<span class="n">src_filename</span> <span class="o">=</span> <span class="s2">&quot;foo123-nginx-module-v</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">.tar.gz&quot;</span>
<span class="n">src_filepath</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">src_filename</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">extract_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span>
  <span class="si">}</span><span class="s2">/nginx_foo123_module/</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s1">&#39;src_filepath&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;extract_module&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    mkdir -p #{extract_path}</span>
<span class="sh">    tar xzf #{src_filename} -C #{extract_path}</span>
<span class="sh">    mv #{extract_path}/*/* #{extract_path}/</span>
<span class="no">    EOH</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install an application from git using bash</strong></p>
<p>The following example shows how Bash can be used to install a plug-in for rbenv named <tt class="docutils literal"><span class="pre">ruby-build</span></tt>, which is located in git version source control. First, the application is synchronized, and then Bash changes its working directory to the location in which <tt class="docutils literal"><span class="pre">ruby-build</span></tt> is located, and then runs a command.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span> <span class="n">git</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/ruby-build&quot;</span> <span class="k">do</span>
   <span class="n">repository</span> <span class="s1">&#39;git://github.com/sstephenson/ruby-build.git&#39;</span>
   <span class="n">reference</span> <span class="s1">&#39;master&#39;</span>
   <span class="n">action</span> <span class="ss">:sync</span>
 <span class="k">end</span>

 <span class="n">bash</span> <span class="s1">&#39;install_ruby_build&#39;</span> <span class="k">do</span>
   <span class="n">cwd</span> <span class="s1">&#39;#{Chef::Config[:file_cache_path]}/ruby-build&#39;</span>
   <span class="n">user</span> <span class="s1">&#39;rbenv&#39;</span>
   <span class="n">group</span> <span class="s1">&#39;rbenv&#39;</span>
   <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">     ./install.sh</span>
<span class="no">     EOH</span>
   <span class="n">environment</span> <span class="s1">&#39;PREFIX&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/local&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>To read more about <tt class="docutils literal"><span class="pre">ruby-build</span></tt>, see here: <a class="reference external" href="https://github.com/sstephenson/ruby-build">https://github.com/sstephenson/ruby-build</a>.</p>
<p><strong>Store certain settings</strong></p>
<p>The following recipe shows how an attributes file can be used to store certain settings. An attributes file is located in the <tt class="docutils literal"><span class="pre">attributes/</span></tt> directory in the same cookbook as the recipe which calls the attributes file. In this example, the attributes file specifies certain settings for Python that are then used across all nodes against which this recipe will run.</p>
<p>Python packages have versions, installation directories, URLs, and checksum files. An attributes file that exists to support this type of recipe would include settings like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;2.7.1&#39;</span>

<span class="k">if</span> <span class="n">python</span><span class="o">[</span><span class="s1">&#39;install_method&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;package&#39;</span>
  <span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/usr&#39;</span>
<span class="k">else</span>
  <span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/usr/local&#39;</span>
<span class="k">end</span>

<span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;http://www.python.org/ftp/python&#39;</span>
<span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;80e387...85fd61&#39;</span>
</pre></div>
</div>
<p>and then the methods in the recipe may refer to these values. A recipe that is used to install Python will need to do the following:</p>
<ul class="simple">
<li>Identify each package to be installed (implied in this example, not shown)</li>
<li>Define variables for the package <tt class="docutils literal"><span class="pre">version</span></tt> and the <tt class="docutils literal"><span class="pre">install_path</span></tt></li>
<li>Get the package from a remote location, but only if the package does not already exist on the target system</li>
<li>Use the <strong>bash</strong> resource to install the package on the node, but only when the package is not already installed</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#  the following code sample comes from the ``oc-nginx`` cookbook on |github|: https://github.com/cookbooks/oc-nginx</span>

<span class="n">version</span> <span class="o">=</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="n">install_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/lib/python</span><span class="si">#{</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/(^\d+\.\d+)/</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/Python-</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">.tar.bz2&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">/Python-</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">.tar.bz2&quot;</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">install_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;build-and-install-python&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span>
<span class="sh">    tar -jxvf Python-#{version}.tar.bz2</span>
<span class="sh">    (cd Python-#{version} &amp;&amp; ./configure #{configure_options})</span>
<span class="sh">    (cd Python-#{version} &amp;&amp; make &amp;&amp; make install)</span>
<span class="no">  EOF</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">install_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="batch">
<h2>batch<a class="headerlink" href="#batch" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_batch.rst">[edit on GitHub]</a></p>
<p>Use the <strong>batch</strong> resource to execute a batch script using the cmd.exe interpreter. The <strong>batch</strong> resource creates and executes a temporary file (similar to how the <strong>script</strong> resource behaves), rather than running the command inline. This resource inherits actions (<tt class="docutils literal"><span class="pre">:run</span></tt> and <tt class="docutils literal"><span class="pre">:nothing</span></tt>) and properties (<tt class="docutils literal"><span class="pre">creates</span></tt>, <tt class="docutils literal"><span class="pre">cwd</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">user</span></tt>) from the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="section" id="id25">
<h3>Syntax<a class="headerlink" href="#id25" title="Permalink to this headline">¶</a></h3>
<p>A <strong>batch</strong> resource block executes a batch script using the cmd.exe interpreter:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="s1">&#39;echo some env vars&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    echo %TEMP%</span>
<span class="sh">    echo %SYSTEMDRIVE%</span>
<span class="sh">    echo %PATH%</span>
<span class="sh">    echo %WINDIR%</span>
<span class="no">    EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>batch</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">architecture</span>               <span class="no">Symbol</span>
  <span class="n">code</span>                       <span class="nb">String</span>
  <span class="n">command</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">creates</span>                    <span class="nb">String</span>
  <span class="n">cwd</span>                        <span class="nb">String</span>
  <span class="n">flags</span>                      <span class="nb">String</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">guard_interpreter</span>          <span class="no">Symbol</span>
  <span class="n">interpreter</span>                <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Batch</span>
  <span class="n">returns</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Float</span>
  <span class="n">user</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :run if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">batch</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">command</span></tt> is the command to be run and <tt class="docutils literal"><span class="pre">cwd</span></tt> is the location from which the command is run</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">architecture</span></tt>, <tt class="docutils literal"><span class="pre">code</span></tt>, <tt class="docutils literal"><span class="pre">command</span></tt>, <tt class="docutils literal"><span class="pre">creates</span></tt>, <tt class="docutils literal"><span class="pre">cwd</span></tt>, <tt class="docutils literal"><span class="pre">flags</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt>, <tt class="docutils literal"><span class="pre">interpreter</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">returns</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">user</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id26">
<h3>Actions<a class="headerlink" href="#id26" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:run</span></tt></dt>
<dd>Run a batch file.</dd>
</dl>
</div>
<div class="section" id="id27">
<h3>Properties<a class="headerlink" href="#id27" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">architecture</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol</p>
<p class="last">The architecture of the process under which a script is executed. If a value is not provided, the chef-client defaults to the correct value for the architecture, as determined by Ohai. An exception is raised when anything other than <tt class="docutils literal"><span class="pre">:i386</span></tt> is specified for a 32-bit process. Possible values: <tt class="docutils literal"><span class="pre">:i386</span></tt> (for 32-bit processes) and <tt class="docutils literal"><span class="pre">:x86_64</span></tt> (for 64-bit processes).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">code</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A quoted (&#8221; &#8221;) string of code to be executed.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">command</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the command to be executed.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">creates</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Prevent a command from creating a file when that file already exists.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">cwd</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The current working directory from which a command is run.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">flags</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One or more command line flags that are passed to the interpreter when a command is invoked.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The group name or group ID that must be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">guard_interpreter</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol</p>
<p class="last">Default value: <tt class="docutils literal"><span class="pre">:batch</span></tt>. When this property is set to <tt class="docutils literal"><span class="pre">:batch</span></tt>, the 64-bit version of the cmd.exe shell will be used to evaluate strings values for the <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> properties. Set this value to <tt class="docutils literal"><span class="pre">:default</span></tt> to use the 32-bit version of the cmd.exe shell.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">interpreter</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The script interpreter to use during code execution. Changing the default value of this property is not supported.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">returns</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Array</p>
<p class="last">The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Float</p>
<p class="last">The amount of time (in seconds) a command is to wait before timing out. Default value: <tt class="docutils literal"><span class="pre">3600</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">A user name or identifier that must be changed before running a command.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">See <a class="reference external" href="http://technet.microsoft.com/en-us/library/bb490880.aspx">http://technet.microsoft.com/en-us/library/bb490880.aspx</a> for more information about the cmd.exe interpreter.</p>
</div>
<div class="section" id="id28">
<h4>Guards<a class="headerlink" href="#id28" title="Permalink to this headline">¶</a></h4>
<p>A guard property can be used to evaluate the state of a node during the execution phase of the chef-client run. Based on the results of this evaluation, a guard property is then used to tell the chef-client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p>
<ul class="simple">
<li>A string is executed as a shell command. If the command returns <tt class="docutils literal"><span class="pre">0</span></tt>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <tt class="docutils literal"><span class="pre">true</span></tt> in addition to <tt class="docutils literal"><span class="pre">0</span></tt>.</li>
<li>A block is executed as Ruby code that must return either <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. If the block returns <tt class="docutils literal"><span class="pre">true</span></tt>, the guard property is applied. If the block returns <tt class="docutils literal"><span class="pre">false</span></tt>, the guard property is not applied.</li>
</ul>
<p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for the chef-client to do nothing.</p>
<p><strong>Attributes</strong></p>
<p>The following properties can be used to define a guard that is evaluated during the execution phase of the chef-client run:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">not_if</span></tt></dt>
<dd>Prevent a resource from executing when the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">only_if</span></tt></dt>
<dd>Allow a resource to execute only if the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
</dl>
<p><strong>Arguments</strong></p>
<p>The following arguments can be used with the <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:user</span></tt></dt>
<dd><p class="first">Specify the user that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:group</span></tt></dt>
<dd><p class="first">Specify the group that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:environment</span></tt></dt>
<dd><p class="first">Specify a Hash of environment variables to be set. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/adam&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:cwd</span></tt></dt>
<dd><p class="first">Set the current working directory before running a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam passwd&#39;</span><span class="p">,</span> <span class="ss">:cwd</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:timeout</span></tt></dt>
<dd><p class="first">Set a timeout for a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;sleep 10000&#39;</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="id29">
<h3>Examples<a class="headerlink" href="#id29" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Unzip a file, and then move it</strong></p>
<p>To run a batch file that unzips and then moves Ruby, do something like:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="s1">&#39;unzip_and_move_ruby&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    7z.exe x #{Chef::Config[:file_cache_path]}/ruby-1.8.7-p352-i386-mingw32.7z</span>
<span class="sh">      -oC:\\source -r -y</span>
<span class="sh">    xcopy C:\\source\\ruby-1.8.7-p352-i386-mingw32 C:\\ruby /e /y</span>
<span class="no">    EOH</span>
<span class="k">end</span>

<span class="n">batch</span> <span class="s1">&#39;echo some env vars&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    echo %TEMP%</span>
<span class="sh">    echo %SYSTEMDRIVE%</span>
<span class="sh">    echo %PATH%</span>
<span class="sh">    echo %WINDIR%</span>
<span class="no">    EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">batch</span> <span class="s1">&#39;unzip_and_move_ruby&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    7z.exe x #{Chef::Config[:file_cache_path]}/ruby-1.8.7-p352-i386-mingw32.7z</span>
<span class="sh">      -oC:\\source -r -y</span>
<span class="sh">    xcopy C:\\source\\ruby-1.8.7-p352-i386-mingw32 C:\\ruby /e /y</span>
<span class="no">    EOH</span>
<span class="k">end</span>

<span class="n">batch</span> <span class="s1">&#39;echo some env vars&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="s1">&#39;echo %TEMP%\\necho %SYSTEMDRIVE%\\necho %PATH%\\necho %WINDIR%&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="bff-package">
<h2>bff_package<a class="headerlink" href="#bff-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_bff_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>bff_package</strong> resource to manage packages for the AIX platform using the installp utility. When a package is installed from a local file, it must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A Backup File Format (BFF) package may not have a <tt class="docutils literal"><span class="pre">.bff</span></tt> file extension. The chef-client will still identify the correct provider to use based on the platform, regardless of the file extension.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id30">
<h3>Syntax<a class="headerlink" href="#id30" title="Permalink to this headline">¶</a></h3>
<p>A <strong>bff_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>bff_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bff_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>bff_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bff_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Aix</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">bff_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id31">
<h3>Actions<a class="headerlink" href="#id31" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:purge</span></tt></dt>
<dd>Purge a package. This action typically removes the configuration files as well as the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
</dl>
</div>
<div class="section" id="id32">
<h3>Properties<a class="headerlink" href="#id32" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Required. The path to a package in the local file system. The AIX platform requires <tt class="docutils literal"><span class="pre">source</span></tt> to be a local file system path because <tt class="docutils literal"><span class="pre">installp</span></tt> does not retrieve packages using HTTP or FTP.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id33">
<h3>Providers<a class="headerlink" href="#id33" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Aix</span></tt>, <tt class="docutils literal"><span class="pre">bff_package</span></tt></dt>
<dd>The provider for the AIX platform. Can be used with the <tt class="docutils literal"><span class="pre">options</span></tt> attribute.</dd>
</dl>
</div>
<div class="section" id="id34">
<h3>Examples<a class="headerlink" href="#id34" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<p>The <strong>bff_package</strong> resource is the default package provider on the AIX platform. The base <strong>package</strong> resource may be used, and then when the platform is AIX, the chef-client will identify the correct package provider. The following examples show how to install part of the IBM XL C/C++ compiler.</p>
<p>Using the base <strong>package</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;xlccmp.13.1.0&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;/var/tmp/IBM_XL_C_13.1.0/usr/sys/inst.images/xlccmp.13.1.0&#39;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Using the <strong>bff_package</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bff_package</span> <span class="s1">&#39;xlccmp.13.1.0&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;/var/tmp/IBM_XL_C_13.1.0/usr/sys/inst.images/xlccmp.13.1.0&#39;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="breakpoint">
<h2>breakpoint<a class="headerlink" href="#breakpoint" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_breakpoint.rst">[edit on GitHub]</a></p>
<p>Use the <strong>breakpoint</strong> resource to add breakpoints to recipes. Run the chef-shell in chef-client mode, and then use those breakpoints to debug recipes. Breakpoints are ignored by the chef-client during an actual chef-client run. That said, breakpoints are typically used to debug recipes only when running them in a non-production environment, after which they are removed from those recipes before the parent cookbook is uploaded to the Chef server.</p>
<div class="section" id="id35">
<h3>Syntax<a class="headerlink" href="#id35" title="Permalink to this headline">¶</a></h3>
<p>A <strong>breakpoint</strong> resource block creates a breakpoint in a recipe:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">breakpoint</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">:break</span></tt> will tell the chef-client to stop running a recipe; can only be used when the chef-client is being run in chef-shell mode</li>
</ul>
</div>
<div class="section" id="id36">
<h3>Actions<a class="headerlink" href="#id36" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:break</span></tt></dt>
<dd>Use to add a breakpoint to a recipe.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
</dl>
</div>
<div class="section" id="id37">
<h3>Properties<a class="headerlink" href="#id37" title="Permalink to this headline">¶</a></h3>
<p>This resource does not have any properties.</p>
</div>
<div class="section" id="debug-recipes-with-chef-shell">
<h3>Debug Recipes with chef-shell<a class="headerlink" href="#debug-recipes-with-chef-shell" title="Permalink to this headline">¶</a></h3>
<p>chef-shell is a recipe debugging tool that allows the use of breakpoints within recipes. chef-shell runs as an Interactive Ruby (IRb) session. chef-shell supports both recipe and attribute file syntax, as well as interactive debugging features.</p>
<div class="section" id="modes">
<h4>Modes<a class="headerlink" href="#modes" title="Permalink to this headline">¶</a></h4>
<p>chef-shell is tool that is run using an Interactive Ruby (IRb) session. chef-shell currently supports recipe and attribute file syntax, as well as interactive debugging features. chef-shell has three run modes:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Mode</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Standalone</td>
<td>Default. No cookbooks are loaded, and the run-list is empty.</td>
</tr>
<tr class="row-odd"><td>Solo</td>
<td>chef-shell acts as a chef-solo client. It attempts to load the chef-solo configuration file and JSON attributes. If the JSON attributes set a run-list, it will be honored. Cookbooks will be loaded in the same way that chef-solo loads them. chef-solo mode is activated with the <tt class="docutils literal"><span class="pre">-s</span></tt> or <tt class="docutils literal"><span class="pre">--solo</span></tt> command line option, and JSON attributes are specified in the same way as for chef-solo, with <tt class="docutils literal"><span class="pre">-j</span> <span class="pre">/path/to/chef-solo.json</span></tt>.</td>
</tr>
<tr class="row-even"><td>Client</td>
<td>chef-shell acts as a chef-client. During startup, it reads the chef-client configuration file and contacts the Chef server to get attributes and cookbooks. The run-list will be set in the same way as normal chef-client runs. chef-client mode is activated with the <tt class="docutils literal"><span class="pre">-z</span></tt> or <tt class="docutils literal"><span class="pre">--client</span></tt> options. You can also specify the configuration file with <tt class="docutils literal"><span class="pre">-c</span> <span class="pre">CONFIG</span></tt> and the server URL with <tt class="docutils literal"><span class="pre">-S</span> <span class="pre">SERVER_URL</span></tt>.</td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="configure">
<h4>Configure<a class="headerlink" href="#configure" title="Permalink to this headline">¶</a></h4>
<p>chef-shell determines which configuration file to load based on the following:</p>
<ol class="arabic simple">
<li>If a configuration file is specified using the <tt class="docutils literal"><span class="pre">-c</span></tt> option, chef-shell will use the specified configuration file</li>
<li>When chef-shell is started using a named configuration as an argument, chef-shell will search for a chef-shell.rb file in that directory under <tt class="docutils literal"><span class="pre">~/.chef</span></tt>. For example, if chef-shell is started using <tt class="docutils literal"><span class="pre">production</span></tt> as the named configuration, the chef-shell will load a configuration file from <tt class="docutils literal"><span class="pre">~/.chef/production/chef_shell.rb</span></tt></li>
<li>If a named configuration is not provided, chef-shell will attempt to load the chef-shell.rb file from the <tt class="docutils literal"><span class="pre">.chef</span></tt> directory. For example: <tt class="docutils literal"><span class="pre">~/.chef/chef_shell.rb</span></tt></li>
<li>If a chef-shell.rb file is not found, chef-shell will attempt to load the client.rb file</li>
<li>If a chef-shell.rb file is not found, chef-shell will attempt to load the solo.rb file</li>
</ol>
<div class="section" id="chef-shell-rb">
<h5>chef-shell.rb<a class="headerlink" href="#chef-shell-rb" title="Permalink to this headline">¶</a></h5>
<p>The chef-shell.rb file can be used to configure chef-shell in the same way as the client.rb file is used to configure the chef-client. For example, to configure chef-shell to authenticate to the Chef server, copy the <tt class="docutils literal"><span class="pre">node_name</span></tt>, <tt class="docutils literal"><span class="pre">client_key</span></tt>, and <tt class="docutils literal"><span class="pre">chef_server_url</span></tt> settings from the knife.rb file:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">node_name</span>                <span class="s1">&#39;your-knife-clientname&#39;</span>
<span class="n">client_key</span>               <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;~/.chef/my-client.pem&#39;</span><span class="p">)</span>
<span class="n">chef_server_url</span>          <span class="s1">&#39;https://api.opscode.com/organizations/myorg&#39;</span>
</pre></div>
</div>
<p>and then add them to the chef-shell.rb file. Other configuration possibilities include disabling Ohai plugins (which will speed up the chef-shell boot process) or including arbitrary Ruby code in the chef-shell.rb file.</p>
</div>
<div class="section" id="run-as-a-chef-client">
<h5>Run as a chef-client<a class="headerlink" href="#run-as-a-chef-client" title="Permalink to this headline">¶</a></h5>
<p>By default, chef-shell loads in standalone mode and does not connect to the Chef server. The chef-shell can be run as a chef-client to verify functionality that is only available when the chef-client connects to the Chef server, such as search functionality or accessing data stored in data bags.</p>
<p>chef-shell can use the same credentials as knife when connecting to a Chef server. Make sure that the settings in chef-shell.rb are the same as those in knife.rb, and then use the <tt class="docutils literal"><span class="pre">-z</span></tt> option as part of the command. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef-shell -z
</pre></div>
</div>
</div>
</div>
<div class="section" id="manage">
<h4>Manage<a class="headerlink" href="#manage" title="Permalink to this headline">¶</a></h4>
<p>When chef-shell is configured to access a Chef server, chef-shell can list, show, search for and edit cookbooks, clients, nodes, roles, environments, and data bags.</p>
<p>The syntax for managing objects on the Chef server is as follows:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef <span class="o">(</span>named_configuration<span class="o">)</span> &gt; items.command
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">named_configuration</span></tt> is a named configuration, such as <tt class="docutils literal"><span class="pre">production</span></tt>, <tt class="docutils literal"><span class="pre">staging</span></tt>, or <tt class="docutils literal"><span class="pre">test</span></tt></li>
<li><tt class="docutils literal"><span class="pre">items</span></tt> is the type of item to search for: <tt class="docutils literal"><span class="pre">cookbooks</span></tt>, <tt class="docutils literal"><span class="pre">clients</span></tt>, <tt class="docutils literal"><span class="pre">nodes</span></tt>, <tt class="docutils literal"><span class="pre">roles</span></tt>, <tt class="docutils literal"><span class="pre">environments</span></tt> or a data bag</li>
<li><tt class="docutils literal"><span class="pre">command</span></tt> is the command: <tt class="docutils literal"><span class="pre">list</span></tt>, <tt class="docutils literal"><span class="pre">show</span></tt>, <tt class="docutils literal"><span class="pre">find</span></tt>, or <tt class="docutils literal"><span class="pre">edit</span></tt></li>
</ul>
<p>For example, to list all of the nodes in a configuration named &#8220;preprod&#8221;:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef <span class="o">(</span>preprod<span class="o">)</span> &gt; nodes.list
</pre></div>
</div>
<p>to return something similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="o">=</span>&gt; <span class="o">[</span>node<span class="o">[</span>i-f09a939b<span class="o">]</span>, node<span class="o">[</span>i-049a936f<span class="o">]</span>, node<span class="o">[</span>i-eaaaa581<span class="o">]</span>, node<span class="o">[</span>i-9154b1fb<span class="o">]</span>,
     node<span class="o">[</span>i-6a213101<span class="o">]</span>, node<span class="o">[</span>i-c2687aa9<span class="o">]</span>, node<span class="o">[</span>i-7abeaa11<span class="o">]</span>, node<span class="o">[</span>i-4eb8ac25<span class="o">]</span>,
     node<span class="o">[</span>i-9a2030f1<span class="o">]</span>, node<span class="o">[</span>i-a06875cb<span class="o">]</span>, node<span class="o">[</span>i-145f457f<span class="o">]</span>, node<span class="o">[</span>i-e032398b<span class="o">]</span>,
     node<span class="o">[</span>i-dc8c98b7<span class="o">]</span>, node<span class="o">[</span>i-6afdf401<span class="o">]</span>, node<span class="o">[</span>i-f49b119c<span class="o">]</span>, node<span class="o">[</span>i-5abfab31<span class="o">]</span>,
     node<span class="o">[</span>i-78b8ac13<span class="o">]</span>, node<span class="o">[</span>i-d99678b3<span class="o">]</span>, node<span class="o">[</span>i-02322269<span class="o">]</span>, node<span class="o">[</span>i-feb4a695<span class="o">]</span>,
     node<span class="o">[</span>i-9e2232f5<span class="o">]</span>, node<span class="o">[</span>i-6e213105<span class="o">]</span>, node<span class="o">[</span>i-cdde3ba7<span class="o">]</span>, node<span class="o">[</span>i-e8bfb083<span class="o">]</span>,
     node<span class="o">[</span>i-743c2c1f<span class="o">]</span>, node<span class="o">[</span>i-2eaca345<span class="o">]</span>, node<span class="o">[</span>i-aa7f74c1<span class="o">]</span>, node<span class="o">[</span>i-72fdf419<span class="o">]</span>,
     node<span class="o">[</span>i-140e1e7f<span class="o">]</span>, node<span class="o">[</span>i-f9d43193<span class="o">]</span>, node<span class="o">[</span>i-bd2dc8d7<span class="o">]</span>, node<span class="o">[</span>i-8e7f70e5<span class="o">]</span>,
     node<span class="o">[</span>i-78f2e213<span class="o">]</span>, node<span class="o">[</span>i-962232fd<span class="o">]</span>, node<span class="o">[</span>i-4c322227<span class="o">]</span>, node<span class="o">[</span>i-922232f9<span class="o">]</span>,
     node<span class="o">[</span>i-c02728ab<span class="o">]</span>, node<span class="o">[</span>i-f06c7b9b<span class="o">]]</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">list</span></tt> command can take a code block, which will applied (but not saved) to each object that is returned from the server. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef <span class="o">(</span>preprod<span class="o">)</span> &gt; nodes.list <span class="o">{</span><span class="p">|</span>n<span class="p">|</span> puts <span class="s2">&quot;#{n.name}: #{n.run_list}&quot;</span> <span class="o">}</span>
</pre></div>
</div>
<p>to return something similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="o">=</span>&gt; i-f09a939b: role<span class="o">[</span>lb<span class="o">]</span>, role<span class="o">[</span>preprod<span class="o">]</span>, recipe<span class="o">[</span>aws<span class="o">]</span>
     i-049a936f: role<span class="o">[</span>lb<span class="o">]</span>, role<span class="o">[</span>preprod<span class="o">]</span>, recipe<span class="o">[</span>aws<span class="o">]</span>
     i-9154b1fb: recipe<span class="o">[</span>erlang<span class="o">]</span>, role<span class="o">[</span>base<span class="o">]</span>, role<span class="o">[</span>couchdb<span class="o">]</span>, role<span class="o">[</span>preprod<span class="o">]</span>,
     i-6a213101: role<span class="o">[</span>chef<span class="o">]</span>, role<span class="o">[</span>preprod<span class="o">]</span>
     <span class="c1"># more...</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">show</span></tt> command can be used to display a specific node. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef <span class="o">(</span>preprod<span class="o">)</span> &gt; <span class="nv">load_balancer</span> <span class="o">=</span> nodes.show<span class="o">(</span><span class="s1">&#39;i-f09a939b&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p>to return something similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="o">=</span>&gt; node<span class="o">[</span>i-f09a939b<span class="o">]</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef <span class="o">(</span>preprod<span class="o">)</span> &gt; load_balancer.ec2.public_hostname
</pre></div>
</div>
<p>to return something similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="o">=</span>&gt; <span class="s2">&quot;ec2-111-22-333-44.compute-1.amazonaws.com&quot;</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">find</span></tt> command can be used to search the Chef server from the chef-shell. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef <span class="o">(</span>preprod<span class="o">)</span> &gt; pp nodes.find<span class="o">(</span>:ec2_public_hostname <span class="o">=</span>&gt; <span class="s1">&#39;ec2*&#39;</span><span class="o">)</span>
</pre></div>
</div>
<p>A code block can be used to format the results. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef <span class="o">(</span>preprod<span class="o">)</span> &gt; pp nodes.find<span class="o">(</span>:ec2_public_hostname <span class="o">=</span>&gt; <span class="s1">&#39;ec2*&#39;</span><span class="o">)</span> <span class="o">{</span><span class="p">|</span>n<span class="p">|</span> n.ec2.ami_id <span class="o">}</span> and nil
</pre></div>
</div>
<p>to return something similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="o">=</span>&gt; <span class="o">[</span><span class="s2">&quot;ami-f8927a91&quot;</span>,
      <span class="s2">&quot;ami-f8927a91&quot;</span>,
      <span class="s2">&quot;ami-a89870c1&quot;</span>,
      <span class="s2">&quot;ami-a89870c1&quot;</span>,
      <span class="s2">&quot;ami-a89870c1&quot;</span>,
      <span class="s2">&quot;ami-a89870c1&quot;</span>,
      <span class="s2">&quot;ami-a89870c1&quot;</span>
      <span class="c1"># and more...</span>
</pre></div>
</div>
<p>Or:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>chef <span class="o">(</span>preprod<span class="o">)</span> &gt; <span class="nv">amis</span> <span class="o">=</span> nodes.find<span class="o">(</span>:ec2_public_hostname <span class="o">=</span>&gt; <span class="s1">&#39;ec2*&#39;</span><span class="o">)</span> <span class="o">{</span><span class="p">|</span>n<span class="p">|</span> n.ec2.ami_id <span class="o">}</span>
chef <span class="o">(</span>preprod<span class="o">)</span> &gt; puts amis.uniq.sort
</pre></div>
</div>
<p>to return something similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ <span class="o">=</span>&gt; ami-4b4ba522
     ami-a89870c1
     ami-eef61587
     ami-f8927a91
</pre></div>
</div>
</div>
<div class="section" id="use-breakpoints">
<h4>Use Breakpoints<a class="headerlink" href="#use-breakpoints" title="Permalink to this headline">¶</a></h4>
<p>chef-shell allows the current position in a run-list to be manipulated during a chef-client run. Add breakpoints to a recipe to take advantage of this functionality.</p>
<div class="section" id="step-through-run-list">
<h5>Step Through Run-list<a class="headerlink" href="#step-through-run-list" title="Permalink to this headline">¶</a></h5>
<p>To explore how using the <strong>breakpoint</strong> to manually step through a chef-client run, create a simple recipe in chef-shell:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef &gt; recipe_mode
  chef:recipe &gt; <span class="nb">echo</span> off
  chef:recipe &gt; file <span class="s2">&quot;/tmp/before-breakpoint&quot;</span>
  chef:recipe &gt; breakpoint <span class="s2">&quot;foo&quot;</span>
  chef:recipe &gt; file <span class="s2">&quot;/tmp/after-breakpoint&quot;</span>
</pre></div>
</div>
<p>and then run the chef-client:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef:recipe &gt; run_chef
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:17:49 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span>
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:17:49 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span> using Chef::Provider::File
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:17:49 -0800<span class="o">]</span> INFO: Creating file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span> at /tmp/before-breakpoint
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:17:49 -0800<span class="o">]</span> DEBUG: Processing <span class="o">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="s1">&#39;new&#39;</span><span class="o">]</span>
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:17:49 -0800<span class="o">]</span> DEBUG: <span class="o">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="s1">&#39;new&#39;</span><span class="o">]</span> using Chef::Provider::Breakpoint
</pre></div>
</div>
<p>The chef-client ran the first resource before the breakpoint (<tt class="docutils literal"><span class="pre">file[/tmp/before-breakpoint]</span></tt>), but then stopped after execution. The chef-client attempted to name the breakpoint after its position in the source file, but the chef-client was confused because the resource was entered interactively. From here, chef-shell can resume the chef-client run:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef:recipe &gt; chef_run.resume
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:27:08 -0800<span class="o">]</span> INFO: Creating file<span class="o">[</span>/tmp/after-breakpoint<span class="o">]</span> at /tmp/after-breakpoint
</pre></div>
</div>
<p>A quick view of the <tt class="docutils literal"><span class="pre">/tmp</span></tt> directory shows that the following files were created:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>after-breakpoint
before-breakpoint
</pre></div>
</div>
<p>The chef-client run can also be rewound, and then stepped through.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef:recipe &gt; Chef::Log.level <span class="o">=</span> :debug <span class="c1"># debug logging won&#39;t turn on automatically in this case</span>
    <span class="o">=</span>&gt; :debug
  chef:recipe &gt; chef_run.rewind
    <span class="o">=</span>&gt; 0
  chef:recipe &gt; chef_run.step
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:40:52 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span>
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:40:52 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span> using Chef::Provider::File
    <span class="o">=</span>&gt; 1
  chef:recipe &gt; chef_run.step
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:40:54 -0800<span class="o">]</span> DEBUG: Processing <span class="o">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="s1">&#39;new&#39;</span><span class="o">]</span>
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:40:54 -0800<span class="o">]</span> DEBUG: <span class="o">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="s1">&#39;new&#39;</span><span class="o">]</span> using Chef::Provider::Breakpoint
    <span class="o">=</span>&gt; 2
  chef:recipe &gt; chef_run.step
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:40:56 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/after-breakpoint<span class="o">]</span>
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:40:56 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/after-breakpoint<span class="o">]</span> using Chef::Provider::File
    <span class="o">=</span>&gt; 3
</pre></div>
</div>
<p>From the output, the rewound run-list is shown, but when the resources are executed again, they will repeat their checks for the existence of files. If they exist, the chef-client will skip creating them. If the files are deleted, then:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef:recipe &gt; ls<span class="o">(</span><span class="s2">&quot;/tmp&quot;</span><span class="o">)</span>.grep<span class="o">(</span>/breakpoint/<span class="o">)</span>.each <span class="o">{</span><span class="p">|</span>f<span class="p">|</span> rm <span class="s2">&quot;/tmp/#{f}&quot;</span> <span class="o">}</span>
    <span class="o">=</span>&gt; <span class="o">[</span><span class="s2">&quot;after-breakpoint&quot;</span>, <span class="s2">&quot;before-breakpoint&quot;</span><span class="o">]</span>
</pre></div>
</div>
<p>Rewind, and then resume the chef-client run to get the expected results:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef:recipe &gt; chef_run.rewind
  chef:recipe &gt; chef_run.resume
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:48:56 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span>
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:48:56 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span> using Chef::Provider::File
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:48:56 -0800<span class="o">]</span> INFO: Creating file<span class="o">[</span>/tmp/before-breakpoint<span class="o">]</span> at /tmp/before-breakpoint
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:48:56 -0800<span class="o">]</span> DEBUG: Processing <span class="o">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="s1">&#39;new&#39;</span><span class="o">]</span>
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:48:56 -0800<span class="o">]</span> DEBUG: <span class="o">[</span>./bin/../lib/chef/mixin/recipe_definition_dsl_core.rb:56:in <span class="s1">&#39;new&#39;</span><span class="o">]</span> using Chef::Provider::Breakpoint
  chef:recipe &gt; chef_run.resume
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:49:20 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/after-breakpoint<span class="o">]</span>
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:49:20 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/after-breakpoint<span class="o">]</span> using Chef::Provider::File
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 14:49:20 -0800<span class="o">]</span> INFO: Creating file<span class="o">[</span>/tmp/after-breakpoint<span class="o">]</span> at /tmp/after-breakpoint
</pre></div>
</div>
</div>
<div class="section" id="debug-existing-recipe">
<h5>Debug Existing Recipe<a class="headerlink" href="#debug-existing-recipe" title="Permalink to this headline">¶</a></h5>
<p>chef-shell can be used to debug existing recipes. The recipe first needs to be added to a run-list for the node, so that it is cached when starting chef-shell and then used for debugging. chef-shell will report which recipes are being cached when it is started:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>loading configuration: none <span class="o">(</span>standalone session<span class="o">)</span>
Session type: standalone
Loading..............done.

This is the chef-shell.
 Chef Version: 12.17.44
 https://www.chef.io/
 https://docs.chef.io/

run <span class="sb">`</span>help<span class="s1">&#39; for help, `exit&#39;</span> or ^D to quit.

Ohai2u YOURNAME@!
chef <span class="o">(</span>12.17.44<span class="o">)</span>&gt;
</pre></div>
</div>
<p>To just load one recipe from the run-list, go into the recipe and use the <tt class="docutils literal"><span class="pre">include_recipe</span></tt> command. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef &gt; recipe_mode
  chef:recipe &gt; include_recipe <span class="s2">&quot;getting-started&quot;</span>
    <span class="o">=</span>&gt; <span class="o">[</span><span class="c1">#&lt;Chef::Recipe:0x10256f9e8 @cookbook_name=&quot;getting-started&quot;,</span>
  ... output truncated ...
</pre></div>
</div>
<p>To load all of the recipes from a run-list, use code similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span><span class="n">run_list</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">chef_environment</span><span class="p">)</span><span class="o">.</span><span class="n">recipes</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">r</span><span class="o">|</span>
  <span class="n">include_recipe</span> <span class="n">r</span>
<span class="k">end</span>
</pre></div>
</div>
<p>After the recipes that are to be debugged have been loaded, use the <tt class="docutils literal"><span class="pre">run_chef</span></tt> command to run them.</p>
</div>
<div class="section" id="advanced-debugging">
<h5>Advanced Debugging<a class="headerlink" href="#advanced-debugging" title="Permalink to this headline">¶</a></h5>
<p>In chef-shell, it is possible to get extremely verbose debugging using the tracing feature in Interactive Ruby (IRb). chef-shell provides a shortcut for turning tracing on and off. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef &gt; tracing on
  /Users/danielsdeleo/.rvm/ree-1.8.7-2009.10/lib/ruby/1.8/tracer.rb:150: warning: tried to create Proc object without a block
  /Users/danielsdeleo/.rvm/ree-1.8.7-2009.10/lib/ruby/1.8/tracer.rb:146: warning: tried to create Proc object without a block
  tracing is <span class="nv">on</span>
    <span class="o">=</span>&gt; nil
</pre></div>
</div>
<p>and:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef &gt; tracing off
  <span class="c1">#0:(irb):3:Object:-: tracing off</span>
  <span class="c1">#0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:108:Shell::Extensions::ObjectCoreExtensions:&gt;:       def off</span>
  <span class="c1">#0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:109:Shell::Extensions::ObjectCoreExtensions:-:         :off</span>
  <span class="c1">#0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:110:Shell::Extensions::ObjectCoreExtensions:&lt;:       end</span>
  <span class="c1">#0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:273:main:&gt;:       def tracing(on_or_off)</span>
  <span class="c1">#0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:274:main:-:         conf.use_tracer = on_or_off.on_off_to_bool</span>
  <span class="c1">#0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:161:Shell::Extensions::Symbol:&gt;:       def on_off_to_bool</span>
  <span class="c1">#0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:162:Shell::Extensions::Symbol:-:         self.to_s.on_off_to_bool</span>
  <span class="c1">#0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:148:Shell::Extensions::String:&gt;:       def on_off_to_bool</span>
  <span class="c1">#0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:149:Shell::Extensions::String:-:         case self</span>
  <span class="c1">#0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:153:Shell::Extensions::String:-:           false</span>
  <span class="c1">#0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:157:Shell::Extensions::String:&lt;:       end</span>
  <span class="c1">#0:/opt/chef/embedded/lib/ruby/gems/1.9.3/gems/chef-11.4.4/lib/chef/shell/ext.rb:163:Shell::Extensions::Symbol:&lt;:       end</span>
  tracing is <span class="nv">off</span>
   <span class="o">=</span>&gt; nil
  chef &gt;
</pre></div>
</div>
</div>
</div>
<div class="section" id="debug-examples">
<h4>Debug Examples<a class="headerlink" href="#debug-examples" title="Permalink to this headline">¶</a></h4>
<p>The following examples show how to use chef-shell.</p>
<div class="section" id="hello-world">
<h5>&#8220;Hello World&#8221;<a class="headerlink" href="#hello-world" title="Permalink to this headline">¶</a></h5>
<p>This example shows how to run chef-shell in standalone mode. (For chef-solo or chef-client modes, you would need to run chef-shell using the <tt class="docutils literal"><span class="pre">-s</span></tt> or <tt class="docutils literal"><span class="pre">-z</span></tt> command line options, and then take into consideration the necessary configuration settings.)</p>
<p>When the chef-client is installed using RubyGems or a package manager, chef-shell should already be installed. When the chef-client is run from a git clone, it will be located in <tt class="docutils literal"><span class="pre">chef/bin/chef</span> <span class="pre">shell</span></tt>. To start chef-shell, just run it without any options. You&#8217;ll see the loading message, then the banner, and then the chef-shell prompt:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ bin/chef-shell
  loading configuration: none <span class="o">(</span>standalone session<span class="o">)</span>
  Session type: standalone
  Loading..............done.

  This is the chef-shell.
   Chef Version: 12.17.44
   https://www.chef.io/
   https://docs.chef.io/

  run <span class="sb">`</span>help<span class="s1">&#39; for help, `exit&#39;</span> or ^D to quit.

  Ohai2u YOURNAME@!
  chef <span class="o">(</span>12.17.44<span class="o">)</span>&gt;
</pre></div>
</div>
<p>(Use the help command to print a list of supported commands.) Use the recipe_mode command to switch to recipe context:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef &gt; recipe_mode
  chef:recipe_mode &gt;
</pre></div>
</div>
<p>Typing is evaluated in the same context as recipes. Create a file resource:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef:recipe_mode &gt; file <span class="s2">&quot;/tmp/ohai2u_shef&quot;</span>
    <span class="o">=</span>&gt; <span class="c1">#&lt;Chef::Resource::File:0x1b691ac</span>
       @enclosing_provider<span class="o">=</span>nil,
       @resource_name<span class="o">=</span>:file,
       @before<span class="o">=</span>nil,
       @supports<span class="o">={}</span>,
       @backup<span class="o">=</span>5,
       @allowed_actions<span class="o">=[</span>:nothing, :create, :delete, :touch, :create_if_missing<span class="o">]</span>,
       @only_if<span class="o">=</span>nil,
       @noop<span class="o">=</span>nil,
       @collection<span class="o">=</span><span class="c1">#&lt;Chef::ResourceCollection:0x1b9926c</span>
       @insert_after_idx<span class="o">=</span>nil,
       @resources_by_name<span class="o">={</span><span class="s2">&quot;file[/tmp/ohai2u_shef]&quot;</span><span class="o">=</span>&gt;0<span class="o">}</span>,
       @resources<span class="o">=[</span><span class="c1">#&lt;Chef::Resource::File:0x1b691ac ...&gt;]&gt;,</span>
       @updated<span class="o">=</span>false,
       @provider<span class="o">=</span>nil,
       @node<span class="o">=</span>&lt;Chef::Node:0xdeeaae
       @name<span class="o">=</span><span class="s2">&quot;eigenstate.local&quot;</span>&gt;,
       @recipe_name<span class="o">=</span>nil,
       @not_if<span class="o">=</span>nil,
       @name<span class="o">=</span><span class="s2">&quot;/tmp/ohai2u_shef&quot;</span>,
       @action<span class="o">=</span><span class="s2">&quot;create&quot;</span>,
       @path<span class="o">=</span><span class="s2">&quot;/tmp/ohai2u_shef&quot;</span>,
       @source_line<span class="o">=</span><span class="s2">&quot;/Users/danielsdeleo/ruby/chef/chef/(irb#1) line 1&quot;</span>,
       @params<span class="o">={}</span>,
       @actions<span class="o">={}</span>,
       @cookbook_name<span class="o">=</span>nil,
       @ignore_failure<span class="o">=</span>false&gt;
</pre></div>
</div>
<p>(The previous example was formatted for presentation.) At this point, chef-shell has created the resource and put it in the run-list, but not yet created the file. To initiate the chef-client run, use the <tt class="docutils literal"><span class="pre">run_chef</span></tt> command:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef:recipe_mode &gt; run_chef
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 10:42:47 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/ohai2u_shef<span class="o">]</span>
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 10:42:47 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/ohai2u_shef<span class="o">]</span> using Chef::Provider::File
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 10:42:47 -0800<span class="o">]</span> INFO: Creating file<span class="o">[</span>/tmp/ohai2u_shef<span class="o">]</span> at /tmp/ohai2u_shef
    <span class="o">=</span>&gt; <span class="nb">true</span>
</pre></div>
</div>
<p>chef-shell can also switch to the same context as attribute files. Set an attribute with the following syntax:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef:recipe_mode &gt; attributes_mode
  chef:attributes &gt; set<span class="o">[</span>:hello<span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;ohai2u-again&quot;</span>
    <span class="o">=</span>&gt; <span class="s2">&quot;ohai2u-again&quot;</span>
  chef:attributes &gt;
</pre></div>
</div>
<p>Switch back to recipe_mode context and use the attributes:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef:attributes &gt; <span class="nv">recipe_mode</span>
    <span class="o">=</span>&gt; :attributes
  chef:recipe_mode &gt; file <span class="s2">&quot;/tmp/#{node.hello}&quot;</span>
</pre></div>
</div>
<p>Now, run the chef-client again:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef:recipe_mode &gt; run_chef
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 10:53:22 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/ohai2u_shef<span class="o">]</span>
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 10:53:22 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/ohai2u_shef<span class="o">]</span> using Chef::Provider::File
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 10:53:22 -0800<span class="o">]</span> DEBUG: Processing file<span class="o">[</span>/tmp/ohai2u-again<span class="o">]</span>
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 10:53:22 -0800<span class="o">]</span> DEBUG: file<span class="o">[</span>/tmp/ohai2u-again<span class="o">]</span> using Chef::Provider::File
  <span class="o">[</span>Fri, <span class="m">15</span> Jan <span class="m">2010</span> 10:53:22 -0800<span class="o">]</span> INFO: Creating file<span class="o">[</span>/tmp/ohai2u-again<span class="o">]</span> at /tmp/ohai2u-again
    <span class="o">=</span>&gt; <span class="nb">true</span>
  chef:recipe_mode &gt;
</pre></div>
</div>
<p>Because the first resource (<tt class="docutils literal"><span class="pre">file[/tmp/ohai2u_shef]</span></tt>) is still in the run-list, it gets executed again. And because that file already exists, the chef-client doesn&#8217;t attempt to re-create it. Finally, the files were created using the <tt class="docutils literal"><span class="pre">ls</span></tt> method:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ chef:recipe_mode &gt; ls<span class="o">(</span><span class="s2">&quot;/tmp&quot;</span><span class="o">)</span>.grep<span class="o">(</span>/ohai/<span class="o">)</span>
    <span class="o">=</span>&gt; <span class="o">[</span><span class="s2">&quot;ohai2u-again&quot;</span>, <span class="s2">&quot;ohai2u_shef&quot;</span><span class="o">]</span>
      Shell Tutorial
</pre></div>
</div>
</div>
<div class="section" id="get-specific-nodes">
<h5>Get Specific Nodes<a class="headerlink" href="#get-specific-nodes" title="Permalink to this headline">¶</a></h5>
<p>To get a list of nodes using a recipe named <tt class="docutils literal"><span class="pre">postfix</span></tt> use <tt class="docutils literal"><span class="pre">search(:node,&quot;recipe:postfix&quot;)</span></tt>. To get a list of nodes using a sub-recipe named <tt class="docutils literal"><span class="pre">delivery</span></tt>, use chef-shell. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">search</span><span class="p">(</span><span class="ss">:node</span><span class="p">,</span> <span class="s1">&#39;recipes:postfix\:\:delivery&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Single (&#8216; &#8216;) vs. double (&#8221; &#8221;) is important. This is because a backslash () needs to be included in the string, instead of having Ruby interpret it as an escape.</p>
</div>
</div>
</div>
</div>
<div class="section" id="id38">
<h3>Examples<a class="headerlink" href="#id38" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>A recipe without a breakpoint</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_key</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">url</span>  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;key_url&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:add</span>
<span class="k">end</span>

<span class="n">yum_repository</span> <span class="s1">&#39;elrepo&#39;</span> <span class="k">do</span>
  <span class="n">description</span> <span class="s1">&#39;ELRepo.org Community Enterprise Linux Extras Repository&#39;</span>
  <span class="n">key</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">]</span>
  <span class="n">mirrorlist</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">includepkgs</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;includepkgs&#39;</span><span class="o">]</span>
  <span class="n">exclude</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;elrepo&#39;</span><span class="o">][</span><span class="s1">&#39;exclude&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>The same recipe with breakpoints</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">breakpoint</span> <span class="s2">&quot;before yum_key node[&#39;yum&#39;][&#39;repo_name&#39;][&#39;key&#39;]&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>

<span class="n">yum_key</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">url</span>  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;key_url&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:add</span>
<span class="k">end</span>

<span class="n">breakpoint</span> <span class="s2">&quot;after yum_key node[&#39;yum&#39;][&#39;repo_name&#39;][&#39;key&#39;]&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>

<span class="n">breakpoint</span> <span class="s2">&quot;before yum_repository &#39;repo_name&#39;&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>

<span class="n">yum_repository</span> <span class="s1">&#39;repo_name&#39;</span> <span class="k">do</span>
  <span class="n">description</span> <span class="s1">&#39;description&#39;</span>
  <span class="n">key</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">]</span>
  <span class="n">mirrorlist</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">includepkgs</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;includepkgs&#39;</span><span class="o">]</span>
  <span class="n">exclude</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;yum&#39;</span><span class="o">][</span><span class="s1">&#39;repo_name&#39;</span><span class="o">][</span><span class="s1">&#39;exclude&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>

<span class="n">breakpoint</span> <span class="s2">&quot;after yum_repository &#39;repo_name&#39;&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:break</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the name of each breakpoint is an arbitrary string. In the previous examples, the names are used to indicate if the breakpoint is before or after a resource, and then also to specify which resource.</p>
</div>
</div>
<div class="section" id="chef-gem">
<h2>chef_gem<a class="headerlink" href="#chef-gem" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_chef_gem.rst">[edit on GitHub]</a></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>chef_gem</strong> and <strong>gem_package</strong> resources are both used to install Ruby gems. For any machine on which the chef-client is installed, there are two instances of Ruby. One is the standard, system-wide instance of Ruby and the other is a dedicated instance that is available only to the chef-client. Use the <strong>chef_gem</strong> resource to install gems into the instance of Ruby that is dedicated to the chef-client. Use the <strong>gem_package</strong> resource to install all other gems (i.e. install gems system-wide).</p>
</div>
<p>Use the <strong>chef_gem</strong> resource to install a gem only for the instance of Ruby that is dedicated to the chef-client. When a gem is installed from a local file, it must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p>
<p>The <strong>chef_gem</strong> resource works with all of the same properties and options as the <strong>gem_package</strong> resource, but does not accept the <tt class="docutils literal"><span class="pre">gem_binary</span></tt> property because it always uses the <tt class="docutils literal"><span class="pre">CurrentGemEnvironment</span></tt> under which the chef-client is running. In addition to performing actions similar to the <strong>gem_package</strong> resource, the <strong>chef_gem</strong> resource does the following:</p>
<ul class="simple">
<li>Runs its actions immediately, before convergence, allowing a gem to be used in a recipe immediately after it is installed</li>
<li>Runs <tt class="docutils literal"><span class="pre">Gem.clear_paths</span></tt> after the action, ensuring that gem is aware of changes so that it can be required immediately after it is installed</li>
</ul>
<div class="section" id="id39">
<h3>Syntax<a class="headerlink" href="#id39" title="Permalink to this headline">¶</a></h3>
<p>A <strong>chef_gem</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>chef_gem</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_gem</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named gem using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>chef_gem</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_gem</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">clear_sources</span>              <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">compile_time</span>               <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rubygems</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">chef_gem</span></tt> tells the chef-client to manage a gem</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the gem</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">clear_sources</span></tt>, <tt class="docutils literal"><span class="pre">compile_time</span></tt>, <tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id40">
<h3>Actions<a class="headerlink" href="#id40" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a gem. If a version is specified, install the specified version of the gem.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:purge</span></tt></dt>
<dd>Purge a gem. This action typically removes the configuration files as well as the gem.</dd>
<dt><tt class="docutils literal"><span class="pre">:reconfig</span></tt></dt>
<dd>Reconfigure a gem. This action requires a response file.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a gem.</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a gem and/or ensure that a gem is the latest version.</dd>
</dl>
</div>
<div class="section" id="id41">
<h3>Properties<a class="headerlink" href="#id41" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">clear_sources</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p>Set to <tt class="docutils literal"><span class="pre">true</span></tt> to download a gem from the path specified by the <tt class="docutils literal"><span class="pre">source</span></tt> property (and not from RubyGems). Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p>Another approach is to use the <strong>gem_package</strong> resource, and then specify the <tt class="docutils literal"><span class="pre">gem_binary</span></tt> location to the RubyGems directory that is used by Chef. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;gem_name&#39;</span> <span class="k">do</span>
  <span class="n">gem_binary</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Util</span><span class="o">::</span><span class="no">PathHelper</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">embedded_dir</span><span class="p">,</span><span class="s1">&#39;bin&#39;</span><span class="p">,</span><span class="s1">&#39;gem&#39;</span><span class="p">)</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">compile_time</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p>Controls the phase during which a gem is installed on a node. Set to <tt class="docutils literal"><span class="pre">true</span></tt> to install a gem while the resource collection is being built (the &#8220;compile phase&#8221;). Set to <tt class="docutils literal"><span class="pre">false</span></tt> to install a gem while the chef-client is configuring the node (the &#8220;converge phase&#8221;). Possible values: <tt class="docutils literal"><span class="pre">nil</span></tt> (for verbose warnings), <tt class="docutils literal"><span class="pre">true</span></tt> (to warn once per chef-client run), or <tt class="docutils literal"><span class="pre">false</span></tt> (to remove all warnings). Recommended value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
<p>To suppress warnings for cookbooks authored prior to chef-client 12.1, use a <tt class="docutils literal"><span class="pre">respond_to?</span></tt> check to ensure backward compatibility. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_gem</span> <span class="s1">&#39;aws-sdk&#39;</span> <span class="k">do</span>
  <span class="n">compile_time</span> <span class="kp">false</span> <span class="k">if</span> <span class="nb">respond_to?</span><span class="p">(</span><span class="ss">:compile_time</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p>If you are using <tt class="docutils literal"><span class="pre">chef-sugar</span></tt>&#8212;a <a class="reference external" href="https://supermarket.chef.io/cookbooks/chef-sugar">community cookbook</a>&#8212;it must be version 3.0.1 (or higher) to use the previous example. If you are using an older version of <tt class="docutils literal"><span class="pre">chef-sugar</span></tt>, the following workaround is required:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_gem</span> <span class="s1">&#39;gem_name&#39;</span> <span class="k">do</span>
  <span class="n">compile_time</span> <span class="kp">true</span> <span class="k">if</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Resource</span><span class="o">::</span><span class="no">ChefGem</span><span class="o">.</span><span class="n">instance_methods</span><span class="p">(</span><span class="kp">false</span><span class="p">)</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="ss">:compile_time</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p class="last">See this <a class="reference external" href="http://jtimberman.housepub.org/blog/2015/03/20/chef-gem-compile-time-compatibility/">blog post</a> for more background on this behavior.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String</p>
<p class="last">The name of the gem. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a gem in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String</p>
<p class="last">The version of a gem to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id42">
<h3>Providers<a class="headerlink" href="#id42" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Rubygems</span></tt>, <tt class="docutils literal"><span class="pre">chef_gem</span></tt></dt>
<dd>Can be used with the <tt class="docutils literal"><span class="pre">options</span></tt> attribute.</dd>
</dl>
</div>
<div class="section" id="id43">
<h3>Examples<a class="headerlink" href="#id43" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Compile time vs. converge time installation of gems</strong></p>
<p>To install a gem while the chef-client is configuring the node (the “converge phase”), set the <tt class="docutils literal"><span class="pre">compile_time</span></tt> property to <tt class="docutils literal"><span class="pre">false</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_gem</span> <span class="s1">&#39;right_aws&#39;</span> <span class="k">do</span>
  <span class="n">compile_time</span> <span class="kp">false</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p>To install a gem while the resource collection is being built (the “compile phase”), set the <tt class="docutils literal"><span class="pre">compile_time</span></tt> property to <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_gem</span> <span class="s1">&#39;right_aws&#39;</span> <span class="k">do</span>
  <span class="n">compile_time</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install MySQL for Chef</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;apt-get update&#39;</span> <span class="k">do</span>
  <span class="n">ignore_failure</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span><span class="o">.</span><span class="n">run_action</span><span class="p">(</span><span class="ss">:run</span><span class="p">)</span> <span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform_family&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;debian&#39;</span>

<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="o">[</span><span class="s1">&#39;build_essential&#39;</span><span class="o">][</span><span class="s1">&#39;compiletime&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="kp">true</span>
<span class="n">include_recipe</span> <span class="s1">&#39;build-essential&#39;</span>
<span class="n">include_recipe</span> <span class="s1">&#39;mysql::client&#39;</span>

<span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;client&#39;</span><span class="o">][</span><span class="s1">&#39;packages&#39;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">mysql_pack</span><span class="o">|</span>
  <span class="n">resources</span><span class="p">(</span><span class="s2">&quot;package[</span><span class="si">#{</span><span class="n">mysql_pack</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">run_action</span><span class="p">(</span><span class="ss">:install</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">chef_gem</span> <span class="s1">&#39;mysql&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="chef-handler">
<h2>chef_handler<a class="headerlink" href="#chef-handler" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_chef_handler.rst">[edit on GitHub]</a></p>
<p>Use the <strong>chef_handler</strong> resource to enable handlers during a chef-client run. The resource allows arguments to be passed to the chef-client, which then applies the conditions defined by the custom handler to the node attribute data collected during the chef-client run, and then processes the handler based on that data.</p>
<p>The <strong>chef_handler</strong> resource is typically defined early in a node&#8217;s run-list (often being the first item). This ensures that all of the handlers will be available for the entire chef-client run.</p>
<p>The <strong>chef_handler</strong> resource <a class="reference external" href="https://github.com/chef-cookbooks/chef_handler">is included with the chef_handler cookbook</a>. This cookbook defines the the resource itself and also provides the location in which the chef-client looks for custom handlers. All custom handlers should be added to the <tt class="docutils literal"><span class="pre">files/default/handlers</span></tt> directory in the <strong>chef_handler</strong> cookbook.</p>
<div class="section" id="handler-types">
<h3>Handler Types<a class="headerlink" href="#handler-types" title="Permalink to this headline">¶</a></h3>
<p>There are three types of handlers:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Handler</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>exception</td>
<td>An exception handler is used to identify situations that have caused a chef-client run to fail. An exception handler can be loaded at the start of a chef-client run by adding a recipe that contains the <strong>chef_handler</strong> resource to a node&#8217;s run-list. An exception handler runs when the <tt class="docutils literal"><span class="pre">failed?</span></tt> property for the <tt class="docutils literal"><span class="pre">run_status</span></tt> object returns <tt class="docutils literal"><span class="pre">true</span></tt>.</td>
</tr>
<tr class="row-odd"><td>report</td>
<td>A report handler is used when a chef-client run succeeds and reports back on certain details about that chef-client run. A report handler can be loaded at the start of a chef-client run by adding a recipe that contains the <strong>chef_handler</strong> resource to a node&#8217;s run-list. A report handler runs when the <tt class="docutils literal"><span class="pre">success?</span></tt> property for the <tt class="docutils literal"><span class="pre">run_status</span></tt> object returns <tt class="docutils literal"><span class="pre">true</span></tt>.</td>
</tr>
<tr class="row-even"><td>start</td>
<td>A start handler is used to run events at the beginning of the chef-client run. A start handler can be loaded at the start of a chef-client run by adding the start handler to the <tt class="docutils literal"><span class="pre">start_handlers</span></tt> setting in the client.rb file or by installing the gem that contains the start handler by using the <strong>chef_gem</strong> resource in a recipe in the <strong>chef-client</strong> cookbook. (A start handler may not be loaded using the <tt class="docutils literal"><span class="pre">chef_handler</span></tt> resource.)</td>
</tr>
</tbody>
</table>
<div class="section" id="exception-report">
<h4>Exception / Report<a class="headerlink" href="#exception-report" title="Permalink to this headline">¶</a></h4>
<p>Exception and report handlers are used to trigger certain behaviors in response to specific situations, typically identified during a chef-client run.</p>
<ul class="simple">
<li>An exception handler is used to trigger behaviors when a defined aspect of a chef-client run fails.</li>
<li>A report handler is used to trigger behaviors when a defined aspect of a chef-client run is successful.</li>
</ul>
<p>Both types of handlers can be used to gather data about a chef-client run and can provide rich levels of data about all types of usage, which can be used later for trending and analysis across the entire organization.</p>
<p>Exception and report handlers are made available to the chef-client run in one of the following ways:</p>
<ul class="simple">
<li>By adding the <strong>chef_handler</strong> resource to a recipe, and then adding that recipe to the run-list for a node. (The <strong>chef_handler</strong> resource is available from the <strong>chef_handler</strong> cookbook.)</li>
<li>By adding the handler to one of the following settings in the node&#8217;s client.rb file: <tt class="docutils literal"><span class="pre">exception_handlers</span></tt> and/or <tt class="docutils literal"><span class="pre">report_handlers</span></tt></li>
</ul>
<p>The <strong>chef_handler</strong> resource allows exception and report handlers to be enabled from within recipes, which can then added to the run-list for any node on which the exception or report handler should run. The <strong>chef_handler</strong> resource is available from the <strong>chef_handler</strong> cookbook.</p>
<p>To use the <strong>chef_handler</strong> resource in a recipe, add code similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s1">&#39;name_of_handler&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;/path/to/handler/handler_name&#39;</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p>For example, a handler for Growl needs to be enabled at the beginning of the chef-client run:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_gem</span> <span class="s1">&#39;chef-handler-growl&#39;</span>
</pre></div>
</div>
<p>and then is activated in a recipe by using the <strong>chef_handler</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s1">&#39;Chef::Handler::Growl&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;chef/handler/growl&#39;</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="start">
<h4>Start<a class="headerlink" href="#start" title="Permalink to this headline">¶</a></h4>
<p>A start handler is not loaded into the chef-client run from a recipe, but is instead listed in the client.rb file using the <tt class="docutils literal"><span class="pre">start_handlers</span></tt> attribute. The start handler must be installed on the node and be available to the chef-client prior to the start of the chef-client run. Use the <strong>chef-client</strong> cookbook to install the start handler.</p>
<p>Start handlers are made available to the chef-client run in one of the following ways:</p>
<ul class="simple">
<li>By adding a start handler to the <strong>chef-client</strong> cookbook, which installs the handler on the node so that it is available to the chef-client at the start of the chef-client run</li>
<li>By adding the handler to one of the following settings in the node&#8217;s client.rb file: <tt class="docutils literal"><span class="pre">start_handlers</span></tt></li>
</ul>
<p>The <strong>chef-client</strong> cookbook can be configured to automatically install and configure gems that are required by a start handler. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;load_gems&#39;</span><span class="o">][</span><span class="s1">&#39;chef-reporting&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="p">{</span>
  <span class="ss">:require_name</span> <span class="o">=&gt;</span> <span class="s1">&#39;chef_reporting&#39;</span><span class="p">,</span>
  <span class="ss">:action</span> <span class="o">=&gt;</span> <span class="ss">:install</span>
<span class="p">}</span>

<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;config&#39;</span><span class="o">][</span><span class="s1">&#39;start_handlers&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span>
  <span class="p">{</span>
    <span class="ss">:class</span> <span class="o">=&gt;</span> <span class="s1">&#39;Chef::Reporting::StartHandler&#39;</span><span class="p">,</span>
    <span class="ss">:arguments</span> <span class="o">=&gt;</span> <span class="o">[]</span>
  <span class="p">}</span>
<span class="o">]</span>

<span class="n">include_recipe</span> <span class="s1">&#39;chef-client::config&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id44">
<h3>Syntax<a class="headerlink" href="#id44" title="Permalink to this headline">¶</a></h3>
<p>A <strong>chef_handler</strong> resource block enables handlers during a chef-client run. Two handlers&#8212;<tt class="docutils literal"><span class="pre">JsonFile</span></tt> and <tt class="docutils literal"><span class="pre">ErrorReport</span></tt>&#8212;are built into Chef:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s1">&#39;Chef::Handler::JsonFile&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;chef/handler/json_file&#39;</span>
  <span class="n">arguments</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/chef/reports&#39;</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s1">&#39;Chef::Handler::ErrorReport&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;chef/handler/error_report&#39;</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p>show how to enable those handlers in a recipe.</p>
<p>The full syntax for all of the properties that are available to the <strong>chef_handler</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">arguments</span>                  <span class="nb">Array</span>
  <span class="n">class_name</span>                 <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">supports</span>                   <span class="no">Hash</span>
  <span class="n">action</span>                     <span class="no">Symbol</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">chef_handler</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">arguments</span></tt>, <tt class="docutils literal"><span class="pre">class_name</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, and <tt class="docutils literal"><span class="pre">supports</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id45">
<h3>Actions<a class="headerlink" href="#id45" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:disable</span></tt></dt>
<dd>Disable the handler for the current chef-client run on the current node.</dd>
<dt><tt class="docutils literal"><span class="pre">:enable</span></tt></dt>
<dd>Enable the handler for the current chef-client run on the current node.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
</dl>
</div>
<div class="section" id="id46">
<h3>Properties<a class="headerlink" href="#id46" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">arguments</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p>An array of arguments that are passed to the initializer for the handler class. Default value: <tt class="docutils literal"><span class="pre">[]</span></tt>. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">arguments</span> <span class="ss">:key1</span> <span class="o">=&gt;</span> <span class="s1">&#39;val1&#39;</span>
</pre></div>
</div>
<p>or:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">arguments</span> <span class="o">[</span><span class="ss">:key1</span> <span class="o">=&gt;</span> <span class="s1">&#39;val1&#39;</span><span class="p">,</span> <span class="ss">:key2</span> <span class="o">=&gt;</span> <span class="s1">&#39;val2&#39;</span><span class="o">]</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">class_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of the handler class. This can be module name-spaced.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The full path to the handler file or the path to a gem (if the handler ships as part of a Ruby gem).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">supports</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">The type of handler. Possible values: <tt class="docutils literal"><span class="pre">:exception</span></tt>, <tt class="docutils literal"><span class="pre">:report</span></tt>, or <tt class="docutils literal"><span class="pre">:start</span></tt>. Default value: <tt class="docutils literal"><span class="pre">{</span> <span class="pre">:report</span> <span class="pre">=&gt;</span> <span class="pre">true,</span> <span class="pre">:exception</span> <span class="pre">=&gt;</span> <span class="pre">true</span> <span class="pre">}</span></tt>.</p>
</dd>
</dl>
</div>
<div class="section" id="custom-handlers">
<h3>Custom Handlers<a class="headerlink" href="#custom-handlers" title="Permalink to this headline">¶</a></h3>
<p>A custom handler can be created to support any situation. The easiest way to build a custom handler:</p>
<ol class="arabic simple">
<li>Download the <strong>chef_handler</strong> cookbook</li>
<li>Create a custom handler</li>
<li>Write a recipe using the <strong>chef_handler</strong> resource</li>
<li>Add that recipe to a node&#8217;s run-list, often as the first recipe in that run-list</li>
</ol>
<div class="section" id="id47">
<h4>Syntax<a class="headerlink" href="#id47" title="Permalink to this headline">¶</a></h4>
<p>The syntax for a handler can vary, depending on what the the situations the handler is being asked to track, the type of handler being used, and so on. All custom exception and report handlers are defined using Ruby and must be a subclass of the <tt class="docutils literal"><span class="pre">Chef::Handler</span></tt> class.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;chef/log&#39;</span>

<span class="k">module</span> <span class="nn">ModuleName</span>
  <span class="k">class</span> <span class="nc">HandlerName</span> <span class="o">&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span>
    <span class="k">def</span> <span class="nf">report</span>
      <span class="c1"># Ruby code goes here</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">require</span></tt> ensures that the logging functionality of the chef-client is available to the handler</li>
<li><tt class="docutils literal"><span class="pre">ModuleName</span></tt> is the name of the module as it exists within the <tt class="docutils literal"><span class="pre">Chef</span></tt> library</li>
<li><tt class="docutils literal"><span class="pre">HandlerName</span></tt> is the name of the handler as it is used in a recipe</li>
<li><tt class="docutils literal"><span class="pre">report</span></tt> is an interface that is used to define the custom handler</li>
</ul>
<p>For example, the following shows a custom handler that sends an email that contains the exception data when a chef-client run fails:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;net/smtp&#39;</span>

<span class="k">module</span> <span class="nn">OrgName</span>
  <span class="k">class</span> <span class="nc">SendEmail</span> <span class="o">&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span>
    <span class="k">def</span> <span class="nf">report</span>
      <span class="k">if</span> <span class="n">run_status</span><span class="o">.</span><span class="n">failed?</span> <span class="k">then</span>
        <span class="n">message</span>  <span class="o">=</span> <span class="s2">&quot;From: sender_name &lt;sender@example.com&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;To: recipient_address &lt;recipient@example.com&gt;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Subject: chef-client Run Failed</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Date: </span><span class="si">#{</span><span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">rfc2822</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;Chef run failed on </span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">run_status</span><span class="o">.</span><span class="n">formatted_exception</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">&lt;&lt;</span> <span class="nb">Array</span><span class="p">(</span><span class="n">backtrace</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span>
        <span class="no">Net</span><span class="o">::</span><span class="no">SMTP</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="s1">&#39;your.smtp.server&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">smtp</span><span class="o">|</span>
          <span class="n">smtp</span><span class="o">.</span><span class="n">send_message</span> <span class="n">message</span><span class="p">,</span> <span class="s1">&#39;sender@example&#39;</span><span class="p">,</span> <span class="s1">&#39;recipient@example&#39;</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then is used in a recipe like:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">send_email</span> <span class="s1">&#39;blah&#39;</span> <span class="k">do</span>
  <span class="c1"># recipe code</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="report-interface">
<h4>report Interface<a class="headerlink" href="#report-interface" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">report</span></tt> interface is used to define how a handler will behave and is a required part of any custom handler. The syntax for the <tt class="docutils literal"><span class="pre">report</span></tt> interface is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">report</span>
  <span class="c1"># Ruby code</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The Ruby code used to define a custom handler will vary significantly from handler to handler. The chef-client includes two default handlers: <tt class="docutils literal"><span class="pre">error_report</span></tt> and <tt class="docutils literal"><span class="pre">json_file</span></tt>. Their use of the <tt class="docutils literal"><span class="pre">report</span></tt> interface is shown below.</p>
<p>The <a class="reference external" href="https://github.com/chef/chef/blob/master/lib/chef/handler/error_report.rb">error_report</a> handler:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;chef/handler&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;chef/resource/directory&#39;</span>

<span class="k">class</span> <span class="nc">Chef</span>
  <span class="k">class</span> <span class="nc">Handler</span>
    <span class="k">class</span> <span class="nc">ErrorReport</span> <span class="o">&lt;</span> <span class="o">::</span><span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span>
      <span class="k">def</span> <span class="nf">report</span>
        <span class="no">Chef</span><span class="o">::</span><span class="no">FileCache</span><span class="o">.</span><span class="n">store</span><span class="p">(</span><span class="s1">&#39;failed-run-data.json&#39;</span><span class="p">,</span> <span class="no">Chef</span><span class="o">::</span><span class="no">JSONCompat</span><span class="o">.</span><span class="n">to_json_pretty</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="mo">0640</span><span class="p">)</span>
        <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;Saving node information to </span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">FileCache</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;failed-run-data.json&#39;</span><span class="p">,</span> <span class="kp">false</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
 <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The <a class="reference external" href="https://github.com/chef/chef/blob/master/lib/chef/handler/json_file.rb">json_file</a> handler:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;chef/handler&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;chef/resource/directory&#39;</span>

<span class="k">class</span> <span class="nc">Chef</span>
  <span class="k">class</span> <span class="nc">Handler</span>
    <span class="k">class</span> <span class="nc">JsonFile</span> <span class="o">&lt;</span> <span class="o">::</span><span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span>
      <span class="kp">attr_reader</span> <span class="ss">:config</span>
      <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">config</span><span class="o">=</span><span class="p">{})</span>
        <span class="vi">@config</span> <span class="o">=</span> <span class="n">config</span>
        <span class="vi">@config</span><span class="o">[</span><span class="ss">:path</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">&#39;/var/chef/reports&#39;</span>
        <span class="vi">@config</span>
      <span class="k">end</span>
      <span class="k">def</span> <span class="nf">report</span>
        <span class="k">if</span> <span class="n">exception</span>
          <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Creating JSON exception report&#39;</span><span class="p">)</span>
        <span class="k">else</span>
          <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating JSON run report&#39;</span><span class="p">)</span>
        <span class="k">end</span>
        <span class="n">build_report_dir</span>
        <span class="n">savetime</span> <span class="o">=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m%d%H%M%S&#39;</span><span class="p">)</span>
        <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">config</span><span class="o">[</span><span class="ss">:path</span><span class="o">]</span><span class="p">,</span> <span class="s1">&#39;chef-run-report-#{savetime}.json&#39;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">file</span><span class="o">|</span>
          <span class="n">run_data</span> <span class="o">=</span> <span class="n">data</span>
          <span class="n">run_data</span><span class="o">[</span><span class="ss">:start_time</span><span class="o">]</span> <span class="o">=</span> <span class="n">run_data</span><span class="o">[</span><span class="ss">:start_time</span><span class="o">].</span><span class="n">to_s</span>
          <span class="n">run_data</span><span class="o">[</span><span class="ss">:end_time</span><span class="o">]</span> <span class="o">=</span> <span class="n">run_data</span><span class="o">[</span><span class="ss">:end_time</span><span class="o">].</span><span class="n">to_s</span>
          <span class="n">file</span><span class="o">.</span><span class="n">puts</span> <span class="no">Chef</span><span class="o">::</span><span class="no">JSONCompat</span><span class="o">.</span><span class="n">to_json_pretty</span><span class="p">(</span><span class="n">run_data</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">end</span>
      <span class="k">def</span> <span class="nf">build_report_dir</span>
        <span class="k">unless</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">config</span><span class="o">[</span><span class="ss">:path</span><span class="o">]</span><span class="p">)</span>
          <span class="no">FileUtils</span><span class="o">.</span><span class="n">mkdir_p</span><span class="p">(</span><span class="n">config</span><span class="o">[</span><span class="ss">:path</span><span class="o">]</span><span class="p">)</span>
          <span class="no">File</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="mo">00700</span><span class="p">,</span> <span class="n">config</span><span class="o">[</span><span class="ss">:path</span><span class="o">]</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="optional-interfaces">
<h4>Optional Interfaces<a class="headerlink" href="#optional-interfaces" title="Permalink to this headline">¶</a></h4>
<p>The following interfaces may be used in a handler in the same way as the <tt class="docutils literal"><span class="pre">report</span></tt> interface to override the default handler behavior in the chef-client. That said, the following interfaces are not typically used in a handler and, for the most part, are completely unnecessary for a handler to work properly and/or as desired.</p>
<div class="section" id="data">
<h5>data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h5>
<p>The <tt class="docutils literal"><span class="pre">data</span></tt> method is used to return the Hash representation of the <tt class="docutils literal"><span class="pre">run_status</span></tt> object. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">data</span>
  <span class="vi">@run_status</span><span class="o">.</span><span class="n">to_hash</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="run-report-safely">
<h5>run_report_safely<a class="headerlink" href="#run-report-safely" title="Permalink to this headline">¶</a></h5>
<p>The <tt class="docutils literal"><span class="pre">run_report_safely</span></tt> method is used to run the report handler, rescuing and logging errors that may arise as the handler runs and ensuring that all handlers get a chance to run during the chef-client run (even if some handlers fail during that run). In general, this method should never be used as an interface in a custom handler unless this default behavior simply must be overridden.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_report_safely</span><span class="p">(</span><span class="n">run_status</span><span class="p">)</span>
  <span class="n">run_report_unsafe</span><span class="p">(</span><span class="n">run_status</span><span class="p">)</span>
<span class="k">rescue</span> <span class="no">Exception</span> <span class="o">=&gt;</span> <span class="n">e</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Report handler #{self.class.name} raised #{e.inspect}&#39;</span><span class="p">)</span>
  <span class="nb">Array</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">backtrace</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">line</span><span class="o">|</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="p">}</span>
<span class="k">ensure</span>
  <span class="vi">@run_status</span> <span class="o">=</span> <span class="kp">nil</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="run-report-unsafe">
<h5>run_report_unsafe<a class="headerlink" href="#run-report-unsafe" title="Permalink to this headline">¶</a></h5>
<p>The <tt class="docutils literal"><span class="pre">run_report_unsafe</span></tt> method is used to run the report handler without any error handling. This method should never be used directly in any handler, except during testing of that handler. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_report_unsafe</span><span class="p">(</span><span class="n">run_status</span><span class="p">)</span>
  <span class="vi">@run_status</span> <span class="o">=</span> <span class="n">run_status</span>
  <span class="n">report</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="run-status-object">
<h4>run_status Object<a class="headerlink" href="#run-status-object" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">run_status</span></tt> object is initialized by the chef-client before the <tt class="docutils literal"><span class="pre">report</span></tt> interface is run for any handler. The <tt class="docutils literal"><span class="pre">run_status</span></tt> object keeps track of the status of the chef-client run and will contain some (or all) of the following properties:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">all_resources</span></tt></td>
<td>A list of all resources that are included in the <tt class="docutils literal"><span class="pre">resource_collection</span></tt> property for the current chef-client run.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">backtrace</span></tt></td>
<td>A backtrace associated with the uncaught exception data that caused a chef-client run to fail, if present; <tt class="docutils literal"><span class="pre">nil</span></tt> for a successful chef-client run.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">elapsed_time</span></tt></td>
<td>The amount of time between the start (<tt class="docutils literal"><span class="pre">start_time</span></tt>) and end (<tt class="docutils literal"><span class="pre">end_time</span></tt>) of a chef-client run.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">end_time</span></tt></td>
<td>The time at which a chef-client run ended.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">exception</span></tt></td>
<td>The uncaught exception data which caused a chef-client run to fail; <tt class="docutils literal"><span class="pre">nil</span></tt> for a successful chef-client run.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">failed?</span></tt></td>
<td>Show that a chef-client run has failed when uncaught exceptions were raised during a chef-client run. An exception handler runs when the <tt class="docutils literal"><span class="pre">failed?</span></tt> indicator is <tt class="docutils literal"><span class="pre">true</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">node</span></tt></td>
<td>The node on which the chef-client run occurred.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">run_context</span></tt></td>
<td>An instance of the <tt class="docutils literal"><span class="pre">Chef::RunContext</span></tt> object; used by the chef-client to track the context of the run; provides access to the <tt class="docutils literal"><span class="pre">cookbook_collection</span></tt>, <tt class="docutils literal"><span class="pre">resource_collection</span></tt>, and <tt class="docutils literal"><span class="pre">definitions</span></tt> properties.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">start_time</span></tt></td>
<td>The time at which a chef-client run started.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">success?</span></tt></td>
<td>Show that a chef-client run succeeded when uncaught exceptions were not raised during a chef-client run. A report handler runs when the <tt class="docutils literal"><span class="pre">success?</span></tt> indicator is <tt class="docutils literal"><span class="pre">true</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">updated_resources</span></tt></td>
<td>A list of resources that were marked as updated as a result of the chef-client run.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">These properties are not always available. For example, a start handler runs at the beginning of the chef-client run, which means that properties like <tt class="docutils literal"><span class="pre">end_time</span></tt> and <tt class="docutils literal"><span class="pre">elapsed_time</span></tt> are still unknown and will be unavailable to the <tt class="docutils literal"><span class="pre">run_status</span></tt> object.</p>
</div>
</div>
</div>
<div class="section" id="id48">
<h3>Examples<a class="headerlink" href="#id48" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Enable the CloudkickHandler handler</strong></p>
<p>The following example shows how to enable the <tt class="docutils literal"><span class="pre">CloudkickHandler</span></tt> handler, which adds it to the default handler path and passes the <tt class="docutils literal"><span class="pre">oauth</span></tt> key/secret to the handler&#8217;s initializer:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s2">&quot;CloudkickHandler&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_handler&#39;</span><span class="o">][</span><span class="s1">&#39;handler_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/cloudkick_handler.rb&quot;</span>
  <span class="n">arguments</span> <span class="o">[</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;cloudkick&#39;</span><span class="o">][</span><span class="s1">&#39;oauth_key&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;cloudkick&#39;</span><span class="o">][</span><span class="s1">&#39;oauth_secret&#39;</span><span class="o">]]</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Enable handlers during the compile phase</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s2">&quot;Chef::Handler::JsonFile&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;chef/handler/json_file&quot;</span>
  <span class="n">arguments</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/chef/reports&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span><span class="o">.</span><span class="n">run_action</span><span class="p">(</span><span class="ss">:enable</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>Handle only exceptions</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s2">&quot;Chef::Handler::JsonFile&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;chef/handler/json_file&quot;</span>
  <span class="n">arguments</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/chef/reports&#39;</span>
  <span class="n">supports</span> <span class="ss">:exception</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Cookbook Versions (a custom handler)</strong></p>
<p>Community member <tt class="docutils literal"><span class="pre">juliandunn</span></tt> created a custom <a class="reference external" href="https://github.com/juliandunn/cookbook_versions_handler">report handler that logs all of the cookbooks and cookbook versions</a> that were used during the chef-client run, and then reports after the run is complete. This handler requires the <strong>chef_handler</strong> resource (which is available from the <strong>chef_handler</strong> cookbook).</p>
<p>cookbook_versions.rb:</p>
<p>The following custom handler defines how cookbooks and cookbook versions that are used during the chef-client run will be compiled into a report using the <tt class="docutils literal"><span class="pre">Chef::Log</span></tt> class in the chef-client:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;chef/log&#39;</span>

<span class="k">module</span> <span class="nn">Opscode</span>
  <span class="k">class</span> <span class="nc">CookbookVersionsHandler</span> <span class="o">&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span>

    <span class="k">def</span> <span class="nf">report</span>
      <span class="n">cookbooks</span> <span class="o">=</span> <span class="n">run_context</span><span class="o">.</span><span class="n">cookbook_collection</span>
      <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Cookbooks and versions run: #{cookbooks.keys.map {|x| cookbooks[x].name.to_s + &#39;</span> <span class="s1">&#39; + cookbooks[x].version} }&#39;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>default.rb:</p>
<p>The following recipe is added to the run-list for every node on which a list of cookbooks and versions will be generated as report output after every chef-client run.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">include_recipe</span> <span class="s1">&#39;chef_handler&#39;</span>

<span class="n">cookbook_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_handler&#39;</span><span class="o">][</span><span class="s1">&#39;handler_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/cookbook_versions.rb&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;cookbook_versions.rb&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>

<span class="n">chef_handler</span> <span class="s1">&#39;Opscode::CookbookVersionsHandler&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_handler&#39;</span><span class="o">][</span><span class="s1">&#39;handler_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/cookbook_versions.rb&quot;</span>
  <span class="n">supports</span> <span class="ss">:report</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This recipe will generate report output similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="o">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">26</span><span class="ss">T03</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mo">06</span><span class="o">+</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="o">]</span> <span class="ss">INFO</span><span class="p">:</span> <span class="no">Chef</span> <span class="no">Run</span> <span class="n">complete</span> <span class="k">in</span> <span class="mi">0</span><span class="o">.</span><span class="mi">300029878</span> <span class="n">seconds</span>
<span class="o">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">26</span><span class="ss">T03</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mo">06</span><span class="o">+</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="o">]</span> <span class="ss">INFO</span><span class="p">:</span> <span class="no">Running</span> <span class="n">report</span> <span class="n">handlers</span>
<span class="o">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">26</span><span class="ss">T03</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mo">06</span><span class="o">+</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="o">]</span> <span class="ss">INFO</span><span class="p">:</span> <span class="no">Cookbooks</span> <span class="ow">and</span> <span class="n">versions</span> <span class="ss">run</span><span class="p">:</span> <span class="o">[</span><span class="s2">&quot;chef_handler 1.1.4&quot;</span><span class="p">,</span> <span class="s2">&quot;cookbook_versions_handler 1.0.0&quot;</span><span class="o">]</span>
<span class="o">[</span><span class="mi">2013</span><span class="o">-</span><span class="mi">11</span><span class="o">-</span><span class="mi">26</span><span class="ss">T03</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mo">06</span><span class="o">+</span><span class="mo">00</span><span class="p">:</span><span class="mo">00</span><span class="o">]</span> <span class="ss">INFO</span><span class="p">:</span> <span class="no">Report</span> <span class="n">handlers</span> <span class="n">complete</span>
</pre></div>
</div>
<p><strong>JsonFile Handler</strong></p>
<p>The <a class="reference external" href="https://github.com/chef/chef/blob/master/lib/chef/handler/json_file.rb">json_file</a> handler is available from the <strong>chef_handler</strong> cookbook and can be used with exceptions and reports. It serializes run status data to a JSON file. This handler may be enabled in one of the following ways.</p>
<p>By adding the following lines of Ruby code to either the client.rb file or the solo.rb file, depending on how the chef-client is being run:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;chef/handler/json_file&#39;</span>
<span class="n">report_handlers</span> <span class="o">&lt;&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span><span class="o">::</span><span class="no">JsonFile</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/chef/reports&#39;</span><span class="p">)</span>
<span class="n">exception_handlers</span> <span class="o">&lt;&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span><span class="o">::</span><span class="no">JsonFile</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/chef/reports&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>By using the <strong>chef_handler</strong> resource in a recipe, similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s1">&#39;Chef::Handler::JsonFile&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;chef/handler/json_file&#39;</span>
  <span class="n">arguments</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/chef/reports&#39;</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p>After it has run, the run status data can be loaded and inspected via Interactive Ruby (IRb):</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">001</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="nb">require</span> <span class="s1">&#39;rubygems&#39;</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">002</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="nb">require</span> <span class="s1">&#39;json&#39;</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">003</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="nb">require</span> <span class="s1">&#39;chef&#39;</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">004</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">r</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">IO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/var/chef/reports/chef-run-report-20110322060731.json&#39;</span><span class="p">))</span> <span class="o">=&gt;</span> <span class="o">...</span> <span class="n">output</span> <span class="n">truncated</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">005</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">r</span><span class="o">.</span><span class="n">keys</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;end_time&#39;</span><span class="p">,</span> <span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="s1">&#39;updated_resources&#39;</span><span class="p">,</span> <span class="s1">&#39;exception&#39;</span><span class="p">,</span> <span class="s1">&#39;all_resources&#39;</span><span class="p">,</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;elapsed_time&#39;</span><span class="p">,</span> <span class="s1">&#39;start_time&#39;</span><span class="p">,</span> <span class="s1">&#39;backtrace&#39;</span><span class="o">]</span>
<span class="n">irb</span><span class="p">(</span><span class="n">main</span><span class="p">):</span><span class="mo">006</span><span class="p">:</span><span class="mi">0</span><span class="o">&gt;</span> <span class="n">r</span><span class="o">[</span><span class="s1">&#39;elapsed_time&#39;</span><span class="o">]</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="o">.</span><span class="mo">00246</span>
</pre></div>
</div>
<p><strong>Register the JsonFile handler</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s2">&quot;Chef::Handler::JsonFile&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;chef/handler/json_file&quot;</span>
  <span class="n">arguments</span> <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;/var/chef/reports&#39;</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>ErrorReport Handler</strong></p>
<p>The <a class="reference external" href="https://github.com/chef/chef/blob/master/lib/chef/handler/error_report.rb">error_report</a> handler is built into the chef-client and can be used for both exceptions and reports. It serializes error report data to a JSON file. This handler may be enabled in one of the following ways.</p>
<p>By adding the following lines of Ruby code to either the client.rb file or the solo.rb file, depending on how the chef-client is being run:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="nb">require</span> <span class="s1">&#39;chef/handler/error_report&#39;</span>
<span class="n">report_handlers</span> <span class="o">&lt;&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span><span class="o">::</span><span class="no">ErrorReport</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
<span class="n">exception_handlers</span> <span class="o">&lt;&lt;</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Handler</span><span class="o">::</span><span class="no">ErrorReport</span><span class="o">.</span><span class="n">new</span><span class="p">()</span>
</pre></div>
</div>
<p>By using the <a class="reference external" href="https://docs.chef.io/resource_chef_handler.html">chef_handler</a> resource in a recipe, similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_handler</span> <span class="s1">&#39;Chef::Handler::ErrorReport&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;chef/handler/error_report&#39;</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="chocolatey-package">
<h2>chocolatey_package<a class="headerlink" href="#chocolatey-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_chocolatey_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>chocolatey_package</strong> resource to manage packages using Chocolatey for the Microsoft Windows platform.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>chocolatey_package</strong> resource must be specified as <tt class="docutils literal"><span class="pre">chocolatey_package</span></tt> and cannot be shortened to <tt class="docutils literal"><span class="pre">package</span></tt> in a recipe.</p>
</div>
<div class="section" id="id52">
<h3>Syntax<a class="headerlink" href="#id52" title="Permalink to this headline">¶</a></h3>
<p>A <strong>chocolatey_package</strong> resource block manages packages using Chocolatey for the Microsoft Windows platform. The simplest use of the <strong>chocolatey_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chocolatey_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>chocolatey_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chocolatey_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Chocolatey</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">chocolatey_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id53">
<h3>Actions<a class="headerlink" href="#id53" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:purge</span></tt></dt>
<dd>Purge a package. This action typically removes the configuration files as well as the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:reconfig</span></tt></dt>
<dd>Reconfigure a package. This action requires a response file.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:uninstall</span></tt></dt>
<dd>Uninstall a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version.</dd>
</dl>
</div>
<div class="section" id="id54">
<h3>Properties<a class="headerlink" href="#id54" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id55">
<h3>Providers<a class="headerlink" href="#id55" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Chocolatey</span></tt>, <tt class="docutils literal"><span class="pre">chocolatey_package</span></tt></dt>
<dd>The provider for the Chocolatey package manager for the Microsoft Windows platform.</dd>
</dl>
</div>
<div class="section" id="id56">
<h3>Examples<a class="headerlink" href="#id56" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chocolatey_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cookbook-file">
<h2>cookbook_file<a class="headerlink" href="#cookbook-file" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_cookbook_file.rst">[edit on GitHub]</a></p>
<p>Use the <strong>cookbook_file</strong> resource to transfer files from a sub-directory of <tt class="docutils literal"><span class="pre">COOKBOOK_NAME/files/</span></tt> to a specified path located on a host that is running the chef-client. The file is selected according to file specificity, which allows different source files to be used based on the hostname, host platform (operating system, distro, or as appropriate), or platform version. Files that are located in the <tt class="docutils literal"><span class="pre">COOKBOOK_NAME/files/default</span></tt> sub-directory may be used on any platform.</p>
<p>During a chef-client run, the checksum for each local file is calculated and then compared against the checksum for the same file as it currently exists in the cookbook on the Chef server. A file is not transferred when the checksums match. Only files that require an update are transferred from the Chef server to a node.</p>
<div class="section" id="id57">
<h3>Syntax<a class="headerlink" href="#id57" title="Permalink to this headline">¶</a></h3>
<p>A <strong>cookbook_file</strong> resource block manages files by using files that exist within a cookbook&#8217;s <tt class="docutils literal"><span class="pre">/files</span></tt> directory. For example, to write the home page for an Apache website:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;/var/www/customers/public_html/index.php&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;index.php&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;web_admin&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;web_admin&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">'/var/www/customers/public_html/index.php'</span></tt> is path to the file to be created</li>
<li><tt class="docutils literal"><span class="pre">'index.php'</span></tt> is a file in the <tt class="docutils literal"><span class="pre">/files</span></tt> directory in a cookbook that is used to create that file (the contents of the file in the cookbook will become the contents of the file on the node)</li>
<li><tt class="docutils literal"><span class="pre">owner</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, and <tt class="docutils literal"><span class="pre">mode</span></tt> define the permissions</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>cookbook_file</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">atomic_update</span>              <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">backup</span>                     <span class="no">FalseClass</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">cookbook</span>                   <span class="nb">String</span>
  <span class="n">force_unlink</span>               <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">inherits</span>                   <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">manage_symlink_source</span>      <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span><span class="p">,</span> <span class="no">NilClass</span>
  <span class="n">mode</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">owner</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">path</span>                       <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">CookbookFile</span>
  <span class="n">rights</span>                     <span class="no">Hash</span>
  <span class="n">source</span>                     <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">verify</span>                     <span class="nb">String</span><span class="p">,</span> <span class="no">Block</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">cookbook_file</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">atomic_update</span></tt>, <tt class="docutils literal"><span class="pre">backup</span></tt>, <tt class="docutils literal"><span class="pre">cookbook</span></tt>, <tt class="docutils literal"><span class="pre">force_unlink</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">inherits</span></tt>, <tt class="docutils literal"><span class="pre">manage_symlink_source</span></tt>, <tt class="docutils literal"><span class="pre">mode</span></tt>, <tt class="docutils literal"><span class="pre">owner</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">rights</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, and <tt class="docutils literal"><span class="pre">verify</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id58">
<h3>Actions<a class="headerlink" href="#id58" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>Default. Create a file. If a file already exists (but does not match), update that file to match.</dd>
<dt><tt class="docutils literal"><span class="pre">:create_if_missing</span></tt></dt>
<dd>Create a file only if the file does not exist. When the file exists, nothing happens.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Delete a file.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:touch</span></tt></dt>
<dd>Touch a file. This updates the access (atime) and file modification (mtime) times for a file. (This action may be used with this resource, but is typically only used with the <strong>file</strong> resource.)</dd>
</dl>
</div>
<div class="section" id="id59">
<h3>Properties<a class="headerlink" href="#id59" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">atomic_update</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Perform atomic file updates on a per-resource basis. Set to <tt class="docutils literal"><span class="pre">true</span></tt> for atomic file updates. Set to <tt class="docutils literal"><span class="pre">false</span></tt> for non-atomic file updates. This setting overrides <tt class="docutils literal"><span class="pre">file_atomic_update</span></tt>, which is a global setting found in the client.rb file. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">backup</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> FalseClass, Integer</p>
<p class="last">The number of backups to be kept in <tt class="docutils literal"><span class="pre">/var/chef/backup</span></tt> (for UNIX- and Linux-based platforms) or <tt class="docutils literal"><span class="pre">C:/chef/backup</span></tt> (for the Microsoft Windows platform). Set to <tt class="docutils literal"><span class="pre">false</span></tt> to prevent backups from being kept. Default value: <tt class="docutils literal"><span class="pre">5</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">cookbook</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The cookbook in which a file is located (if it is not located in the current cookbook). The default value is the current cookbook.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">force_unlink</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">How the chef-client handles certain situations when the target file turns out not to be a file. For example, when a target file is actually a symlink. Set to <tt class="docutils literal"><span class="pre">true</span></tt> for the chef-client delete the non-file target and replace it with the specified file. Set to <tt class="docutils literal"><span class="pre">false</span></tt> for the chef-client to raise an error. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">A string or ID that identifies the group owner by group name, including fully qualified group names such as <tt class="docutils literal"><span class="pre">domain\group</span></tt> or <tt class="docutils literal"><span class="pre">group&#64;domain</span></tt>. If this value is not specified, existing groups remain unchanged and new group assignments use the default <tt class="docutils literal"><span class="pre">POSIX</span></tt> group (if available).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">inherits</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Microsoft Windows only. Whether a file inherits rights from its parent directory. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">manage_symlink_source</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass, NilClass</p>
<p class="last">Cause the chef-client to detect and manage the source file for a symlink. Possible values: <tt class="docutils literal"><span class="pre">nil</span></tt>, <tt class="docutils literal"><span class="pre">true</span></tt>, or <tt class="docutils literal"><span class="pre">false</span></tt>. When this value is set to <tt class="docutils literal"><span class="pre">nil</span></tt>, the chef-client will manage a symlink&#8217;s source file and emit a warning. When this value is set to <tt class="docutils literal"><span class="pre">true</span></tt>, the chef-client will manage a symlink&#8217;s source file and not emit a warning. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>. The default value will be changed to <tt class="docutils literal"><span class="pre">false</span></tt> in a future version.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">mode</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p>If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified and if the file already exists, the existing mode on the file is used. If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified, the file does not exist, and the <tt class="docutils literal"><span class="pre">:create</span></tt> action is specified, the chef-client assumes a mask value of <tt class="docutils literal"><span class="pre">'0777'</span></tt> and then applies the umask for the system on which the file is to be created to the <tt class="docutils literal"><span class="pre">mask</span></tt> value. For example, if the umask on a system is <tt class="docutils literal"><span class="pre">'022'</span></tt>, the chef-client uses the default value of <tt class="docutils literal"><span class="pre">'0755'</span></tt>.</p>
<p>The behavior is different depending on the platform.</p>
<p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. If the value is specified as a quoted string, it works exactly as if the <tt class="docutils literal"><span class="pre">chmod</span></tt> command was passed. If the value is specified as an integer, prepend a zero (<tt class="docutils literal"><span class="pre">0</span></tt>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <tt class="docutils literal"><span class="pre">'0777'</span></tt> or <tt class="docutils literal"><span class="pre">'777'</span></tt>; for the same rights, plus the sticky bit, use <tt class="docutils literal"><span class="pre">01777</span></tt> or <tt class="docutils literal"><span class="pre">'1777'</span></tt>.</p>
<p class="last">Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. Values up to <tt class="docutils literal"><span class="pre">'0777'</span></tt> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <tt class="docutils literal"><span class="pre">4</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">2</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, and <tt class="docutils literal"><span class="pre">1</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>. This property cannot be used to set <tt class="docutils literal"><span class="pre">:full_control</span></tt>. This property has no effect if not specified, but when it and <tt class="docutils literal"><span class="pre">rights</span></tt> are both specified, the effects are cumulative.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">owner</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">A string or ID that identifies the group owner by user name, including fully qualified user names such as <tt class="docutils literal"><span class="pre">domain\user</span></tt> or <tt class="docutils literal"><span class="pre">user&#64;domain</span></tt>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p>The path to the destination at which a file is to be created. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block For example: <tt class="docutils literal"><span class="pre">file.txt</span></tt>.</p>
<p class="last">Microsoft Windows: A path that begins with a forward slash (<tt class="docutils literal"><span class="pre">/</span></tt>) will point to the root of the current working directory of the chef-client process. This path can vary from system to system. Therefore, using a path that begins with a forward slash (<tt class="docutils literal"><span class="pre">/</span></tt>) is not recommended.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">rights</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">Microsoft Windows only. The permissions for users and groups in a Microsoft Windows environment. For example: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">&lt;permissions&gt;,</span> <span class="pre">&lt;principal&gt;,</span> <span class="pre">&lt;options&gt;</span></tt> where <tt class="docutils literal"><span class="pre">&lt;permissions&gt;</span></tt> specifies the rights granted to the principal, <tt class="docutils literal"><span class="pre">&lt;principal&gt;</span></tt> is the group or user name, and <tt class="docutils literal"><span class="pre">&lt;options&gt;</span></tt> is a Hash with one (or more) advanced rights options.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the file in <tt class="docutils literal"><span class="pre">COOKBOOK_NAME/files/default</span></tt> or the path to a file located in <tt class="docutils literal"><span class="pre">COOKBOOK_NAME/files</span></tt>. The path must include the file name and its extension. Can be used to distribute specific files to specific platforms. See &#8220;File Specificity&#8221; below for more information. See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">verify</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Block</p>
<p>A block or a string that returns <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. A string, when <tt class="docutils literal"><span class="pre">true</span></tt> is executed as a system command.</p>
<p>A block is arbitrary Ruby defined within the resource block by using the <tt class="docutils literal"><span class="pre">verify</span></tt> property. When a block is <tt class="docutils literal"><span class="pre">true</span></tt>, the chef-client will continue to update the file as appropriate.</p>
<p>For example, this should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;/tmp/baz&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="p">{</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;/etc/nginx.conf&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="s1">&#39;nginx -t -c %{path}&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>For releases of the chef-client prior to 12.5 (chef-client 12.4 and earlier) the correct syntax is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;/etc/nginx.conf&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="s1">&#39;nginx -t -c %{file}&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p class="last">See GitHub issues <a class="reference external" href="https://github.com/chef/chef/issues/3232">https://github.com/chef/chef/issues/3232</a> and <a class="reference external" href="https://github.com/chef/chef/pull/3693">https://github.com/chef/chef/pull/3693</a> for more information about these differences.</p>
</div>
<p>This should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;/tmp/bar&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="p">{</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>And this should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;/tmp/foo&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
    <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Whereas, this should return <tt class="docutils literal"><span class="pre">false</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;/tmp/turtle&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="s1">&#39;/usr/bin/false&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p class="last">If a string or a block return <tt class="docutils literal"><span class="pre">false</span></tt>, the chef-client run will stop and an error is returned.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use the <tt class="docutils literal"><span class="pre">owner</span></tt> and <tt class="docutils literal"><span class="pre">right</span></tt> properties and avoid the <tt class="docutils literal"><span class="pre">group</span></tt> and <tt class="docutils literal"><span class="pre">mode</span></tt> properties whenever possible. The <tt class="docutils literal"><span class="pre">group</span></tt> and <tt class="docutils literal"><span class="pre">mode</span></tt> properties are not true Microsoft Windows concepts and are provided more for backward compatibility than for best practice.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">For a machine on which SELinux is enabled, the chef-client will create files that correctly match the default policy settings only when the cookbook that defines the action also conforms to the same policy.</p>
</div>
<div class="section" id="id60">
<h4>Atomic File Updates<a class="headerlink" href="#id60" title="Permalink to this headline">¶</a></h4>
<p>Atomic updates are used with <strong>file</strong>-based resources to help ensure that file updates can be made when updating a binary or if disk space runs out.</p>
<p>Atomic updates are enabled by default. They can be managed globally using the <tt class="docutils literal"><span class="pre">file_atomic_update</span></tt> setting in the client.rb file. They can be managed on a per-resource basis using the <tt class="docutils literal"><span class="pre">atomic_update</span></tt> property that is available with the <strong>cookbook_file</strong>, <strong>file</strong>, <strong>remote_file</strong>, and <strong>template</strong> resources.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On certain platforms, and after a file has been moved into place, the chef-client may modify file permissions to support features specific to those platforms. On platforms with SELinux enabled, the chef-client will fix up the security contexts after a file has been moved into the correct location by running the <tt class="docutils literal"><span class="pre">restorecon</span></tt> command. On the Microsoft Windows platform, the chef-client will create files so that ACL inheritance works as expected.</p>
</div>
</div>
<div class="section" id="id61">
<h4>Windows File Security<a class="headerlink" href="#id61" title="Permalink to this headline">¶</a></h4>
<p>To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes.</p>
<p><strong>Access Control Lists (ACLs)</strong></p>
<p>The <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used as many times as necessary; the chef-client will apply them to the file or directory as required. The syntax for the <tt class="docutils literal"><span class="pre">rights</span></tt> property is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="n">permission</span><span class="p">,</span> <span class="n">principal</span><span class="p">,</span> <span class="n">option_type</span> <span class="o">=&gt;</span> <span class="n">value</span>
</pre></div>
</div>
<p>where</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">permission</span></tt></dt>
<dd><p class="first">Use to specify which rights are granted to the <tt class="docutils literal"><span class="pre">principal</span></tt>. The possible values are: <tt class="docutils literal"><span class="pre">:read</span></tt>, <tt class="docutils literal"><span class="pre">:write</span></tt>, <tt class="docutils literal"><span class="pre">read_execute</span></tt>, <tt class="docutils literal"><span class="pre">:modify</span></tt>, and <tt class="docutils literal"><span class="pre">:full_control</span></tt>.</p>
<p>These permissions are cumulative. If <tt class="docutils literal"><span class="pre">:write</span></tt> is specified, then it includes <tt class="docutils literal"><span class="pre">:read</span></tt>. If <tt class="docutils literal"><span class="pre">:full_control</span></tt> is specified, then it includes both <tt class="docutils literal"><span class="pre">:write</span></tt> and <tt class="docutils literal"><span class="pre">:read</span></tt>.</p>
<p class="last">(For those who know the Microsoft Windows API: <tt class="docutils literal"><span class="pre">:read</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>; <tt class="docutils literal"><span class="pre">:write</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>; <tt class="docutils literal"><span class="pre">:read_execute</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt> and <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>; <tt class="docutils literal"><span class="pre">:modify</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>, and <tt class="docutils literal"><span class="pre">DELETE</span></tt>; <tt class="docutils literal"><span class="pre">:full_control</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_ALL</span></tt>, which allows a user to change the owner and other metadata about a file.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">principal</span></tt></dt>
<dd>Use to specify a group or user name. This is identical to what is entered in the login box for Microsoft Windows, such as <tt class="docutils literal"><span class="pre">user_name</span></tt>, <tt class="docutils literal"><span class="pre">domain\user_name</span></tt>, or <tt class="docutils literal"><span class="pre">user_name&#64;fully_qualified_domain_name</span></tt>. The chef-client does not need to know if a principal is a user or a group.</dd>
<dt><tt class="docutils literal"><span class="pre">option_type</span></tt></dt>
<dd><p class="first">A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">:write,</span> <span class="pre">'domain\group_name',</span> <span class="pre">:one_level_deep</span> <span class="pre">=&gt;</span> <span class="pre">true</span></tt>. Possible option types:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:applies_to_children</span></tt></td>
<td>Specify how permissions are applied to children. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to inherit both child directories and files;  <tt class="docutils literal"><span class="pre">false</span></tt> to not inherit any child directories or files; <tt class="docutils literal"><span class="pre">:containers_only</span></tt> to inherit only child directories (and not files); <tt class="docutils literal"><span class="pre">:objects_only</span></tt> to recursively inherit files (and not child directories).</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:applies_to_self</span></tt></td>
<td>Indicates whether a permission is applied to the parent directory. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply to the parent directory or file and its children; <tt class="docutils literal"><span class="pre">false</span></tt> to not apply only to child directories and files.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:one_level_deep</span></tt></td>
<td>Indicates the depth to which permissions will be applied. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply only to the first level of children; <tt class="docutils literal"><span class="pre">false</span></tt> to apply to all children.</td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Administrators&#39;</span><span class="p">,</span><span class="s1">&#39;Everyone&#39;</span><span class="o">]</span>
<span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;Users&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;Sally&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="ss">:containers_only</span><span class="p">,</span> <span class="ss">:applies_to_self</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:one_level_deep</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</pre></div>
</div>
<p>Some other important things to know when using the <tt class="docutils literal"><span class="pre">rights</span></tt> attribute:</p>
<ul class="simple">
<li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li>
<li>If rights are not specified, nothing will be changed. The chef-client does not clear out the rights on a file or directory if rights are not specified.</li>
<li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li>
</ul>
<p>Use the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> property to deny specific rights to specific users. The ordering is independent of using the <tt class="docutils literal"><span class="pre">rights</span></tt> property. For example, it doesn&#8217;t matter if rights are granted to everyone is placed before or after <tt class="docutils literal"><span class="pre">deny_rights</span> <span class="pre">:read,</span> <span class="pre">['Julian',</span> <span class="pre">'Lewis']</span></tt>, both Julian and Lewis will be unable to read the document. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Julian&#39;</span><span class="p">,</span> <span class="s1">&#39;Lewis&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deny_rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Sally&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p><strong>Inheritance</strong></p>
<p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <tt class="docutils literal"><span class="pre">inherits</span></tt> property can be used to specifically tell the chef-client to apply (or not apply) inherited rights from its parent directory.</p>
<p>For example, the following example specifies the rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">inherits</span> <span class="kp">false</span> <span class="c1"># Sauron is the only person who should have any sort of access</span>
<span class="k">end</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> permission were to be used instead, something could slip through unless all users and groups were denied.</p>
<p>Another example also shows how to specify rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;SHIRE\Frodo&#39;</span> <span class="c1"># Who put that there I didn&#39;t put that there</span>
<span class="k">end</span>
</pre></div>
</div>
<p>but then not use the <tt class="docutils literal"><span class="pre">inherits</span></tt> property to deny those rights on a child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span> <span class="c1"># Oops, not specific enough</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Because the <tt class="docutils literal"><span class="pre">inherits</span></tt> property is not specified, the chef-client will default it to <tt class="docutils literal"><span class="pre">true</span></tt>, which will ensure that security settings for existing files remain unchanged.</p>
</div>
</div>
<div class="section" id="file-specificity">
<h3>File Specificity<a class="headerlink" href="#file-specificity" title="Permalink to this headline">¶</a></h3>
<p>A cookbook is frequently designed to work across many platforms and is often required to distribute a specific file to a specific platform. A cookbook can be designed to support the distribution of files across platforms, while ensuring that the correct file ends up on each system.</p>
<p>The pattern for file specificity depends on two things: the lookup path and the source attribute. The first pattern that matches is used:</p>
<ol class="arabic simple">
<li>/host-$fqdn/$source</li>
<li>/$platform-$platform_version/$source</li>
<li>/$platform/$source</li>
<li>/default/$source</li>
<li>/$source</li>
</ol>
<p>Use an array with the <tt class="docutils literal"><span class="pre">source</span></tt> attribute to define an explicit lookup path. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/conf.py&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="o">[</span><span class="s1">&#39;#{node.chef_environment}.py&#39;</span><span class="p">,</span> <span class="s1">&#39;conf.py&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example emulates the entire file specificity pattern by defining it as an explicit path:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/conf.py&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="sx">%W{</span>
<span class="sx">    host-</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;fqdn&#39;</span><span class="o">]</span><span class="si">}</span><span class="sx">/conf.py</span>
<span class="sx">    </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span><span class="si">}</span><span class="sx">-</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform_version&#39;</span><span class="o">]</span><span class="si">}</span><span class="sx">/conf.py</span>
<span class="sx">    </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span><span class="si">}</span><span class="sx">/conf.py</span>
<span class="sx">    default/conf.py</span>
<span class="sx">  }</span>
<span class="k">end</span>
</pre></div>
</div>
<p>A cookbook may have a <tt class="docutils literal"><span class="pre">/files</span></tt> directory structure like this:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>files/
   host-foo.example.com
   ubuntu-10.04
   ubuntu-10
   ubuntu
   redhat-5.8
   redhat-6.4
   ...
   default
</pre></div>
</div>
<p>and a resource that looks something like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;/usr/local/bin/apache2_module_conf_generate.pl&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;apache2_module_conf_generate.pl&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This resource is matched in the same order as the <tt class="docutils literal"><span class="pre">/files</span></tt> directory structure. For a node that is running Ubuntu 10.04, the second item would be the matching item and the location to which the file identified in the <strong>cookbook_file</strong> resource would be distributed:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">host</span><span class="o">-</span><span class="n">foo</span><span class="o">.</span><span class="n">example</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">apache2_module_conf_generate</span><span class="o">.</span><span class="n">pl</span>
<span class="n">ubuntu</span><span class="o">-</span><span class="mi">10</span><span class="o">.</span><span class="mo">04</span><span class="o">/</span><span class="n">apache2_module_conf_generate</span><span class="o">.</span><span class="n">pl</span>
<span class="n">ubuntu</span><span class="o">-</span><span class="mi">10</span><span class="o">/</span><span class="n">apache2_module_conf_generate</span><span class="o">.</span><span class="n">pl</span>
<span class="n">ubuntu</span><span class="o">/</span><span class="n">apache2_module_conf_generate</span><span class="o">.</span><span class="n">pl</span>
<span class="n">default</span><span class="o">/</span><span class="n">apache2_module_conf_generate</span><span class="o">.</span><span class="n">pl</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">apache2_module_conf_generate.pl</span></tt> file was located in the cookbook directory under <tt class="docutils literal"><span class="pre">files/host-foo.example.com/</span></tt>, the specified file(s) would only be copied to the machine with the domain name foo.example.com.</p>
<p><strong>Host Notation</strong></p>
<p>The naming of folders within cookbook directories must literally match the host notation used for file specificity matching. For example, if a host is named <tt class="docutils literal"><span class="pre">foo.example.com</span></tt>, the folder must be named <tt class="docutils literal"><span class="pre">host-foo.example.com</span></tt>.</p>
</div>
<div class="section" id="id62">
<h3>Examples<a class="headerlink" href="#id62" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Transfer a file</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;file.txt&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Handle cookbook_file and yum_package resources in the same recipe</strong></p>
<p>When a <strong>cookbook_file</strong> resource and a <strong>yum_package</strong> resource are both called from within the same recipe, use the <tt class="docutils literal"><span class="pre">flush_cache</span></tt> attribute to dump the in-memory Yum cache, and then use the repository immediately to ensure that the correct package is installed:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;/etc/yum.repos.d/custom.repo&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;custom&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">yum_package</span> <span class="s1">&#39;only-in-custom-repo&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">flush_cache</span> <span class="o">[</span> <span class="ss">:before</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install repositories from a file, trigger a command, and force the internal cache to reload</strong></p>
<p>The following example shows how to install new Yum repositories from a file, where the installation of the repository triggers a creation of the Yum cache that forces the internal cache for the chef-client to reload:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;create-yum-cache&#39;</span> <span class="k">do</span>
 <span class="n">command</span> <span class="s1">&#39;yum -q makecache&#39;</span>
 <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;reload-internal-yum-cache&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Yum</span><span class="o">::</span><span class="no">YumCache</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">reload</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">cookbook_file</span> <span class="s1">&#39;/etc/yum.repos.d/custom.repo&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;custom&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[create-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload-internal-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a case statement</strong></p>
<p>The following example shows how a case statement can be used to handle a situation where an application needs to be installed on multiple platforms, but where the install directories are different paths, depending on the platform:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;application.pm&#39;</span> <span class="k">do</span>
  <span class="n">path</span> <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span>
    <span class="k">when</span> <span class="s1">&#39;centos&#39;</span><span class="p">,</span><span class="s1">&#39;redhat&#39;</span>
      <span class="s1">&#39;/usr/lib/version/1.2.3/dir/application.pm&#39;</span>
    <span class="k">when</span> <span class="s1">&#39;arch&#39;</span>
      <span class="s1">&#39;/usr/share/version/core_version/dir/application.pm&#39;</span>
    <span class="k">else</span>
      <span class="s1">&#39;/etc/version/dir/application.pm&#39;</span>
    <span class="k">end</span>
  <span class="n">source</span> <span class="s2">&quot;application-</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;languages&#39;</span><span class="o">][</span><span class="s1">&#39;perl&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">.pm&quot;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Manage dotfiles</strong></p>
<p>The following example shows using the <strong>directory</strong> and <strong>cookbook_file</strong> resources to manage dotfiles. The dotfiles are defined by a JSON data structure similar to:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="s2">&quot;files&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;.zshrc&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;mode&quot;</span><span class="o">:</span> <span class="s1">&#39;0755&#39;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;dot-zshrc&quot;</span>
    <span class="p">},</span>
  <span class="s2">&quot;.bashrc&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;mode&quot;</span><span class="o">:</span> <span class="s1">&#39;0755&#39;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;dot-bashrc&quot;</span>
     <span class="p">},</span>
  <span class="s2">&quot;.bash_profile&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;mode&quot;</span><span class="o">:</span> <span class="s1">&#39;0755&#39;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;dot-bash_profile&quot;</span>
    <span class="p">},</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>and then the following resources manage the dotfiles:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">has_key?</span><span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">)</span>
  <span class="n">u</span><span class="o">[</span><span class="s1">&#39;files&#39;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">filename</span><span class="p">,</span> <span class="n">file_data</span><span class="o">|</span>

  <span class="n">directory</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">home_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">recursive</span> <span class="kp">true</span>
    <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="k">end</span> <span class="k">if</span> <span class="n">file_data</span><span class="o">[</span><span class="s1">&#39;subdir&#39;</span><span class="o">]</span>

  <span class="n">cookbook_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">home_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">file_data</span><span class="o">[</span><span class="s1">&#39;source&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">owner</span> <span class="s1">&#39;u[&#39;</span><span class="nb">id</span><span class="s1">&#39;]&#39;</span>
    <span class="n">group</span> <span class="s1">&#39;group_id&#39;</span>
    <span class="n">mode</span> <span class="s1">&#39;file_data[&#39;</span><span class="n">mode</span><span class="s1">&#39;]&#39;</span>
    <span class="n">ignore_failure</span> <span class="kp">true</span>
    <span class="n">backup</span> <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cron">
<h2>cron<a class="headerlink" href="#cron" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_cron.rst">[edit on GitHub]</a></p>
<p>Use the <strong>cron</strong> resource to manage cron entries for time-based job scheduling. Properties for a schedule will default to <tt class="docutils literal"><span class="pre">*</span></tt> if not provided. The <strong>cron</strong> resource requires access to a crontab program, typically cron.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>cron</strong> resource should only be used to modify an entry in a crontab file. Use the <strong>cookbook_file</strong> or <strong>template</strong> resources to add a crontab file to the cron.d directory. The <tt class="docutils literal"><span class="pre">cron_d</span></tt> lightweight resource (found in the <a class="reference external" href="https://github.com/chef-cookbooks/cron">cron</a> cookbook) is another option for managing crontab files.</p>
</div>
<div class="section" id="id63">
<h3>Syntax<a class="headerlink" href="#id63" title="Permalink to this headline">¶</a></h3>
<p>A <strong>cron</strong> resource block manage cron entries. For example, to get a weekly cookbook report from the Chef Supermarket:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cron</span> <span class="s1">&#39;cookbooks_report&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="n">node</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="s1">&#39;cookbooks-report&#39;</span><span class="p">)</span> <span class="p">?</span> <span class="ss">:create</span> <span class="p">:</span> <span class="ss">:delete</span>
  <span class="n">minute</span> <span class="s1">&#39;0&#39;</span>
  <span class="n">hour</span> <span class="s1">&#39;0&#39;</span>
  <span class="n">weekday</span> <span class="s1">&#39;1&#39;</span>
  <span class="n">user</span> <span class="s1">&#39;getchef&#39;</span>
  <span class="n">mailto</span> <span class="s1">&#39;sysadmin@example.com&#39;</span>
  <span class="n">home</span> <span class="s1">&#39;/srv/supermarket/shared/system&#39;</span>
  <span class="n">command</span> <span class="sx">%W{</span>
<span class="sx">    cd /srv/supermarket/current &amp;&amp;</span>
<span class="sx">    env RUBYLIB=&quot;/srv/supermarket/current/lib&quot;</span>
<span class="sx">    RAILS_ASSET_ID=`git rev-parse HEAD` RAILS_ENV=&quot;</span><span class="si">#{</span><span class="n">rails_env</span><span class="si">}</span><span class="sx">&quot;</span>
<span class="sx">    bundle exec rake cookbooks_report</span>
<span class="sx">  }</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>cron</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cron</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">command</span>                    <span class="nb">String</span>
  <span class="n">day</span>                        <span class="nb">String</span>
  <span class="n">environment</span>                <span class="no">Hash</span>
  <span class="n">home</span>                       <span class="nb">String</span>
  <span class="n">hour</span>                       <span class="nb">String</span>
  <span class="n">mailto</span>                     <span class="nb">String</span>
  <span class="n">minute</span>                     <span class="nb">String</span>
  <span class="n">month</span>                      <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">path</span>                       <span class="nb">String</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Cron</span>
  <span class="n">shell</span>                      <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">time</span>                       <span class="no">Symbol</span>
  <span class="n">user</span>                       <span class="nb">String</span>
  <span class="n">weekday</span>                    <span class="nb">String</span><span class="p">,</span> <span class="no">Symbol</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">cron</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">command</span></tt> is the command to be run</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">command</span></tt>, <tt class="docutils literal"><span class="pre">day</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">home</span></tt>, <tt class="docutils literal"><span class="pre">hour</span></tt>, <tt class="docutils literal"><span class="pre">mailto</span></tt>, <tt class="docutils literal"><span class="pre">minute</span></tt>, <tt class="docutils literal"><span class="pre">month</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">shell</span></tt>, <tt class="docutils literal"><span class="pre">time</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt>, and <tt class="docutils literal"><span class="pre">weekday</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id64">
<h3>Actions<a class="headerlink" href="#id64" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>Default. Create an entry in a cron table file (crontab). If an entry already exists (but does not match), update that entry to match.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Delete an entry from a cron table file (crontab).</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
</dl>
</div>
<div class="section" id="id65">
<h3>Properties<a class="headerlink" href="#id65" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p>The command to be run, or the path to a file that contains the command to be run.</p>
<p>Some examples:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>command if [ -x /usr/share/mdadm/checkarray ] &amp;&amp; [ $(date +\%d) -le 7 ];
then /usr/share/mdadm/checkarray --cron --all --idle --quiet; fi
</pre></div>
</div>
<p>and:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">command</span> <span class="sx">%w{</span>
<span class="sx">  cd /srv/opscode-community-site/current &amp;&amp;</span>
<span class="sx">  env RUBYLIB=&quot;/srv/opscode-community-site/current/lib&quot;</span>
<span class="sx">  RAILS_ASSET_ID=`git rev-parse HEAD` RAILS_ENV=&quot;#{rails_env}&quot;</span>
<span class="sx">  bundle exec rake cookbooks_report</span>
<span class="sx">}</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>and:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">command</span> <span class="s2">&quot;/srv/app/scripts/daily_report&quot;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">day</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The day of month at which the cron entry should run (1 - 31). Default value: <tt class="docutils literal"><span class="pre">*</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">environment</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A Hash of environment variables in the form of <tt class="docutils literal"><span class="pre">({&quot;ENV_VARIABLE&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;VALUE&quot;})</span></tt>. (These variables must exist for a command to be run successfully.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">home</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Set the <tt class="docutils literal"><span class="pre">HOME</span></tt> environment variable.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">hour</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The hour at which the cron entry is to run (0 - 23). Default value: <tt class="docutils literal"><span class="pre">*</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">mailto</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Set the <tt class="docutils literal"><span class="pre">MAILTO</span></tt> environment variable.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">minute</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The minute at which the cron entry should run (0 - 59). Default value: <tt class="docutils literal"><span class="pre">*</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">month</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The month in the year on which a cron entry is to run (1 - 12). Default value: <tt class="docutils literal"><span class="pre">*</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Set the <tt class="docutils literal"><span class="pre">PATH</span></tt> environment variable.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">shell</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Set the <tt class="docutils literal"><span class="pre">SHELL</span></tt> environment variable.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">time</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol</p>
<p class="last">A time interval. Possible values: <tt class="docutils literal"><span class="pre">:annually</span></tt>, <tt class="docutils literal"><span class="pre">:daily</span></tt>, <tt class="docutils literal"><span class="pre">:hourly</span></tt>, <tt class="docutils literal"><span class="pre">:midnight</span></tt>, <tt class="docutils literal"><span class="pre">:monthly</span></tt>, <tt class="docutils literal"><span class="pre">:reboot</span></tt>, <tt class="docutils literal"><span class="pre">:weekly</span></tt>, or <tt class="docutils literal"><span class="pre">:yearly</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">This attribute is not applicable on the AIX platform. The name of the user that runs the command. If the <tt class="docutils literal"><span class="pre">user</span></tt> property is changed, the original <tt class="docutils literal"><span class="pre">user</span></tt> for the crontab program continues to run until that crontab program is deleted. Default value: <tt class="docutils literal"><span class="pre">root</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">weekday</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The day of the week on which this entry is to run (0 - 6), where Sunday = 0. Default value: <tt class="docutils literal"><span class="pre">*</span></tt>.</p>
</dd>
</dl>
</div>
<div class="section" id="id66">
<h3>Examples<a class="headerlink" href="#id66" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Run a program at a specified interval</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cron</span> <span class="s1">&#39;noop&#39;</span> <span class="k">do</span>
  <span class="n">hour</span> <span class="s1">&#39;5&#39;</span>
  <span class="n">minute</span> <span class="s1">&#39;0&#39;</span>
  <span class="n">command</span> <span class="s1">&#39;/bin/true&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run an entry if a folder exists</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cron</span> <span class="s1">&#39;ganglia_tomcat_thread_max&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s2">&quot;/usr/bin/gmetric</span>
<span class="s2">    -n &#39;tomcat threads max&#39;</span>
<span class="s2">    -t uint32</span>
<span class="s2">    -v &#39;/usr/local/bin/tomcat-stat</span>
<span class="s2">    --thread-max&#39;&quot;</span>
  <span class="n">only_if</span> <span class="k">do</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/home/jboss&#39;</span><span class="p">)</span> <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run every Saturday, 8:00 AM</strong></p>
<p>The following example shows a schedule that will run every hour at 8:00 each Saturday morning, and will then send an email to &#8220;<a class="reference external" href="mailto:admin&#37;&#52;&#48;example&#46;com">admin<span>&#64;</span>example<span>&#46;</span>com</a>&#8221; after each run.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cron</span> <span class="s1">&#39;name_of_cron_entry&#39;</span> <span class="k">do</span>
  <span class="n">minute</span> <span class="s1">&#39;0&#39;</span>
  <span class="n">hour</span> <span class="s1">&#39;8&#39;</span>
  <span class="n">weekday</span> <span class="s1">&#39;6&#39;</span>
  <span class="n">mailto</span> <span class="s1">&#39;admin@example.com&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run only in November</strong></p>
<p>The following example shows a schedule that will run at 8:00 PM, every weekday (Monday through Friday), but only in November:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cron</span> <span class="s1">&#39;name_of_cron_entry&#39;</span> <span class="k">do</span>
  <span class="n">minute</span> <span class="s1">&#39;0&#39;</span>
  <span class="n">hour</span> <span class="s1">&#39;20&#39;</span>
  <span class="n">day</span> <span class="s1">&#39;*&#39;</span>
  <span class="n">month</span> <span class="s1">&#39;11&#39;</span>
  <span class="n">weekday</span> <span class="s1">&#39;1-5&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="csh">
<h2>csh<a class="headerlink" href="#csh" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_csh.rst">[edit on GitHub]</a></p>
<p>Use the <strong>csh</strong> resource to execute scripts using the csh interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>csh</strong> script resource (which is based on the <strong>script</strong> resource) is different from the <strong>ruby_block</strong> resource because Ruby code that is run with this resource is created as a temporary file and executed like other script resources, rather than run inline.</p>
</div>
<div class="section" id="id67">
<h3>Syntax<a class="headerlink" href="#id67" title="Permalink to this headline">¶</a></h3>
<p>A <strong>csh</strong> resource block executes scripts using csh:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">csh</span> <span class="s1">&#39;hello world&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    echo &quot;Hello world!&quot;</span>
<span class="sh">    echo &quot;Current directory: &quot; $cwd</span>
<span class="no">    EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">code</span></tt> specifies the command to run</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>csh</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">csh</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">code</span>                       <span class="nb">String</span>
  <span class="n">creates</span>                    <span class="nb">String</span>
  <span class="n">cwd</span>                        <span class="nb">String</span>
  <span class="n">environment</span>                <span class="no">Hash</span>
  <span class="n">flags</span>                      <span class="nb">String</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">path</span>                       <span class="nb">Array</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Script</span><span class="o">::</span><span class="no">Csh</span>
  <span class="n">returns</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Float</span>
  <span class="n">user</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">umask</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :run if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">csh</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">code</span></tt>, <tt class="docutils literal"><span class="pre">creates</span></tt>, <tt class="docutils literal"><span class="pre">cwd</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">flags</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">returns</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt>, and <tt class="docutils literal"><span class="pre">umask</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id68">
<h3>Actions<a class="headerlink" href="#id68" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Prevent a command from running. This action is used to specify that a command is run only when another resource notifies it.</dd>
<dt><tt class="docutils literal"><span class="pre">:run</span></tt></dt>
<dd>Default. Run a script.</dd>
</dl>
</div>
<div class="section" id="id69">
<h3>Properties<a class="headerlink" href="#id69" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">code</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A quoted (&#8221; &#8221;) string of code to be executed.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">creates</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Prevent a command from creating a file when that file already exists.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">cwd</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The current working directory.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">environment</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A Hash of environment variables in the form of <tt class="docutils literal"><span class="pre">({&quot;ENV_VARIABLE&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;VALUE&quot;})</span></tt>. (These variables must exist for a command to be run successfully.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">flags</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One or more command line flags that are passed to the interpreter when a command is invoked.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The group name or group ID that must be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p>An array of paths to use when searching for a command. These paths are not added to the command&#8217;s environment $PATH. The default value uses the system path.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p>For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">csh</span> <span class="s1">&#39;mycommand&#39;</span> <span class="k">do</span>
  <span class="n">environment</span> <span class="s1">&#39;PATH&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/my/path/to/bin:</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PATH&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">returns</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Array</p>
<p class="last">The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Float</p>
<p class="last">The amount of time (in seconds) a command is to wait before timing out. Default value: <tt class="docutils literal"><span class="pre">3600</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The user name or user ID that should be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">umask</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The file mode creation mask, or umask.</p>
</dd>
</dl>
<div class="section" id="id70">
<h4>Guards<a class="headerlink" href="#id70" title="Permalink to this headline">¶</a></h4>
<p>A guard property can be used to evaluate the state of a node during the execution phase of the chef-client run. Based on the results of this evaluation, a guard property is then used to tell the chef-client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p>
<ul class="simple">
<li>A string is executed as a shell command. If the command returns <tt class="docutils literal"><span class="pre">0</span></tt>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <tt class="docutils literal"><span class="pre">true</span></tt> in addition to <tt class="docutils literal"><span class="pre">0</span></tt>.</li>
<li>A block is executed as Ruby code that must return either <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. If the block returns <tt class="docutils literal"><span class="pre">true</span></tt>, the guard property is applied. If the block returns <tt class="docutils literal"><span class="pre">false</span></tt>, the guard property is not applied.</li>
</ul>
<p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for the chef-client to do nothing.</p>
<p><strong>Attributes</strong></p>
<p>The following properties can be used to define a guard that is evaluated during the execution phase of the chef-client run:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">not_if</span></tt></dt>
<dd>Prevent a resource from executing when the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">only_if</span></tt></dt>
<dd>Allow a resource to execute only if the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
</dl>
<p><strong>Arguments</strong></p>
<p>The following arguments can be used with the <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:user</span></tt></dt>
<dd><p class="first">Specify the user that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:group</span></tt></dt>
<dd><p class="first">Specify the group that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:environment</span></tt></dt>
<dd><p class="first">Specify a Hash of environment variables to be set. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/adam&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:cwd</span></tt></dt>
<dd><p class="first">Set the current working directory before running a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam passwd&#39;</span><span class="p">,</span> <span class="ss">:cwd</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:timeout</span></tt></dt>
<dd><p class="first">Set a timeout for a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;sleep 10000&#39;</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="id71">
<h3>Providers<a class="headerlink" href="#id71" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script</span></tt>, <tt class="docutils literal"><span class="pre">script</span></tt></dt>
<dd>When this short name is used, the chef-client will determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script::Csh</span></tt>, <tt class="docutils literal"><span class="pre">csh</span></tt></dt>
<dd>The provider for the csh command interpreter.</dd>
</dl>
</div>
<div class="section" id="id72">
<h3>Examples<a class="headerlink" href="#id72" title="Permalink to this headline">¶</a></h3>
<p>None.</p>
</div>
</div>
<div class="section" id="deploy">
<h2>deploy<a class="headerlink" href="#deploy" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_deploy.rst">[edit on GitHub]</a></p>
<p>Use the <strong>deploy</strong> resource to manage and control deployments. This is a popular resource, but is also complex, having the most properties, multiple providers, the added complexity of callbacks, plus four attributes that support layout modifications from within a recipe.</p>
<p>The <strong>deploy</strong> resource is modeled after Capistrano, a utility and framework for executing commands in parallel on multiple remote machines via SSH. The <strong>deploy</strong> resource is designed to behave in a way that is similar to the <tt class="docutils literal"><span class="pre">deploy</span></tt> and <tt class="docutils literal"><span class="pre">deploy:migration</span></tt> tasks in Capistrano.</p>
<div class="section" id="id73">
<h3>Syntax<a class="headerlink" href="#id73" title="Permalink to this headline">¶</a></h3>
<p>A <strong>deploy</strong> resource block manages and controls deployments:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;private_repo&#39;</span> <span class="k">do</span>
  <span class="n">repo</span> <span class="s1">&#39;git@github.com:acctname/private-repo.git&#39;</span>
  <span class="n">user</span> <span class="s1">&#39;ubuntu&#39;</span>
  <span class="n">deploy_to</span> <span class="s1">&#39;/tmp/private_code&#39;</span>
  <span class="n">ssh_wrapper</span> <span class="s1">&#39;/tmp/private_code/wrap-ssh4git.sh&#39;</span>
  <span class="n">action</span> <span class="ss">:deploy</span>
<span class="k">end</span>
</pre></div>
</div>
<p>For example, an application that is deployed to a folder named <tt class="docutils literal"><span class="pre">&quot;/path/to/application&quot;</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy_revision</span> <span class="s1">&#39;/path/to/application&#39;</span> <span class="k">do</span>
  <span class="n">repo</span> <span class="s1">&#39;ssh://name-of-git-repo/repos/repo.git&#39;</span>
  <span class="n">migrate</span> <span class="kp">false</span>
  <span class="n">purge_before_symlink</span> <span class="sx">%w{one two folder/three}</span>
  <span class="n">create_dirs_before_symlink</span> <span class="o">[]</span>
  <span class="n">symlinks</span><span class="p">{</span>
    <span class="s2">&quot;one&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;one&quot;</span><span class="p">,</span>
    <span class="s2">&quot;two&quot;</span>   <span class="o">=&gt;</span> <span class="s2">&quot;two&quot;</span><span class="p">,</span>
    <span class="s2">&quot;three&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;folder/three&quot;</span>
  <span class="p">}</span>
  <span class="n">before_restart</span> <span class="k">do</span>
    <span class="c1"># some Ruby code</span>
  <span class="k">end</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[foo]&#39;</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[bar]&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>For the example shown above:</p>
<ul class="simple">
<li>Because an action is not explicitly specified, the chef-client will use the default action: <tt class="docutils literal"><span class="pre">:deploy</span></tt></li>
<li>The <tt class="docutils literal"><span class="pre">purge_before_symlink</span></tt> application layout is an array of paths that will be cleared before the <tt class="docutils literal"><span class="pre">symlinks</span></tt> property is run</li>
<li>The <tt class="docutils literal"><span class="pre">create_dirs_before_symlink</span></tt> property is empty, which is different from the default</li>
<li>The <tt class="docutils literal"><span class="pre">symlinks</span></tt> property is creating three symbolic links</li>
<li>The <tt class="docutils literal"><span class="pre">before_restart</span></tt> callback is being used to add custom actions that will occur at the end of the deployment process, but before any services have been notified</li>
<li>At the end, the recipe is using the <tt class="docutils literal"><span class="pre">notifies</span></tt> property&#8212;a common attribute available to all resources&#8212;to alert two services (named &#8220;foo&#8221; and &#8220;bar&#8221;) that they should restart.</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>deploy</strong> when used with git is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">after_restart</span>              <span class="no">Proc</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">before_migrate</span>             <span class="no">Proc</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">before_restart</span>             <span class="no">Proc</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">before_symlink</span>             <span class="no">Proc</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">branch</span>                     <span class="nb">String</span>
  <span class="n">create_dirs_before_symlink</span> <span class="nb">Array</span>
  <span class="n">deploy_to</span>                  <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">depth</span>                      <span class="nb">Integer</span>
  <span class="n">enable_submodules</span>          <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">environment</span>                <span class="no">Hash</span>
  <span class="n">git_ssh_wrapper</span>            <span class="nb">String</span>
  <span class="n">group</span>                      <span class="nb">String</span>
  <span class="n">keep_releases</span>              <span class="nb">Integer</span>
  <span class="n">migrate</span>                    <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">migration_command</span>          <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Deploy</span>
  <span class="n">purge_before_symlink</span>       <span class="nb">Array</span>
  <span class="n">remote</span>                     <span class="nb">String</span>
  <span class="n">repo</span>                       <span class="nb">String</span>
  <span class="n">repository</span>                 <span class="nb">String</span>
  <span class="n">repository_cache</span>           <span class="nb">String</span>
  <span class="n">restart_command</span>            <span class="no">Proc</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">revision</span>                   <span class="nb">String</span>
  <span class="n">rollback_on_error</span>          <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">scm_provider</span>               <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Git</span>
  <span class="n">shallow_clone</span>              <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">ssh_wrapper</span>                <span class="nb">String</span>
  <span class="n">symlinks</span>                   <span class="no">Hash</span>
  <span class="n">symlink_before_migrate</span>     <span class="no">Hash</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span>
  <span class="n">user</span>                       <span class="nb">String</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and the full syntax for all of the properties that are available to the <strong>deploy</strong> when used with Subversion is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">after_restart</span>              <span class="no">Proc</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">before_migrate</span>             <span class="no">Proc</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">before_restart</span>             <span class="no">Proc</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">before_symlink</span>             <span class="no">Proc</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">branch</span>                     <span class="nb">String</span>
  <span class="n">create_dirs_before_symlink</span> <span class="nb">Array</span>
  <span class="n">deploy_to</span>                  <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">environment</span>                <span class="no">Hash</span>
  <span class="n">group</span>                      <span class="nb">String</span>
  <span class="n">keep_releases</span>              <span class="nb">Integer</span>
  <span class="n">migrate</span>                    <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">migration_command</span>          <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Deploy</span>
  <span class="n">purge_before_symlink</span>       <span class="nb">Array</span>
  <span class="n">repo</span>                       <span class="nb">String</span>
  <span class="n">repository</span>                 <span class="nb">String</span>
  <span class="n">repository_cache</span>           <span class="nb">String</span>
  <span class="n">restart_command</span>            <span class="no">Proc</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">revision</span>                   <span class="nb">String</span>
  <span class="n">rollback_on_error</span>          <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">scm_provider</span>               <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Subversion</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">svn_arguments</span>              <span class="nb">String</span>
  <span class="n">svn_password</span>               <span class="nb">String</span>
  <span class="n">svn_username</span>               <span class="nb">String</span>
  <span class="n">symlinks</span>                   <span class="no">Hash</span>
  <span class="n">symlink_before_migrate</span>     <span class="no">Hash</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span>
  <span class="n">user</span>                       <span class="nb">String</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">deploy</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">after_restart</span></tt>, <tt class="docutils literal"><span class="pre">before_migrate</span></tt>, <tt class="docutils literal"><span class="pre">before_restart</span></tt>, <tt class="docutils literal"><span class="pre">before_symlink</span></tt>, <tt class="docutils literal"><span class="pre">branch</span></tt>, <tt class="docutils literal"><span class="pre">create_dirs_before_symlink</span></tt>, <tt class="docutils literal"><span class="pre">deploy_to</span></tt>, <tt class="docutils literal"><span class="pre">depth</span></tt>, <tt class="docutils literal"><span class="pre">enable_submodules</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">git_ssh_wrapper</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">keep_releases</span></tt>, <tt class="docutils literal"><span class="pre">migrate</span></tt>, <tt class="docutils literal"><span class="pre">migration_command</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">purge_before_symlink</span></tt>, <tt class="docutils literal"><span class="pre">remote</span></tt>, <tt class="docutils literal"><span class="pre">repo</span></tt>, <tt class="docutils literal"><span class="pre">repository</span></tt>, <tt class="docutils literal"><span class="pre">repository_cache</span></tt>, <tt class="docutils literal"><span class="pre">restart_command</span></tt>, <tt class="docutils literal"><span class="pre">revision</span></tt>, <tt class="docutils literal"><span class="pre">rollback_on_error</span></tt>, <tt class="docutils literal"><span class="pre">scm_provider</span></tt>, <tt class="docutils literal"><span class="pre">shallow_clone</span></tt>, <tt class="docutils literal"><span class="pre">ssh_wrapper</span></tt>, <tt class="docutils literal"><span class="pre">svn_arguments</span></tt>, <tt class="docutils literal"><span class="pre">svn_password</span></tt>, <tt class="docutils literal"><span class="pre">svn_username</span></tt>, <tt class="docutils literal"><span class="pre">symlinks</span></tt>, <tt class="docutils literal"><span class="pre">symlink_before_migrate</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">user</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="deploy-strategies">
<h3>Deploy Strategies<a class="headerlink" href="#deploy-strategies" title="Permalink to this headline">¶</a></h3>
<p>In the <tt class="docutils literal"><span class="pre">deploy</span></tt> directory, a sub-directory named <tt class="docutils literal"><span class="pre">shared</span></tt> must be created. This sub-directory is where configuration and temporary files will be kept. A typical Ruby on Rails application will have <tt class="docutils literal"><span class="pre">config</span></tt>, <tt class="docutils literal"><span class="pre">log</span></tt>, <tt class="docutils literal"><span class="pre">pids</span></tt>, and <tt class="docutils literal"><span class="pre">system</span></tt> directories within the <tt class="docutils literal"><span class="pre">shared</span></tt> directory to keep the files stored there independent of the code in the source repository.</p>
<p>In addition to the <tt class="docutils literal"><span class="pre">shared</span></tt> sub-directory, the deploy process will create sub-directories named <tt class="docutils literal"><span class="pre">releases</span></tt> and <tt class="docutils literal"><span class="pre">current</span></tt> (also in the <tt class="docutils literal"><span class="pre">deploy</span></tt> directory). The <tt class="docutils literal"><span class="pre">release</span></tt> directory holds (up to) five most recently deployed versions of an application. The <tt class="docutils literal"><span class="pre">current</span></tt> directory holds the currently-released version.</p>
<p>For example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>deploy_directory/
  current/
  releases/
  shared/
    config/
    log/
    pids/
    system/
</pre></div>
</div>
<div class="section" id="deploy-phases">
<h4>Deploy Phases<a class="headerlink" href="#deploy-phases" title="Permalink to this headline">¶</a></h4>
<p>A deployment happens in four phases:</p>
<ol class="arabic simple">
<li><strong>Checkout</strong>&#8212;the chef-client uses the <strong>scm</strong> resource to get the specified application revision, placing a clone or checkout in the sub-directory of the <tt class="docutils literal"><span class="pre">deploy</span></tt> directory named <tt class="docutils literal"><span class="pre">cached-copy</span></tt>. A copy of the application is then placed in a sub-directory under <tt class="docutils literal"><span class="pre">releases</span></tt>.</li>
<li><strong>Migrate</strong>&#8212;If a migration is to be run, the chef-client symlinks the database configuration file into the checkout (<tt class="docutils literal"><span class="pre">config/database.yml</span></tt> by default) and runs the migration command. For a Ruby on Rails application, the <tt class="docutils literal"><span class="pre">migration_command</span></tt> is usually set to <tt class="docutils literal"><span class="pre">rake</span> <span class="pre">db:migrate</span></tt>.</li>
<li><strong>Symlink</strong>&#8212;Directories for shared and temporary files are removed from the checkout (<tt class="docutils literal"><span class="pre">log</span></tt>, <tt class="docutils literal"><span class="pre">tmp/pids</span></tt>, and <tt class="docutils literal"><span class="pre">public/system</span></tt> by default). After this step, any needed directories (<tt class="docutils literal"><span class="pre">tmp</span></tt>, <tt class="docutils literal"><span class="pre">public</span></tt>, and <tt class="docutils literal"><span class="pre">config</span></tt> by default) are created if they don&#8217;t already exist. This step is completed by symlinking shared directories into the current <tt class="docutils literal"><span class="pre">release</span></tt>, <tt class="docutils literal"><span class="pre">public/system</span></tt>, <tt class="docutils literal"><span class="pre">tmp/pids</span></tt>, and <tt class="docutils literal"><span class="pre">log</span></tt> directories, and then symlinking the <tt class="docutils literal"><span class="pre">release</span></tt> directory to <tt class="docutils literal"><span class="pre">current</span></tt>.</li>
<li><strong>Restart</strong>&#8212;The application is restarted according to the restart command set in the recipe.</li>
</ol>
<div class="section" id="deploy-cache-file">
<h5>Deploy Cache File<a class="headerlink" href="#deploy-cache-file" title="Permalink to this headline">¶</a></h5>
<p>The chef-client uses a cache file to keep track of the order in which each revision of an application is deployed. By default, the cache file is located at <tt class="docutils literal"><span class="pre">/var/chef/cache/revision-deploys/APPNAME/</span></tt>. To force a re-deploy, delete the deployment directory or delete the cache file.</p>
</div>
</div>
<div class="section" id="callbacks">
<h4>Callbacks<a class="headerlink" href="#callbacks" title="Permalink to this headline">¶</a></h4>
<p>In-between each step in a deployment process, callbacks can be run using arbitrary Ruby code, including recipes. All callbacks support embedded recipes given in a block, but each callback assumes a shell command (instead of a deploy hook filename) when given a string.</p>
<p>The following callback types are available:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Callback</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">after_restart</span></tt></td>
<td>A block of code, or a path to a file that contains code, that is run after restarting. Default value: <tt class="docutils literal"><span class="pre">deploy/after_restart.rb</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">before_migrate</span></tt></td>
<td>A block of code, or a path to a file that contains code, that is run before a migration. Default value: <tt class="docutils literal"><span class="pre">deploy/before_migrate.rb</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">before_restart</span></tt></td>
<td>A block of code, or a path to a file that contains code, that is run before restarting. Default value: <tt class="docutils literal"><span class="pre">deploy/before_restart.rb</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">before_symlink</span></tt></td>
<td>A block of code, or a path to a file that contains code, that is run before symbolic linking. Default value: <tt class="docutils literal"><span class="pre">deploy/before_symlink.rb</span></tt>.</td>
</tr>
</tbody>
</table>
<p>Each of these callback types can be used in one of three ways:</p>
<ul class="simple">
<li>To pass a block of code, such as Ruby or Python</li>
<li>To specify a file</li>
<li>To do neither; the chef-client will look for a callback file named after one of the callback types (<tt class="docutils literal"><span class="pre">before_migrate.rb</span></tt>, for example) and if the file exists, to evaluate it as if it were a specified file</li>
</ul>
<p>Within a callback, there are two ways to get access to information about the deployment:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">release_path</span></tt> can be used to get the path to the current release</li>
<li><tt class="docutils literal"><span class="pre">new_resource</span></tt> can be used to access the deploy resource, including environment variables that have been set there (using <tt class="docutils literal"><span class="pre">new_resource</span></tt> is a preferred approach over using the <tt class="docutils literal"><span class="pre">&#64;configuration</span></tt> variable)</li>
</ul>
<p>Both of these options must be available at the top-level within the callback, along with any assigned values that will be used later in the callback.</p>
<p><strong>Callbacks and Capistrano</strong></p>
<p>If you are familiar with Capistrano, the following examples should help you know when to use the various callbacks that are available. If you are not familiar with Capistrano, then follow the semantic names of these callbacks to help you determine when to use each of the callbacks within a recipe that is built with the <strong>deploy</strong> resource.</p>
<p>The following example shows where callbacks fit in relation to the steps taken by the <tt class="docutils literal"><span class="pre">deploy</span></tt> process in Capistrano:</p>
<img alt="_images/includes_resource_deploy_strategy_callbacks_example1.png" src="_images/includes_resource_deploy_strategy_callbacks_example1.png" />
<p>and the following example shows the same comparison, but with the <tt class="docutils literal"><span class="pre">deploy:migrations</span></tt> process:</p>
<img alt="_images/includes_resource_deploy_strategy_callbacks_example2.png" src="_images/includes_resource_deploy_strategy_callbacks_example2.png" />
</div>
<div class="section" id="layout-modifiers">
<h4>Layout Modifiers<a class="headerlink" href="#layout-modifiers" title="Permalink to this headline">¶</a></h4>
<p>The <strong>deploy</strong> resource expects an application to be structured like a Ruby on Rails application, but the layout can be modified to meet custom requirements as needed. Use the following attributes within a recipe to modify the layout of a recipe that is using the <strong>deploy</strong> resource:</p>
<table border="1" class="docutils">
<colgroup>
<col width="40%" />
<col width="60%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Layout Modifiers</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">create_dirs_before_symlink</span></tt></td>
<td>Create directories in the release directory before symbolic links are created. This property runs after <tt class="docutils literal"><span class="pre">purge_before_symlink</span></tt> and before <tt class="docutils literal"><span class="pre">symlink</span></tt>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">purge_before_symlink</span></tt></td>
<td>An array of directories (relative to the application root) to be removed from a checkout before symbolic links are created. This attribute runs before <tt class="docutils literal"><span class="pre">create_dirs_before_symlink</span></tt> and before <tt class="docutils literal"><span class="pre">symlink</span></tt>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">symlink_before_migrate</span></tt></td>
<td>Map files in a shared directory to the current release directory. The symbolic links for these files are created before any migration is run. Use parentheses <tt class="docutils literal"><span class="pre">(</span> <span class="pre">)</span></tt> around curly braces <tt class="docutils literal"><span class="pre">{</span> <span class="pre">}</span></tt> to ensure the contents within the curly braces are interpreted as a block and not as an empty Hash. Set to <tt class="docutils literal"><span class="pre">symlink_before_migrate({})</span></tt> to prevent the creation of symbolic links.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">symlinks</span></tt></td>
<td>Map files in a shared directory to their paths in the current release directory. This property runs after <tt class="docutils literal"><span class="pre">create_dirs_before_symlink</span></tt> and <tt class="docutils literal"><span class="pre">purge_before_symlink</span></tt>.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="id74">
<h3>Actions<a class="headerlink" href="#id74" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:deploy</span></tt></dt>
<dd>Default. Deploy an application.</dd>
<dt><tt class="docutils literal"><span class="pre">:force_deploy</span></tt></dt>
<dd>Remove any existing release of the same code version and re-deploy a new one in its place.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:rollback</span></tt></dt>
<dd>Roll an application back to the previous release.</dd>
</dl>
<div class="section" id="naming-resources">
<h4>Naming Resources<a class="headerlink" href="#naming-resources" title="Permalink to this headline">¶</a></h4>
<p>The chef-client caches deployment actions as they are taken. In order for the chef-client to be able to apply a subsequent deployment action&#8212;rolling back a release using the <tt class="docutils literal"><span class="pre">:rollback</span></tt> action, for example&#8212;all related deployment actions must be contained within resource blocks that have the same name. This ensures that the chef-client will be able to find the correct deployment from within the cached deployment actions.</p>
<p>For example, a simple deployment:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy_revision</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="o">...</span>
  <span class="n">action</span> <span class="ss">:deploy</span>
<span class="k">end</span>
</pre></div>
</div>
<p>In order to use the <tt class="docutils literal"><span class="pre">:rollback</span></tt> action with this deployment, the <tt class="docutils literal"><span class="pre">:rollback</span></tt> action must be in a resource block that has the same resource name as the initial deploy action. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy_revision</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="o">...</span>
  <span class="n">action</span> <span class="ss">:rollback</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id75">
<h3>Properties<a class="headerlink" href="#id75" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">after_restart</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Proc, String</p>
<p class="last">A block of code, or a path to a file that contains code, that is run after restarting. Default value: <tt class="docutils literal"><span class="pre">deploy/after_restart.rb</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">before_migrate</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Proc, String</p>
<p class="last">A block of code, or a path to a file that contains code, that is run before a migration. Default value: <tt class="docutils literal"><span class="pre">deploy/before_migrate.rb</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">before_restart</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Proc, String</p>
<p class="last">A block of code, or a path to a file that contains code, that is run before restarting. Default value: <tt class="docutils literal"><span class="pre">deploy/before_restart.rb</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">before_symlink</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Proc, String</p>
<p class="last">A block of code, or a path to a file that contains code, that is run before symbolic linking. Default value: <tt class="docutils literal"><span class="pre">deploy/before_symlink.rb</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">branch</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The alias for the revision.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">create_dirs_before_symlink</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p class="last">Create directories in the release directory before symbolic links are created. This property runs after <tt class="docutils literal"><span class="pre">purge_before_symlink</span></tt> and before <tt class="docutils literal"><span class="pre">symlink</span></tt>. Default value: <tt class="docutils literal"><span class="pre">%w{tmp</span> <span class="pre">public</span> <span class="pre">config}</span></tt> (or the same as <tt class="docutils literal"><span class="pre">[&quot;tmp&quot;,</span> <span class="pre">&quot;public&quot;,</span> <span class="pre">&quot;config&quot;]</span></tt>).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">deploy_to</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The &#8220;meta root&#8221; for the application, if different from the path that is used to specify the name of a resource. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">environment</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A Hash of environment variables in the form of <tt class="docutils literal"><span class="pre">({&quot;ENV_VARIABLE&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;VALUE&quot;})</span></tt>. (These variables must exist for a command to be run successfully.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The system group that is responsible for the checked-out code.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">keep_releases</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of releases for which a backup is kept. Default value: <tt class="docutils literal"><span class="pre">5</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">migrate</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Run a migration command. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">migration_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A string that contains a shell command that can be executed to run a migration operation.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">purge_before_symlink</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p class="last">An array of directories (relative to the application root) to be removed from a checkout before symbolic links are created. This attribute runs before <tt class="docutils literal"><span class="pre">create_dirs_before_symlink</span></tt> and before <tt class="docutils literal"><span class="pre">symlink</span></tt>. Default value: <tt class="docutils literal"><span class="pre">%w{log</span> <span class="pre">tmp/pids</span> <span class="pre">public/system}</span></tt> (or the same as <tt class="docutils literal"><span class="pre">[&quot;log&quot;,</span> <span class="pre">&quot;tmp/pids&quot;,</span> <span class="pre">&quot;public/system&quot;]</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">repo</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The alias for the repository.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">repository</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The URI for the repository.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">repository_cache</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of the sub-directory in which the pristine copy of an application&#8217;s source is kept. Default value: <tt class="docutils literal"><span class="pre">cached-copy</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">restart_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Proc</p>
<p class="last">A string that contains a shell command that can be executed to run a restart operation.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">revision</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A branch, tag, or commit to be synchronized with git. This can be symbolic, like <tt class="docutils literal"><span class="pre">HEAD</span></tt> or it can be a source control management-specific revision identifier. Default value: <tt class="docutils literal"><span class="pre">HEAD</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">rollback_on_error</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Roll a resource back to a previously-deployed release if an error occurs when deploying a new release. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">scm_provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">The name of the source control management provider. Default value: <tt class="docutils literal"><span class="pre">Chef::Provider::Git</span></tt>. Optional values: <tt class="docutils literal"><span class="pre">Chef::Provider::Subversion</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">symlinks</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">Map files in a shared directory to their paths in the current release directory. This property runs after <tt class="docutils literal"><span class="pre">create_dirs_before_symlink</span></tt> and <tt class="docutils literal"><span class="pre">purge_before_symlink</span></tt>. Default value: <tt class="docutils literal"><span class="pre">{&quot;system&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;public/system&quot;,</span> <span class="pre">&quot;pids&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;tmp/pids&quot;,</span> <span class="pre">&quot;log&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;log&quot;}</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">symlink_before_migrate</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">Map files in a shared directory to the current release directory. The symbolic links for these files are created before any migration is run. Use parentheses <tt class="docutils literal"><span class="pre">(</span> <span class="pre">)</span></tt> around curly braces <tt class="docutils literal"><span class="pre">{</span> <span class="pre">}</span></tt> to ensure the contents within the curly braces are interpreted as a block and not as an empty Hash. Set to <tt class="docutils literal"><span class="pre">symlink_before_migrate({})</span></tt> to prevent the creation of symbolic links. Default value: <tt class="docutils literal"><span class="pre">{&quot;config/database.yml&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;config/database.yml&quot;}</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The amount of time (in seconds) to wait for a command to execute before timing out. When specified, this value is passed from the <strong>deploy</strong> resource to the <strong>git</strong> or <strong>subversion</strong> resources.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The system user that is responsible for the checked-out code.</p>
</dd>
</dl>
<p>The following properties are for use with git only:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">depth</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The depth of a git repository, truncated to the specified number of revisions. See <tt class="docutils literal"><span class="pre">shallow_clone</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">enable_submodules</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Perform a sub-module initialization and update. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">git_ssh_wrapper</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The alias for the <tt class="docutils literal"><span class="pre">ssh_wrapper</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">remote</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The remote repository to use when synchronizing an existing clone. Default value: <tt class="docutils literal"><span class="pre">origin</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">shallow_clone</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Set the clone depth to <tt class="docutils literal"><span class="pre">5</span></tt>. If a depth other than <tt class="docutils literal"><span class="pre">5</span></tt> is required, use the <tt class="docutils literal"><span class="pre">depth</span></tt> property instead of <tt class="docutils literal"><span class="pre">shallow_clone</span></tt>. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ssh_wrapper</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The path to the wrapper script used when running SSH with git. The <tt class="docutils literal"><span class="pre">GIT_SSH</span></tt> environment variable is set to this.</p>
</dd>
</dl>
<p>The following properties are for use with Subversion only:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">svn_arguments</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The extra arguments that are passed to the Subversion command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">svn_password</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The password for a user that has access to the Subversion repository.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">svn_username</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The user name for a user that has access to the Subversion repository.</p>
</dd>
</dl>
</div>
<div class="section" id="id76">
<h3>Providers<a class="headerlink" href="#id76" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Deploy</span></tt>, <tt class="docutils literal"><span class="pre">deploy</span></tt></dt>
<dd>When this short name is used, the chef-client will determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Deploy::Branch</span></tt>, <tt class="docutils literal"><span class="pre">deploy_branch</span></tt></dt>
<dd>See below for more information.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Deploy::Revision</span></tt>, <tt class="docutils literal"><span class="pre">deploy_revision</span></tt></dt>
<dd>See below for more information.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Deploy::TimestampedDeploy</span></tt>, <tt class="docutils literal"><span class="pre">timestamped_deploy</span></tt></dt>
<dd>The default provider for all platforms. See below for more information.</dd>
</dl>
<div class="section" id="deploy-branch">
<h4>deploy_branch<a class="headerlink" href="#deploy-branch" title="Permalink to this headline">¶</a></h4>
<p>The <strong>deploy_branch</strong> resource functions identically to the <strong>deploy_revision</strong> resource, in terms of how the chef-client processes the resource during the chef-client run. It uses the same <tt class="docutils literal"><span class="pre">Deploy::Revision</span></tt> provider, the same set of actions and attributes, and is (outside of the name itself) identical to the <strong>deploy_revision</strong> resource. Using the <strong>deploy_revision</strong> resource is preferred; however, the <strong>deploy_branch</strong> resource exists for those situations where, semantically, it is preferable to refer to a resource as a &#8220;branch&#8221; instead of a &#8220;revision&#8221;.</p>
</div>
<div class="section" id="deploy-revision">
<h4>deploy_revision<a class="headerlink" href="#deploy-revision" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">deploy_revision</span></tt> provider is the recommended provider, even if it is not listed as the default. The <tt class="docutils literal"><span class="pre">deploy_revision</span></tt> provider is used to ensure that the name of a release sub-directory is based on a revision identifier. For users of git, this will be the familiar SHA checksum. For users of Subversion, it will be the integer revision number. If a name other than a revision identifier is provided&#8212;branch names, tags, and so on&#8212;the chef-client will ignore the alternate names and will look up the revision identifier and use it to name the release sub-directory. When the <tt class="docutils literal"><span class="pre">deploy_revision</span></tt> provider is given an exact revision to deploy, it will behave in an idempotent manner.</p>
<p>The <tt class="docutils literal"><span class="pre">deploy_revision</span></tt> provider results in deployed components under the destination location that is owned by the user who runs the application. This is sometimes an issue for certain workflows. If issues arise, consider the following:</p>
<ul class="simple">
<li>Incorporate changing permissions to the desired end state from within a recipe</li>
<li>Add a <tt class="docutils literal"><span class="pre">before_restart</span></tt> block to fix up the permissions</li>
<li>Have an unprivileged user (for example: <tt class="docutils literal"><span class="pre">opscode</span></tt>) be the owner of the <tt class="docutils literal"><span class="pre">deploy</span></tt> directory and another unprivileged user (for example: <tt class="docutils literal"><span class="pre">opscodeapp</span></tt>) run the application. Most often, this is the solution that works best</li>
</ul>
<p>When using the <tt class="docutils literal"><span class="pre">deploy_revision</span></tt> provider, and when the deploy fails for any reason, and when the same code is used to re-deploy, the action should be set manually to <tt class="docutils literal"><span class="pre">:force_deploy</span></tt>. Forcing the re-deploy will remove the old release directory, after which the deploy can proceed as usual. (Forcing a re-deploy over the current release can cause some downtime.) Deployed revisions are stored in <tt class="docutils literal"><span class="pre">(file_cache_path)/revision-deploys/(deploy_path)</span></tt>.</p>
</div>
<div class="section" id="timestamped-deploy">
<h4>timestamped_deploy<a class="headerlink" href="#timestamped-deploy" title="Permalink to this headline">¶</a></h4>
<p>The <tt class="docutils literal"><span class="pre">timestamped_deploy</span></tt> provider is the default <strong>deploy</strong> provider. It is used to name release directories with a timestamp in the form of <tt class="docutils literal"><span class="pre">YYYYMMDDHHMMSS</span></tt>. For example: <tt class="docutils literal"><span class="pre">/my/deploy/dir/releases/20121120162342</span></tt>. The <strong>deploy</strong> resource will determine whether or not to deploy code based on the existence of the release directory in which it is attempting to deploy. Because the timestamp is different for every chef-client run, the <tt class="docutils literal"><span class="pre">timestamped_deploy</span></tt> provider is not idempotent. When the <tt class="docutils literal"><span class="pre">timestamped_deploy</span></tt> provider is used, it requires that the action setting on a resource be managed manually in order to prevent unintended continuous deployment.</p>
</div>
</div>
<div class="section" id="id77">
<h3>Examples<a class="headerlink" href="#id77" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Modify the layout of a Ruby on Rails application</strong></p>
<p>The layout of the <strong>deploy</strong> resource matches a Ruby on Rails app by default, but this can be customized. To customize the layout, do something like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;/my/apps/dir/deploy&#39;</span> <span class="k">do</span>
  <span class="c1"># Use a local repo if you prefer</span>
  <span class="n">repo</span> <span class="s1">&#39;/path/to/gitrepo/typo/&#39;</span>
  <span class="n">environment</span> <span class="s1">&#39;RAILS_ENV&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;production&#39;</span>
  <span class="n">revision</span> <span class="s1">&#39;HEAD&#39;</span>
  <span class="n">action</span> <span class="ss">:deploy</span>
  <span class="n">migration_command</span> <span class="s1">&#39;rake db:migrate --trace&#39;</span>
  <span class="n">migrate</span> <span class="kp">true</span>
  <span class="n">restart_command</span> <span class="s1">&#39;touch tmp/restart.txt&#39;</span>
  <span class="n">create_dirs_before_symlink</span>  <span class="sx">%w{tmp public config deploy}</span>

  <span class="c1"># You can use this to customize if your app has extra configuration files</span>
  <span class="c1"># such as amqp.yml or app_config.yml</span>
  <span class="n">symlink_before_migrate</span>  <span class="s1">&#39;config/database.yml&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;config/database.yml&#39;</span>

  <span class="c1"># If your app has extra files in the shared folder, specify them here</span>
  <span class="n">symlinks</span>  <span class="s1">&#39;system&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;public/system&#39;</span><span class="p">,</span>
            <span class="s1">&#39;pids&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;tmp/pids&#39;</span><span class="p">,</span>
            <span class="s1">&#39;log&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span>
            <span class="s1">&#39;deploy/before_migrate.rb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;deploy/before_migrate.rb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;deploy/before_symlink.rb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;deploy/before_symlink.rb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;deploy/before_restart.rb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;deploy/before_restart.rb&#39;</span><span class="p">,</span>
            <span class="s1">&#39;deploy/after_restart.rb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;deploy/after_restart.rb&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use resources within callbacks</strong></p>
<p>Using resources from within your callbacks as blocks or within callback files distributed with your application&#8217;s source code. To use embedded recipes for callbacks:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;tmpdir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/deploy&quot;</span> <span class="k">do</span>
  <span class="n">repo</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;tmpdir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/gitrepo/typo/&quot;</span>
  <span class="n">environment</span> <span class="s1">&#39;RAILS_ENV&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;production&#39;</span>
  <span class="n">revision</span> <span class="s1">&#39;HEAD&#39;</span>
  <span class="n">action</span> <span class="ss">:deploy</span>
  <span class="n">migration_command</span> <span class="s1">&#39;rake db:migrate --trace&#39;</span>
  <span class="n">migrate</span> <span class="kp">true</span>

  <span class="c1"># Callback awesomeness:</span>
  <span class="n">before_migrate</span> <span class="k">do</span>
    <span class="n">current_release</span> <span class="o">=</span> <span class="n">release_path</span>

    <span class="n">directory</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">current_release</span><span class="si">}</span><span class="s2">/deploy&quot;</span> <span class="k">do</span>
      <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
    <span class="k">end</span>

    <span class="c1"># creates a callback for before_symlink</span>
    <span class="n">template</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">current_release</span><span class="si">}</span><span class="s2">/deploy/before_symlink_callback.rb&quot;</span> <span class="k">do</span>
      <span class="n">source</span> <span class="s1">&#39;embedded_recipe_before_symlink.rb.erb&#39;</span>
      <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
    <span class="k">end</span>

  <span class="k">end</span>

  <span class="c1"># This file can contain Chef recipe code, plain ruby also works</span>
  <span class="n">before_symlink</span> <span class="s1">&#39;deploy/before_symlink_callback.rb&#39;</span>

  <span class="n">restart</span> <span class="k">do</span>
    <span class="n">current_release</span> <span class="o">=</span> <span class="n">release_path</span>
    <span class="n">file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">release_path</span><span class="si">}</span><span class="s2">/tmp/restart.txt&quot;</span> <span class="k">do</span>
      <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div>
<p><strong>Deploy from a private git repository without using the application cookbook</strong></p>
<p>To deploy from a private git repository without using the <tt class="docutils literal"><span class="pre">application</span></tt> cookbook, first ensure that:</p>
<ul class="simple">
<li>the private key does not have a passphrase, as this will pause a chef-client run to wait for input</li>
<li>an SSH wrapper is being used</li>
<li>a private key has been added to the node</li>
</ul>
<p>and then remove a passphrase from a private key by using code similar to:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>ssh-keygen -p -P <span class="s1">&#39;PASSPHRASE&#39;</span> -N <span class="s1">&#39;&#39;</span> -f id_deploy
</pre></div>
</div>
<p><strong>Use an SSH wrapper</strong></p>
<p>To write a recipe that uses an SSH wrapper:</p>
<ol class="arabic">
<li><p class="first">Create a file in the <tt class="docutils literal"><span class="pre">cookbooks/COOKBOOK_NAME/files/default</span></tt> directory that is named <tt class="docutils literal"><span class="pre">wrap-ssh4git.sh</span></tt> and which contains the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="sr">/usr/</span><span class="n">bin</span><span class="o">/</span><span class="n">env</span> <span class="n">ssh</span> <span class="o">-</span><span class="n">o</span> <span class="s2">&quot;StrictHostKeyChecking=no&quot;</span> <span class="o">-</span><span class="n">i</span> <span class="s2">&quot;/tmp/private_code/.ssh/id_deploy&quot;</span> <span class="vg">$1</span> <span class="vg">$2</span>
</pre></div>
</div>
</li>
<li><p class="first">Set up the cookbook file.</p>
</li>
<li><p class="first">Add a recipe to the cookbook file similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;/tmp/private_code/.ssh&#39;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;ubuntu&#39;</span>
  <span class="n">recursive</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">cookbook_file</span> <span class="s1">&#39;/tmp/private_code/wrap-ssh4git.sh&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;wrap-ssh4git.sh&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;ubuntu&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">deploy</span> <span class="s1">&#39;private_repo&#39;</span> <span class="k">do</span>
  <span class="n">repo</span> <span class="s1">&#39;git@github.com:acctname/private-repo.git&#39;</span>
  <span class="n">user</span> <span class="s1">&#39;ubuntu&#39;</span>
  <span class="n">deploy_to</span> <span class="s1">&#39;/tmp/private_code&#39;</span>
  <span class="n">action</span> <span class="ss">:deploy</span>
  <span class="n">ssh_wrapper</span> <span class="s1">&#39;/tmp/private_code/wrap-ssh4git.sh&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This will deploy the git repository at <tt class="docutils literal"><span class="pre">git&#64;github.com:acctname/private-repo.git</span></tt> in the <tt class="docutils literal"><span class="pre">/tmp/private_code</span></tt> directory.</p>
</li>
</ol>
<p><strong>Use a callback to include a file that will be passed as a code block</strong></p>
<p>The code in a file that is included in a recipe using a callback is evaluated exactly as if the code had been put in the recipe as a block. Files are searched relative to the current release.</p>
<p>To specify a file that contains code to be used as a block:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;/deploy/dir/&#39;</span> <span class="k">do</span>
  <span class="c1"># ...</span>

  <span class="n">before_migrate</span> <span class="s1">&#39;callbacks/do_this_before_migrate.rb&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a callback to pass a code block</strong></p>
<p>To pass a block of Python code before a migration is run:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy_revision</span> <span class="s1">&#39;/deploy/dir/&#39;</span> <span class="k">do</span>
  <span class="c1"># other attributes</span>
  <span class="c1"># ...</span>

  <span class="n">before_migrate</span> <span class="k">do</span>
    <span class="c1"># release_path is the path to the timestamp dir</span>
    <span class="c1"># for the current release</span>
    <span class="n">current_release</span> <span class="o">=</span> <span class="n">release_path</span>

    <span class="c1"># Create a local variable for the node so we&#39;ll have access to</span>
    <span class="c1"># the attributes</span>
    <span class="n">deploy_node</span> <span class="o">=</span> <span class="n">node</span>

    <span class="c1"># A local variable with the deploy resource.</span>
    <span class="n">deploy_resource</span> <span class="o">=</span> <span class="n">new_resource</span>

    <span class="n">python</span> <span class="k">do</span>
      <span class="n">cwd</span> <span class="n">current_release</span>
      <span class="n">user</span> <span class="s1">&#39;myappuser&#39;</span>
      <span class="n">code</span><span class="o">&lt;&lt;-</span><span class="no">PYCODE</span>
        <span class="c1"># Woah, callbacks in python!</span>
        <span class="c1"># ...</span>
        <span class="c1"># current_release, deploy_node, and deploy_resource are all available</span>
        <span class="c1"># within the deploy hook now.</span>
      <span class="no">PYCODE</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the same API for all recipes using the same gem</strong></p>
<p>Any recipes using the <tt class="docutils literal"><span class="pre">git-deploy</span></tt> gem can continue using the same API. To include this behavior in a recipe, do something like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s2">&quot;/srv/</span><span class="si">#{</span><span class="n">appname</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
  <span class="n">repo</span> <span class="s1">&#39;git://github.com/radiant/radiant.git&#39;</span>
  <span class="n">revision</span> <span class="s1">&#39;HEAD&#39;</span>
  <span class="n">user</span> <span class="s1">&#39;railsdev&#39;</span>
  <span class="n">enable_submodules</span> <span class="kp">false</span>
  <span class="n">migrate</span> <span class="kp">true</span>
  <span class="n">migration_command</span> <span class="s1">&#39;rake db:migrate&#39;</span>
  <span class="c1"># Giving a string for environment sets RAILS_ENV, MERB_ENV, RACK_ENV</span>
  <span class="n">environment</span> <span class="s1">&#39;production&#39;</span>
  <span class="n">shallow_clone</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:deploy</span>
  <span class="n">restart_command</span> <span class="s1">&#39;touch tmp/restart.txt&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Deploy without creating symbolic links to a shared folder</strong></p>
<p>To deploy without creating symbolic links to a shared folder:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;/my/apps/dir/deploy&#39;</span> <span class="k">do</span>
  <span class="n">symlinks</span> <span class="p">{}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>When deploying code that is not Ruby on Rails and symbolic links to a shared folder are not wanted, use parentheses <tt class="docutils literal"><span class="pre">()</span></tt> or <tt class="docutils literal"><span class="pre">Hash.new</span></tt> to avoid ambiguity. For example, using parentheses:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;/my/apps/dir/deploy&#39;</span> <span class="k">do</span>
  <span class="n">symlinks</span><span class="p">({})</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or using <tt class="docutils literal"><span class="pre">Hash.new</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;/my/apps/dir/deploy&#39;</span> <span class="k">do</span>
  <span class="n">symlinks</span> <span class="no">Hash</span><span class="o">.</span><span class="n">new</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Clear a layout modifier attribute</strong></p>
<p>Using the default property values for the various resources is the recommended starting point when working with recipes. Then, depending on what each node requires, these default values can be overridden with node-, role-, environment-, and cookbook-specific values. The <strong>deploy</strong> resource has four layout modifiers: <tt class="docutils literal"><span class="pre">create_dirs_before_symlink</span></tt>, <tt class="docutils literal"><span class="pre">purge_before_symlink</span></tt>, <tt class="docutils literal"><span class="pre">symlink_before_migrate</span></tt>, and <tt class="docutils literal"><span class="pre">symlinks</span></tt>. Each of these is a Hash that behaves as a property of the <strong>deploy</strong> resource. When these layout modifiers are used in a recipe, they appear similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="o">...</span>
  <span class="n">symlink_before_migrate</span>       <span class="p">{</span><span class="s1">&#39;config/database.yml&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;config/database.yml&#39;</span><span class="p">}</span>
  <span class="n">create_dirs_before_symlink</span>   <span class="sx">%w{tmp public config}</span>
  <span class="n">purge_before_symlink</span>         <span class="sx">%w{log tmp/pids public/system}</span>
  <span class="n">symlinks</span>                     <span class="p">{</span> <span class="s1">&#39;system&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;public/system&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;pids&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;tmp/pids&#39;</span><span class="p">,</span>
                                 <span class="s1">&#39;log&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;log&#39;</span>
                               <span class="p">}</span>
  <span class="o">...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then what these layout modifiers look like if they were empty:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="o">...</span>
  <span class="n">symlink_before_migrate</span>       <span class="kp">nil</span>
  <span class="n">create_dirs_before_symlink</span>   <span class="o">[]</span>
  <span class="n">purge_before_symlink</span>         <span class="o">[]</span>
  <span class="n">symlinks</span>                     <span class="kp">nil</span>
  <span class="o">...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>In most cases, using the empty values for the layout modifiers will prevent the chef-client from passing symbolic linking information to a node during the chef-client run. However, in some cases, it may be preferable to ensure that one (or more) of these layout modifiers do not pass any symbolic linking information to a node during the chef-client run at all. Because each of these layout modifiers are a Hash, the <tt class="docutils literal"><span class="pre">clear</span></tt> instance method can be used to clear out these values.</p>
<p>To clear the default values for a layout modifier:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deploy</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="o">...</span>
  <span class="n">symlink_before_migrate</span><span class="o">.</span><span class="n">clear</span>
  <span class="n">create_dirs_before_symlink</span><span class="o">.</span><span class="n">clear</span>
  <span class="n">purge_before_symlink</span><span class="o">.</span><span class="n">clear</span>
  <span class="n">symlinks</span><span class="o">.</span><span class="n">clear</span>
  <span class="o">...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>In general, use this approach carefully and only after it is determined that nil or empty values won&#8217;t provide the expected result.</p>
</div>
</div>
<div class="section" id="directory">
<h2>directory<a class="headerlink" href="#directory" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_directory.rst">[edit on GitHub]</a></p>
<p>Use the <strong>directory</strong> resource to manage a directory, which is a hierarchy of folders that comprises all of the information stored on a computer. The root directory is the top-level, under which the rest of the directory is organized. The <strong>directory</strong> resource uses the <tt class="docutils literal"><span class="pre">name</span></tt> property to specify the path to a location in a directory. Typically, permission to access that location in the directory is required.</p>
<div class="section" id="id78">
<h3>Syntax<a class="headerlink" href="#id78" title="Permalink to this headline">¶</a></h3>
<p>A <strong>directory</strong> resource block declares a directory and the permissions needed on that directory. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;/etc/apache2&#39;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">'/etc/apache2'</span></tt> specifies the directory</li>
<li><tt class="docutils literal"><span class="pre">owner</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, and <tt class="docutils literal"><span class="pre">mode</span></tt> define the permissions</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>directory</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">inherits</span>                   <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">mode</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">owner</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">path</span>                       <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Directory</span>
  <span class="n">recursive</span>                  <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">rights</span>                     <span class="no">Hash</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">directory</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block; when the <tt class="docutils literal"><span class="pre">path</span></tt> property is not specified, <tt class="docutils literal"><span class="pre">name</span></tt> is also the path to the directory, from the root</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">inherits</span></tt>, <tt class="docutils literal"><span class="pre">mode</span></tt>, <tt class="docutils literal"><span class="pre">owner</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">recursive</span></tt>, and <tt class="docutils literal"><span class="pre">rights</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id79">
<h3>Actions<a class="headerlink" href="#id79" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>Default. Create a directory. If a directory already exists (but does not match), update that directory to match.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Delete a directory.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
</dl>
</div>
<div class="section" id="id80">
<h3>Properties<a class="headerlink" href="#id80" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">A string or ID that identifies the group owner by group name, including fully qualified group names such as <tt class="docutils literal"><span class="pre">domain\group</span></tt> or <tt class="docutils literal"><span class="pre">group&#64;domain</span></tt>. If this value is not specified, existing groups remain unchanged and new group assignments use the default <tt class="docutils literal"><span class="pre">POSIX</span></tt> group (if available).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">inherits</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Microsoft Windows only. Whether a file inherits rights from its parent directory. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">mode</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p>A quoted 3-5 character string that defines the octal mode. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified and if the directory already exists, the existing mode on the directory is used. If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified, the directory does not exist, and the <tt class="docutils literal"><span class="pre">:create</span></tt> action is specified, the chef-client assumes a mask value of <tt class="docutils literal"><span class="pre">'0777'</span></tt>, and then applies the umask for the system on which the directory is to be created to the <tt class="docutils literal"><span class="pre">mask</span></tt> value. For example, if the umask on a system is <tt class="docutils literal"><span class="pre">'022'</span></tt>, the chef-client uses the default value of <tt class="docutils literal"><span class="pre">'0755'</span></tt>.</p>
<p>The behavior is different depending on the platform.</p>
<p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. If the value is specified as a quoted string, it works exactly as if the <tt class="docutils literal"><span class="pre">chmod</span></tt> command was passed. If the value is specified as an integer, prepend a zero (<tt class="docutils literal"><span class="pre">0</span></tt>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <tt class="docutils literal"><span class="pre">'0777'</span></tt> or <tt class="docutils literal"><span class="pre">'777'</span></tt>; for the same rights, plus the sticky bit, use <tt class="docutils literal"><span class="pre">01777</span></tt> or <tt class="docutils literal"><span class="pre">'1777'</span></tt>.</p>
<p class="last">Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. Values up to <tt class="docutils literal"><span class="pre">'0777'</span></tt> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <tt class="docutils literal"><span class="pre">4</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">2</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, and <tt class="docutils literal"><span class="pre">1</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>. This property cannot be used to set <tt class="docutils literal"><span class="pre">:full_control</span></tt>. This property has no effect if not specified, but when it and <tt class="docutils literal"><span class="pre">rights</span></tt> are both specified, the effects are cumulative.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">owner</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">A string or ID that identifies the group owner by user name, including fully qualified user names such as <tt class="docutils literal"><span class="pre">domain\user</span></tt> or <tt class="docutils literal"><span class="pre">user&#64;domain</span></tt>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The path to the directory. Using a fully qualified path is recommended, but is not always required. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">recursive</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Create or delete parent directories recursively. For the <tt class="docutils literal"><span class="pre">owner</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, and <tt class="docutils literal"><span class="pre">mode</span></tt> properties, the value of this attribute applies only to the leaf directory. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">rights</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">Microsoft Windows only. The permissions for users and groups in a Microsoft Windows environment. For example: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">&lt;permissions&gt;,</span> <span class="pre">&lt;principal&gt;,</span> <span class="pre">&lt;options&gt;</span></tt> where <tt class="docutils literal"><span class="pre">&lt;permissions&gt;</span></tt> specifies the rights granted to the principal, <tt class="docutils literal"><span class="pre">&lt;principal&gt;</span></tt> is the group or user name, and <tt class="docutils literal"><span class="pre">&lt;options&gt;</span></tt> is a Hash with one (or more) advanced rights options.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
</dl>
<div class="section" id="recursive-directories">
<h4>Recursive Directories<a class="headerlink" href="#recursive-directories" title="Permalink to this headline">¶</a></h4>
<p>The <strong>directory</strong> resource can be used to create directory structures, as long as each directory within that structure is created explicitly. This is because the <tt class="docutils literal"><span class="pre">recursive</span></tt> attribute only applies <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">mode</span></tt>, and <tt class="docutils literal"><span class="pre">owner</span></tt> attribute values to the leaf directory.</p>
<p>A directory structure:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>/foo
  /bar
    /baz
</pre></div>
</div>
<p>The following example shows a way create a file in the <tt class="docutils literal"><span class="pre">/baz</span></tt> directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s2">&quot;/foo/bar/baz&quot;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>But with this example, the <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">mode</span></tt>, and <tt class="docutils literal"><span class="pre">owner</span></tt> attribute values will only be applied to <tt class="docutils literal"><span class="pre">/baz</span></tt>. Which is fine, if that&#8217;s what you want. But most of the time, when the entire <tt class="docutils literal"><span class="pre">/foo/bar/baz</span></tt> directory structure is not there, you must be explicit about each directory. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="sx">%w[ /foo /foo/bar /foo/bar/baz ]</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
  <span class="n">directory</span> <span class="n">path</span> <span class="k">do</span>
    <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
    <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
    <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This approach will create the correct hierarchy&#8212;<tt class="docutils literal"><span class="pre">/foo</span></tt>, then <tt class="docutils literal"><span class="pre">/bar</span></tt> in <tt class="docutils literal"><span class="pre">/foo</span></tt>, and then <tt class="docutils literal"><span class="pre">/baz</span></tt> in <tt class="docutils literal"><span class="pre">/bar</span></tt>&#8212;and also with the correct attribute values for <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">mode</span></tt>, and <tt class="docutils literal"><span class="pre">owner</span></tt>.</p>
</div>
<div class="section" id="id81">
<h4>Windows File Security<a class="headerlink" href="#id81" title="Permalink to this headline">¶</a></h4>
<p>To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes.</p>
<p><strong>Access Control Lists (ACLs)</strong></p>
<p>The <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used as many times as necessary; the chef-client will apply them to the file or directory as required. The syntax for the <tt class="docutils literal"><span class="pre">rights</span></tt> property is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="n">permission</span><span class="p">,</span> <span class="n">principal</span><span class="p">,</span> <span class="n">option_type</span> <span class="o">=&gt;</span> <span class="n">value</span>
</pre></div>
</div>
<p>where</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">permission</span></tt></dt>
<dd><p class="first">Use to specify which rights are granted to the <tt class="docutils literal"><span class="pre">principal</span></tt>. The possible values are: <tt class="docutils literal"><span class="pre">:read</span></tt>, <tt class="docutils literal"><span class="pre">:write</span></tt>, <tt class="docutils literal"><span class="pre">read_execute</span></tt>, <tt class="docutils literal"><span class="pre">:modify</span></tt>, and <tt class="docutils literal"><span class="pre">:full_control</span></tt>.</p>
<p>These permissions are cumulative. If <tt class="docutils literal"><span class="pre">:write</span></tt> is specified, then it includes <tt class="docutils literal"><span class="pre">:read</span></tt>. If <tt class="docutils literal"><span class="pre">:full_control</span></tt> is specified, then it includes both <tt class="docutils literal"><span class="pre">:write</span></tt> and <tt class="docutils literal"><span class="pre">:read</span></tt>.</p>
<p class="last">(For those who know the Microsoft Windows API: <tt class="docutils literal"><span class="pre">:read</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>; <tt class="docutils literal"><span class="pre">:write</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>; <tt class="docutils literal"><span class="pre">:read_execute</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt> and <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>; <tt class="docutils literal"><span class="pre">:modify</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>, and <tt class="docutils literal"><span class="pre">DELETE</span></tt>; <tt class="docutils literal"><span class="pre">:full_control</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_ALL</span></tt>, which allows a user to change the owner and other metadata about a file.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">principal</span></tt></dt>
<dd>Use to specify a group or user name. This is identical to what is entered in the login box for Microsoft Windows, such as <tt class="docutils literal"><span class="pre">user_name</span></tt>, <tt class="docutils literal"><span class="pre">domain\user_name</span></tt>, or <tt class="docutils literal"><span class="pre">user_name&#64;fully_qualified_domain_name</span></tt>. The chef-client does not need to know if a principal is a user or a group.</dd>
<dt><tt class="docutils literal"><span class="pre">option_type</span></tt></dt>
<dd><p class="first">A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">:write,</span> <span class="pre">'domain\group_name',</span> <span class="pre">:one_level_deep</span> <span class="pre">=&gt;</span> <span class="pre">true</span></tt>. Possible option types:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:applies_to_children</span></tt></td>
<td>Specify how permissions are applied to children. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to inherit both child directories and files;  <tt class="docutils literal"><span class="pre">false</span></tt> to not inherit any child directories or files; <tt class="docutils literal"><span class="pre">:containers_only</span></tt> to inherit only child directories (and not files); <tt class="docutils literal"><span class="pre">:objects_only</span></tt> to recursively inherit files (and not child directories).</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:applies_to_self</span></tt></td>
<td>Indicates whether a permission is applied to the parent directory. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply to the parent directory or file and its children; <tt class="docutils literal"><span class="pre">false</span></tt> to not apply only to child directories and files.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:one_level_deep</span></tt></td>
<td>Indicates the depth to which permissions will be applied. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply only to the first level of children; <tt class="docutils literal"><span class="pre">false</span></tt> to apply to all children.</td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Administrators&#39;</span><span class="p">,</span><span class="s1">&#39;Everyone&#39;</span><span class="o">]</span>
<span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;Users&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;Sally&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="ss">:containers_only</span><span class="p">,</span> <span class="ss">:applies_to_self</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:one_level_deep</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</pre></div>
</div>
<p>Some other important things to know when using the <tt class="docutils literal"><span class="pre">rights</span></tt> attribute:</p>
<ul class="simple">
<li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li>
<li>If rights are not specified, nothing will be changed. The chef-client does not clear out the rights on a file or directory if rights are not specified.</li>
<li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li>
</ul>
<p>Use the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> property to deny specific rights to specific users. The ordering is independent of using the <tt class="docutils literal"><span class="pre">rights</span></tt> property. For example, it doesn&#8217;t matter if rights are granted to everyone is placed before or after <tt class="docutils literal"><span class="pre">deny_rights</span> <span class="pre">:read,</span> <span class="pre">['Julian',</span> <span class="pre">'Lewis']</span></tt>, both Julian and Lewis will be unable to read the document. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Julian&#39;</span><span class="p">,</span> <span class="s1">&#39;Lewis&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deny_rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Sally&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p><strong>Inheritance</strong></p>
<p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <tt class="docutils literal"><span class="pre">inherits</span></tt> property can be used to specifically tell the chef-client to apply (or not apply) inherited rights from its parent directory.</p>
<p>For example, the following example specifies the rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">inherits</span> <span class="kp">false</span> <span class="c1"># Sauron is the only person who should have any sort of access</span>
<span class="k">end</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> permission were to be used instead, something could slip through unless all users and groups were denied.</p>
<p>Another example also shows how to specify rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;SHIRE\Frodo&#39;</span> <span class="c1"># Who put that there I didn&#39;t put that there</span>
<span class="k">end</span>
</pre></div>
</div>
<p>but then not use the <tt class="docutils literal"><span class="pre">inherits</span></tt> property to deny those rights on a child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span> <span class="c1"># Oops, not specific enough</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Because the <tt class="docutils literal"><span class="pre">inherits</span></tt> property is not specified, the chef-client will default it to <tt class="docutils literal"><span class="pre">true</span></tt>, which will ensure that security settings for existing files remain unchanged.</p>
</div>
</div>
<div class="section" id="id82">
<h3>Examples<a class="headerlink" href="#id82" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Create a directory</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;/tmp/something&#39;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a directory in Microsoft Windows</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">tmp</span><span class="se">\\</span><span class="s2">something.txt&quot;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s2">&quot;DOMAIN</span><span class="se">\\</span><span class="s2">User&quot;</span>
  <span class="n">inherits</span> <span class="kp">false</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\tmp\something.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;DOMAIN\User&#39;</span>
  <span class="n">inherits</span> <span class="kp">false</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The difference between the two previous examples is the single- versus double-quoted strings, where if the double quotes are used, the backslash character (<tt class="docutils literal"><span class="pre">\</span></tt>) must be escaped using the Ruby escape character (which is a backslash).</p>
</div>
<p><strong>Create a directory recursively</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="sx">%w{dir1 dir2 dir3}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
  <span class="n">directory</span> <span class="s2">&quot;/tmp/mydirs/</span><span class="si">#{</span><span class="n">dir</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
    <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
    <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
    <span class="n">action</span> <span class="ss">:create</span>
    <span class="n">recursive</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delete a directory</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;/tmp/something&#39;</span> <span class="k">do</span>
  <span class="n">recursive</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:delete</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set directory permissions using a variable</strong></p>
<p>The following example shows how read/write/execute permissions can be set using a variable named <tt class="docutils literal"><span class="pre">user_home</span></tt>, and then for owners and groups on any matching node:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user_home</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:user</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">directory</span> <span class="n">user_home</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;node[:matching_node][:user]&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;node[:matching_node][:group]&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">matching_node</span></tt> represents a type of node. For example, if the <tt class="docutils literal"><span class="pre">user_home</span></tt> variable specified <tt class="docutils literal"><span class="pre">{node[:nginx]...}</span></tt>, a recipe might look similar to:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user_home</span> <span class="o">=</span> <span class="s2">&quot;/</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:nginx</span><span class="o">][</span><span class="ss">:user</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">directory</span> <span class="n">user_home</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;node[:nginx][:user]&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;node[:nginx][:group]&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set directory permissions for a specific type of node</strong></p>
<p>The following example shows how permissions can be set for the <tt class="docutils literal"><span class="pre">/certificates</span></tt> directory on any node that is running Nginx. In this example, permissions are being set for the <tt class="docutils literal"><span class="pre">owner</span></tt> and <tt class="docutils literal"><span class="pre">group</span></tt> properties as <tt class="docutils literal"><span class="pre">root</span></tt>, and then read/write permissions are granted to the root.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:nginx</span><span class="o">][</span><span class="ss">:dir</span><span class="o">]</span><span class="si">}</span><span class="s2">/shared/certificates&quot;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">recursive</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reload the configuration</strong></p>
<p>The following example shows how to reload the configuration of a chef-client using the <strong>remote_file</strong> resource to:</p>
<ul class="simple">
<li>using an if statement to check whether the plugins on a node are the latest versions</li>
<li>identify the location from which Ohai plugins are stored</li>
<li>using the <tt class="docutils literal"><span class="pre">notifies</span></tt> property and a <strong>ruby_block</strong> resource to trigger an update (if required) and to then reload the client.rb file.</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;node[:ohai][:plugin_path]&#39;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;chef&#39;</span>
  <span class="n">recursive</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;reload_config&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;/etc/chef/client.rb&#39;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="ss">:ohai</span><span class="o">].</span><span class="n">key?</span><span class="p">(</span><span class="ss">:plugins</span><span class="p">)</span>
  <span class="n">node</span><span class="o">[</span><span class="ss">:ohai</span><span class="o">][</span><span class="ss">:plugins</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">plugin</span><span class="o">|</span>
    <span class="n">remote_file</span> <span class="n">node</span><span class="o">[</span><span class="ss">:ohai</span><span class="o">][</span><span class="ss">:plugin_path</span><span class="o">]</span> <span class="o">+</span><span class="s2">&quot;/</span><span class="si">#{</span><span class="n">plugin</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
      <span class="n">source</span> <span class="n">plugin</span>
      <span class="n">owner</span> <span class="s1">&#39;chef&#39;</span>
              <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload_config]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Manage dotfiles</strong></p>
<p>The following example shows using the <strong>directory</strong> and <strong>cookbook_file</strong> resources to manage dotfiles. The dotfiles are defined by a JSON data structure similar to:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span></span><span class="s2">&quot;files&quot;</span><span class="o">:</span> <span class="p">{</span>
  <span class="s2">&quot;.zshrc&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;mode&quot;</span><span class="o">:</span> <span class="s1">&#39;0755&#39;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;dot-zshrc&quot;</span>
    <span class="p">},</span>
  <span class="s2">&quot;.bashrc&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;mode&quot;</span><span class="o">:</span> <span class="s1">&#39;0755&#39;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;dot-bashrc&quot;</span>
     <span class="p">},</span>
  <span class="s2">&quot;.bash_profile&quot;</span><span class="o">:</span> <span class="p">{</span>
    <span class="s2">&quot;mode&quot;</span><span class="o">:</span> <span class="s1">&#39;0755&#39;</span><span class="p">,</span>
    <span class="s2">&quot;source&quot;</span><span class="o">:</span> <span class="s2">&quot;dot-bash_profile&quot;</span>
    <span class="p">},</span>
  <span class="p">}</span>
</pre></div>
</div>
<p>and then the following resources manage the dotfiles:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">has_key?</span><span class="p">(</span><span class="s1">&#39;files&#39;</span><span class="p">)</span>
  <span class="n">u</span><span class="o">[</span><span class="s1">&#39;files&#39;</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">filename</span><span class="p">,</span> <span class="n">file_data</span><span class="o">|</span>

  <span class="n">directory</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">home_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">recursive</span> <span class="kp">true</span>
    <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="k">end</span> <span class="k">if</span> <span class="n">file_data</span><span class="o">[</span><span class="s1">&#39;subdir&#39;</span><span class="o">]</span>

  <span class="n">cookbook_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">home_dir</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">filename</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">file_data</span><span class="o">[</span><span class="s1">&#39;source&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">owner</span> <span class="s1">&#39;u[&#39;</span><span class="nb">id</span><span class="s1">&#39;]&#39;</span>
    <span class="n">group</span> <span class="s1">&#39;group_id&#39;</span>
    <span class="n">mode</span> <span class="s1">&#39;file_data[&#39;</span><span class="n">mode</span><span class="s1">&#39;]&#39;</span>
    <span class="n">ignore_failure</span> <span class="kp">true</span>
    <span class="n">backup</span> <span class="mi">0</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dpkg-package">
<h2>dpkg_package<a class="headerlink" href="#dpkg-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_dpkg_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>dpkg_package</strong> resource to manage packages for the dpkg platform. When a package is installed from a local file, it must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id83">
<h3>Syntax<a class="headerlink" href="#id83" title="Permalink to this headline">¶</a></h3>
<p>A <strong>dpkg_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>dpkg_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dpkg_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>dpkg_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dpkg_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Dpkg</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">dpkg_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package; this may be an array of packages</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id84">
<h3>Actions<a class="headerlink" href="#id84" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:purge</span></tt></dt>
<dd>Purge a package. This action typically removes the configuration files as well as the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
</dl>
</div>
<div class="section" id="id85">
<h3>Properties<a class="headerlink" href="#id85" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id86">
<h3>Providers<a class="headerlink" href="#id86" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Dpkg</span></tt>, <tt class="docutils literal"><span class="pre">dpkg_package</span></tt></dt>
<dd>The provider for the dpkg platform. Can be used with the <tt class="docutils literal"><span class="pre">options</span></tt> attribute.</dd>
</dl>
</div>
<div class="section" id="id87">
<h3>Examples<a class="headerlink" href="#id87" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dpkg_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dsc-resource">
<h2>dsc_resource<a class="headerlink" href="#dsc-resource" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_dsc_resource.rst">[edit on GitHub]</a></p>
<p>Windows PowerShell is a task-based command-line shell and scripting language developed by Microsoft. Windows PowerShell uses a document-oriented approach for managing Microsoft Windows-based machines, similar to the approach that is used for managing UNIX- and Linux-based machines. Windows PowerShell is <a class="reference external" href="http://technet.microsoft.com/en-us/library/bb978526.aspx">a tool-agnostic platform</a> that supports using Chef for configuration management.</p>
<p>Desired State Configuration (DSC) is a feature of Windows PowerShell that provides <a class="reference external" href="http://technet.microsoft.com/en-us/library/dn249912.aspx">a set of language extensions, cmdlets, and resources</a> that can be used to declaratively configure software. DSC is similar to Chef, in that both tools are idempotent, take similar approaches to the concept of resources, describe the configuration of a system, and then take the steps required to do that configuration. The most important difference between Chef and DSC is that Chef uses Ruby and DSC is exposed as configuration data from within Windows PowerShell.</p>
<p>The <strong>dsc_resource</strong> resource allows any DSC resource to be used in a Chef recipe, as well as any custom resources that have been added to your Windows PowerShell environment. Microsoft <a class="reference external" href="https://github.com/powershell/DscResources">frequently adds new resources</a> to the DSC resource collection.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Using the <strong>dsc_resource</strong> has the following requirements:</p>
<ul class="last">
<li><p class="first">Windows Management Framework (WMF) 5.0 February Preview (or higher), which includes Windows PowerShell 5.0.10018.0 (or higher).</p>
</li>
<li><p class="first">The <tt class="docutils literal"><span class="pre">RefreshMode</span></tt> configuration setting in the Local Configuration Manager must be set to <tt class="docutils literal"><span class="pre">Disabled</span></tt>.</p>
<p><strong>NOTE:</strong> Starting with the chef-client 12.6 release, this requirement applies only for versions of Windows PowerShell earlier than 5.0.10586.0. The latest version of Windows Management Framework (WMF) 5 has relaxed the limitation that prevented the chef-client from running in non-disabled refresh mode.</p>
</li>
<li><p class="first">The <strong>dsc_script</strong> resource  may not be used in the same run-list with the <strong>dsc_resource</strong>. This is because the <strong>dsc_script</strong> resource requires that <tt class="docutils literal"><span class="pre">RefreshMode</span></tt> in the Local Configuration Manager be set to <tt class="docutils literal"><span class="pre">Push</span></tt>, whereas the <strong>dsc_resource</strong> resource requires it to be set to <tt class="docutils literal"><span class="pre">Disabled</span></tt>.</p>
<p><strong>NOTE:</strong> Starting with the chef-client 12.6 release, this requirement applies only for versions of Windows PowerShell earlier than 5.0.10586.0. The latest version of Windows Management Framework (WMF) 5 has relaxed the limitation that prevented the chef-client from running in non-disabled refresh mode, which allows the Local Configuration Manager to be set to <tt class="docutils literal"><span class="pre">Push</span></tt>.</p>
</li>
<li><p class="first">The <strong>dsc_resource</strong> resource can only use binary- or script-based resources. Composite DSC resources may not be used.</p>
<p>This is because composite resources aren&#8217;t &#8220;real&#8221; resources from the perspective of the the Local Configuration Manager (LCM). Composite resources are used by the &#8220;configuration&#8221; keyword from the <tt class="docutils literal"><span class="pre">PSDesiredStateConfiguration</span></tt> module, and then evaluated in that context. When using DSC to create the configuration document (the Managed Object Framework (MOF) file) from the configuration command, the composite resource is evaluated. Any individual resources from that composite resource are written into the Managed Object Framework (MOF) document. As far as the Local Configuration Manager (LCM) is concerned, there is no such thing as a composite resource. Unless that changes, the <strong>dsc_resource</strong> resource and/or <tt class="docutils literal"><span class="pre">Invoke-DscResource</span></tt> command cannot directly use them.</p>
</li>
</ul>
</div>
<div class="section" id="id88">
<h3>Syntax<a class="headerlink" href="#id88" title="Permalink to this headline">¶</a></h3>
<p>A <strong>dsc_resource</strong> resource block allows DSC resourcs to be used in a Chef recipe. For example, the DSC <tt class="docutils literal"><span class="pre">Archive</span></tt> resource:</p>
<div class="highlight-powershell"><div class="highlight"><pre><span></span><span class="n">Archive</span> <span class="n">ExampleArchive</span> <span class="p">{</span>
  <span class="n">Ensure</span> <span class="p">=</span> <span class="s2">&quot;Present&quot;</span>
  <span class="n">Path</span> <span class="p">=</span> <span class="s2">&quot;C:\Users\Public\Documents\example.zip&quot;</span>
  <span class="n">Destination</span> <span class="p">=</span> <span class="s2">&quot;C:\Users\Public\Documents\ExtractionPath&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>and then the same <strong>dsc_resource</strong> with Chef:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_resource</span> <span class="s1">&#39;example&#39;</span> <span class="k">do</span>
   <span class="n">resource</span> <span class="ss">:archive</span>
   <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;Present&#39;</span>
   <span class="n">property</span> <span class="ss">:path</span><span class="p">,</span> <span class="s2">&quot;C:\Users\Public\Documents</span><span class="se">\e</span><span class="s2">xample.zip&quot;</span>
   <span class="n">property</span> <span class="ss">:destination</span><span class="p">,</span> <span class="s2">&quot;C:\Users\Public\Documents\ExtractionPath&quot;</span>
 <span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>dsc_resource</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_resource</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">module_name</span>                <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">property</span>                   <span class="no">Symbol</span>
  <span class="n">resource</span>                   <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">dsc_resource</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">property</span></tt> is zero (or more) properties in the DSC resource, where each property is entered on a separate line, <tt class="docutils literal"><span class="pre">:dsc_property_name</span></tt> is the case-insensitive name of that property, and <tt class="docutils literal"><span class="pre">&quot;property_value&quot;</span></tt> is a Ruby value to be applied by the chef-client</li>
<li><tt class="docutils literal"><span class="pre">module_name</span></tt>, <tt class="docutils literal"><span class="pre">property</span></tt>, and <tt class="docutils literal"><span class="pre">resource</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id89">
<h3>Actions<a class="headerlink" href="#id89" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd><p class="first">Default.</p>
<p class="last">Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">:reboot_action</span></tt></dt>
<dd>Use to request an immediate reboot or to queue a reboot using the <tt class="docutils literal"><span class="pre">:reboot_now</span></tt> (immediate reboot) or <tt class="docutils literal"><span class="pre">:request_reboot</span></tt> (queued reboot) actions built into the <strong>reboot</strong> resource.</dd>
</dl>
</div>
<div class="section" id="id90">
<h3>Properties<a class="headerlink" href="#id90" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">module_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of the module from which a DSC resource originates. If this property is not specified, it will be inferred.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">property</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol</p>
<p>A property from a Desired State Configuration (DSC) resource. Use this property multiple times, one for each property in the Desired State Configuration (DSC) resource. The format for this property must follow <tt class="docutils literal"><span class="pre">property</span> <span class="pre">:dsc_property_name,</span> <span class="pre">&quot;property_value&quot;</span></tt> for each DSC property added to the resource block.</p>
<p>The <tt class="docutils literal"><span class="pre">:dsc_property_name</span></tt> must be a symbol.</p>
<p>Use the following Ruby types to define <tt class="docutils literal"><span class="pre">property_value</span></tt>:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Ruby</th>
<th class="head">Windows PowerShell</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">Array</span></tt></td>
<td><tt class="docutils literal"><span class="pre">Object[]</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">Chef::Util::Powershell:PSCredential</span></tt></td>
<td><tt class="docutils literal"><span class="pre">PSCredential</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">FalseClass</span></tt></td>
<td><tt class="docutils literal"><span class="pre">bool($false)</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">Fixnum</span></tt></td>
<td><tt class="docutils literal"><span class="pre">Integer</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">Float</span></tt></td>
<td><tt class="docutils literal"><span class="pre">Double</span></tt></td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">Hash</span></tt></td>
<td><tt class="docutils literal"><span class="pre">Hashtable</span></tt></td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">TrueClass</span></tt></td>
<td><tt class="docutils literal"><span class="pre">bool($true)</span></tt></td>
</tr>
</tbody>
</table>
<p class="last">These are converted into the corresponding Windows PowerShell type during the chef-client run.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">resource</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p>The name of the DSC resource. This value is case-insensitive and must be a symbol that matches the name of the DSC resource.</p>
<p>For built-in DSC resources, use the following values:</p>
<table border="1" class="docutils">
<colgroup>
<col width="50%" />
<col width="50%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Value</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:archive</span></tt></td>
<td>Use to to <a class="reference external" href="https://msdn.microsoft.com/en-us/powershell/dsc/archiveresource">unpack archive (.zip) files</a>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:environment</span></tt></td>
<td>Use to to <a class="reference external" href="https://msdn.microsoft.com/en-us/powershell/dsc/environmentresource">manage system environment variables</a>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:file</span></tt></td>
<td>Use to to <a class="reference external" href="https://msdn.microsoft.com/en-us/powershell/dsc/fileresource">manage files and directories</a>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:group</span></tt></td>
<td>Use to to <a class="reference external" href="https://msdn.microsoft.com/en-us/powershell/dsc/groupresource">manage local groups</a>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:log</span></tt></td>
<td>Use to to <a class="reference external" href="https://msdn.microsoft.com/en-us/powershell/dsc/logresource">log configuration messages</a>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:package</span></tt></td>
<td>Use to to <a class="reference external" href="https://msdn.microsoft.com/en-us/powershell/dsc/packageresource">install and manage packages</a>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:registry</span></tt></td>
<td>Use to to <a class="reference external" href="https://msdn.microsoft.com/en-us/powershell/dsc/registryresource">manage registry keys and registry key values</a>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:script</span></tt></td>
<td>Use to to <a class="reference external" href="https://msdn.microsoft.com/en-us/powershell/dsc/scriptresource">run Powershell script blocks</a>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:service</span></tt></td>
<td>Use to to <a class="reference external" href="https://msdn.microsoft.com/en-us/powershell/dsc/serviceresource">manage services</a>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:user</span></tt></td>
<td>Use to to <a class="reference external" href="https://msdn.microsoft.com/en-us/powershell/dsc/userresource">manage local user accounts</a>.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:windowsfeature</span></tt></td>
<td>Use to to <a class="reference external" href="https://msdn.microsoft.com/en-us/powershell/dsc/windowsfeatureresource">add or remove Windows features and roles</a>.</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:windowsoptionalfeature</span></tt></td>
<td>Use to configure Microsoft Windows optional features.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:windowsprocess</span></tt></td>
<td>Use to to <a class="reference external" href="https://msdn.microsoft.com/en-us/powershell/dsc/windowsprocessresource">configure Windows processes</a>.</td>
</tr>
</tbody>
</table>
<p class="last">Any DSC resource may be used in a Chef recipe. For example, the DSC Resource Kit contains resources for <a class="reference external" href="http://www.powershellgallery.com/packages/xActiveDirectory/2.8.0.0">configuring Active Directory components</a>, such as <tt class="docutils literal"><span class="pre">xADDomain</span></tt>, <tt class="docutils literal"><span class="pre">xADDomainController</span></tt>, and <tt class="docutils literal"><span class="pre">xADUser</span></tt>. Assuming that these resources are available to the chef-client, the corresponding values for the <tt class="docutils literal"><span class="pre">resource</span></tt> attribute would be: <tt class="docutils literal"><span class="pre">:xADDomain</span></tt>, <tt class="docutils literal"><span class="pre">:xADDomainController</span></tt>, and <tt class="docutils literal"><span class="pre">xADUser</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="id91">
<h3>Examples<a class="headerlink" href="#id91" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Open a Zip file</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_resource</span> <span class="s1">&#39;example&#39;</span> <span class="k">do</span>
   <span class="n">resource</span> <span class="ss">:archive</span>
   <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;Present&#39;</span>
   <span class="n">property</span> <span class="ss">:path</span><span class="p">,</span> <span class="s1">&#39;C:\Users\Public\Documents\example.zip&#39;</span>
   <span class="n">property</span> <span class="ss">:destination</span><span class="p">,</span> <span class="s1">&#39;C:\Users\Public\Documents\ExtractionPath&#39;</span>
 <span class="k">end</span>
</pre></div>
</div>
<p><strong>Manage users and groups</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_resource</span> <span class="s1">&#39;demogroupadd&#39;</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:group</span>
  <span class="n">property</span> <span class="ss">:groupname</span><span class="p">,</span> <span class="s1">&#39;demo1&#39;</span>
  <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;present&#39;</span>
<span class="k">end</span>

<span class="n">dsc_resource</span> <span class="s1">&#39;useradd&#39;</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:user</span>
  <span class="n">property</span> <span class="ss">:username</span><span class="p">,</span> <span class="s1">&#39;Foobar1&#39;</span>
  <span class="n">property</span> <span class="ss">:fullname</span><span class="p">,</span> <span class="s1">&#39;Foobar1&#39;</span>
  <span class="n">property</span> <span class="ss">:password</span><span class="p">,</span> <span class="n">ps_credential</span><span class="p">(</span><span class="s1">&#39;P@assword!&#39;</span><span class="p">)</span>
  <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;present&#39;</span>
<span class="k">end</span>

<span class="n">dsc_resource</span> <span class="s1">&#39;AddFoobar1ToUsers&#39;</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:Group</span>
  <span class="n">property</span> <span class="ss">:GroupName</span><span class="p">,</span> <span class="s1">&#39;demo1&#39;</span>
  <span class="n">property</span> <span class="ss">:MembersToInclude</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Foobar1&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create and register a windows service</strong></p>
<p>The following example creates a windows service, defines it&#8217;s execution path, and prevents windows from starting the service
in case the executable is not at the defined location:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_resource</span> <span class="s1">&#39;NAME&#39;</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:service</span>
  <span class="n">property</span> <span class="ss">:name</span><span class="p">,</span> <span class="s1">&#39;NAME&#39;</span>
  <span class="n">property</span> <span class="ss">:startuptype</span><span class="p">,</span> <span class="s1">&#39;Disabled&#39;</span>
  <span class="n">property</span> <span class="ss">:path</span><span class="p">,</span> <span class="s1">&#39;D:\\Sites\\Site_name\file_to_run.exe&#39;</span>
  <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;Present&#39;</span>
  <span class="n">property</span> <span class="ss">:state</span><span class="p">,</span> <span class="s1">&#39;Stopped&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a test message queue</strong></p>
<p>The following example creates a file on a node (based on one that is located in a cookbook), unpacks the <tt class="docutils literal"><span class="pre">MessageQueue.zip</span></tt> Windows PowerShell module, and then uses the <strong>dsc_resource</strong> to ensure that Message Queuing (MSMQ) sub-features are installed, a test queue is created, and that permissions are set on the test queue:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;cMessageQueue.zip&#39;</span> <span class="k">do</span>
  <span class="n">path</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="se">\\</span><span class="s2">MessageQueue.zip&quot;</span>
  <span class="n">action</span> <span class="ss">:create_if_missing</span>
<span class="k">end</span>

<span class="n">windows_zipfile</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PROGRAMW6432&#39;</span><span class="o">]</span><span class="si">}</span><span class="se">\\</span><span class="s2">WindowsPowerShell</span><span class="se">\\</span><span class="s2">Modules&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="se">\\</span><span class="s2">MessageQueue.zip&quot;</span>
  <span class="n">action</span> <span class="ss">:unzip</span>
<span class="k">end</span>

<span class="n">dsc_resource</span> <span class="s1">&#39;install-sub-features&#39;</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:windowsfeature</span>
  <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;Present&#39;</span>
  <span class="n">property</span> <span class="ss">:name</span><span class="p">,</span> <span class="s1">&#39;msmq&#39;</span>
  <span class="n">property</span> <span class="ss">:IncludeAllSubFeature</span><span class="p">,</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">dsc_resource</span> <span class="s1">&#39;create-test-queue&#39;</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:cPrivateMsmqQueue</span>
  <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;Present&#39;</span>
  <span class="n">property</span> <span class="ss">:name</span><span class="p">,</span> <span class="s1">&#39;Test_Queue&#39;</span>
<span class="k">end</span>

<span class="n">dsc_resource</span> <span class="s1">&#39;set-permissions&#39;</span> <span class="k">do</span>
  <span class="n">resource</span> <span class="ss">:cPrivateMsmqQueuePermissions</span>
  <span class="n">property</span> <span class="ss">:ensure</span><span class="p">,</span> <span class="s1">&#39;Present&#39;</span>
  <span class="n">property</span> <span class="ss">:name</span><span class="p">,</span> <span class="s1">&#39;Test_Queue_Permissions&#39;</span>
  <span class="n">property</span> <span class="ss">:QueueNames</span><span class="p">,</span> <span class="s1">&#39;Test_Queue&#39;</span>
  <span class="n">property</span> <span class="ss">:ReadUsers</span><span class="p">,</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;msmq&#39;</span><span class="o">][</span><span class="s1">&#39;read_user&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="dsc-script">
<h2>dsc_script<a class="headerlink" href="#dsc-script" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_dsc_script.rst">[edit on GitHub]</a></p>
<p>Windows PowerShell is a task-based command-line shell and scripting language developed by Microsoft. Windows PowerShell uses a document-oriented approach for managing Microsoft Windows-based machines, similar to the approach that is used for managing UNIX- and Linux-based machines. Windows PowerShell is <a class="reference external" href="http://technet.microsoft.com/en-us/library/bb978526.aspx">a tool-agnostic platform</a> that supports using Chef for configuration management.</p>
<p>Desired State Configuration (DSC) is a feature of Windows PowerShell that provides <a class="reference external" href="http://technet.microsoft.com/en-us/library/dn249912.aspx">a set of language extensions, cmdlets, and resources</a> that can be used to declaratively configure software. DSC is similar to Chef, in that both tools are idempotent, take similar approaches to the concept of resources, describe the configuration of a system, and then take the steps required to do that configuration. The most important difference between Chef and DSC is that Chef uses Ruby and DSC is exposed as configuration data from within Windows PowerShell.</p>
<p>Many DSC resources are comparable to built-in Chef resources. For example, both DSC and Chef have <strong>file</strong>, <strong>package</strong>, and <strong>service</strong> resources. The <strong>dsc_script</strong> resource is most useful for those DSC resources that do not have a direct comparison to a resource in Chef, such as the <tt class="docutils literal"><span class="pre">Archive</span></tt> resource, a custom DSC resource, an existing DSC script that performs an important task, and so on. Use the <strong>dsc_script</strong> resource to embed the code that defines a DSC configuration directly within a Chef recipe.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Windows PowerShell 4.0 is required for using the <strong>dsc_script</strong> resource with Chef.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The WinRM service must be enabled. (Use <tt class="docutils literal"><span class="pre">winrm</span> <span class="pre">quickconfig</span></tt> to enable the service.)</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>dsc_script</strong> resource  may not be used in the same run-list with the <strong>dsc_resource</strong>. This is because the <strong>dsc_script</strong> resource requires that <tt class="docutils literal"><span class="pre">RefreshMode</span></tt> in the Local Configuration Manager be set to <tt class="docutils literal"><span class="pre">Push</span></tt>, whereas the <strong>dsc_resource</strong> resource requires it to be set to <tt class="docutils literal"><span class="pre">Disabled</span></tt>.</p>
</div>
<div class="section" id="id94">
<h3>Syntax<a class="headerlink" href="#id94" title="Permalink to this headline">¶</a></h3>
<p>A <strong>dsc_script</strong> resource block embeds the code that defines a DSC configuration directly within a Chef recipe:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_script</span> <span class="s1">&#39;get-dsc-resource-kit&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    Archive reskit</span>
<span class="sh">    {</span>
<span class="sh">      ensure = &#39;Present&#39;</span>
<span class="sh">      path = &quot;#{Chef::Config[:file_cache_path]}\\DSCResourceKit620082014.zip&quot;</span>
<span class="sh">      destination = &quot;#{ENV[&#39;PROGRAMW6432&#39;]}\\WindowsPowerShell\\Modules&quot;</span>
<span class="sh">    }</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <strong>remote_file</strong> resource is first used to download the <tt class="docutils literal"><span class="pre">DSCResourceKit620082014.zip</span></tt> file.</p>
<p>The full syntax for all of the properties that are available to the <strong>dsc_script</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_script</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">code</span>                       <span class="nb">String</span>
  <span class="n">command</span>                    <span class="nb">String</span>
  <span class="n">configuration_data</span>         <span class="nb">String</span>
  <span class="n">configuration_data_script</span>  <span class="nb">String</span>
  <span class="n">configuration_name</span>         <span class="nb">String</span>
  <span class="n">cwd</span>                        <span class="nb">String</span>
  <span class="n">environment</span>                <span class="no">Hash</span>
  <span class="n">flags</span>                      <span class="no">Hash</span>
  <span class="n">imports</span>                    <span class="nb">Array</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :run if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">dsc_script</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">code</span></tt>, <tt class="docutils literal"><span class="pre">command</span></tt>, <tt class="docutils literal"><span class="pre">configuration_data</span></tt>, <tt class="docutils literal"><span class="pre">configuration_data_script</span></tt>, <tt class="docutils literal"><span class="pre">configuration_name</span></tt>, <tt class="docutils literal"><span class="pre">cwd</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">flags</span></tt>, <tt class="docutils literal"><span class="pre">imports</span></tt>, and <tt class="docutils literal"><span class="pre">timeout</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id95">
<h3>Actions<a class="headerlink" href="#id95" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<p><tt class="docutils literal"><span class="pre">:nothing</span></tt></p>
<blockquote>
<div>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</div></blockquote>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:run</span></tt></dt>
<dd>Default. Use to run the DSC configuration defined as defined in this resource.</dd>
</dl>
</div>
<div class="section" id="id96">
<h3>Properties<a class="headerlink" href="#id96" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">code</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The code for the DSC configuration script. This property may not be used in the same recipe as the <tt class="docutils literal"><span class="pre">command</span></tt> property.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The path to a valid Windows PowerShell data file that contains the DSC configuration script. This data file must be capable of running independently of Chef and must generate a valid DSC configuration. This property may not be used in the same recipe as the <tt class="docutils literal"><span class="pre">code</span></tt> property.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">configuration_data</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The configuration data for the DSC script. The configuration data must be <a class="reference external" href="http://msdn.microsoft.com/en-us/library/dd878337(v=vs.85).aspx">a valid Windows Powershell data file</a>. This property may not be used in the same recipe as the <tt class="docutils literal"><span class="pre">configuration_data_script</span></tt> property.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">configuration_data_script</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The path to a valid Windows PowerShell data file that also contains a node called <tt class="docutils literal"><span class="pre">localhost</span></tt>. This property may not be used in the same recipe as the <tt class="docutils literal"><span class="pre">configuration_data</span></tt> property.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">configuration_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of a valid Windows PowerShell cmdlet. The name may only contain letter (a-z, A-Z), number (0-9), and underscore (_) characters and should start with a letter. The name may not be null or empty. This property may not be used in the same recipe as the <tt class="docutils literal"><span class="pre">code</span></tt> property.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">cwd</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The current working directory.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">environment</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A Hash of environment variables in the form of <tt class="docutils literal"><span class="pre">({&quot;ENV_VARIABLE&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;VALUE&quot;})</span></tt>. (These variables must exist for a command to be run successfully.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">flags</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">Pass parameters to the DSC script that is specified by the <tt class="docutils literal"><span class="pre">command</span></tt> property. Parameters are defined as key-value pairs, where the value of each key is the parameter to pass. This property may not be used in the same recipe as the <tt class="docutils literal"><span class="pre">code</span></tt> property. For example: <tt class="docutils literal"><span class="pre">flags</span> <span class="pre">({</span> <span class="pre">:EditorChoice</span> <span class="pre">=&gt;</span> <span class="pre">'emacs',</span> <span class="pre">:EditorFlags</span> <span class="pre">=&gt;</span> <span class="pre">'--maximized'</span> <span class="pre">})</span></tt>. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">imports</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This property <strong>MUST</strong> be used with the <tt class="docutils literal"><span class="pre">code</span></tt> attribute.</p>
</div>
<p>Use to import DSC resources from a module.</p>
<p>To import all resources from a module, specify only the module name:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">imports</span> <span class="s1">&#39;module_name&#39;</span>
</pre></div>
</div>
<p>To import specific resources, specify the module name, and then specify the name for each resource in that module to import:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">imports</span> <span class="s1">&#39;module_name&#39;</span><span class="p">,</span> <span class="s1">&#39;resource_name_a&#39;</span><span class="p">,</span> <span class="s1">&#39;resource_name_b&#39;</span><span class="p">,</span> <span class="o">...</span>
</pre></div>
</div>
<p>For example, to import all resources from a module named <tt class="docutils literal"><span class="pre">cRDPEnabled</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">imports</span> <span class="s1">&#39;cRDPEnabled&#39;</span>
</pre></div>
</div>
<p>To import only the <tt class="docutils literal"><span class="pre">PSHOrg_cRDPEnabled</span></tt> resource:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">imports</span> <span class="s1">&#39;cRDPEnabled&#39;</span><span class="p">,</span> <span class="s1">&#39;PSHOrg_cRDPEnabled&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer</p>
<p class="last">The amount of time (in seconds) a command is to wait before timing out.</p>
</dd>
</dl>
<div class="section" id="ps-credential-helper">
<h4>ps_credential Helper<a class="headerlink" href="#ps-credential-helper" title="Permalink to this headline">¶</a></h4>
<p>Use the <tt class="docutils literal"><span class="pre">ps_credential</span></tt> helper to embed a <tt class="docutils literal"><span class="pre">PSCredential</span></tt> object&#8212;<a class="reference external" href="https://technet.microsoft.com/en-us/magazine/ff714574.aspx">a set of security credentials, such as a user name or password</a>&#8212;within a script, which allows that script to be run using security credentials.</p>
<p>For example, assuming the <tt class="docutils literal"><span class="pre">CertificateID</span></tt> is configured in the local configuration manager, the <tt class="docutils literal"><span class="pre">SeaPower1&#64;3</span></tt> object is created and embedded within the <tt class="docutils literal"><span class="pre">seapower-user</span></tt> script:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span> <span class="n">dsc_script</span> <span class="s1">&#39;seapower-user&#39;</span> <span class="k">do</span>
   <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">     User AlbertAtom</span>
<span class="sh">     {</span>
<span class="sh">       UserName = &#39;AlbertAtom&#39;</span>
<span class="sh">       Password = #{ps_credential(&#39;SeaPower1@3&#39;)}</span>
<span class="sh">     }</span>
<span class="no">  EOH</span>
  <span class="n">configuration_data</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    @{</span>
<span class="sh">      AllNodes = @(</span>
<span class="sh">        @{</span>
<span class="sh">          NodeName = &quot;localhost&quot;;</span>
<span class="sh">          CertificateID = &#39;A8D1234559F349F7EF19104678908F701D4167&#39;</span>
<span class="sh">        }</span>
<span class="sh">      )</span>
<span class="sh">    }</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id97">
<h3>Examples<a class="headerlink" href="#id97" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Specify DSC code directly</strong></p>
<p>DSC data can be specified directly in a recipe:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_script</span> <span class="s1">&#39;emacs&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  Environment &#39;texteditor&#39;</span>
<span class="sh">  {</span>
<span class="sh">    Name = &#39;EDITOR&#39;</span>
<span class="sh">    Value = &#39;c:\\emacs\\bin\\emacs.exe&#39;</span>
<span class="sh">  }</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify DSC code using a Windows Powershell data file</strong></p>
<p>Use the <tt class="docutils literal"><span class="pre">command</span></tt> property to specify the path to a Windows PowerShell data file. For example, the following Windows PowerShell script defines the <tt class="docutils literal"><span class="pre">DefaultEditor</span></tt>:</p>
<div class="highlight-powershell"><div class="highlight"><pre><span></span><span class="n">Configuration</span> <span class="s1">&#39;DefaultEditor&#39;</span>
<span class="p">{</span>
  <span class="n">Environment</span> <span class="s1">&#39;texteditor&#39;</span>
    <span class="p">{</span>
      <span class="n">Name</span> <span class="p">=</span> <span class="s1">&#39;EDITOR&#39;</span>
      <span class="n">Value</span> <span class="p">=</span> <span class="s1">&#39;c:\emacs\bin\emacs.exe&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Use the following recipe to specify the location of that data file:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_script</span> <span class="s1">&#39;DefaultEditor&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;c:\dsc_scripts\emacs.ps1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Pass parameters to DSC configurations</strong></p>
<p>If a DSC script contains configuration data that takes parameters, those parameters may be passed using the <tt class="docutils literal"><span class="pre">flags</span></tt> property. For example, the following Windows PowerShell script takes parameters for the <tt class="docutils literal"><span class="pre">EditorChoice</span></tt> and <tt class="docutils literal"><span class="pre">EditorFlags</span></tt> settings:</p>
<div class="highlight-powershell"><div class="highlight"><pre><span></span><span class="nv">$choices</span> <span class="p">=</span> <span class="p">@{</span><span class="s1">&#39;emacs&#39;</span> <span class="p">=</span> <span class="s1">&#39;c:\emacs\bin\emacs&#39;</span><span class="p">;</span><span class="s1">&#39;vi&#39;</span> <span class="p">=</span> <span class="s1">&#39;c:\vim\vim.exe&#39;</span><span class="p">;</span><span class="s1">&#39;powershell&#39;</span> <span class="p">=</span> <span class="s1">&#39;powershell_ise.exe&#39;</span><span class="p">}</span>
  <span class="n">Configuration</span> <span class="s1">&#39;DefaultEditor&#39;</span>
    <span class="p">{</span>
      <span class="p">[</span><span class="k">CmdletBinding</span><span class="p">()]</span>
      <span class="k">param</span>
        <span class="p">(</span>
          <span class="nv">$EditorChoice</span><span class="p">,</span>
          <span class="nv">$EditorFlags</span> <span class="p">=</span> <span class="s1">&#39;&#39;</span>
        <span class="p">)</span>
      <span class="n">Environment</span> <span class="s1">&#39;TextEditor&#39;</span>
      <span class="p">{</span>
        <span class="n">Name</span> <span class="p">=</span> <span class="s1">&#39;EDITOR&#39;</span>
        <span class="n">Value</span> <span class="p">=</span>  <span class="s2">&quot;</span><span class="p">$(</span><span class="nv">$choices</span><span class="p">[</span><span class="nv">$EditorChoice</span><span class="p">])</span><span class="s2"> $EditorFlags&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>Use the following recipe to set those parameters:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_script</span> <span class="s1">&#39;DefaultEditor&#39;</span> <span class="k">do</span>
  <span class="n">flags</span> <span class="p">({</span> <span class="ss">:EditorChoice</span> <span class="o">=&gt;</span> <span class="s1">&#39;emacs&#39;</span><span class="p">,</span> <span class="ss">:EditorFlags</span> <span class="o">=&gt;</span> <span class="s1">&#39;--maximized&#39;</span> <span class="p">})</span>
  <span class="n">command</span> <span class="s1">&#39;c:\dsc_scripts\editors.ps1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use custom configuration data</strong></p>
<p>Configuration data in DSC scripts may be customized from a recipe. For example, scripts are typically customized to set the behavior for Windows PowerShell credential data types. Configuration data may be specified in one of three ways:</p>
<ul class="simple">
<li>By using the <tt class="docutils literal"><span class="pre">configuration_data</span></tt> attribute</li>
<li>By using the <tt class="docutils literal"><span class="pre">configuration_data_script</span></tt> attribute</li>
<li>By specifying the path to a valid Windows PowerShell data file</li>
</ul>
<p>The following example shows how to specify custom configuration data using the <tt class="docutils literal"><span class="pre">configuration_data</span></tt> property:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_script</span> <span class="s1">&#39;BackupUser&#39;</span> <span class="k">do</span>
  <span class="n">configuration_data</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    @{</span>
<span class="sh">     AllNodes = @(</span>
<span class="sh">          @{</span>
<span class="sh">          NodeName = &quot;localhost&quot;;</span>
<span class="sh">          PSDscAllowPlainTextPassword = $true</span>
<span class="sh">          })</span>
<span class="sh">     }</span>
<span class="no">  EOH</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    $user = &#39;backup&#39;</span>
<span class="sh">    $password = ConvertTo-SecureString -String &quot;YourPass$(random)&quot; -AsPlainText -Force</span>
<span class="sh">    $cred = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList $user, $password</span>

<span class="sh">   User $user</span>
<span class="sh">     {</span>
<span class="sh">       UserName = $user</span>
<span class="sh">       Password = $cred</span>
<span class="sh">       Description = &#39;Backup operator&#39;</span>
<span class="sh">       Ensure = &quot;Present&quot;</span>
<span class="sh">       Disabled = $false</span>
<span class="sh">       PasswordNeverExpires = $true</span>
<span class="sh">       PasswordChangeRequired = $false</span>
<span class="sh">     }</span>
<span class="no">   EOH</span>

  <span class="n">configuration_data</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    @{</span>
<span class="sh">      AllNodes = @(</span>
<span class="sh">          @{</span>
<span class="sh">          NodeName = &quot;localhost&quot;;</span>
<span class="sh">          PSDscAllowPlainTextPassword = $true</span>
<span class="sh">          })</span>
<span class="sh">      }</span>
<span class="no">    EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example shows how to specify custom configuration data using the <tt class="docutils literal"><span class="pre">configuration_name</span></tt> property. For example, the following Windows PowerShell script defines the <tt class="docutils literal"><span class="pre">vi</span></tt> configuration:</p>
<div class="highlight-powershell"><div class="highlight"><pre><span></span><span class="n">Configuration</span> <span class="s1">&#39;emacs&#39;</span>
  <span class="p">{</span>
    <span class="n">Environment</span> <span class="s1">&#39;TextEditor&#39;</span>
    <span class="p">{</span>
      <span class="n">Name</span> <span class="p">=</span> <span class="s1">&#39;EDITOR&#39;</span>
      <span class="n">Value</span> <span class="p">=</span> <span class="s1">&#39;c:\emacs\bin\emacs.exe&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">Configuration</span> <span class="s1">&#39;vi&#39;</span>
<span class="p">{</span>
    <span class="n">Environment</span> <span class="s1">&#39;TextEditor&#39;</span>
    <span class="p">{</span>
      <span class="n">Name</span> <span class="p">=</span> <span class="s1">&#39;EDITOR&#39;</span>
      <span class="n">Value</span> <span class="p">=</span> <span class="s1">&#39;c:\vim\bin\vim.exe&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Use the following recipe to specify that configuration:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">dsc_script</span> <span class="s1">&#39;EDITOR&#39;</span> <span class="k">do</span>
  <span class="n">configuration_name</span> <span class="s1">&#39;vi&#39;</span>
  <span class="n">command</span> <span class="s1">&#39;C:\dsc_scripts\editors.ps1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Using DSC with other Chef resources</strong></p>
<p>The <strong>dsc_script</strong> resource can be used with other resources. The following example shows how to download a file using the <strong>remote_file</strong> resource, and then uncompress it using the DSC <tt class="docutils literal"><span class="pre">Archive</span></tt> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="se">\\</span><span class="s2">DSCResourceKit620082014.zip&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://gallery.technet.microsoft.com/DSC-Resource-Kit-All-c449312d/file/124481/1/DSC%20Resource%20Kit%20Wave%206%2008282014.zip&#39;</span>
<span class="k">end</span>

<span class="n">dsc_script</span> <span class="s1">&#39;get-dsc-resource-kit&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    Archive reskit</span>
<span class="sh">    {</span>
<span class="sh">      ensure = &#39;Present&#39;</span>
<span class="sh">      path = &quot;#{Chef::Config[:file_cache_path]}\\DSCResourceKit620082014.zip&quot;</span>
<span class="sh">      destination = &quot;#{ENV[&#39;PROGRAMW6432&#39;]}\\WindowsPowerShell\\Modules&quot;</span>
<span class="sh">    }</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="easy-install-package">
<h2>easy_install_package<a class="headerlink" href="#easy-install-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_easy_install_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>easy_install_package</strong> resource to manage packages for the Python platform.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id98">
<h3>Syntax<a class="headerlink" href="#id98" title="Permalink to this headline">¶</a></h3>
<p>A <strong>easy_install_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>easy_install_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">easy_install_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>easy_install_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">easy_install_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">easy_install_binary</span>        <span class="nb">String</span>
  <span class="n">module_name</span>                <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">EasyInstall</span>
  <span class="n">python_binary</span>              <span class="nb">String</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">easy_install_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">easy_install_binary</span></tt>, <tt class="docutils literal"><span class="pre">module_name</span></tt>, <tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">python_binary</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id99">
<h3>Actions<a class="headerlink" href="#id99" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:purge</span></tt></dt>
<dd>Purge a package. This action typically removes the configuration files as well as the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version.</dd>
</dl>
</div>
<div class="section" id="id100">
<h3>Properties<a class="headerlink" href="#id100" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">easy_install_binary</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The location of the Easy Install binary.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">module_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of the module.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">python_binary</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The location of the Python binary.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id101">
<h3>Providers<a class="headerlink" href="#id101" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::EasyInstall</span></tt>, <tt class="docutils literal"><span class="pre">easy_install_package</span></tt></dt>
<dd>The provider for Python.</dd>
</dl>
</div>
<div class="section" id="id102">
<h3>Examples<a class="headerlink" href="#id102" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">easy_install_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="env">
<h2>env<a class="headerlink" href="#env" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_env.rst">[edit on GitHub]</a></p>
<p>Use the <strong>env</strong> resource to manage environment keys in Microsoft Windows. After an environment key is set, Microsoft Windows must be restarted before the environment key will be available to the Task Scheduler.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On UNIX-based systems, the best way to manipulate environment keys is with the <tt class="docutils literal"><span class="pre">ENV</span></tt> variable in Ruby; however, this approach does not have the same permanent effect as using the <strong>env</strong> resource.</p>
</div>
<div class="section" id="id103">
<h3>Syntax<a class="headerlink" href="#id103" title="Permalink to this headline">¶</a></h3>
<p>A <strong>env</strong> resource block manages environment keys in Microsoft Windows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="s1">&#39;ComSpec&#39;</span> <span class="k">do</span>
  <span class="n">value</span> <span class="s1">&#39;C:\\Windows\\system32\\cmd.exe&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>env</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">delim</span>                      <span class="nb">String</span>
  <span class="n">key_name</span>                   <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Env</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">value</span>                      <span class="nb">String</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">env</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">delim</span></tt>, <tt class="docutils literal"><span class="pre">key_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, and <tt class="docutils literal"><span class="pre">value</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id104">
<h3>Actions<a class="headerlink" href="#id104" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>Default. Create an environment variable. If an environment variable already exists (but does not match), update that environment variable to match.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Delete an environment variable.</dd>
<dt><tt class="docutils literal"><span class="pre">:modify</span></tt></dt>
<dd>Modify an existing environment variable. This prepends the new value to the existing value, using the delimiter specified by the <tt class="docutils literal"><span class="pre">delim</span></tt> property.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
</dl>
</div>
<div class="section" id="id105">
<h3>Properties<a class="headerlink" href="#id105" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">delim</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The delimiter that is used to separate multiple values for a single key.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">key_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of the key that is to be created, deleted, or modified. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">value</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The value with which <tt class="docutils literal"><span class="pre">key_name</span></tt> is set.</p>
</dd>
</dl>
<div class="section" id="id106">
<h4>Guards<a class="headerlink" href="#id106" title="Permalink to this headline">¶</a></h4>
<p>A guard property can be used to evaluate the state of a node during the execution phase of the chef-client run. Based on the results of this evaluation, a guard property is then used to tell the chef-client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p>
<ul class="simple">
<li>A string is executed as a shell command. If the command returns <tt class="docutils literal"><span class="pre">0</span></tt>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <tt class="docutils literal"><span class="pre">true</span></tt> in addition to <tt class="docutils literal"><span class="pre">0</span></tt>.</li>
<li>A block is executed as Ruby code that must return either <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. If the block returns <tt class="docutils literal"><span class="pre">true</span></tt>, the guard property is applied. If the block returns <tt class="docutils literal"><span class="pre">false</span></tt>, the guard property is not applied.</li>
</ul>
<p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for the chef-client to do nothing.</p>
<p><strong>Attributes</strong></p>
<p>The following properties can be used to define a guard that is evaluated during the execution phase of the chef-client run:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">not_if</span></tt></dt>
<dd>Prevent a resource from executing when the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">only_if</span></tt></dt>
<dd>Allow a resource to execute only if the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
</dl>
<p><strong>Arguments</strong></p>
<p>The following arguments can be used with the <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:user</span></tt></dt>
<dd><p class="first">Specify the user that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:group</span></tt></dt>
<dd><p class="first">Specify the group that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:environment</span></tt></dt>
<dd><p class="first">Specify a Hash of environment variables to be set. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/adam&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:cwd</span></tt></dt>
<dd><p class="first">Set the current working directory before running a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam passwd&#39;</span><span class="p">,</span> <span class="ss">:cwd</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:timeout</span></tt></dt>
<dd><p class="first">Set a timeout for a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;sleep 10000&#39;</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="id107">
<h3>Examples<a class="headerlink" href="#id107" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Set an environment variable</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">env</span> <span class="s1">&#39;ComSpec&#39;</span> <span class="k">do</span>
  <span class="n">value</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Windows</span><span class="se">\\</span><span class="s2">system32</span><span class="se">\\</span><span class="s2">cmd.exe&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="erl-call">
<h2>erl_call<a class="headerlink" href="#erl-call" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_erlang_call.rst">[edit on GitHub]</a></p>
<p>Use the <strong>erl_call</strong> resource to connect to a node located within a distributed Erlang system. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">erl_call</span></tt> command needs to be on the path for this resource to work properly.</p>
</div>
<div class="section" id="id108">
<h3>Syntax<a class="headerlink" href="#id108" title="Permalink to this headline">¶</a></h3>
<p>A <strong>erl_call</strong> resource block connects to a node located within a distributed Erlang system:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">erl_call</span> <span class="s1">&#39;list names&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="s1">&#39;net_adm:names().&#39;</span>
  <span class="n">distributed</span> <span class="kp">true</span>
  <span class="n">node_name</span> <span class="s1">&#39;chef@latte&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>erl_call</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">erl_call</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">code</span>                       <span class="nb">String</span>
  <span class="n">cookie</span>                     <span class="nb">String</span>
  <span class="n">distributed</span>                <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">name_type</span>                  <span class="nb">String</span>
  <span class="n">node_name</span>                  <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">ErlCall</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :run if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">erl_call</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">code</span></tt>, <tt class="docutils literal"><span class="pre">cookie</span></tt>, <tt class="docutils literal"><span class="pre">distributed</span></tt>, <tt class="docutils literal"><span class="pre">name_type</span></tt>, <tt class="docutils literal"><span class="pre">node_name</span></tt>, and <tt class="docutils literal"><span class="pre">provider</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id109">
<h3>Actions<a class="headerlink" href="#id109" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Prevent the Erlang call from running.</dd>
<dt><tt class="docutils literal"><span class="pre">:run</span></tt></dt>
<dd>Default. Run the Erlang call.</dd>
</dl>
</div>
<div class="section" id="id110">
<h3>Properties<a class="headerlink" href="#id110" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">code</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The code to be executed on a node located within a distributed Erlang system. Default value: <tt class="docutils literal"><span class="pre">q()</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">cookie</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The magic cookie for the node to which a connection is made.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">distributed</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">The node is a distributed Erlang node. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">name_type</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The <tt class="docutils literal"><span class="pre">node_name</span></tt> property as a short node name (<tt class="docutils literal"><span class="pre">sname</span></tt>) or a long node name (<tt class="docutils literal"><span class="pre">name</span></tt>). A node with a long node name cannot communicate with a node with a short node name. Default value: <tt class="docutils literal"><span class="pre">sname</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">node_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The hostname to which the node is to connect. Default value: <tt class="docutils literal"><span class="pre">chef&#64;localhost</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
</dl>
<div class="section" id="id111">
<h4>Guards<a class="headerlink" href="#id111" title="Permalink to this headline">¶</a></h4>
<p>A guard property can be used to evaluate the state of a node during the execution phase of the chef-client run. Based on the results of this evaluation, a guard property is then used to tell the chef-client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p>
<ul class="simple">
<li>A string is executed as a shell command. If the command returns <tt class="docutils literal"><span class="pre">0</span></tt>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <tt class="docutils literal"><span class="pre">true</span></tt> in addition to <tt class="docutils literal"><span class="pre">0</span></tt>.</li>
<li>A block is executed as Ruby code that must return either <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. If the block returns <tt class="docutils literal"><span class="pre">true</span></tt>, the guard property is applied. If the block returns <tt class="docutils literal"><span class="pre">false</span></tt>, the guard property is not applied.</li>
</ul>
<p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for the chef-client to do nothing.</p>
<p><strong>Attributes</strong></p>
<p>The following properties can be used to define a guard that is evaluated during the execution phase of the chef-client run:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">not_if</span></tt></dt>
<dd>Prevent a resource from executing when the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">only_if</span></tt></dt>
<dd>Allow a resource to execute only if the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
</dl>
<p><strong>Arguments</strong></p>
<p>The following arguments can be used with the <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:user</span></tt></dt>
<dd><p class="first">Specify the user that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:group</span></tt></dt>
<dd><p class="first">Specify the group that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:environment</span></tt></dt>
<dd><p class="first">Specify a Hash of environment variables to be set. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/adam&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:cwd</span></tt></dt>
<dd><p class="first">Set the current working directory before running a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam passwd&#39;</span><span class="p">,</span> <span class="ss">:cwd</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:timeout</span></tt></dt>
<dd><p class="first">Set a timeout for a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;sleep 10000&#39;</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="id112">
<h3>Examples<a class="headerlink" href="#id112" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Run a command</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">erl_call</span> <span class="s1">&#39;list names&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="s1">&#39;net_adm:names().&#39;</span>
  <span class="n">distributed</span> <span class="kp">true</span>
  <span class="n">node_name</span> <span class="s1">&#39;chef@latte&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="execute">
<h2>execute<a class="headerlink" href="#execute" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_execute.rst">[edit on GitHub]</a></p>
<p>Use the <strong>execute</strong> resource to execute a single command. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use the <strong>script</strong> resource to execute a script using a specific interpreter (Ruby, Python, Perl, csh, or Bash).</p>
</div>
<div class="section" id="id113">
<h3>Syntax<a class="headerlink" href="#id113" title="Permalink to this headline">¶</a></h3>
<p>A <strong>execute</strong> resource block typically executes a single command that is unique to the environment in which a recipe will run. Some <strong>execute</strong> resource commands are run by themselves, but often they are run in combination with other Chef resources. For example, a single command that is run by itself:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;apache_configtest&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;/usr/sbin/apachectl configtest&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">'/usr/sbin/apachectl</span> <span class="pre">configtest'</span></tt> is a command that tests if the configuration files for Apache are valid.</p>
<p>Commands are often run in combination with other Chef resources. The following example shows the <strong>template</strong> resource run with the <strong>execute</strong> resource to add an entry to a LDAP Directory Interchange Format (LDIF) file:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;slapadd&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;slapadd &lt; /tmp/something.ldif&#39;</span>
  <span class="n">creates</span> <span class="s1">&#39;/var/lib/slapd/uid.bdb&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/tmp/something.ldif&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;something.ldif&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[slapadd]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">'/tmp/something.ldif'</span></tt> specifies the location of the file</li>
<li><tt class="docutils literal"><span class="pre">'something.ldif'</span></tt> specifies template file from which <tt class="docutils literal"><span class="pre">/tmp/something.ldif</span></tt> is created</li>
<li><tt class="docutils literal"><span class="pre">'slapadd</span> <span class="pre">&lt;</span> <span class="pre">/tmp/something.ldif'</span></tt> is the command that is run</li>
<li><tt class="docutils literal"><span class="pre">/var/lib/slapd/uid.bdb</span></tt> prevents the <strong>execute</strong> resource block from running if that file already exists</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>execute</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">command</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">creates</span>                    <span class="nb">String</span>
  <span class="n">cwd</span>                        <span class="nb">String</span>
  <span class="n">environment</span>                <span class="no">Hash</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">live_stream</span>                <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">path</span>                       <span class="nb">Array</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Execute</span>
  <span class="n">returns</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">sensitive</span>                  <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Float</span>
  <span class="n">umask</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">user</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :run if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">execute</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">command</span></tt> is the command to be run</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">command</span></tt>, <tt class="docutils literal"><span class="pre">creates</span></tt>, <tt class="docutils literal"><span class="pre">cwd</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">live_stream</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">returns</span></tt>, <tt class="docutils literal"><span class="pre">sensitive</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt>, and <tt class="docutils literal"><span class="pre">umask</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id114">
<h3>Actions<a class="headerlink" href="#id114" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Prevent a command from running. This action is used to specify that a command is run only when another resource notifies it.</dd>
<dt><tt class="docutils literal"><span class="pre">:run</span></tt></dt>
<dd>Default. Run a command.</dd>
</dl>
</div>
<div class="section" id="id115">
<h3>Properties<a class="headerlink" href="#id115" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">command</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p>The name of the command to be executed. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use the <strong>execute</strong> resource to run a single command. Use multiple <strong>execute</strong> resource blocks to run multiple commands.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">creates</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Prevent a command from creating a file when that file already exists.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">cwd</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The current working directory from which a command is run.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">environment</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A Hash of environment variables in the form of <tt class="docutils literal"><span class="pre">({&quot;ENV_VARIABLE&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;VALUE&quot;})</span></tt>. (These variables must exist for a command to be run successfully.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The group name or group ID that must be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">live_stream</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Send the output of the command run by this <strong>execute</strong> resource block to the chef-client event stream. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p>An array of paths to use when searching for a command. These paths are not added to the command&#8217;s environment $PATH. The default value uses the system path.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p>For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;mycommand&#39;</span> <span class="k">do</span>
  <span class="n">environment</span> <span class="s1">&#39;PATH&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/my/path/to/bin:</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PATH&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">returns</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Array</p>
<p class="last">The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">sensitive</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Ensure that sensitive resource data is not logged by the chef-client. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Float</p>
<p class="last">The amount of time (in seconds) a command is to wait before timing out. Default value: <tt class="docutils literal"><span class="pre">3600</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The user name or user ID that should be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">umask</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The file mode creation mask, or umask.</p>
</dd>
</dl>
<div class="section" id="id116">
<h4>Guards<a class="headerlink" href="#id116" title="Permalink to this headline">¶</a></h4>
<p>A guard property can be used to evaluate the state of a node during the execution phase of the chef-client run. Based on the results of this evaluation, a guard property is then used to tell the chef-client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p>
<ul class="simple">
<li>A string is executed as a shell command. If the command returns <tt class="docutils literal"><span class="pre">0</span></tt>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <tt class="docutils literal"><span class="pre">true</span></tt> in addition to <tt class="docutils literal"><span class="pre">0</span></tt>.</li>
<li>A block is executed as Ruby code that must return either <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. If the block returns <tt class="docutils literal"><span class="pre">true</span></tt>, the guard property is applied. If the block returns <tt class="docutils literal"><span class="pre">false</span></tt>, the guard property is not applied.</li>
</ul>
<p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for the chef-client to do nothing.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>When using the <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> guards with the <strong>execute</strong> resource, the current working directory property (<tt class="docutils literal"><span class="pre">cwd</span></tt>) is <strong>not</strong> inherited from the resource. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;bundle install&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="s1">&#39;/myapp&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;bundle check&#39;</span> <span class="c1"># This is not run inside /myapp</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<p><strong>Attributes</strong></p>
<p>The following properties can be used to define a guard that is evaluated during the execution phase of the chef-client run:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">not_if</span></tt></dt>
<dd>Prevent a resource from executing when the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">only_if</span></tt></dt>
<dd>Allow a resource to execute only if the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
</dl>
<p><strong>Arguments</strong></p>
<p>The following arguments can be used with the <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:user</span></tt></dt>
<dd><p class="first">Specify the user that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:group</span></tt></dt>
<dd><p class="first">Specify the group that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:environment</span></tt></dt>
<dd><p class="first">Specify a Hash of environment variables to be set. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/adam&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:cwd</span></tt></dt>
<dd><p class="first">Set the current working directory before running a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam passwd&#39;</span><span class="p">,</span> <span class="ss">:cwd</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:timeout</span></tt></dt>
<dd><p class="first">Set a timeout for a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;sleep 10000&#39;</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="id117">
<h3>Examples<a class="headerlink" href="#id117" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Run a command upon notification</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;slapadd&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;slapadd &lt; /tmp/something.ldif&#39;</span>
  <span class="n">creates</span> <span class="s1">&#39;/var/lib/slapd/uid.bdb&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/tmp/something.ldif&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;something.ldif&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[slapadd]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run a touch file only once while running a command</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;upgrade script&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;php upgrade-application.php &amp;&amp; touch /var/application/.upgraded&#39;</span>
  <span class="n">creates</span> <span class="s1">&#39;/var/application/.upgraded&#39;</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run a command which requires an environment variable</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;slapadd&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;slapadd &lt; /tmp/something.ldif&#39;</span>
  <span class="n">creates</span> <span class="s1">&#39;/var/lib/slapd/uid.bdb&#39;</span>
  <span class="n">action</span> <span class="ss">:run</span>
  <span class="n">environment</span> <span class="p">({</span><span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/myhome&#39;</span><span class="p">})</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delete a repository using yum to scrub the cache</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample thanks to gaffneyc @ https://gist.github.com/918711</span>

<span class="n">execute</span> <span class="s1">&#39;clean-yum-cache&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;yum clean all&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">file</span> <span class="s1">&#39;/etc/yum.repos.d/bad.repo&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:delete</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[clean-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload-internal-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install repositories from a file, trigger a command, and force the internal cache to reload</strong></p>
<p>The following example shows how to install new Yum repositories from a file, where the installation of the repository triggers a creation of the Yum cache that forces the internal cache for the chef-client to reload:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;create-yum-cache&#39;</span> <span class="k">do</span>
 <span class="n">command</span> <span class="s1">&#39;yum -q makecache&#39;</span>
 <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;reload-internal-yum-cache&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Yum</span><span class="o">::</span><span class="no">YumCache</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">reload</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">cookbook_file</span> <span class="s1">&#39;/etc/yum.repos.d/custom.repo&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;custom&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[create-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload-internal-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Prevent restart and reconfigure if configuration is broken</strong></p>
<p>Use the <tt class="docutils literal"><span class="pre">:nothing</span></tt> action (common to all resources) to prevent an application from restarting, and then use the <tt class="docutils literal"><span class="pre">subscribes</span></tt> notification to ask the broken configuration to be reconfigured immediately:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test-nagios-config&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;nagios3 --verify-config&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">subscribes</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;template[/etc/nagios3/configures-nagios.conf]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Notify in a specific order</strong></p>
<p>To notify multiple resources, and then have these resources run in a certain order, do something like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;...&#39;</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;template[baz]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:install</span><span class="p">,</span> <span class="s1">&#39;package[bar]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[final]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;baz&#39;</span> <span class="k">do</span>
  <span class="o">...</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[restart_baz]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">package</span> <span class="s1">&#39;bar&#39;</span>

<span class="n">execute</span> <span class="s1">&#39;restart_baz&#39;</span>

<span class="n">execute</span> <span class="s1">&#39;final&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;...&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the sequencing will be in the same order as the resources are listed in the recipe: <tt class="docutils literal"><span class="pre">execute</span> <span class="pre">'foo'</span></tt>, <tt class="docutils literal"><span class="pre">template</span> <span class="pre">'baz'</span></tt>, <tt class="docutils literal"><span class="pre">execute</span> <span class="pre">[restart_baz]</span></tt>, <tt class="docutils literal"><span class="pre">package</span> <span class="pre">'bar'</span></tt>, and <tt class="docutils literal"><span class="pre">execute</span> <span class="pre">'final'</span></tt>.</p>
<p><strong>Execute a command using a template</strong></p>
<p>The following example shows how to set up IPv4 packet forwarding using the <strong>execute</strong> resource to run a command named <tt class="docutils literal"><span class="pre">forward_ipv4</span></tt> that uses a template defined by the <strong>template</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;forward_ipv4&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;echo &gt; /proc/.../ipv4/ip_forward&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/etc/file_name.conf&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;routing/file_name.conf.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[forward_ipv4]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">command</span></tt> property for the <strong>execute</strong> resource contains the command that is to be run and the <tt class="docutils literal"><span class="pre">source</span></tt> property for the <strong>template</strong> resource specifies which template to use. The <tt class="docutils literal"><span class="pre">notifies</span></tt> property for the <strong>template</strong> specifies that the <tt class="docutils literal"><span class="pre">execute[forward_ipv4]</span></tt> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of the chef-client run.</p>
<p><strong>Add a rule to an IP table</strong></p>
<p>The following example shows how to add a rule named <tt class="docutils literal"><span class="pre">test_rule</span></tt> to an IP table using the <strong>execute</strong> resource to run a command using a template that is defined by the <strong>template</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test_rule&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;command_to_run</span>
<span class="s1">    --option value</span>
<span class="s1">    ...</span>
<span class="s1">    --option value</span>
<span class="s1">    --source #{node[:name_of_node][:ipsec][:local][:subnet]}</span>
<span class="s1">    -j test_rule&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/etc/file_name.local&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;routing/file_name.local.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test_rule]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">command</span></tt> property for the <strong>execute</strong> resource contains the command that is to be run and the <tt class="docutils literal"><span class="pre">source</span></tt> property for the <strong>template</strong> resource specifies which template to use. The <tt class="docutils literal"><span class="pre">notifies</span></tt> property for the <strong>template</strong> specifies that the <tt class="docutils literal"><span class="pre">execute[test_rule]</span></tt> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of the chef-client run.</p>
<p><strong>Stop a service, do stuff, and then restart it</strong></p>
<p>The following example shows how to use the <strong>execute</strong>, <strong>service</strong>, and <strong>mount</strong> resources together to ensure that a node running on Amazon EC2 is running MySQL. This example does the following:</p>
<ul class="simple">
<li>Checks to see if the Amazon EC2 node has MySQL</li>
<li>If the node has MySQL, stops MySQL</li>
<li>Installs MySQL</li>
<li>Mounts the node</li>
<li>Restarts MySQL</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``server_ec2``</span>
<span class="c1"># recipe in the following cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/mysql</span>

<span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attribute?</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">))</span>

  <span class="n">service</span> <span class="s1">&#39;mysql&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:stop</span>
  <span class="k">end</span>

  <span class="n">execute</span> <span class="s1">&#39;install-mysql&#39;</span> <span class="k">do</span>
    <span class="n">command</span> <span class="s2">&quot;mv </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">not_if</span> <span class="k">do</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">)</span> <span class="k">end</span>
  <span class="k">end</span>

  <span class="o">[</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
    <span class="n">directory</span> <span class="n">dir</span> <span class="k">do</span>
      <span class="n">owner</span> <span class="s1">&#39;mysql&#39;</span>
      <span class="n">group</span> <span class="s1">&#39;mysql&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">mount</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">device</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span>
    <span class="n">fstype</span> <span class="s1">&#39;none&#39;</span>
    <span class="n">options</span> <span class="s1">&#39;bind,rw&#39;</span>
    <span class="n">action</span> <span class="o">[</span><span class="ss">:mount</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="n">service</span> <span class="s1">&#39;mysql&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:start</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li>the two <strong>service</strong> resources are used to stop, and then restart the MySQL service</li>
<li>the <strong>execute</strong> resource is used to install MySQL</li>
<li>the <strong>mount</strong> resource is used to mount the node and enable MySQL</li>
</ul>
<p><strong>Use the platform_family? method</strong></p>
<p>The following is an example of using the <tt class="docutils literal"><span class="pre">platform_family?</span></tt> method in the Recipe DSL to create a variable that can be used with other resources in the same recipe. In this example, <tt class="docutils literal"><span class="pre">platform_family?</span></tt> is being used to ensure that a specific binary is used for a specific platform before using the <strong>remote_file</strong> resource to download a file from a remote location, and then using the <strong>execute</strong> resource to install that file by running a command.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">platform_family?</span><span class="p">(</span><span class="s1">&#39;rhel&#39;</span><span class="p">)</span>
  <span class="n">pip_binary</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/pip&#39;</span>
<span class="k">else</span>
  <span class="n">pip_binary</span> <span class="o">=</span> <span class="s1">&#39;/usr/local/bin/pip&#39;</span>
<span class="k">end</span>

<span class="n">remote_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/distribute_setup.py&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://python-distribute.org/distribute_setup.py&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">pip_binary</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">execute</span> <span class="s1">&#39;install-pip&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">command</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span>
<span class="sh">    # command for installing Python goes here</span>
<span class="no">    EOF</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">pip_binary</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where a command for installing Python might look something like:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#{node[&#39;python&#39;][&#39;binary&#39;]} distribute_setup.py</span>
<span class="c1">#{::File.dirname(pip_binary)}/easy_install pip</span>
</pre></div>
</div>
<p><strong>Control a service using the execute resource</strong></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is an example of something that should NOT be done. Use the <strong>service</strong> resource to control a service, not the <strong>execute</strong> resource.</p>
</div>
<p>Do something like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;tomcat&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and NOT something like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;start-tomcat&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;/etc/init.d/tomcat6 start&#39;</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p>There is no reason to use the <strong>execute</strong> resource to control a service because the <strong>service</strong> resource exposes the <tt class="docutils literal"><span class="pre">start_command</span></tt> property directly, which gives a recipe full control over the command issued in a much cleaner, more direct manner.</p>
<p><strong>Use the search recipe DSL method to find users</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">search</span></tt> method in the Recipe DSL to search for users:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#  the following code sample comes from the openvpn cookbook: https://github.com/chef-cookbooks/openvpn</span>

<span class="n">search</span><span class="p">(</span><span class="s2">&quot;users&quot;</span><span class="p">,</span> <span class="s2">&quot;*:*&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">u</span><span class="o">|</span>
  <span class="n">execute</span> <span class="s2">&quot;generate-openvpn-</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">command</span> <span class="s2">&quot;./pkitool </span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">cwd</span> <span class="s1">&#39;/etc/openvpn/easy-rsa&#39;</span>
    <span class="n">environment</span><span class="p">(</span>
      <span class="s1">&#39;EASY_RSA&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc/openvpn/easy-rsa&#39;</span><span class="p">,</span>
      <span class="s1">&#39;KEY_CONFIG&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc/openvpn/easy-rsa/openssl.cnf&#39;</span><span class="p">,</span>
      <span class="s1">&#39;KEY_DIR&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key_dir&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="s1">&#39;CA_EXPIRE&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;ca_expire&#39;</span><span class="o">].</span><span class="n">to_s</span><span class="p">,</span>
      <span class="s1">&#39;KEY_EXPIRE&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;expire&#39;</span><span class="o">].</span><span class="n">to_s</span><span class="p">,</span>
      <span class="s1">&#39;KEY_SIZE&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;size&#39;</span><span class="o">].</span><span class="n">to_s</span><span class="p">,</span>
      <span class="s1">&#39;KEY_COUNTRY&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;country&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="s1">&#39;KEY_PROVINCE&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;province&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="s1">&#39;KEY_CITY&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;city&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="s1">&#39;KEY_ORG&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;org&#39;</span><span class="o">]</span><span class="p">,</span>
      <span class="s1">&#39;KEY_EMAIL&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key&#39;</span><span class="o">][</span><span class="s1">&#39;email&#39;</span><span class="o">]</span>
    <span class="p">)</span>
    <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">.crt&quot;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>

  <span class="sx">%w{ conf ovpn }</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">ext</span><span class="o">|</span>
    <span class="n">template</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">.</span><span class="si">#{</span><span class="n">ext</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
      <span class="n">source</span> <span class="s1">&#39;client.conf.erb&#39;</span>
      <span class="n">variables</span> <span class="ss">:username</span> <span class="o">=&gt;</span> <span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">execute</span> <span class="s2">&quot;create-openvpn-tar-</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">cwd</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key_dir&#39;</span><span class="o">]</span>
    <span class="n">command</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">      tar zcf #{u[&#39;id&#39;]}.tar.gz \</span>
<span class="sh">      ca.crt #{u[&#39;id&#39;]}.crt #{u[&#39;id&#39;]}.key \</span>
<span class="sh">      #{u[&#39;id&#39;]}.conf #{u[&#39;id&#39;]}.ovpn \</span>
<span class="no">    EOH</span>
    <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;openvpn&#39;</span><span class="o">][</span><span class="s1">&#39;key_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">u</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">.tar.gz&quot;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li>the search will use both of the <strong>execute</strong> resources, unless the condition specified by the <tt class="docutils literal"><span class="pre">not_if</span></tt> commands are met</li>
<li>the <tt class="docutils literal"><span class="pre">environments</span></tt> property in the first <strong>execute</strong> resource is being used to define values that appear as variables in the OpenVPN configuration</li>
<li>the <strong>template</strong> resource tells the chef-client which template to use</li>
</ul>
<p><strong>Enable remote login for Mac OS X</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;enable ssh&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;/usr/sbin/systemsetup -setremotelogin on&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;/usr/sbin/systemsetup -getremotelogin | /usr/bin/grep On&#39;</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Execute code immediately, based on the template resource</strong></p>
<p>By default, notifications are <tt class="docutils literal"><span class="pre">:delayed</span></tt>, that is they are queued up as they are triggered, and then executed at the very end of a chef-client run. To run an action immediately, use <tt class="docutils literal"><span class="pre">:immediately</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/nagios3/configures-nagios.conf&#39;</span> <span class="k">do</span>
  <span class="c1"># other parameters</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test-nagios-config]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the chef-client would immediately run the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test-nagios-config&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;nagios3 --verify-config&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Sourcing a file</strong></p>
<p>The <strong>execute</strong> resource cannot be used to source a file (e.g. <tt class="docutils literal"><span class="pre">command</span> <span class="pre">'source</span> <span class="pre">filename'</span></tt>). The following example will fail because <tt class="docutils literal"><span class="pre">source</span></tt> is not an executable:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;source /tmp/foo.sh&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Instead, use the <strong>script</strong> resource or one of the <strong>script</strong>-based resources (<strong>bash</strong>, <strong>csh</strong>, <strong>perl</strong>, <strong>python</strong>, or <strong>ruby</strong>). For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="s1">&#39;source /tmp/foo.sh&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run a Knife command</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;create_user&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="o">&lt;&lt;-</span><span class="no">EOM</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip!</span>
<span class="sh">        knife user create #{user}</span>
<span class="sh">      --admin</span>
<span class="sh">      --password password</span>
<span class="sh">      --disable-editing</span>
<span class="sh">      --file /home/vagrant/.chef/user.pem</span>
<span class="sh">      --config /tmp/knife-admin.rb</span>
<span class="no">    EOM</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run install command into virtual environment</strong></p>
<p>The following example shows how to install a lightweight JavaScript framework into Vagrant:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s2">&quot;install q and zombiejs&quot;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="s2">&quot;/home/vagrant&quot;</span>
  <span class="n">user</span> <span class="s2">&quot;vagrant&quot;</span>
  <span class="n">environment</span> <span class="p">({</span><span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/vagrant&#39;</span><span class="p">,</span> <span class="s1">&#39;USER&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;vagrant&#39;</span><span class="p">})</span>
  <span class="n">command</span> <span class="s2">&quot;npm install -g q zombie should mocha coffee-script&quot;</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run a command as a named user</strong></p>
<p>The following example shows how to run <tt class="docutils literal"><span class="pre">bundle</span> <span class="pre">install</span></tt> from a chef-client run as a specific user. This will put the gem into the path of the user (<tt class="docutils literal"><span class="pre">vagrant</span></tt>) instead of the root user (under which the chef-client runs):</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;/opt/chefdk/embedded/bin/bundle install&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_workstation&#39;</span><span class="o">][</span><span class="s1">&#39;bundler_path&#39;</span><span class="o">]</span>
  <span class="n">user</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_workstation&#39;</span><span class="o">][</span><span class="s1">&#39;user&#39;</span><span class="o">]</span>
  <span class="n">environment</span> <span class="p">({</span>
    <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/home/</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_workstation&#39;</span><span class="o">][</span><span class="s1">&#39;user&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;USER&#39;</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_workstation&#39;</span><span class="o">][</span><span class="s1">&#39;user&#39;</span><span class="o">]</span>
  <span class="p">})</span>
  <span class="n">not_if</span> <span class="s1">&#39;bundle check&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="file">
<h2>file<a class="headerlink" href="#file" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_file.rst">[edit on GitHub]</a></p>
<p>Use the <strong>file</strong> resource to manage files directly on a node.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Use the <strong>cookbook_file</strong> resource to copy a file from a cookbook&#8217;s <tt class="docutils literal"><span class="pre">/files</span></tt> directory. Use the <strong>template</strong> resource to create a file based on a template in a cookbook&#8217;s <tt class="docutils literal"><span class="pre">/templates</span></tt> directory. And use the <strong>remote_file</strong> resource to transfer a file to a node from a remote location.</p>
</div>
<div class="section" id="id118">
<h3>Syntax<a class="headerlink" href="#id118" title="Permalink to this headline">¶</a></h3>
<p>A <strong>file</strong> resource block manages files that exist on nodes. For example, to write the home page for an Apache website:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/var/www/customers/public_html/index.php&#39;</span> <span class="k">do</span>
  <span class="n">content</span> <span class="s1">&#39;&lt;html&gt;This is a placeholder for the home page.&lt;/html&gt;&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;web_admin&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;web_admin&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">'/var/www/customers/public_html/index.php'</span></tt> is path to the file and also the filename to be managed</li>
<li><tt class="docutils literal"><span class="pre">content</span></tt> defines the contents of the file</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>file</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">atomic_update</span>              <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">backup</span>                     <span class="no">FalseClass</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">checksum</span>                   <span class="nb">String</span>
  <span class="n">content</span>                    <span class="nb">String</span>
  <span class="n">force_unlink</span>               <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">inherits</span>                   <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">manage_symlink_source</span>      <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span><span class="p">,</span> <span class="no">NilClass</span>
  <span class="n">mode</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">owner</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">path</span>                       <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">File</span>
  <span class="n">rights</span>                     <span class="no">Hash</span>
  <span class="n">sensitive</span>                  <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">verify</span>                     <span class="nb">String</span><span class="p">,</span> <span class="no">Block</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">file</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block; when the <tt class="docutils literal"><span class="pre">path</span></tt> property is not specified as part of a recipe, <tt class="docutils literal"><span class="pre">name</span></tt> is also the path to the file</li>
<li><tt class="docutils literal"><span class="pre">content</span></tt> specifies the contents of the file</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">atomic_update</span></tt>, <tt class="docutils literal"><span class="pre">backup</span></tt>, <tt class="docutils literal"><span class="pre">checksum</span></tt>, <tt class="docutils literal"><span class="pre">content</span></tt>, <tt class="docutils literal"><span class="pre">force_unlink</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">inherits</span></tt>, <tt class="docutils literal"><span class="pre">manage_symlink_source</span></tt>, <tt class="docutils literal"><span class="pre">mode</span></tt>, <tt class="docutils literal"><span class="pre">owner</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">rights</span></tt>, <tt class="docutils literal"><span class="pre">sensitive</span></tt>, and <tt class="docutils literal"><span class="pre">verify</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id119">
<h3>Actions<a class="headerlink" href="#id119" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>Default. Create a file. If a file already exists (but does not match), update that file to match.</dd>
<dt><tt class="docutils literal"><span class="pre">:create_if_missing</span></tt></dt>
<dd>Create a file only if the file does not exist. When the file exists, nothing happens.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Delete a file.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:touch</span></tt></dt>
<dd>Touch a file. This updates the access (atime) and file modification (mtime) times for a file.</dd>
</dl>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">For a machine on which SELinux is enabled, the chef-client will create files that correctly match the default policy settings only when the cookbook that defines the action also conforms to the same policy.</p>
</div>
</div>
<div class="section" id="id120">
<h3>Properties<a class="headerlink" href="#id120" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">atomic_update</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Perform atomic file updates on a per-resource basis. Set to <tt class="docutils literal"><span class="pre">true</span></tt> for atomic file updates. Set to <tt class="docutils literal"><span class="pre">false</span></tt> for non-atomic file updates. This setting overrides <tt class="docutils literal"><span class="pre">file_atomic_update</span></tt>, which is a global setting found in the client.rb file. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">backup</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> FalseClass, Integer</p>
<p class="last">The number of backups to be kept in <tt class="docutils literal"><span class="pre">/var/chef/backup</span></tt> (for UNIX- and Linux-based platforms) or <tt class="docutils literal"><span class="pre">C:/chef/backup</span></tt> (for the Microsoft Windows platform). Set to <tt class="docutils literal"><span class="pre">false</span></tt> to prevent backups from being kept. Default value: <tt class="docutils literal"><span class="pre">5</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">checksum</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String</p>
<p class="last">The SHA-256 checksum of the file. Use to ensure that a specific file is used. If the checksum does not match, the file is not used. Default value: no checksum required.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">content</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A string that is written to the file. The contents of this property replace any previous content when this property has something other than the default value. The default behavior will not modify content.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">force_unlink</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">How the chef-client handles certain situations when the target file turns out not to be a file. For example, when a target file is actually a symlink. Set to <tt class="docutils literal"><span class="pre">true</span></tt> for the chef-client delete the non-file target and replace it with the specified file. Set to <tt class="docutils literal"><span class="pre">false</span></tt> for the chef-client to raise an error. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">A string or ID that identifies the group owner by group name, including fully qualified group names such as <tt class="docutils literal"><span class="pre">domain\group</span></tt> or <tt class="docutils literal"><span class="pre">group&#64;domain</span></tt>. If this value is not specified, existing groups remain unchanged and new group assignments use the default <tt class="docutils literal"><span class="pre">POSIX</span></tt> group (if available).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">inherits</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Microsoft Windows only. Whether a file inherits rights from its parent directory. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">manage_symlink_source</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass, NilClass</p>
<p class="last">Cause the chef-client to detect and manage the source file for a symlink. Possible values: <tt class="docutils literal"><span class="pre">nil</span></tt>, <tt class="docutils literal"><span class="pre">true</span></tt>, or <tt class="docutils literal"><span class="pre">false</span></tt>. When this value is set to <tt class="docutils literal"><span class="pre">nil</span></tt>, the chef-client will manage a symlink&#8217;s source file and emit a warning. When this value is set to <tt class="docutils literal"><span class="pre">true</span></tt>, the chef-client will manage a symlink&#8217;s source file and not emit a warning. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>. The default value will be changed to <tt class="docutils literal"><span class="pre">false</span></tt> in a future version.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">mode</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p>A quoted 3-5 character string that defines the octal mode. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified and if the file already exists, the existing mode on the file is used. If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified, the file does not exist, and the <tt class="docutils literal"><span class="pre">:create</span></tt> action is specified, the chef-client assumes a mask value of <tt class="docutils literal"><span class="pre">'0777'</span></tt> and then applies the umask for the system on which the file is to be created to the <tt class="docutils literal"><span class="pre">mask</span></tt> value. For example, if the umask on a system is <tt class="docutils literal"><span class="pre">'022'</span></tt>, the chef-client uses the default value of <tt class="docutils literal"><span class="pre">'0755'</span></tt>.</p>
<p>The behavior is different depending on the platform.</p>
<p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. If the value is specified as a quoted string, it works exactly as if the <tt class="docutils literal"><span class="pre">chmod</span></tt> command was passed. If the value is specified as an integer, prepend a zero (<tt class="docutils literal"><span class="pre">0</span></tt>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <tt class="docutils literal"><span class="pre">'0777'</span></tt> or <tt class="docutils literal"><span class="pre">'777'</span></tt>; for the same rights, plus the sticky bit, use <tt class="docutils literal"><span class="pre">01777</span></tt> or <tt class="docutils literal"><span class="pre">'1777'</span></tt>.</p>
<p class="last">Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. Values up to <tt class="docutils literal"><span class="pre">'0777'</span></tt> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <tt class="docutils literal"><span class="pre">4</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">2</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, and <tt class="docutils literal"><span class="pre">1</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>. This property cannot be used to set <tt class="docutils literal"><span class="pre">:full_control</span></tt>. This property has no effect if not specified, but when it and <tt class="docutils literal"><span class="pre">rights</span></tt> are both specified, the effects are cumulative.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">owner</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">A string or ID that identifies the group owner by user name, including fully qualified user names such as <tt class="docutils literal"><span class="pre">domain\user</span></tt> or <tt class="docutils literal"><span class="pre">user&#64;domain</span></tt>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p>The full path to the file, including the file name and its extension. For example: <tt class="docutils literal"><span class="pre">/files/file.txt</span></tt>. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
<p class="last">Microsoft Windows: A path that begins with a forward slash (<tt class="docutils literal"><span class="pre">/</span></tt>) will point to the root of the current working directory of the chef-client process. This path can vary from system to system. Therefore, using a path that begins with a forward slash (<tt class="docutils literal"><span class="pre">/</span></tt>) is not recommended.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">rights</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">Microsoft Windows only. The permissions for users and groups in a Microsoft Windows environment. For example: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">&lt;permissions&gt;,</span> <span class="pre">&lt;principal&gt;,</span> <span class="pre">&lt;options&gt;</span></tt> where <tt class="docutils literal"><span class="pre">&lt;permissions&gt;</span></tt> specifies the rights granted to the principal, <tt class="docutils literal"><span class="pre">&lt;principal&gt;</span></tt> is the group or user name, and <tt class="docutils literal"><span class="pre">&lt;options&gt;</span></tt> is a Hash with one (or more) advanced rights options.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">sensitive</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Ensure that sensitive resource data is not logged by the chef-client. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">verify</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Block</p>
<p>A block or a string that returns <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. A string, when <tt class="docutils literal"><span class="pre">true</span></tt> is executed as a system command.</p>
<p>A block is arbitrary Ruby defined within the resource block by using the <tt class="docutils literal"><span class="pre">verify</span></tt> property. When a block is <tt class="docutils literal"><span class="pre">true</span></tt>, the chef-client will continue to update the file as appropriate.</p>
<p>For example, this should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/tmp/baz&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="p">{</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/etc/nginx.conf&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="s1">&#39;nginx -t -c %{path}&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>For releases of the chef-client prior to 12.5 (chef-client 12.4 and earlier) the correct syntax is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/etc/nginx.conf&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="s1">&#39;nginx -t -c %{file}&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p class="last">See GitHub issues <a class="reference external" href="https://github.com/chef/chef/issues/3232">https://github.com/chef/chef/issues/3232</a> and <a class="reference external" href="https://github.com/chef/chef/pull/3693">https://github.com/chef/chef/pull/3693</a> for more information about these differences.</p>
</div>
<p>This should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/tmp/bar&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="p">{</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>And this should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/tmp/foo&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
    <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Whereas, this should return <tt class="docutils literal"><span class="pre">false</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/tmp/turtle&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="s1">&#39;/usr/bin/false&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p class="last">If a string or a block return <tt class="docutils literal"><span class="pre">false</span></tt>, the chef-client run will stop and an error is returned.</p>
</dd>
</dl>
<div class="section" id="id121">
<h4>Atomic File Updates<a class="headerlink" href="#id121" title="Permalink to this headline">¶</a></h4>
<p>Atomic updates are used with <strong>file</strong>-based resources to help ensure that file updates can be made when updating a binary or if disk space runs out.</p>
<p>Atomic updates are enabled by default. They can be managed globally using the <tt class="docutils literal"><span class="pre">file_atomic_update</span></tt> setting in the client.rb file. They can be managed on a per-resource basis using the <tt class="docutils literal"><span class="pre">atomic_update</span></tt> property that is available with the <strong>cookbook_file</strong>, <strong>file</strong>, <strong>remote_file</strong>, and <strong>template</strong> resources.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On certain platforms, and after a file has been moved into place, the chef-client may modify file permissions to support features specific to those platforms. On platforms with SELinux enabled, the chef-client will fix up the security contexts after a file has been moved into the correct location by running the <tt class="docutils literal"><span class="pre">restorecon</span></tt> command. On the Microsoft Windows platform, the chef-client will create files so that ACL inheritance works as expected.</p>
</div>
</div>
<div class="section" id="id122">
<h4>Windows File Security<a class="headerlink" href="#id122" title="Permalink to this headline">¶</a></h4>
<p>To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes.</p>
<p><strong>Access Control Lists (ACLs)</strong></p>
<p>The <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used as many times as necessary; the chef-client will apply them to the file or directory as required. The syntax for the <tt class="docutils literal"><span class="pre">rights</span></tt> property is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="n">permission</span><span class="p">,</span> <span class="n">principal</span><span class="p">,</span> <span class="n">option_type</span> <span class="o">=&gt;</span> <span class="n">value</span>
</pre></div>
</div>
<p>where</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">permission</span></tt></dt>
<dd><p class="first">Use to specify which rights are granted to the <tt class="docutils literal"><span class="pre">principal</span></tt>. The possible values are: <tt class="docutils literal"><span class="pre">:read</span></tt>, <tt class="docutils literal"><span class="pre">:write</span></tt>, <tt class="docutils literal"><span class="pre">read_execute</span></tt>, <tt class="docutils literal"><span class="pre">:modify</span></tt>, and <tt class="docutils literal"><span class="pre">:full_control</span></tt>.</p>
<p>These permissions are cumulative. If <tt class="docutils literal"><span class="pre">:write</span></tt> is specified, then it includes <tt class="docutils literal"><span class="pre">:read</span></tt>. If <tt class="docutils literal"><span class="pre">:full_control</span></tt> is specified, then it includes both <tt class="docutils literal"><span class="pre">:write</span></tt> and <tt class="docutils literal"><span class="pre">:read</span></tt>.</p>
<p class="last">(For those who know the Microsoft Windows API: <tt class="docutils literal"><span class="pre">:read</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>; <tt class="docutils literal"><span class="pre">:write</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>; <tt class="docutils literal"><span class="pre">:read_execute</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt> and <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>; <tt class="docutils literal"><span class="pre">:modify</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>, and <tt class="docutils literal"><span class="pre">DELETE</span></tt>; <tt class="docutils literal"><span class="pre">:full_control</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_ALL</span></tt>, which allows a user to change the owner and other metadata about a file.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">principal</span></tt></dt>
<dd>Use to specify a group or user name. This is identical to what is entered in the login box for Microsoft Windows, such as <tt class="docutils literal"><span class="pre">user_name</span></tt>, <tt class="docutils literal"><span class="pre">domain\user_name</span></tt>, or <tt class="docutils literal"><span class="pre">user_name&#64;fully_qualified_domain_name</span></tt>. The chef-client does not need to know if a principal is a user or a group.</dd>
<dt><tt class="docutils literal"><span class="pre">option_type</span></tt></dt>
<dd><p class="first">A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">:write,</span> <span class="pre">'domain\group_name',</span> <span class="pre">:one_level_deep</span> <span class="pre">=&gt;</span> <span class="pre">true</span></tt>. Possible option types:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:applies_to_children</span></tt></td>
<td>Specify how permissions are applied to children. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to inherit both child directories and files;  <tt class="docutils literal"><span class="pre">false</span></tt> to not inherit any child directories or files; <tt class="docutils literal"><span class="pre">:containers_only</span></tt> to inherit only child directories (and not files); <tt class="docutils literal"><span class="pre">:objects_only</span></tt> to recursively inherit files (and not child directories).</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:applies_to_self</span></tt></td>
<td>Indicates whether a permission is applied to the parent directory. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply to the parent directory or file and its children; <tt class="docutils literal"><span class="pre">false</span></tt> to not apply only to child directories and files.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:one_level_deep</span></tt></td>
<td>Indicates the depth to which permissions will be applied. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply only to the first level of children; <tt class="docutils literal"><span class="pre">false</span></tt> to apply to all children.</td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Administrators&#39;</span><span class="p">,</span><span class="s1">&#39;Everyone&#39;</span><span class="o">]</span>
<span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;Users&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;Sally&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="ss">:containers_only</span><span class="p">,</span> <span class="ss">:applies_to_self</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:one_level_deep</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</pre></div>
</div>
<p>Some other important things to know when using the <tt class="docutils literal"><span class="pre">rights</span></tt> attribute:</p>
<ul class="simple">
<li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li>
<li>If rights are not specified, nothing will be changed. The chef-client does not clear out the rights on a file or directory if rights are not specified.</li>
<li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li>
</ul>
<p>Use the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> property to deny specific rights to specific users. The ordering is independent of using the <tt class="docutils literal"><span class="pre">rights</span></tt> property. For example, it doesn&#8217;t matter if rights are granted to everyone is placed before or after <tt class="docutils literal"><span class="pre">deny_rights</span> <span class="pre">:read,</span> <span class="pre">['Julian',</span> <span class="pre">'Lewis']</span></tt>, both Julian and Lewis will be unable to read the document. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Julian&#39;</span><span class="p">,</span> <span class="s1">&#39;Lewis&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deny_rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Sally&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p><strong>Inheritance</strong></p>
<p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <tt class="docutils literal"><span class="pre">inherits</span></tt> property can be used to specifically tell the chef-client to apply (or not apply) inherited rights from its parent directory.</p>
<p>For example, the following example specifies the rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">inherits</span> <span class="kp">false</span> <span class="c1"># Sauron is the only person who should have any sort of access</span>
<span class="k">end</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> permission were to be used instead, something could slip through unless all users and groups were denied.</p>
<p>Another example also shows how to specify rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;SHIRE\Frodo&#39;</span> <span class="c1"># Who put that there I didn&#39;t put that there</span>
<span class="k">end</span>
</pre></div>
</div>
<p>but then not use the <tt class="docutils literal"><span class="pre">inherits</span></tt> property to deny those rights on a child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span> <span class="c1"># Oops, not specific enough</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Because the <tt class="docutils literal"><span class="pre">inherits</span></tt> property is not specified, the chef-client will default it to <tt class="docutils literal"><span class="pre">true</span></tt>, which will ensure that security settings for existing files remain unchanged.</p>
</div>
</div>
<div class="section" id="id123">
<h3>Examples<a class="headerlink" href="#id123" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Create a file</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/tmp/something&#39;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file in Microsoft Windows</strong></p>
<p>To create a file in Microsoft Windows, be sure to add an escape character&#8212;<tt class="docutils literal"><span class="pre">\</span></tt>&#8212;before the backslashes in the paths:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;C:\\tmp\\something.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;DOMAIN\\User&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Remove a file</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/tmp/something&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:delete</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set file modes</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/tmp/something&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delete a repository using yum to scrub the cache</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample thanks to gaffneyc @ https://gist.github.com/918711</span>

<span class="n">execute</span> <span class="s1">&#39;clean-yum-cache&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;yum clean all&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">file</span> <span class="s1">&#39;/etc/yum.repos.d/bad.repo&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:delete</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[clean-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload-internal-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Add the value of a data bag item to a file</strong></p>
<p>The following example shows how to get the contents of a data bag item named <tt class="docutils literal"><span class="pre">impossible_things</span></tt>, create a .pem file located at <tt class="docutils literal"><span class="pre">some/directory/path/</span></tt>, and then use the <tt class="docutils literal"><span class="pre">content</span></tt> attribute to update the contents of that file with the value of the <tt class="docutils literal"><span class="pre">impossible_things</span></tt> data bag item:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">private_key</span> <span class="o">=</span> <span class="n">data_bag_item</span><span class="p">(</span><span class="s1">&#39;impossible_things&#39;</span><span class="p">,</span> <span class="n">private_key_name</span><span class="p">)</span><span class="o">[</span><span class="s1">&#39;private_key&#39;</span><span class="o">]</span>

<span class="n">file</span> <span class="s2">&quot;some/directory/path/</span><span class="si">#{</span><span class="n">private_key_name</span><span class="si">}</span><span class="s2">.pem&quot;</span> <span class="k">do</span>
  <span class="n">content</span> <span class="n">private_key</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;group&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Write a YAML file</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">content</span></tt> property to write a YAML file:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">app</span><span class="o">[</span><span class="s1">&#39;deploy_to&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/shared/config/settings.yml&quot;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s2">&quot;app[&#39;owner&#39;]&quot;</span>
  <span class="n">group</span> <span class="s2">&quot;app[&#39;group&#39;]&quot;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">content</span> <span class="n">app</span><span class="o">.</span><span class="n">to_yaml</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Write a string to a file</strong></p>
<p>The following example specifies a directory, and then uses the <tt class="docutils literal"><span class="pre">content</span></tt> property to add a string to the file created in that directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">status_file</span> <span class="o">=</span> <span class="s1">&#39;/path/to/file/status_file&#39;</span>

<span class="n">file</span> <span class="n">status_file</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">content</span> <span class="s1">&#39;My favourite foremost coastal Antarctic shelf, oh Larsen B!&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a file from a copy</strong></p>
<p>The following example shows how to copy a file from one directory to another, locally on a node:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">file</span> <span class="s1">&#39;/root/1.txt&#39;</span> <span class="k">do</span>
  <span class="n">content</span> <span class="no">IO</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/tmp/1.txt&#39;</span><span class="p">)</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">content</span></tt> attribute uses the Ruby <tt class="docutils literal"><span class="pre">IO.read</span></tt> method to get the contents of the <tt class="docutils literal"><span class="pre">/tmp/1.txt</span></tt> file.</p>
</div>
</div>
<div class="section" id="freebsd-package">
<h2>freebsd_package<a class="headerlink" href="#freebsd-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_freebsd_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>freebsd_package</strong> resource to manage packages for the FreeBSD platform.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id124">
<h3>Syntax<a class="headerlink" href="#id124" title="Permalink to this headline">¶</a></h3>
<p>A <strong>freebsd_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>freebsd_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">freebsd_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>freebsd_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">freebsd_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Freebsd</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">freebsd_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id125">
<h3>Actions<a class="headerlink" href="#id125" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
</dl>
</div>
<div class="section" id="id126">
<h3>Properties<a class="headerlink" href="#id126" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id127">
<h3>Providers<a class="headerlink" href="#id127" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Freebsd</span></tt>, <tt class="docutils literal"><span class="pre">freebsd_package</span></tt></dt>
<dd>The provider for the FreeBSD platform.</dd>
</dl>
</div>
<div class="section" id="id128">
<h3>Examples<a class="headerlink" href="#id128" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">freebsd_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="gem-package">
<h2>gem_package<a class="headerlink" href="#gem-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_gem_package.rst">[edit on GitHub]</a></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>chef_gem</strong> and <strong>gem_package</strong> resources are both used to install Ruby gems. For any machine on which the chef-client is installed, there are two instances of Ruby. One is the standard, system-wide instance of Ruby and the other is a dedicated instance that is available only to the chef-client. Use the <strong>chef_gem</strong> resource to install gems into the instance of Ruby that is dedicated to the chef-client. Use the <strong>gem_package</strong> resource to install all other gems (i.e. install gems system-wide).</p>
</div>
<p>Use the <strong>gem_package</strong> resource to manage gem packages that are only included in recipes. When a package is installed from a local file, it must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>gem_package</strong> resource must be specified as <tt class="docutils literal"><span class="pre">gem_package</span></tt> and cannot be shortened to <tt class="docutils literal"><span class="pre">package</span></tt> in a recipe.</p>
</div>
<div class="section" id="id129">
<h3>Syntax<a class="headerlink" href="#id129" title="Permalink to this headline">¶</a></h3>
<p>A <strong>gem_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>gem_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>gem_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">clear_sources</span>              <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">gem_binary</span>                 <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rubygems</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">gem_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">clear_sources</span></tt>, <tt class="docutils literal"><span class="pre">gem_binary</span></tt>, <tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="gem-package-options">
<h3>Gem Package Options<a class="headerlink" href="#gem-package-options" title="Permalink to this headline">¶</a></h3>
<p>The RubyGems package provider attempts to use the RubyGems API to install gems without spawning a new process, whenever possible. A gems command to install will be spawned under the following conditions:</p>
<ul class="simple">
<li>When a <tt class="docutils literal"><span class="pre">gem_binary</span></tt> property is specified (as a hash, a string, or by a .gemrc file), the chef-client will run that command to examine its environment settings and then again to install the gem.</li>
<li>When install options are specified as a string, the chef-client will span a gems command with those options when installing the gem.</li>
<li>The omnibus installer will search the <tt class="docutils literal"><span class="pre">PATH</span></tt> for a gem command rather than defaulting to the current gem environment. As part of <tt class="docutils literal"><span class="pre">enforce_path_sanity</span></tt>, the <tt class="docutils literal"><span class="pre">bin</span></tt> directories area added to the <tt class="docutils literal"><span class="pre">PATH</span></tt>, which means when there are no other proceeding RubyGems, the installation will still be operated against it.</li>
</ul>
<div class="section" id="specify-with-hash">
<h4>Specify with Hash<a class="headerlink" href="#specify-with-hash" title="Permalink to this headline">¶</a></h4>
<p>If an explicit <tt class="docutils literal"><span class="pre">gem_binary</span></tt> parameter is not being used with the <tt class="docutils literal"><span class="pre">gem_package</span></tt> resource, it is preferable to provide the install options as a hash. This approach allows the provider to install the gem without needing to spawn an external gem process.</p>
<p>The following RubyGems options are available for inclusion within a hash and are passed to the RubyGems DependencyInstaller:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">:env_shebang</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:force</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:format_executable</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:ignore_dependencies</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:prerelease</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:security_policy</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:wrappers</span></tt></li>
</ul>
<p>For more information about these options, see the RubyGems documentation: <a class="reference external" href="http://rubygems.rubyforge.org/rubygems-update/Gem/DependencyInstaller.html">http://rubygems.rubyforge.org/rubygems-update/Gem/DependencyInstaller.html</a>.</p>
<p><strong>Example</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;bundler&#39;</span> <span class="k">do</span>
  <span class="n">options</span><span class="p">(</span><span class="ss">:prerelease</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:format_executable</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="specify-with-string">
<h4>Specify with String<a class="headerlink" href="#specify-with-string" title="Permalink to this headline">¶</a></h4>
<p>When using an explicit <tt class="docutils literal"><span class="pre">gem_binary</span></tt>, options must be passed as a string. When not using an explicit <tt class="docutils literal"><span class="pre">gem_binary</span></tt>, the chef-client is forced to spawn a gems process to install the gems (which uses more system resources) when options are passed as a string. String options are passed verbatim to the gems command and should be specified just as if they were passed on a command line. For example, <tt class="docutils literal"><span class="pre">--prerelease</span></tt> for a pre-release gem.</p>
<p><strong>Example</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;nokogiri&#39;</span> <span class="k">do</span>
  <span class="n">gem_binary</span><span class="p">(</span><span class="s1">&#39;/opt/ree/bin/gem&#39;</span><span class="p">)</span>
  <span class="n">options</span><span class="p">(</span><span class="s1">&#39;--prerelease --no-format-executable&#39;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="specify-with-gemrc-file">
<h4>Specify with .gemrc File<a class="headerlink" href="#specify-with-gemrc-file" title="Permalink to this headline">¶</a></h4>
<p>Options can be specified in a .gemrc file. By default the <tt class="docutils literal"><span class="pre">gem_package</span></tt> resource will use the Ruby interface to install gems which will ignore the .gemrc file. The <tt class="docutils literal"><span class="pre">gem_package</span></tt> resource can be forced to use the gems command instead (and to read the .gemrc file) by adding the <tt class="docutils literal"><span class="pre">gem_binary</span></tt> attribute to a code block.</p>
<p><strong>Example</strong></p>
<p>A template named <tt class="docutils literal"><span class="pre">gemrc.erb</span></tt> is located in a cookbook&#8217;s <tt class="docutils literal"><span class="pre">/templates</span></tt> directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="ss">:sources</span><span class="p">:</span>
<span class="o">-</span> <span class="ss">http</span><span class="p">:</span><span class="sr">//</span><span class="o">&lt;</span><span class="sx">%= node[&#39;gem_file&#39;][&#39;host&#39;] %&gt;:&lt;%=</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;gem_file&#39;</span><span class="o">][</span><span class="s1">&#39;port&#39;</span><span class="o">]</span> <span class="o">%&gt;</span><span class="sr">/</span>
</pre></div>
</div>
<p>A recipe can be built that does the following:</p>
<ul class="simple">
<li>Builds a <tt class="docutils literal"><span class="pre">.gemrc</span></tt> file based on a <tt class="docutils literal"><span class="pre">gemrc.erb</span></tt> template</li>
<li>Runs a <tt class="docutils literal"><span class="pre">Gem.configuration</span></tt> command</li>
<li>Installs a package using the <tt class="docutils literal"><span class="pre">.gemrc</span></tt> file</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/root/.gemrc&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;gemrc.erb&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;ruby_block[refresh_gemrc]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;refresh_gemrc&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Gem</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="no">Gem</span><span class="o">::</span><span class="no">ConfigFile</span><span class="o">.</span><span class="n">new</span> <span class="o">[]</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">gem_package</span> <span class="s1">&#39;di-ruby-lvm&#39;</span> <span class="k">do</span>
  <span class="n">gem_binary</span> <span class="s1">&#39;/opt/chef/embedded/bin/gem&#39;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id130">
<h3>Actions<a class="headerlink" href="#id130" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:purge</span></tt></dt>
<dd>Purge a package. This action typically removes the configuration files as well as the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:reconfig</span></tt></dt>
<dd>Reconfigure a package. This action requires a response file.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version.</dd>
</dl>
</div>
<div class="section" id="id131">
<h3>Properties<a class="headerlink" href="#id131" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">clear_sources</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Set to <tt class="docutils literal"><span class="pre">true</span></tt> to download a gem from the path specified by the <tt class="docutils literal"><span class="pre">source</span></tt> property (and not from RubyGems). Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">gem_binary</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A property for the <tt class="docutils literal"><span class="pre">gem_package</span></tt> provider that is used to specify a gems binary. By default, the same version of Ruby that is used by the chef-client will be installed.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The URL at which the gem package is located.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id132">
<h3>Providers<a class="headerlink" href="#id132" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Rubygems</span></tt>, <tt class="docutils literal"><span class="pre">gem_package</span></tt></dt>
<dd>Can be used with the <tt class="docutils literal"><span class="pre">options</span></tt> attribute.</dd>
</dl>
</div>
<div class="section" id="id133">
<h3>Examples<a class="headerlink" href="#id133" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a gems file from the local file system</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;right_aws&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;/tmp/right_aws-1.11.0.gem&#39;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the ignore_failure common attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;syntax&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">ignore_failure</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="git">
<h2>git<a class="headerlink" href="#git" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_git.rst">[edit on GitHub]</a></p>
<p>Use the <strong>git</strong> resource to manage source control resources that exist in a git repository. git version 1.6.5 (or higher) is required to use all of the functionality in the <strong>git</strong> resource.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This resource is often used in conjunction with the <strong>deploy</strong> resource.</p>
</div>
<div class="section" id="id134">
<h3>Syntax<a class="headerlink" href="#id134" title="Permalink to this headline">¶</a></h3>
<p>A <strong>git</strong> resource block manages source control resources that exist in a git repository:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/app_name&quot;</span> <span class="k">do</span>
  <span class="n">repository</span> <span class="n">node</span><span class="o">[</span><span class="ss">:app_name</span><span class="o">][</span><span class="ss">:git_repository</span><span class="o">]</span>
  <span class="n">revision</span> <span class="n">node</span><span class="o">[</span><span class="ss">:app_name</span><span class="o">][</span><span class="ss">:git_revision</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:sync</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>git</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">additional_remotes</span>         <span class="no">Hash</span>
  <span class="n">checkout_branch</span>            <span class="nb">String</span>
  <span class="n">depth</span>                      <span class="nb">Integer</span>
  <span class="n">destination</span>                <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">enable_checkout</span>            <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">enable_submodules</span>          <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">environment</span>                <span class="no">Hash</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Scm</span><span class="o">::</span><span class="no">Git</span>
  <span class="n">reference</span>                  <span class="nb">String</span>
  <span class="n">remote</span>                     <span class="nb">String</span>
  <span class="n">repository</span>                 <span class="nb">String</span>
  <span class="n">revision</span>                   <span class="nb">String</span>
  <span class="n">ssh_wrapper</span>                <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span>
  <span class="n">user</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :sync if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">git</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block and also (when the <tt class="docutils literal"><span class="pre">destination</span></tt> property is not specified) the location in which the source files will be placed and/or synchronized with the files under source control management</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">additional_remotes</span></tt>, <tt class="docutils literal"><span class="pre">checkout_branch</span></tt>, <tt class="docutils literal"><span class="pre">depth</span></tt>, <tt class="docutils literal"><span class="pre">destination</span></tt>, <tt class="docutils literal"><span class="pre">enable_checkout</span></tt>, <tt class="docutils literal"><span class="pre">enable_submodules</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">reference</span></tt>, <tt class="docutils literal"><span class="pre">remote</span></tt>, <tt class="docutils literal"><span class="pre">repository</span></tt>, <tt class="docutils literal"><span class="pre">revision</span></tt>, <tt class="docutils literal"><span class="pre">ssh_wrapper</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">user</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id135">
<h3>Actions<a class="headerlink" href="#id135" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:checkout</span></tt></dt>
<dd>Clone or check out the source. When a checkout is available, this provider does nothing.</dd>
<dt><tt class="docutils literal"><span class="pre">:export</span></tt></dt>
<dd>Export the source, excluding or removing any version control artifacts.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:sync</span></tt></dt>
<dd>Default. Update the source to the specified version, or get a new clone or checkout. This action causes a hard reset of the index and working tree, discarding any uncommitted changes.</dd>
</dl>
</div>
<div class="section" id="id136">
<h3>Properties<a class="headerlink" href="#id136" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">additional_remotes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">An array of additional remotes that are added to the git repository configuration.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">checkout_branch</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Do a one-time checkout from git <strong>or</strong> use when a branch in the upstream repository is named <tt class="docutils literal"><span class="pre">deploy</span></tt>. To prevent the <strong>git</strong> resource from attempting to check out master from master, set <tt class="docutils literal"><span class="pre">enable_checkout</span></tt> to <tt class="docutils literal"><span class="pre">false</span></tt> when using the <tt class="docutils literal"><span class="pre">checkout_branch</span></tt> property. See <tt class="docutils literal"><span class="pre">revision</span></tt>. Default value: <tt class="docutils literal"><span class="pre">deploy</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">depth</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of past revisions to be included in the git shallow clone. The default behavior will do a full clone.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">destination</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The location path to which the source is to be cloned, checked out, or exported. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">enable_checkout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Check out a repo from master. Set to <tt class="docutils literal"><span class="pre">false</span></tt> when using the <tt class="docutils literal"><span class="pre">checkout_branch</span></tt> attribute to prevent the <strong>git</strong> resource from attempting to check out master from master. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">enable_submodules</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Perform a sub-module initialization and update. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">environment</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p>A Hash of environment variables in the form of <tt class="docutils literal"><span class="pre">({&quot;ENV_VARIABLE&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;VALUE&quot;})</span></tt>. (These variables must exist for a command to be run successfully.)</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>git</strong> provider automatically sets the <tt class="docutils literal"><span class="pre">ENV['HOME']</span></tt> and <tt class="docutils literal"><span class="pre">ENV['GIT_SSH']</span></tt> environment variables. To override this behavior and provide different values, add <tt class="docutils literal"><span class="pre">ENV['HOME']</span></tt> and/or <tt class="docutils literal"><span class="pre">ENV['GIT_SSH']</span></tt> to the <tt class="docutils literal"><span class="pre">environment</span></tt> Hash.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The system group that is responsible for the checked-out code.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">reference</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The alias for revision.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">remote</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The remote repository to use when synchronizing an existing clone.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">repository</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The URI for the git repository.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">revision</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p>A branch, tag, or commit to be synchronized with git. This can be symbolic, like <tt class="docutils literal"><span class="pre">HEAD</span></tt> or it can be a source control management-specific revision identifier. See <tt class="docutils literal"><span class="pre">checkout_branch</span></tt>. Default value: <tt class="docutils literal"><span class="pre">HEAD</span></tt>.</p>
<p>The value of the <tt class="docutils literal"><span class="pre">revision</span></tt> attribute may change over time. From one branch to another, to a tag, to a specific SHA for a commit, and then back to a branch. The <tt class="docutils literal"><span class="pre">revision</span></tt> attribute may even be changed in a way where history gets rewritten.</p>
<p>Instead of tracking a specific branch or doing a headless checkout, the chef-client maintains its own branch (via the <strong>git</strong> resource) that does not exist in the upstream repository. The chef-client is then free to forcibly check out this branch to any commit without destroying the local history of an existing branch.</p>
<p>For example, to explicitly track an upstream repository&#8217;s master branch:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">revision</span> <span class="s1">&#39;master&#39;</span>
</pre></div>
</div>
<p class="last">Use the <tt class="docutils literal"><span class="pre">git</span> <span class="pre">rev-parse</span></tt> and <tt class="docutils literal"><span class="pre">git</span> <span class="pre">ls-remote</span></tt> commands to verify that the chef-client is synchronizing commits correctly. (The chef-client always runs <tt class="docutils literal"><span class="pre">git</span> <span class="pre">ls-remote</span></tt> on the upstream repository to verify the commit is made to the correct repository.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ssh_wrapper</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The path to the wrapper script used when running SSH with git. The <tt class="docutils literal"><span class="pre">GIT_SSH</span></tt> environment variable is set to this.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The amount of time (in seconds) to wait for a command to execute before timing out. When this property is specified using the <strong>deploy</strong> resource, the value of the <tt class="docutils literal"><span class="pre">timeout</span></tt> property is passed from the <strong>deploy</strong> resource to the <strong>git</strong> resource.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The system user that is responsible for the checked-out code. Default value: the home directory of this user, as indicated by the <tt class="docutils literal"><span class="pre">HOME</span></tt> environment variable.</p>
</dd>
</dl>
</div>
<div class="section" id="id137">
<h3>Examples<a class="headerlink" href="#id137" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Use the git mirror</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="s1">&#39;/opt/mysources/couch&#39;</span> <span class="k">do</span>
  <span class="n">repository</span> <span class="s1">&#39;git://git.apache.org/couchdb.git&#39;</span>
  <span class="n">revision</span> <span class="s1">&#39;master&#39;</span>
  <span class="n">action</span> <span class="ss">:sync</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use different branches</strong></p>
<p>To use different branches, depending on the environment of the node:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">chef_environment</span> <span class="o">==</span> <span class="s1">&#39;QA&#39;</span>
   <span class="n">branch_name</span> <span class="o">=</span> <span class="s1">&#39;staging&#39;</span>
<span class="k">else</span>
   <span class="n">branch_name</span> <span class="o">=</span> <span class="s1">&#39;master&#39;</span>
<span class="k">end</span>

<span class="n">git</span> <span class="s1">&#39;/home/user/deployment&#39;</span> <span class="k">do</span>
   <span class="n">repository</span> <span class="s1">&#39;git@github.com:gitsite/deployment.git&#39;</span>
   <span class="n">revision</span> <span class="n">branch_name</span>
   <span class="n">action</span> <span class="ss">:sync</span>
   <span class="n">user</span> <span class="s1">&#39;user&#39;</span>
   <span class="n">group</span> <span class="s1">&#39;test&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">branch_name</span></tt> variable is set to <tt class="docutils literal"><span class="pre">staging</span></tt> or <tt class="docutils literal"><span class="pre">master</span></tt>, depending on the environment of the node. Once this is determined, the <tt class="docutils literal"><span class="pre">branch_name</span></tt> variable is used to set the revision for the repository. If the <tt class="docutils literal"><span class="pre">git</span> <span class="pre">status</span></tt> command is used after running the example above, it will return the branch name as <tt class="docutils literal"><span class="pre">deploy</span></tt>, as this is the default value. Run the chef-client in debug mode to verify that the correct branches are being checked out:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ sudo chef-client -l debug
</pre></div>
</div>
<p><strong>Install an application from git using bash</strong></p>
<p>The following example shows how Bash can be used to install a plug-in for rbenv named <tt class="docutils literal"><span class="pre">ruby-build</span></tt>, which is located in git version source control. First, the application is synchronized, and then Bash changes its working directory to the location in which <tt class="docutils literal"><span class="pre">ruby-build</span></tt> is located, and then runs a command.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span> <span class="n">git</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/ruby-build&quot;</span> <span class="k">do</span>
   <span class="n">repository</span> <span class="s1">&#39;git://github.com/sstephenson/ruby-build.git&#39;</span>
   <span class="n">reference</span> <span class="s1">&#39;master&#39;</span>
   <span class="n">action</span> <span class="ss">:sync</span>
 <span class="k">end</span>

 <span class="n">bash</span> <span class="s1">&#39;install_ruby_build&#39;</span> <span class="k">do</span>
   <span class="n">cwd</span> <span class="s1">&#39;#{Chef::Config[:file_cache_path]}/ruby-build&#39;</span>
   <span class="n">user</span> <span class="s1">&#39;rbenv&#39;</span>
   <span class="n">group</span> <span class="s1">&#39;rbenv&#39;</span>
   <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">     ./install.sh</span>
<span class="no">     EOH</span>
   <span class="n">environment</span> <span class="s1">&#39;PREFIX&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/local&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>To read more about <tt class="docutils literal"><span class="pre">ruby-build</span></tt>, see here: <a class="reference external" href="https://github.com/sstephenson/ruby-build">https://github.com/sstephenson/ruby-build</a>.</p>
<p><strong>Upgrade packages from git</strong></p>
<p>The following example uses the <strong>git</strong> resource to upgrade packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``source`` recipe</span>
<span class="c1"># in the ``libvpx-cookbook`` cookbook:</span>
<span class="c1"># https://github.com/enmasse-entertainment/libvpx-cookbook</span>

<span class="n">git</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/libvpx&quot;</span> <span class="k">do</span>
  <span class="n">repository</span> <span class="n">node</span><span class="o">[</span><span class="ss">:libvpx</span><span class="o">][</span><span class="ss">:git_repository</span><span class="o">]</span>
  <span class="n">revision</span> <span class="n">node</span><span class="o">[</span><span class="ss">:libvpx</span><span class="o">][</span><span class="ss">:git_revision</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:sync</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;bash[compile_libvpx]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Pass in environment variables</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="s1">&#39;/opt/mysources/couch&#39;</span> <span class="k">do</span>
  <span class="n">repository</span> <span class="s1">&#39;git://git.apache.org/couchdb.git&#39;</span>
  <span class="n">revision</span> <span class="s1">&#39;master&#39;</span>
  <span class="n">environment</span>  <span class="p">{</span> <span class="s1">&#39;VAR&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;whatever&#39;</span> <span class="p">}</span>
  <span class="n">action</span> <span class="ss">:sync</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="group">
<h2>group<a class="headerlink" href="#group" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_group.rst">[edit on GitHub]</a></p>
<p>Use the <strong>group</strong> resource to manage a local group.</p>
<div class="section" id="id138">
<h3>Syntax<a class="headerlink" href="#id138" title="Permalink to this headline">¶</a></h3>
<p>A <strong>group</strong> resource block manages groups on a node:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">group</span> <span class="s1">&#39;www-data&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:modify</span>
  <span class="n">members</span> <span class="s1">&#39;maintenance&#39;</span>
  <span class="n">append</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>group</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">group</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">append</span>                     <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">excluded_members</span>           <span class="nb">Array</span>
  <span class="n">gid</span>                        <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">group_name</span>                 <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">members</span>                    <span class="nb">Array</span>
  <span class="n">non_unique</span>                 <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Group</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="nb">system</span>                     <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">group</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">append</span></tt>, <tt class="docutils literal"><span class="pre">excluded_members</span></tt>, <tt class="docutils literal"><span class="pre">gid</span></tt>, <tt class="docutils literal"><span class="pre">group_name</span></tt>, <tt class="docutils literal"><span class="pre">members</span></tt>, <tt class="docutils literal"><span class="pre">non_unique</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, and <tt class="docutils literal"><span class="pre">system</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id139">
<h3>Actions<a class="headerlink" href="#id139" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>Default. Create a group. If a group already exists (but does not match), update that group to match.</dd>
<dt><tt class="docutils literal"><span class="pre">:manage</span></tt></dt>
<dd>Manage an existing group. This action does nothing if the group does not exist.</dd>
<dt><tt class="docutils literal"><span class="pre">:modify</span></tt></dt>
<dd>Modify an existing group. This action raises an exception if the group does not exist.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a group.</dd>
</dl>
</div>
<div class="section" id="id140">
<h3>Properties<a class="headerlink" href="#id140" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">append</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">How members should be appended and/or removed from a group. When <tt class="docutils literal"><span class="pre">true</span></tt>, <tt class="docutils literal"><span class="pre">members</span></tt> are appended and <tt class="docutils literal"><span class="pre">excluded_members</span></tt> are removed. When <tt class="docutils literal"><span class="pre">false</span></tt>, group members are reset to the value of the <tt class="docutils literal"><span class="pre">members</span></tt> property. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">excluded_members</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p class="last">Remove users from a group. May only be used when <tt class="docutils literal"><span class="pre">append</span></tt> is set to <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">gid</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The identifier for the group.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of the group. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">members</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p class="last">Which users should be set or appended to a group. When more than one group member is identified, the list of members should be an array: <tt class="docutils literal"><span class="pre">members</span> <span class="pre">['user1',</span> <span class="pre">'user2']</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">non_unique</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Allow <tt class="docutils literal"><span class="pre">gid</span></tt> duplication. May only be used with the <tt class="docutils literal"><span class="pre">Groupadd</span></tt> provider. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">system</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Show if a group belongs to a system group. Set to <tt class="docutils literal"><span class="pre">true</span></tt> if the group belongs to a system group.</p>
</dd>
</dl>
</div>
<div class="section" id="id141">
<h3>Providers<a class="headerlink" href="#id141" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Group</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd>When this short name is used, the chef-client will determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Group::Aix</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd>The provider for the AIX platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Group::Dscl</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd>The provider for the Mac OS X platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Group::Gpasswd</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd>The provider for the gpasswd command.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Group::Groupadd</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd>The provider for the groupadd command.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Group::Groupmod</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd>The provider for the groupmod command.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Group::Pw</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd>The provider for the FreeBSD platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Group::Suse</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd>The provider for the openSUSE platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Group::Usermod</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd>The provider for the Solaris platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Group::Windows</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd>The provider for the Microsoft Windows platform.</dd>
</dl>
</div>
<div class="section" id="id142">
<h3>Examples<a class="headerlink" href="#id142" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Append users to groups</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">group</span> <span class="s1">&#39;www-data&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:modify</span>
  <span class="n">members</span> <span class="s1">&#39;maintenance&#39;</span>
  <span class="n">append</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Add a user to group on the Windows platform</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">group</span> <span class="s1">&#39;Administrators&#39;</span> <span class="k">do</span>
  <span class="n">members</span> <span class="o">[</span><span class="s1">&#39;domain\foo&#39;</span><span class="o">]</span>
  <span class="n">append</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:modify</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="homebrew-package">
<h2>homebrew_package<a class="headerlink" href="#homebrew-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_homebrew_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>homebrew_package</strong> resource to manage packages for the Mac OS X platform.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id143">
<h3>Syntax<a class="headerlink" href="#id143" title="Permalink to this headline">¶</a></h3>
<p>A <strong>homebrew_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>homebrew_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">homebrew_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>homebrew_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">homebrew_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">homebrew_user</span>              <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Homebrew</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">homebrew_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">homebrew_user</span></tt>, <tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id144">
<h3>Actions<a class="headerlink" href="#id144" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:purge</span></tt></dt>
<dd>Purge a package. This action typically removes the configuration files as well as the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version.</dd>
</dl>
</div>
<div class="section" id="id145">
<h3>Properties<a class="headerlink" href="#id145" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">homebrew_user</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p>The name of the Homebrew owner to be used by the chef-client when executing a command.</p>
<p class="last">The chef-client, by default, will attempt to execute a Homebrew command as the owner of <tt class="docutils literal"><span class="pre">/usr/local/bin/brew</span></tt>. If that executable does not exist, the chef-client will attempt to find the user by executing <tt class="docutils literal"><span class="pre">which</span> <span class="pre">brew</span></tt>. If that executable cannot be found, the chef-client will print an error message: <tt class="docutils literal"><span class="pre">Could</span> <span class="pre">not</span> <span class="pre">find</span> <span class="pre">the</span> <span class="pre">&quot;brew&quot;</span> <span class="pre">executable</span> <span class="pre">in</span> <span class="pre">/usr/local/bin</span> <span class="pre">or</span> <span class="pre">anywhere</span> <span class="pre">on</span> <span class="pre">the</span> <span class="pre">path.</span></tt>. Use the <tt class="docutils literal"><span class="pre">homebrew_user</span></tt> attribute to specify the Homebrew owner for situations where the chef-client cannot automatically detect the correct owner.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id146">
<h3>Providers<a class="headerlink" href="#id146" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Homebrew</span></tt>, <tt class="docutils literal"><span class="pre">homebrew_package</span></tt></dt>
<dd>The provider for the Mac OS X platform.</dd>
</dl>
</div>
<div class="section" id="id147">
<h3>Examples<a class="headerlink" href="#id147" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">homebrew_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify the Homebrew user with a UUID</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">homebrew_package</span> <span class="s1">&#39;emacs&#39;</span> <span class="k">do</span>
  <span class="n">homebrew_user</span> <span class="mi">1001</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify the Homebrew user with a string</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">homebrew_package</span> <span class="s1">&#39;vim&#39;</span> <span class="k">do</span>
  <span class="n">homebrew_user</span> <span class="s1">&#39;user1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="http-request">
<h2>http_request<a class="headerlink" href="#http-request" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_http_request.rst">[edit on GitHub]</a></p>
<p>Use the <strong>http_request</strong> resource to send an HTTP request (<tt class="docutils literal"><span class="pre">GET</span></tt>, <tt class="docutils literal"><span class="pre">PUT</span></tt>, <tt class="docutils literal"><span class="pre">POST</span></tt>, <tt class="docutils literal"><span class="pre">DELETE</span></tt>, <tt class="docutils literal"><span class="pre">HEAD</span></tt>, or <tt class="docutils literal"><span class="pre">OPTIONS</span></tt>) with an arbitrary message. This resource is often useful when custom callbacks are necessary.</p>
<div class="section" id="id148">
<h3>Syntax<a class="headerlink" href="#id148" title="Permalink to this headline">¶</a></h3>
<p>A <strong>http_request</strong> resource block sends HTTP requests with an arbitrary message. For example, send a <tt class="docutils literal"><span class="pre">DELETE</span></tt> request to <tt class="docutils literal"><span class="pre">'http://www.chef.io/some_page?message=please_delete_me'</span></tt>.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">http_request</span> <span class="s1">&#39;please_delete_me&#39;</span> <span class="k">do</span>
  <span class="n">url</span> <span class="s1">&#39;http://www.chef.io/some_page&#39;</span>
  <span class="n">action</span> <span class="ss">:delete</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>http_request</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">http_request</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">headers</span>                    <span class="no">Hash</span>
  <span class="n">message</span>                    <span class="no">Object</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">HttpRequest</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">url</span>                        <span class="nb">String</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :get if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">http_request</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">headers</span></tt>, <tt class="docutils literal"><span class="pre">message</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, and <tt class="docutils literal"><span class="pre">url</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id149">
<h3>Actions<a class="headerlink" href="#id149" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Send a <tt class="docutils literal"><span class="pre">DELETE</span></tt> request.</dd>
<dt><tt class="docutils literal"><span class="pre">:get</span></tt></dt>
<dd>Default. Send a <tt class="docutils literal"><span class="pre">GET</span></tt> request.</dd>
<dt><tt class="docutils literal"><span class="pre">:head</span></tt></dt>
<dd>Send a <tt class="docutils literal"><span class="pre">HEAD</span></tt> request.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:options</span></tt></dt>
<dd>Send an <tt class="docutils literal"><span class="pre">OPTIONS</span></tt> request.</dd>
<dt><tt class="docutils literal"><span class="pre">:post</span></tt></dt>
<dd>Send a <tt class="docutils literal"><span class="pre">POST</span></tt> request.</dd>
<dt><tt class="docutils literal"><span class="pre">:put</span></tt></dt>
<dd>Send a <tt class="docutils literal"><span class="pre">PUT</span></tt> request.</dd>
</dl>
</div>
<div class="section" id="id150">
<h3>Properties<a class="headerlink" href="#id150" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">headers</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A Hash of custom headers. Default value: <tt class="docutils literal"><span class="pre">{}</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">message</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Object</p>
<p class="last">The message that is sent by the HTTP request. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">url</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The URL to which an HTTP request is sent.</p>
</dd>
</dl>
</div>
<div class="section" id="id151">
<h3>Examples<a class="headerlink" href="#id151" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Send a GET request</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">http_request</span> <span class="s1">&#39;some_message&#39;</span> <span class="k">do</span>
  <span class="n">url</span> <span class="s1">&#39;http://example.com/check_in&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The message is sent as <tt class="docutils literal"><span class="pre">http://example.com/check_in?message=some_message</span></tt>.</p>
<p><strong>Send a POST request</strong></p>
<p>To send a <tt class="docutils literal"><span class="pre">POST</span></tt> request as JSON data, convert the message to JSON and include the correct content-type header. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">http_request</span> <span class="s1">&#39;posting data&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:post</span>
  <span class="n">url</span> <span class="s1">&#39;http://example.com/check_in&#39;</span>
  <span class="n">message</span> <span class="p">({</span><span class="ss">:some</span> <span class="o">=&gt;</span> <span class="s1">&#39;data&#39;</span><span class="p">}</span><span class="o">.</span><span class="n">to_json</span><span class="p">)</span>
  <span class="n">headers</span><span class="p">({</span><span class="s1">&#39;AUTHORIZATION&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;Basic </span><span class="si">#{</span>
    <span class="no">Base64</span><span class="o">.</span><span class="n">encode64</span><span class="p">(</span><span class="s1">&#39;username:password&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="s1">&#39;Content-Type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/data&#39;</span>
  <span class="p">})</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Transfer a file only when the remote source changes</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/tmp/couch.png&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://couchdb.apache.org/img/sketch.png&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">http_request</span> <span class="s1">&#39;HEAD http://couchdb.apache.org/img/sketch.png&#39;</span> <span class="k">do</span>
  <span class="n">message</span> <span class="s1">&#39;&#39;</span>
  <span class="n">url</span> <span class="s1">&#39;http://couchdb.apache.org/img/sketch.png&#39;</span>
  <span class="n">action</span> <span class="ss">:head</span>
  <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/tmp/couch.png&#39;</span><span class="p">)</span>
    <span class="n">headers</span> <span class="s1">&#39;If-Modified-Since&#39;</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">mtime</span><span class="p">(</span><span class="s1">&#39;/tmp/couch.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">httpdate</span>
  <span class="k">end</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;remote_file[/tmp/couch.png]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ifconfig">
<h2>ifconfig<a class="headerlink" href="#ifconfig" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_ifconfig.rst">[edit on GitHub]</a></p>
<p>Use the <strong>ifconfig</strong> resource to manage interfaces.</p>
<div class="section" id="id152">
<h3>Syntax<a class="headerlink" href="#id152" title="Permalink to this headline">¶</a></h3>
<p>A <strong>ifconfig</strong> resource block manages interfaces, such as a static IP address:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="s1">&#39;33.33.33.80&#39;</span> <span class="k">do</span>
  <span class="n">device</span> <span class="s1">&#39;eth1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>ifconfig</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">bcast</span>                      <span class="nb">String</span>
  <span class="n">bootproto</span>                  <span class="nb">String</span>
  <span class="n">device</span>                     <span class="nb">String</span>
  <span class="n">hwaddr</span>                     <span class="nb">String</span>
  <span class="n">inet_addr</span>                  <span class="nb">String</span>
  <span class="n">mask</span>                       <span class="nb">String</span>
  <span class="n">metric</span>                     <span class="nb">String</span>
  <span class="n">mtu</span>                        <span class="nb">String</span>
  <span class="n">network</span>                    <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">onboot</span>                     <span class="nb">String</span>
  <span class="n">onparent</span>                   <span class="nb">String</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Ifconfig</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">target</span>                     <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ifconfig</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">bcast</span></tt>, <tt class="docutils literal"><span class="pre">bootproto</span></tt>, <tt class="docutils literal"><span class="pre">device</span></tt>, <tt class="docutils literal"><span class="pre">hwaddr</span></tt>, <tt class="docutils literal"><span class="pre">inet_addr</span></tt>, <tt class="docutils literal"><span class="pre">mask</span></tt>, <tt class="docutils literal"><span class="pre">metric</span></tt>, <tt class="docutils literal"><span class="pre">mtu</span></tt>, <tt class="docutils literal"><span class="pre">network</span></tt>, <tt class="docutils literal"><span class="pre">onboot</span></tt>, <tt class="docutils literal"><span class="pre">onparent</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>,  and <tt class="docutils literal"><span class="pre">target</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id153">
<h3>Actions<a class="headerlink" href="#id153" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:add</span></tt></dt>
<dd>Default. Run ifconfig to configure a network interface and (on some platforms) write a configuration file for that network interface.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Run ifconfig to disable a network interface and (on some platforms) delete that network interface&#8217;s configuration file.</dd>
<dt><tt class="docutils literal"><span class="pre">:disable</span></tt></dt>
<dd>Run ifconfig to disable a network interface.</dd>
<dt><tt class="docutils literal"><span class="pre">:enable</span></tt></dt>
<dd>Run ifconfig to enable a network interface.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
</dl>
</div>
<div class="section" id="id154">
<h3>Properties<a class="headerlink" href="#id154" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">bcast</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The broadcast address for a network interface. On some platforms this property is not set using ifconfig, but instead is added to the startup configuration file for the network interface.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">bootproto</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The boot protocol used by a network interface.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">device</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The network interface to be configured.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">hwaddr</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The hardware address for the network interface.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">inet_addr</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The Internet host address for the network interface.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">mask</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The decimal representation of the network mask. For example: <tt class="docutils literal"><span class="pre">255.255.255.0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">metric</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The routing metric for the interface.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">mtu</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The maximum transmission unit (MTU) for the network interface.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">network</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The address for the network interface.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">onboot</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Bring up the network interface on boot.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">onparent</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Bring up the network interface when its parent interface is brought up.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">target</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The IP address that is to be assigned to the network interface. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
</dl>
</div>
<div class="section" id="id155">
<h3>Examples<a class="headerlink" href="#id155" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Configure a network interface</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="s2">&quot;33.33.33.80&quot;</span> <span class="k">do</span>
  <span class="n">bootproto</span> <span class="s2">&quot;dhcp&quot;</span>
  <span class="n">device</span> <span class="s2">&quot;eth1&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>will create the following interface:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>vagrant@default-ubuntu-1204:~$ cat /etc/network/interfaces.d/ifcfg-eth1
iface eth1 inet dhcp
</pre></div>
</div>
<p><strong>Specify a boot protocol</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="s1">&#39;192.186.0.1&#39;</span> <span class="k">do</span>
  <span class="n">device</span> <span class="s1">&#39;eth0&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify a static IP address</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="s2">&quot;33.33.33.80&quot;</span> <span class="k">do</span>
  <span class="n">device</span> <span class="s2">&quot;eth1&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>will create the following interface:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>iface eth1 inet static
  address 33.33.33.80
</pre></div>
</div>
<p><strong>Update a static IP address with a boot protocol</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="s2">&quot;33.33.33.80&quot;</span> <span class="k">do</span>
  <span class="n">bootproto</span> <span class="s2">&quot;dhcp&quot;</span>
  <span class="n">device</span> <span class="s2">&quot;eth1&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>will update the interface from <tt class="docutils literal"><span class="pre">static</span></tt> to <tt class="docutils literal"><span class="pre">dhcp</span></tt>:</p>
<div class="highlight-none"><div class="highlight"><pre><span></span>iface eth1 inet dhcp
  address 33.33.33.80
</pre></div>
</div>
</div>
</div>
<div class="section" id="ips-package">
<h2>ips_package<a class="headerlink" href="#ips-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_ips_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>ips_package</strong> resource to manage packages (using Image Packaging System (IPS)) on the Solaris 11 platform.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id156">
<h3>Syntax<a class="headerlink" href="#id156" title="Permalink to this headline">¶</a></h3>
<p>A <strong>ips_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>ips_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ips_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>ips_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ips_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">accept_license</span>             <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Ips</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ips_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">accept_license</span></tt>, <tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id157">
<h3>Actions<a class="headerlink" href="#id157" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version.</dd>
</dl>
</div>
<div class="section" id="id158">
<h3>Properties<a class="headerlink" href="#id158" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">accept_license</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Accept an end-user license agreement, automatically. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id159">
<h3>Providers<a class="headerlink" href="#id159" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Ips</span></tt>, <tt class="docutils literal"><span class="pre">ips_package</span></tt></dt>
<dd>The provider for the ips platform.</dd>
</dl>
</div>
<div class="section" id="id160">
<h3>Examples<a class="headerlink" href="#id160" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ips_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="link">
<h2>link<a class="headerlink" href="#link" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_link.rst">[edit on GitHub]</a></p>
<p>Use the <strong>link</strong> resource to create symbolic or hard links.</p>
<p>A symbolic link&#8212;sometimes referred to as a soft link&#8212;is a directory entry that associates a file name with a string that contains an absolute or relative path to a file on any file system. In other words, &#8220;a file that contains a path that points to another file.&#8221; A symbolic link creates a new file with a new inode that points to the inode location of the original file.</p>
<p>A hard link is a directory entry that associates a file with another file in the same file system. In other words, &#8220;multiple directory entries to the same file.&#8221; A hard link creates a new file that points to the same inode as the original file.</p>
<div class="section" id="id161">
<h3>Syntax<a class="headerlink" href="#id161" title="Permalink to this headline">¶</a></h3>
<p>A <strong>link</strong> resource block creates symbolic or hard links. For example, to create a hard link from <tt class="docutils literal"><span class="pre">/tmp/file</span></tt> to <tt class="docutils literal"><span class="pre">/etc/file</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="s1">&#39;/tmp/file&#39;</span> <span class="k">do</span>
  <span class="n">to</span> <span class="s1">&#39;/etc/file&#39;</span>
  <span class="n">link_type</span> <span class="ss">:hard</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Because the default value for <tt class="docutils literal"><span class="pre">link_type</span></tt> is symbolic, and because properties that are not specified in the resource block will be assigned their default values, the following example creates a symbolic link:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="s1">&#39;/tmp/file&#39;</span> <span class="k">do</span>
  <span class="n">to</span> <span class="s1">&#39;/etc/file&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>link</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">group</span>                      <span class="nb">Integer</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">link_type</span>                  <span class="no">Symbol</span>
  <span class="n">mode</span>                       <span class="nb">Integer</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">owner</span>                      <span class="nb">Integer</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Link</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">target_file</span>                <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">to</span>                         <span class="nb">String</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">link</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">link_type</span></tt>, <tt class="docutils literal"><span class="pre">mode</span></tt>, <tt class="docutils literal"><span class="pre">owner</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">target_file</span></tt>, and <tt class="docutils literal"><span class="pre">to</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id162">
<h3>Actions<a class="headerlink" href="#id162" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>Default. Create a link. If a link already exists (but does not match), update that link to match.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Delete a link.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
</dl>
</div>
<div class="section" id="id163">
<h3>Properties<a class="headerlink" href="#id163" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">A string or ID that identifies the group associated with a symbolic link.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">link_type</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol</p>
<p class="last">The type of link: <tt class="docutils literal"><span class="pre">:symbolic</span></tt> or <tt class="docutils literal"><span class="pre">:hard</span></tt>. Default value: <tt class="docutils literal"><span class="pre">:symbolic</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">mode</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p>If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified and if the file already exists, the existing mode on the file is used. If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified, the file does not exist, and the <tt class="docutils literal"><span class="pre">:create</span></tt> action is specified, the chef-client assumes a mask value of <tt class="docutils literal"><span class="pre">'0777'</span></tt> and then applies the umask for the system on which the file is to be created to the <tt class="docutils literal"><span class="pre">mask</span></tt> value. For example, if the umask on a system is <tt class="docutils literal"><span class="pre">'022'</span></tt>, the chef-client uses the default value of <tt class="docutils literal"><span class="pre">'0755'</span></tt>. Default value: <tt class="docutils literal"><span class="pre">777</span></tt>.</p>
<p>The behavior is different depending on the platform.</p>
<p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. If the value is specified as a quoted string, it works exactly as if the <tt class="docutils literal"><span class="pre">chmod</span></tt> command was passed. If the value is specified as an integer, prepend a zero (<tt class="docutils literal"><span class="pre">0</span></tt>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <tt class="docutils literal"><span class="pre">'0777'</span></tt> or <tt class="docutils literal"><span class="pre">'777'</span></tt>; for the same rights, plus the sticky bit, use <tt class="docutils literal"><span class="pre">01777</span></tt> or <tt class="docutils literal"><span class="pre">'1777'</span></tt>.</p>
<p class="last">Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. Values up to <tt class="docutils literal"><span class="pre">'0777'</span></tt> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <tt class="docutils literal"><span class="pre">4</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">2</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, and <tt class="docutils literal"><span class="pre">1</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>. This property cannot be used to set <tt class="docutils literal"><span class="pre">:full_control</span></tt>. This property has no effect if not specified, but when it and <tt class="docutils literal"><span class="pre">rights</span></tt> are both specified, the effects are cumulative.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">owner</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">The owner associated with a symbolic link.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">target_file</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of the link. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">to</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The actual file to which the link is to be created.</p>
</dd>
</dl>
</div>
<div class="section" id="id164">
<h3>Examples<a class="headerlink" href="#id164" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Create symbolic links</strong></p>
<p>The following example will create a symbolic link from <tt class="docutils literal"><span class="pre">/tmp/file</span></tt> to <tt class="docutils literal"><span class="pre">/etc/file</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="s1">&#39;/tmp/file&#39;</span> <span class="k">do</span>
  <span class="n">to</span> <span class="s1">&#39;/etc/file&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create hard links</strong></p>
<p>The following example will create a hard link from <tt class="docutils literal"><span class="pre">/tmp/file</span></tt> to <tt class="docutils literal"><span class="pre">/etc/file</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="s1">&#39;/tmp/file&#39;</span> <span class="k">do</span>
  <span class="n">to</span> <span class="s1">&#39;/etc/file&#39;</span>
  <span class="n">link_type</span> <span class="ss">:hard</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delete links</strong></p>
<p>The following example will delete the <tt class="docutils literal"><span class="pre">/tmp/file</span></tt> symbolic link and uses the <tt class="docutils literal"><span class="pre">only_if</span></tt> guard to run the <tt class="docutils literal"><span class="pre">test</span> <span class="pre">-L</span></tt> command, which verifies that <tt class="docutils literal"><span class="pre">/tmp/file</span></tt> is a symbolic link, and then only deletes <tt class="docutils literal"><span class="pre">/tmp/file</span></tt> if the test passes:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="s1">&#39;/tmp/file&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:delete</span>
  <span class="n">only_if</span> <span class="s1">&#39;test -L /tmp/file&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create multiple symbolic links</strong></p>
<p>The following example creates symbolic links from two files in the <tt class="docutils literal"><span class="pre">/vol/webserver/cert/</span></tt> directory to files located in the <tt class="docutils literal"><span class="pre">/etc/ssl/certs/</span></tt> directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">link</span> <span class="s1">&#39;/vol/webserver/cert/server.crt&#39;</span> <span class="k">do</span>
  <span class="n">to</span> <span class="s1">&#39;/etc/ssl/certs/ssl-cert-name.pem&#39;</span>
<span class="k">end</span>

<span class="n">link</span> <span class="s1">&#39;/vol/webserver/cert/server.key&#39;</span> <span class="k">do</span>
  <span class="n">to</span> <span class="s1">&#39;/etc/ssl/certs/ssl-cert-name.key&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create platform-specific symbolic links</strong></p>
<p>The following example shows installing a filter module on Apache. The package name is different for different platforms, and for the Red Hat Enterprise Linux family, a symbolic link is required:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">include_recipe</span> <span class="s1">&#39;apache2::default&#39;</span>

<span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform_family&#39;</span><span class="o">]</span>
<span class="k">when</span> <span class="s1">&#39;debian&#39;</span>
  <span class="o">...</span>
<span class="k">when</span> <span class="s1">&#39;suse&#39;</span>
  <span class="o">...</span>
<span class="k">when</span> <span class="s1">&#39;rhel&#39;</span><span class="p">,</span> <span class="s1">&#39;fedora&#39;</span>
  <span class="o">...</span>

  <span class="n">link</span> <span class="s1">&#39;/usr/lib64/httpd/modules/mod_apreq.so&#39;</span> <span class="k">do</span>
    <span class="n">to</span>      <span class="s1">&#39;/usr/lib64/httpd/modules/mod_apreq2.so&#39;</span>
    <span class="n">only_if</span> <span class="s1">&#39;test -f /usr/lib64/httpd/modules/mod_apreq2.so&#39;</span>
  <span class="k">end</span>

  <span class="n">link</span> <span class="s1">&#39;/usr/lib/httpd/modules/mod_apreq.so&#39;</span> <span class="k">do</span>
    <span class="n">to</span>      <span class="s1">&#39;/usr/lib/httpd/modules/mod_apreq2.so&#39;</span>
    <span class="n">only_if</span> <span class="s1">&#39;test -f /usr/lib/httpd/modules/mod_apreq2.so&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="o">...</span>
</pre></div>
</div>
<p>For the entire recipe, see <a class="reference external" href="https://github.com/onehealth-cookbooks/apache2/blob/68bdfba4680e70b3e90f77e40223dd535bf22c17/recipes/mod_apreq2.rb">https://github.com/onehealth-cookbooks/apache2/blob/68bdfba4680e70b3e90f77e40223dd535bf22c17/recipes/mod_apreq2.rb</a>.</p>
</div>
</div>
<div class="section" id="log">
<h2>log<a class="headerlink" href="#log" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_log.rst">[edit on GitHub]</a></p>
<p>Use the <strong>log</strong> resource to create log entries. The <strong>log</strong> resource behaves like any other resource: built into the resource collection during the compile phase, and then run during the execution phase. (To create a log entry that is not built into the resource collection, use <tt class="docutils literal"><span class="pre">Chef::Log</span></tt> instead of the <strong>log</strong> resource.)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">By default, every log resource that executes will count as an updated resource in the updated resource count at the end of a Chef run. You can disable this behavior by adding <tt class="docutils literal"><span class="pre">count_log_resource_updates</span> <span class="pre">false</span></tt> to your Chef <tt class="docutils literal"><span class="pre">client.rb</span></tt> configuration file.</p>
</div>
<div class="section" id="id165">
<h3>Syntax<a class="headerlink" href="#id165" title="Permalink to this headline">¶</a></h3>
<p>A <strong>log</strong> resource block adds messages to the log file based on events that occur during the chef-client run:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="s1">&#39;message&#39;</span> <span class="k">do</span>
  <span class="n">message</span> <span class="s1">&#39;A message add to the log.&#39;</span>
  <span class="n">level</span> <span class="ss">:info</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>log</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">level</span>                      <span class="no">Symbol</span>
  <span class="n">message</span>                    <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">ChefLog</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :write if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">log</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">message</span></tt> is the log message to write</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">level</span></tt>, <tt class="docutils literal"><span class="pre">message</span></tt>, and <tt class="docutils literal"><span class="pre">provider</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id166">
<h3>Actions<a class="headerlink" href="#id166" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:write</span></tt></dt>
<dd>Default. Write to log.</dd>
</dl>
</div>
<div class="section" id="id167">
<h3>Properties<a class="headerlink" href="#id167" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">level</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol</p>
<p class="last">The level of logging that is to be displayed by the chef-client. The chef-client uses the <tt class="docutils literal"><span class="pre">mixlib-log</span></tt> (<a class="reference external" href="https://github.com/chef/mixlib-log">https://github.com/chef/mixlib-log</a>) to handle logging behavior. Options (in order of priority): <tt class="docutils literal"><span class="pre">:debug</span></tt>, <tt class="docutils literal"><span class="pre">:info</span></tt>, <tt class="docutils literal"><span class="pre">:warn</span></tt>, <tt class="docutils literal"><span class="pre">:error</span></tt>, and <tt class="docutils literal"><span class="pre">:fatal</span></tt>. Default value: <tt class="docutils literal"><span class="pre">:info</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">message</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The message to be added to a log file. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="chef-log-entries">
<h3>Chef::Log Entries<a class="headerlink" href="#chef-log-entries" title="Permalink to this headline">¶</a></h3>
<p><tt class="docutils literal"><span class="pre">Chef::Log</span></tt> extends <tt class="docutils literal"><span class="pre">Mixlib::Log</span></tt> and will print log entries to the default logger that is configured for the machine on which the chef-client is running. (To create a log entry that is built into the resource collection, use the <strong>log</strong> resource instead of <tt class="docutils literal"><span class="pre">Chef::Log</span></tt>.)</p>
<p>The following log levels are supported:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Log Level</th>
<th class="head">Syntax</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Fatal</td>
<td><tt class="docutils literal"><span class="pre">Chef::Log.fatal('string')</span></tt></td>
</tr>
<tr class="row-odd"><td>Error</td>
<td><tt class="docutils literal"><span class="pre">Chef::Log.error('string')</span></tt></td>
</tr>
<tr class="row-even"><td>Warn</td>
<td><tt class="docutils literal"><span class="pre">Chef::Log.warn('string')</span></tt></td>
</tr>
<tr class="row-odd"><td>Info</td>
<td><tt class="docutils literal"><span class="pre">Chef::Log.info('string')</span></tt></td>
</tr>
<tr class="row-even"><td>Debug</td>
<td><tt class="docutils literal"><span class="pre">Chef::Log.debug('string')</span></tt></td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The parentheses are optional, e.g. <tt class="docutils literal"><span class="pre">Chef::Log.info</span> <span class="pre">'string'</span></tt> may be used instead of <tt class="docutils literal"><span class="pre">Chef::Log.info('string')</span></tt>.</p>
</div>
<p>The following example shows a series of fatal <tt class="docutils literal"><span class="pre">Chef::Log</span></tt> entries:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">unless</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;splunk&#39;</span><span class="o">][</span><span class="s1">&#39;upgrade_enabled&#39;</span><span class="o">]</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s1">&#39;The chef-splunk::upgrade recipe was added to the node,&#39;</span><span class="p">)</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s1">&#39;but the attribute `node[&quot;splunk&quot;][&quot;upgrade_enabled&quot;]` was not set.&#39;</span><span class="p">)</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s1">&#39;I am bailing here so this node does not upgrade.&#39;</span><span class="p">)</span>
  <span class="k">raise</span>
<span class="k">end</span>

<span class="n">service</span> <span class="s1">&#39;splunk_stop&#39;</span> <span class="k">do</span>
  <span class="n">service_name</span> <span class="s1">&#39;splunk&#39;</span>
  <span class="n">supports</span> <span class="ss">status</span><span class="p">:</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:stop</span>
<span class="k">end</span>

<span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;splunk&#39;</span><span class="o">][</span><span class="s1">&#39;is_server&#39;</span><span class="o">]</span>
  <span class="n">splunk_package</span> <span class="o">=</span> <span class="s1">&#39;splunk&#39;</span>
  <span class="n">url_type</span> <span class="o">=</span> <span class="s1">&#39;server&#39;</span>
<span class="k">else</span>
  <span class="n">splunk_package</span> <span class="o">=</span> <span class="s1">&#39;splunkforwarder&#39;</span>
  <span class="n">url_type</span> <span class="o">=</span> <span class="s1">&#39;forwarder&#39;</span>
<span class="k">end</span>

<span class="n">splunk_installer</span> <span class="n">splunk_package</span> <span class="k">do</span>
  <span class="n">url</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;splunk&#39;</span><span class="o">][</span><span class="s1">&#39;upgrade&#39;</span><span class="o">][</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">url_type</span><span class="si">}</span><span class="s2">_url&quot;</span><span class="o">]</span>
<span class="k">end</span>

<span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;splunk&#39;</span><span class="o">][</span><span class="s1">&#39;accept_license&#39;</span><span class="o">]</span>
  <span class="n">execute</span> <span class="s1">&#39;splunk-unattended-upgrade&#39;</span> <span class="k">do</span>
    <span class="n">command</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">splunk_cmd</span><span class="si">}</span><span class="s2"> start --accept-license --answer-yes&quot;</span>
  <span class="k">end</span>
<span class="k">else</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s1">&#39;You did not accept the license (set node[&quot;splunk&quot;][&quot;accept_license&quot;] to true)&#39;</span><span class="p">)</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s1">&#39;Splunk is stopped and cannot be restarted until the license is accepted!&#39;</span><span class="p">)</span>
  <span class="k">raise</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full recipe is the <tt class="docutils literal"><span class="pre">upgrade.rb</span></tt> recipe of the <a class="reference external" href="https://github.com/chef-cookbooks/chef-splunk/">chef-splunk cookbook</a> that is maintained by Chef.</p>
<p>The following example shows using multiple <tt class="docutils literal"><span class="pre">Chef::Log</span></tt> entry types:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="o">...</span>

<span class="k">begin</span>
  <span class="n">aws</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">DataBagItem</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="ss">:aws</span><span class="p">,</span> <span class="ss">:main</span><span class="p">)</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Loaded AWS information from DataBagItem aws[</span><span class="si">#{</span><span class="n">aws</span><span class="o">[</span><span class="s1">&#39;id&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
<span class="k">rescue</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">fatal</span><span class="p">(</span><span class="s2">&quot;Could not find the &#39;main&#39; item in the &#39;aws&#39; data bag&quot;</span><span class="p">)</span>
  <span class="k">raise</span>
<span class="k">end</span>

<span class="o">...</span>
</pre></div>
</div>
<p>The full recipe is in the <tt class="docutils literal"><span class="pre">ebs_volume.rb</span></tt> recipe of the <a class="reference external" href="https://github.com/chef-cookbooks/database/">database cookbook</a> that is maintained by Chef.</p>
</div>
<div class="section" id="id168">
<h3>Examples<a class="headerlink" href="#id168" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Set default logging level</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="s1">&#39;a string to log&#39;</span>
</pre></div>
</div>
<p><strong>Set debug logging level</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="s1">&#39;a debug string&#39;</span> <span class="k">do</span>
  <span class="n">level</span> <span class="ss">:debug</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Add a message to a log file</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">log</span> <span class="s1">&#39;message&#39;</span> <span class="k">do</span>
  <span class="n">message</span> <span class="s1">&#39;This is the message that will be added to the log.&#39;</span>
  <span class="n">level</span> <span class="ss">:info</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="macports-package">
<h2>macports_package<a class="headerlink" href="#macports-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_macports_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>macports_package</strong> resource to manage packages for the Mac OS X platform.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id169">
<h3>Syntax<a class="headerlink" href="#id169" title="Permalink to this headline">¶</a></h3>
<p>A <strong>macports_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>macports_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">macports_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>macports_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">macports_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Macports</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">macports_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id170">
<h3>Actions<a class="headerlink" href="#id170" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:purge</span></tt></dt>
<dd>Purge a package. This action typically removes the configuration files as well as the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version.</dd>
</dl>
</div>
<div class="section" id="id171">
<h3>Properties<a class="headerlink" href="#id171" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id172">
<h3>Providers<a class="headerlink" href="#id172" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Macports</span></tt>, <tt class="docutils literal"><span class="pre">macports_package</span></tt></dt>
<dd>The provider for the Mac OS X platform.</dd>
</dl>
</div>
<div class="section" id="id173">
<h3>Examples<a class="headerlink" href="#id173" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">macports_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mdadm">
<h2>mdadm<a class="headerlink" href="#mdadm" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_mdadm.rst">[edit on GitHub]</a></p>
<p>Use the <strong>mdadm</strong> resource to manage RAID devices in a Linux environment using the mdadm utility. The <strong>mdadm</strong> provider will create and assemble an array, but it will not create the config file that is used to persist the array upon reboot. If the config file is required, it must be done by specifying a template with the correct array layout, and then by using the <strong>mount</strong> provider to create a file systems table (fstab) entry.</p>
<div class="section" id="id174">
<h3>Syntax<a class="headerlink" href="#id174" title="Permalink to this headline">¶</a></h3>
<p>A <strong>mdadm</strong> resource block manages RAID devices in a Linux environment using the mdadm utility:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mdadm</span> <span class="s1">&#39;/dev/md0&#39;</span> <span class="k">do</span>
  <span class="n">devices</span> <span class="o">[</span> <span class="s1">&#39;/dev/sda&#39;</span><span class="p">,</span> <span class="s1">&#39;/dev/sdb&#39;</span> <span class="o">]</span>
  <span class="n">level</span> <span class="mi">1</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:assemble</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>mdadm</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mdadm</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">bitmap</span>                     <span class="nb">String</span>
  <span class="n">chunk</span>                      <span class="nb">Integer</span>
  <span class="n">devices</span>                    <span class="nb">Array</span>
  <span class="n">exists</span>                     <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">layout</span>                     <span class="nb">String</span>
  <span class="n">level</span>                      <span class="nb">Integer</span>
  <span class="n">mdadm_defaults</span>             <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">metadata</span>                   <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Mdadm</span>
  <span class="n">raid_device</span>                <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">mdadm</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">bitmap</span></tt>, <tt class="docutils literal"><span class="pre">chunk</span></tt>, <tt class="docutils literal"><span class="pre">devices</span></tt>, <tt class="docutils literal"><span class="pre">exists</span></tt>, <tt class="docutils literal"><span class="pre">layout</span></tt>, <tt class="docutils literal"><span class="pre">level</span></tt>, <tt class="docutils literal"><span class="pre">mdadm_defaults</span></tt>, <tt class="docutils literal"><span class="pre">metadata</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>,  and <tt class="docutils literal"><span class="pre">raid_device</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id175">
<h3>Actions<a class="headerlink" href="#id175" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:assemble</span></tt></dt>
<dd>Assemble a previously created array into an active array.</dd>
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>Default. Create an array with per-device superblocks. If an array already exists (but does not match), update that array to match.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:stop</span></tt></dt>
<dd>Stop an active array.</dd>
</dl>
</div>
<div class="section" id="id176">
<h3>Properties<a class="headerlink" href="#id176" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">bitmap</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The path to a file in which a write-intent bitmap is stored.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">chunk</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The chunk size. This property should not be used for a RAID 1 mirrored pair (i.e. when the <tt class="docutils literal"><span class="pre">level</span></tt> property is set to <tt class="docutils literal"><span class="pre">1</span></tt>). Default value: <tt class="docutils literal"><span class="pre">16</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">devices</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p class="last">A comma-separated list of devices to be part of a RAID array. Default value: <tt class="docutils literal"><span class="pre">[]</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">exists</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Indicates whether the RAID array exists. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">layout</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The RAID5 parity algorithm. Possible values: <tt class="docutils literal"><span class="pre">left-asymmetric</span></tt> (or <tt class="docutils literal"><span class="pre">la</span></tt>), <tt class="docutils literal"><span class="pre">left-symmetric</span></tt> (or <tt class="docutils literal"><span class="pre">ls</span></tt>), <tt class="docutils literal"><span class="pre">right-asymmetric</span></tt> (or <tt class="docutils literal"><span class="pre">ra</span></tt>), or <tt class="docutils literal"><span class="pre">right-symmetric</span></tt> (or <tt class="docutils literal"><span class="pre">rs</span></tt>).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">level</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The RAID level. Default value: <tt class="docutils literal"><span class="pre">1</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">mdadm_defaults</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">When <tt class="docutils literal"><span class="pre">true</span></tt> this property sets the default values for <tt class="docutils literal"><span class="pre">chunk</span></tt> and <tt class="docutils literal"><span class="pre">metadata</span></tt> to <tt class="docutils literal"><span class="pre">nil</span></tt> allowing mdadm to use its own default values. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">metadata</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The superblock type for RAID metadata. Default value: <tt class="docutils literal"><span class="pre">0.90</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">raid_device</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of the RAID device. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="id177">
<h3>Examples<a class="headerlink" href="#id177" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Create and assemble a RAID 0 array</strong></p>
<p>The mdadm command can be used to create RAID arrays. For example, a RAID 0 array named <tt class="docutils literal"><span class="pre">/dev/md0</span></tt> with 10 devices would have a command similar to the following:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ mdadm --create /dev/md0 --level<span class="o">=</span><span class="m">0</span> --raid-devices<span class="o">=</span><span class="m">10</span> /dev/s01.../dev/s10
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">/dev/s01</span> <span class="pre">..</span> <span class="pre">/dev/s10</span></tt> represents 10 devices (01, 02, 03, and so on). This same command, when expressed as a recipe using the <strong>mdadm</strong> resource, would be similar to:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mdadm</span> <span class="s1">&#39;/dev/md0&#39;</span> <span class="k">do</span>
  <span class="n">devices</span> <span class="o">[</span> <span class="s1">&#39;/dev/s01&#39;</span><span class="p">,</span> <span class="o">...</span> <span class="s1">&#39;/dev/s10&#39;</span> <span class="o">]</span>
  <span class="n">level</span> <span class="mi">0</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>(again, where <tt class="docutils literal"><span class="pre">/dev/s01</span> <span class="pre">..</span> <span class="pre">/dev/s10</span></tt> represents devices /dev/s01, /dev/s02, /dev/s03, and so on).</p>
<p><strong>Create and assemble a RAID 1 array</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mdadm</span> <span class="s1">&#39;/dev/md0&#39;</span> <span class="k">do</span>
  <span class="n">devices</span> <span class="o">[</span> <span class="s1">&#39;/dev/sda&#39;</span><span class="p">,</span> <span class="s1">&#39;/dev/sdb&#39;</span> <span class="o">]</span>
  <span class="n">level</span> <span class="mi">1</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:create</span><span class="p">,</span> <span class="ss">:assemble</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create and assemble a RAID 5 array</strong></p>
<p>The mdadm command can be used to create RAID arrays. For example, a RAID 5 array named <tt class="docutils literal"><span class="pre">/dev/sd0</span></tt> with 4, and a superblock type of <tt class="docutils literal"><span class="pre">0.90</span></tt> would be similar to:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mdadm</span> <span class="s1">&#39;/dev/sd0&#39;</span> <span class="k">do</span>
  <span class="n">devices</span> <span class="o">[</span> <span class="s1">&#39;/dev/s1&#39;</span><span class="p">,</span> <span class="s1">&#39;/dev/s2&#39;</span><span class="p">,</span> <span class="s1">&#39;/dev/s3&#39;</span><span class="p">,</span> <span class="s1">&#39;/dev/s4&#39;</span> <span class="o">]</span>
  <span class="n">level</span> <span class="mi">5</span>
  <span class="n">metadata</span> <span class="s1">&#39;0.90&#39;</span>
  <span class="n">chunk</span> <span class="mi">32</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="mount">
<h2>mount<a class="headerlink" href="#mount" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_mount.rst">[edit on GitHub]</a></p>
<p>Use the <strong>mount</strong> resource to manage a mounted file system.</p>
<div class="section" id="id178">
<h3>Syntax<a class="headerlink" href="#id178" title="Permalink to this headline">¶</a></h3>
<p>A <strong>mount</strong> resource block manages a mounted file system:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">device</span> <span class="n">ebs_vol_dev</span>
  <span class="n">fstype</span> <span class="s1">&#39;xfs&#39;</span>
  <span class="n">action</span> <span class="ss">:mount</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>mount</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">device</span>                     <span class="nb">String</span>
  <span class="n">device_type</span>                <span class="no">Symbol</span>
  <span class="n">domain</span>                     <span class="nb">String</span>
  <span class="n">dump</span>                       <span class="nb">Integer</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">enabled</span>                    <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">fsck_device</span>                <span class="nb">String</span>
  <span class="n">fstype</span>                     <span class="nb">String</span>
  <span class="n">mount_point</span>                <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">mounted</span>                    <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">Array</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">pass</span>                       <span class="nb">Integer</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">password</span>                   <span class="nb">String</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Mount</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">supports</span>                   <span class="nb">Array</span>
  <span class="n">username</span>                   <span class="nb">String</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :mount if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">mount</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">device</span></tt>, <tt class="docutils literal"><span class="pre">device_type</span></tt>, <tt class="docutils literal"><span class="pre">domain</span></tt>, <tt class="docutils literal"><span class="pre">dump</span></tt>, <tt class="docutils literal"><span class="pre">enabled</span></tt>, <tt class="docutils literal"><span class="pre">fsck_device</span></tt>, <tt class="docutils literal"><span class="pre">fstype</span></tt>, <tt class="docutils literal"><span class="pre">mount_point</span></tt>, <tt class="docutils literal"><span class="pre">mounted</span></tt>, <tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">pass</span></tt>, <tt class="docutils literal"><span class="pre">password</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">supports</span></tt>, and <tt class="docutils literal"><span class="pre">username</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id179">
<h3>Actions<a class="headerlink" href="#id179" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:disable</span></tt></dt>
<dd>Remove an entry from the file systems table (<tt class="docutils literal"><span class="pre">fstab</span></tt>).</dd>
<dt><tt class="docutils literal"><span class="pre">:enable</span></tt></dt>
<dd>Add an entry to the file systems table (<tt class="docutils literal"><span class="pre">fstab</span></tt>).</dd>
<dt><tt class="docutils literal"><span class="pre">:mount</span></tt></dt>
<dd>Default. Mount a device.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:remount</span></tt></dt>
<dd>Remount a device.</dd>
<dt><tt class="docutils literal"><span class="pre">:umount</span></tt></dt>
<dd>Unmount a device.</dd>
<dt><tt class="docutils literal"><span class="pre">:unmount</span></tt></dt>
<dd><p class="first">Alias for <tt class="docutils literal"><span class="pre">:umount</span></tt> action.</p>
<p class="last">New in Chef client 12.17.</p>
</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Order matters when passing multiple actions. For example: <tt class="docutils literal"><span class="pre">action</span> <span class="pre">[:mount,</span> <span class="pre">:enable]</span></tt> ensures that the file system is mounted before it is enabled.</p>
</div>
</div>
<div class="section" id="id180">
<h3>Properties<a class="headerlink" href="#id180" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">device</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Required for <tt class="docutils literal"><span class="pre">:umount</span></tt> and <tt class="docutils literal"><span class="pre">:remount</span></tt> actions (for the purpose of checking the mount command output for presence). The special block device or remote node, a label, or a uuid to be mounted.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">device_type</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol</p>
<p class="last">The type of device: <tt class="docutils literal"><span class="pre">:device</span></tt>, <tt class="docutils literal"><span class="pre">:label</span></tt>, or <tt class="docutils literal"><span class="pre">:uuid</span></tt>. Default value: <tt class="docutils literal"><span class="pre">:device</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">domain</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Microsoft Windows only. Use to specify the domain in which the <tt class="docutils literal"><span class="pre">username</span></tt> and <tt class="docutils literal"><span class="pre">password</span></tt> are located.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">dump</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, FalseClass</p>
<p class="last">The dump frequency (in days) used while creating a file systems table (fstab) entry. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">enabled</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Use to specify if a mounted file system is enabled. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">fsck_device</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The fsck device on the Solaris platform. Default value: <tt class="docutils literal"><span class="pre">-</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">fstype</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Required. The file system type (fstype) of the device.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">mount_point</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The directory (or path) in which the device is to be mounted. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">mounted</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Use to specify if a file system is already mounted. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Array, String</p>
<p class="last">An array or string that contains mount options. If this value is a string, it is converted to an array. Default value: <tt class="docutils literal"><span class="pre">defaults</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">pass</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, FalseClass</p>
<p class="last">The pass number used by the file system check (<tt class="docutils literal"><span class="pre">fsck</span></tt>) command while creating a file systems table (<tt class="docutils literal"><span class="pre">fstab</span></tt>) entry. Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">password</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Microsoft Windows only. Use to specify the password for <tt class="docutils literal"><span class="pre">username</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">supports</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p class="last">An array of options for supported mount features. Default value: <tt class="docutils literal"><span class="pre">:remount</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">username</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Microsoft Windows only. Use to specify the user name.</p>
</dd>
</dl>
</div>
<div class="section" id="id181">
<h3>Providers<a class="headerlink" href="#id181" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Mount</span></tt>, <tt class="docutils literal"><span class="pre">mount</span></tt></dt>
<dd>The default provider for all platforms, except for Microsoft Windows.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Mount::Windows</span></tt>, <tt class="docutils literal"><span class="pre">mount</span></tt></dt>
<dd>The default provider for the Microsoft Windows platform.</dd>
</dl>
</div>
<div class="section" id="id182">
<h3>Examples<a class="headerlink" href="#id182" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Mount a labeled file system</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;/mnt/volume1&#39;</span> <span class="k">do</span>
  <span class="n">device</span> <span class="s1">&#39;volume1&#39;</span>
  <span class="n">device_type</span> <span class="ss">:label</span>
  <span class="n">fstype</span> <span class="s1">&#39;xfs&#39;</span>
  <span class="n">options</span> <span class="s1">&#39;rw&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Mount a local block drive</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;/mnt/local&#39;</span> <span class="k">do</span>
  <span class="n">device</span> <span class="s1">&#39;/dev/sdb1&#39;</span>
  <span class="n">fstype</span> <span class="s1">&#39;ext3&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Mount a non-block file system</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;/mount/tmp&#39;</span> <span class="k">do</span>
  <span class="n">pass</span>     <span class="mi">0</span>
  <span class="n">fstype</span>   <span class="s1">&#39;tmpfs&#39;</span>
  <span class="n">device</span>   <span class="s1">&#39;/dev/null&#39;</span>
  <span class="n">options</span>  <span class="s1">&#39;nr_inodes=999k,mode=755,size=500m&#39;</span>
  <span class="n">action</span>   <span class="o">[</span><span class="ss">:mount</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Mount and add to the file systems table</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;/export/www&#39;</span> <span class="k">do</span>
  <span class="n">device</span> <span class="s1">&#39;nas1prod:/export/web_sites&#39;</span>
  <span class="n">fstype</span> <span class="s1">&#39;nfs&#39;</span>
  <span class="n">options</span> <span class="s1">&#39;rw&#39;</span>
  <span class="n">action</span> <span class="o">[</span><span class="ss">:mount</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Mount a remote file system</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;/export/www&#39;</span> <span class="k">do</span>
  <span class="n">device</span> <span class="s1">&#39;nas1prod:/export/web_sites&#39;</span>
  <span class="n">fstype</span> <span class="s1">&#39;nfs&#39;</span>
  <span class="n">options</span> <span class="s1">&#39;rw&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Mount a remote folder in Microsoft Windows</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;T:&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:mount</span>
  <span class="n">device</span> <span class="s1">&#39;\\\\hostname.example.com\\folder&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Unmount a remote folder in Microsoft Windows</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="s1">&#39;T:&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:umount</span>
  <span class="n">device</span> <span class="s1">&#39;\\\\hostname.example.com\\D$&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Stop a service, do stuff, and then restart it</strong></p>
<p>The following example shows how to use the <strong>execute</strong>, <strong>service</strong>, and <strong>mount</strong> resources together to ensure that a node running on Amazon EC2 is running MySQL. This example does the following:</p>
<ul class="simple">
<li>Checks to see if the Amazon EC2 node has MySQL</li>
<li>If the node has MySQL, stops MySQL</li>
<li>Installs MySQL</li>
<li>Mounts the node</li>
<li>Restarts MySQL</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``server_ec2``</span>
<span class="c1"># recipe in the following cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/mysql</span>

<span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attribute?</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">))</span>

  <span class="n">service</span> <span class="s1">&#39;mysql&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:stop</span>
  <span class="k">end</span>

  <span class="n">execute</span> <span class="s1">&#39;install-mysql&#39;</span> <span class="k">do</span>
    <span class="n">command</span> <span class="s2">&quot;mv </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">not_if</span> <span class="k">do</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">)</span> <span class="k">end</span>
  <span class="k">end</span>

  <span class="o">[</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
    <span class="n">directory</span> <span class="n">dir</span> <span class="k">do</span>
      <span class="n">owner</span> <span class="s1">&#39;mysql&#39;</span>
      <span class="n">group</span> <span class="s1">&#39;mysql&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">mount</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">device</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span>
    <span class="n">fstype</span> <span class="s1">&#39;none&#39;</span>
    <span class="n">options</span> <span class="s1">&#39;bind,rw&#39;</span>
    <span class="n">action</span> <span class="o">[</span><span class="ss">:mount</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="n">service</span> <span class="s1">&#39;mysql&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:start</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li>the two <strong>service</strong> resources are used to stop, and then restart the MySQL service</li>
<li>the <strong>execute</strong> resource is used to install MySQL</li>
<li>the <strong>mount</strong> resource is used to mount the node and enable MySQL</li>
</ul>
</div>
</div>
<div class="section" id="ohai">
<h2>ohai<a class="headerlink" href="#ohai" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_ohai.rst">[edit on GitHub]</a></p>
<p>Use the <strong>ohai</strong> resource to reload the Ohai configuration on a node. This allows recipes that change system attributes (like a recipe that adds a user) to refer to those attributes later on during the chef-client run.</p>
<div class="section" id="id183">
<h3>Syntax<a class="headerlink" href="#id183" title="Permalink to this headline">¶</a></h3>
<p>A <strong>ohai</strong> resource block reloads the Ohai configuration on a node:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ohai</span> <span class="s1">&#39;reload&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:reload</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>ohai</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ohai</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="nb">name</span>                       <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">plugin</span>                     <span class="nb">String</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Ohai</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :reload if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ohai</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt>, <tt class="docutils literal"><span class="pre">plugin</span></tt>,  and <tt class="docutils literal"><span class="pre">provider</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id184">
<h3>Actions<a class="headerlink" href="#id184" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:reload</span></tt></dt>
<dd>Default. Reload the Ohai configuration on a node.</dd>
</dl>
</div>
<div class="section" id="id185">
<h3>Properties<a class="headerlink" href="#id185" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">name</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Always the same value as the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block. See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">plugin</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The name of an Ohai plugin to be reloaded. If this property is not specified, the chef-client will reload all plugins.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="id186">
<h3>Examples<a class="headerlink" href="#id186" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Reload Ohai</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ohai</span> <span class="s1">&#39;reload&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:reload</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reload Ohai after a new user is created</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ohai</span> <span class="s1">&#39;reload_passwd&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">plugin</span> <span class="s1">&#39;etc&#39;</span>
<span class="k">end</span>

<span class="n">user</span> <span class="s1">&#39;daemonuser&#39;</span> <span class="k">do</span>
  <span class="n">home</span> <span class="s1">&#39;/dev/null&#39;</span>
  <span class="n">shell</span> <span class="s1">&#39;/sbin/nologin&#39;</span>
  <span class="nb">system</span> <span class="kp">true</span>
  <span class="n">notifies</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;ohai[reload_passwd]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;just an example&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="c1"># These variables will now have the new values</span>
    <span class="nb">puts</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;etc&#39;</span><span class="o">][</span><span class="s1">&#39;passwd&#39;</span><span class="o">][</span><span class="s1">&#39;daemonuser&#39;</span><span class="o">][</span><span class="s1">&#39;uid&#39;</span><span class="o">]</span>
    <span class="nb">puts</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;etc&#39;</span><span class="o">][</span><span class="s1">&#39;passwd&#39;</span><span class="o">][</span><span class="s1">&#39;daemonuser&#39;</span><span class="o">][</span><span class="s1">&#39;gid&#39;</span><span class="o">]</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="openbsd-package">
<h2>openbsd_package<a class="headerlink" href="#openbsd-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_openbsd_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>openbsd_package</strong> resource to manage packages for the OpenBSD platform.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id187">
<h3>Syntax<a class="headerlink" href="#id187" title="Permalink to this headline">¶</a></h3>
<p>A <strong>openbsd_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>openbsd_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">openbsd_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>openbsd_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">openbsd_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Openbsd</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">openbsd_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id188">
<h3>Actions<a class="headerlink" href="#id188" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
</dl>
</div>
<div class="section" id="id189">
<h3>Properties<a class="headerlink" href="#id189" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id190">
<h3>Providers<a class="headerlink" href="#id190" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Openbsd</span></tt>, <tt class="docutils literal"><span class="pre">openbsd_package</span></tt></dt>
<dd>The provider for the OpenBSD platform.</dd>
</dl>
</div>
<div class="section" id="id191">
<h3>Examples<a class="headerlink" href="#id191" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">openbsd_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="osx-profile">
<h2>osx_profile<a class="headerlink" href="#osx-profile" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_osx_profile.rst">[edit on GitHub]</a></p>
<p>Use the <strong>osx_profile</strong> resource to manage configuration profiles (<tt class="docutils literal"><span class="pre">.mobileconfig</span></tt> files) on the Mac OS X platform. The <strong>osx_profile</strong> resource installs profiles by using the <tt class="docutils literal"><span class="pre">uuidgen</span></tt> library to generate a unique <tt class="docutils literal"><span class="pre">ProfileUUID</span></tt>, and then using the <tt class="docutils literal"><span class="pre">profiles</span></tt> command to install the profile on the system.</p>
<div class="section" id="id192">
<h3>Syntax<a class="headerlink" href="#id192" title="Permalink to this headline">¶</a></h3>
<p>A <strong>osx_profile</strong> resource block manages configuration profiles on the Mac OS X platform:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">osx_profile</span> <span class="s1">&#39;Install screensaver profile&#39;</span> <span class="k">do</span>
  <span class="n">profile</span> <span class="s1">&#39;com.company.screensaver.mobileconfig&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>osx_profile</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">osx_profile</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">path</span>                       <span class="c1"># set automatically</span>
  <span class="n">profile</span>                    <span class="nb">String</span><span class="p">,</span> <span class="no">Hash</span>
  <span class="n">profile_name</span>               <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">identifier</span>                 <span class="nb">String</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">osx_profile</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">profile</span></tt>, <tt class="docutils literal"><span class="pre">profile_name</span></tt>, and <tt class="docutils literal"><span class="pre">identifier</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id193">
<h3>Actions<a class="headerlink" href="#id193" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install the specified configuration profile.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd><p class="first">Default. .. tag resources_common_actions_nothing</p>
<blockquote class="last">
<div>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</div></blockquote>
</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove the specified configuration profile.</dd>
</dl>
</div>
<div class="section" id="id194">
<h3>Properties<a class="headerlink" href="#id194" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">identifier</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Use to specify the identifier for the profile, such as <tt class="docutils literal"><span class="pre">com.company.screensaver</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">profile</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Hash</p>
<p class="last">Use to specify a profile. This may be the name of a profile contained in a cookbook or a Hash that contains the contents of the profile.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">profile_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Use to specify the name of the profile, if different from the name of the resource block.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="id195">
<h3>Examples<a class="headerlink" href="#id195" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>One liner to install profile from cookbook file</strong></p>
<p>The <tt class="docutils literal"><span class="pre">profiles</span></tt> command will be used to install the specified configuration profile.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">osx_profile</span> <span class="s1">&#39;com.company.screensaver.mobileconfig&#39;</span>
</pre></div>
</div>
<p><strong>Install profile from cookbook file</strong></p>
<p>The <tt class="docutils literal"><span class="pre">profiles</span></tt> command will be used to install the specified configuration profile. It can be in sub-directory within a cookbook.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">osx_profile</span> <span class="s1">&#39;Install screensaver profile&#39;</span> <span class="k">do</span>
  <span class="n">profile</span> <span class="s1">&#39;screensaver/com.company.screensaver.mobileconfig&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install profile from a hash</strong></p>
<p>The <tt class="docutils literal"><span class="pre">profiles</span></tt> command will be used to install the configuration profile, which is provided as a hash.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">profile_hash</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s1">&#39;PayloadIdentifier&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;com.company.screensaver&#39;</span><span class="p">,</span>
  <span class="s1">&#39;PayloadRemovalDisallowed&#39;</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span>
  <span class="s1">&#39;PayloadScope&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;System&#39;</span><span class="p">,</span>
  <span class="s1">&#39;PayloadType&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Configuration&#39;</span><span class="p">,</span>
  <span class="s1">&#39;PayloadUUID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1781fbec-3325-565f-9022-8aa28135c3cc&#39;</span><span class="p">,</span>
  <span class="s1">&#39;PayloadOrganization&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Chef&#39;</span><span class="p">,</span>
  <span class="s1">&#39;PayloadVersion&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
  <span class="s1">&#39;PayloadDisplayName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Screensaver Settings&#39;</span><span class="p">,</span>
  <span class="s1">&#39;PayloadContent&#39;</span><span class="o">=&gt;</span> <span class="o">[</span>
    <span class="p">{</span>
      <span class="s1">&#39;PayloadType&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;com.apple.ManagedClient.preferences&#39;</span><span class="p">,</span>
      <span class="s1">&#39;PayloadVersion&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s1">&#39;PayloadIdentifier&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;com.company.screensaver&#39;</span><span class="p">,</span>
      <span class="s1">&#39;PayloadUUID&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;73fc30e0-1e57-0131-c32d-000c2944c108&#39;</span><span class="p">,</span>
      <span class="s1">&#39;PayloadEnabled&#39;</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span>
      <span class="s1">&#39;PayloadDisplayName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;com.apple.screensaver&#39;</span><span class="p">,</span>
      <span class="s1">&#39;PayloadContent&#39;</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="s1">&#39;com.apple.screensaver&#39;</span> <span class="o">=&gt;</span> <span class="p">{</span>
          <span class="s1">&#39;Forced&#39;</span> <span class="o">=&gt;</span> <span class="o">[</span>
            <span class="p">{</span>
              <span class="s1">&#39;mcx_preference_settings&#39;</span> <span class="o">=&gt;</span> <span class="p">{</span>
                <span class="s1">&#39;idleTime&#39;</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="o">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="o">]</span>
<span class="p">}</span>

<span class="n">osx_profile</span> <span class="s1">&#39;Install screensaver profile&#39;</span> <span class="k">do</span>
  <span class="n">profile</span> <span class="n">profile_hash</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Remove profile using identifier in resource name</strong></p>
<p>The <tt class="docutils literal"><span class="pre">profiles</span></tt> command will be used to remove the configuration profile specified by the provided <tt class="docutils literal"><span class="pre">identifier</span></tt> property.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">osx_profile</span> <span class="s1">&#39;com.company.screensaver&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:remove</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Remove profile by identifier and user friendly resource name</strong></p>
<p>The <tt class="docutils literal"><span class="pre">profiles</span></tt> command will be used to remove the configuration profile specified by the provided <tt class="docutils literal"><span class="pre">identifier</span></tt> property.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">osx_profile</span> <span class="s1">&#39;Remove screensaver profile&#39;</span> <span class="k">do</span>
  <span class="n">identifier</span> <span class="s1">&#39;com.company.screensaver&#39;</span>
  <span class="n">action</span> <span class="ss">:remove</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="package">
<h2>package<a class="headerlink" href="#package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>package</strong> resource to manage packages. When the package is installed from a local file (such as with RubyGems, dpkg, or RPM Package Manager), the file must be added to the node using the <strong>remote_file</strong> or <strong>cookbook_file</strong> resources.</p>
<p>This resource is the base resource for several other resources used for package management on specific platforms. While it is possible to use each of these specific resources, it is recommended to use the <strong>package</strong> resource as often as possible.</p>
<p>For more information about specific resources for specific platforms, see the following topics:</p>
<ul class="simple">
<li><a class="reference internal" href="resource_apt_package.html"><em>apt_package</em></a></li>
<li><a class="reference internal" href="resource_bff_package.html"><em>bff_package</em></a></li>
<li><a class="reference internal" href="resource_chef_gem.html"><em>chef_gem</em></a></li>
<li><a class="reference internal" href="resource_chocolatey_package.html"><em>chocolatey_package</em></a></li>
<li><a class="reference internal" href="resource_dpkg_package.html"><em>dpkg_package</em></a></li>
<li><a class="reference internal" href="resource_easy_install_package.html"><em>easy_install_package</em></a></li>
<li><a class="reference internal" href="resource_freebsd_package.html"><em>freebsd_package</em></a></li>
<li><a class="reference internal" href="resource_gem_package.html"><em>gem_package</em></a></li>
<li><a class="reference internal" href="resource_homebrew_package.html"><em>homebrew_package</em></a></li>
<li><a class="reference internal" href="resource_ips_package.html"><em>ips_package</em></a></li>
<li><a class="reference internal" href="resource_macports_package.html"><em>macports_package</em></a></li>
<li><a class="reference internal" href="resource_openbsd_package.html"><em>openbsd_package</em></a></li>
<li><a class="reference internal" href="resource_pacman_package.html"><em>pacman_package</em></a></li>
<li><a class="reference internal" href="resource_paludis_package.html"><em>paludis_package</em></a></li>
<li><a class="reference internal" href="resource_portage_package.html"><em>portage_package</em></a></li>
<li><a class="reference internal" href="resource_rpm_package.html"><em>rpm_package</em></a></li>
<li><a class="reference internal" href="resource_smartos_package.html"><em>smartos_package</em></a></li>
<li><a class="reference internal" href="resource_solaris_package.html"><em>solaris_package</em></a></li>
<li><a class="reference internal" href="resource_windows_package.html"><em>windows_package</em></a></li>
<li><a class="reference internal" href="resource_yum.html"><em>yum_package</em></a></li>
</ul>
<div class="section" id="id196">
<h3>Syntax<a class="headerlink" href="#id196" title="Permalink to this headline">¶</a></h3>
<p>A <strong>package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;httpd&#39;</span>
</pre></div>
</div>
<p>which will install Apache using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>For a package that has different package names, depending on the platform, use a <tt class="docutils literal"><span class="pre">case</span></tt> statement within the <strong>package</strong>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;Install Apache&#39;</span> <span class="k">do</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="ss">:platform</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">&#39;redhat&#39;</span><span class="p">,</span> <span class="s1">&#39;centos&#39;</span>
    <span class="n">package_name</span> <span class="s1">&#39;httpd&#39;</span>
  <span class="k">when</span> <span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span> <span class="s1">&#39;debian&#39;</span>
    <span class="n">package_name</span> <span class="s1">&#39;apache2&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">'redhat',</span> <span class="pre">'centos'</span></tt> will install Apache using the <tt class="docutils literal"><span class="pre">httpd</span></tt> package and <tt class="docutils literal"><span class="pre">'ubuntu',</span> <span class="pre">'debian'</span></tt> will install it using the <tt class="docutils literal"><span class="pre">apache2</span></tt> package</p>
<p>The full syntax for all of the properties that are available to the <strong>package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">allow_downgrade</span>            <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span> <span class="c1"># Yum, RPM packages only</span>
  <span class="n">arch</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># Yum packages only</span>
  <span class="n">default_release</span>            <span class="nb">String</span> <span class="c1"># Apt packages only</span>
  <span class="n">flush_cache</span>                <span class="nb">Array</span>
  <span class="n">gem_binary</span>                 <span class="nb">String</span>
  <span class="n">homebrew_user</span>              <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span> <span class="c1"># Homebrew packages only</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span>
  <span class="n">response_file</span>              <span class="nb">String</span> <span class="c1"># Apt packages only</span>
  <span class="n">response_file_variables</span>    <span class="no">Hash</span> <span class="c1"># Apt packages only</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">package</span></tt> tells the chef-client to manage a package; the chef-client will determine the correct package provider to use based on the platform running on the node</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">allow_downgrade</span></tt>, <tt class="docutils literal"><span class="pre">arch</span></tt>, <tt class="docutils literal"><span class="pre">default_release</span></tt>, <tt class="docutils literal"><span class="pre">flush_cache</span></tt>, <tt class="docutils literal"><span class="pre">gem_binary</span></tt>, <tt class="docutils literal"><span class="pre">homebrew_user</span></tt>, <tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">response_file</span></tt>, <tt class="docutils literal"><span class="pre">response_file_variables</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">recursive</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
<div class="section" id="id197">
<h4>Gem Package Options<a class="headerlink" href="#id197" title="Permalink to this headline">¶</a></h4>
<p>The RubyGems package provider attempts to use the RubyGems API to install gems without spawning a new process, whenever possible. A gems command to install will be spawned under the following conditions:</p>
<ul class="simple">
<li>When a <tt class="docutils literal"><span class="pre">gem_binary</span></tt> property is specified (as a hash, a string, or by a .gemrc file), the chef-client will run that command to examine its environment settings and then again to install the gem.</li>
<li>When install options are specified as a string, the chef-client will span a gems command with those options when installing the gem.</li>
<li>The omnibus installer will search the <tt class="docutils literal"><span class="pre">PATH</span></tt> for a gem command rather than defaulting to the current gem environment. As part of <tt class="docutils literal"><span class="pre">enforce_path_sanity</span></tt>, the <tt class="docutils literal"><span class="pre">bin</span></tt> directories area added to the <tt class="docutils literal"><span class="pre">PATH</span></tt>, which means when there are no other proceeding RubyGems, the installation will still be operated against it.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Gem package options should only be used when gems are installed into the system-wide instance of Ruby, and not the instance of Ruby dedicated to the chef-client.</p>
</div>
<div class="section" id="id198">
<h5>Specify with Hash<a class="headerlink" href="#id198" title="Permalink to this headline">¶</a></h5>
<p>If an explicit <tt class="docutils literal"><span class="pre">gem_binary</span></tt> parameter is not being used with the <tt class="docutils literal"><span class="pre">gem_package</span></tt> resource, it is preferable to provide the install options as a hash. This approach allows the provider to install the gem without needing to spawn an external gem process.</p>
<p>The following RubyGems options are available for inclusion within a hash and are passed to the RubyGems DependencyInstaller:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">:env_shebang</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:force</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:format_executable</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:ignore_dependencies</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:prerelease</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:security_policy</span></tt></li>
<li><tt class="docutils literal"><span class="pre">:wrappers</span></tt></li>
</ul>
<p>For more information about these options, see the RubyGems documentation: <a class="reference external" href="http://rubygems.rubyforge.org/rubygems-update/Gem/DependencyInstaller.html">http://rubygems.rubyforge.org/rubygems-update/Gem/DependencyInstaller.html</a>.</p>
<p><strong>Example</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;bundler&#39;</span> <span class="k">do</span>
  <span class="n">options</span><span class="p">(</span><span class="ss">:prerelease</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:format_executable</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="id199">
<h5>Specify with String<a class="headerlink" href="#id199" title="Permalink to this headline">¶</a></h5>
<p>When using an explicit <tt class="docutils literal"><span class="pre">gem_binary</span></tt>, options must be passed as a string. When not using an explicit <tt class="docutils literal"><span class="pre">gem_binary</span></tt>, the chef-client is forced to spawn a gems process to install the gems (which uses more system resources) when options are passed as a string. String options are passed verbatim to the gems command and should be specified just as if they were passed on a command line. For example, <tt class="docutils literal"><span class="pre">--prerelease</span></tt> for a pre-release gem.</p>
<p><strong>Example</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;nokogiri&#39;</span> <span class="k">do</span>
  <span class="n">gem_binary</span><span class="p">(</span><span class="s1">&#39;/opt/ree/bin/gem&#39;</span><span class="p">)</span>
  <span class="n">options</span><span class="p">(</span><span class="s1">&#39;--prerelease --no-format-executable&#39;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
<div class="section" id="id200">
<h5>Specify with .gemrc File<a class="headerlink" href="#id200" title="Permalink to this headline">¶</a></h5>
<p>Options can be specified in a .gemrc file. By default the <tt class="docutils literal"><span class="pre">gem_package</span></tt> resource will use the Ruby interface to install gems which will ignore the .gemrc file. The <tt class="docutils literal"><span class="pre">gem_package</span></tt> resource can be forced to use the gems command instead (and to read the .gemrc file) by adding the <tt class="docutils literal"><span class="pre">gem_binary</span></tt> attribute to a code block.</p>
<p><strong>Example</strong></p>
<p>A template named <tt class="docutils literal"><span class="pre">gemrc.erb</span></tt> is located in a cookbook&#8217;s <tt class="docutils literal"><span class="pre">/templates</span></tt> directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="ss">:sources</span><span class="p">:</span>
<span class="o">-</span> <span class="ss">http</span><span class="p">:</span><span class="sr">//</span><span class="o">&lt;</span><span class="sx">%= node[&#39;gem_file&#39;][&#39;host&#39;] %&gt;:&lt;%=</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;gem_file&#39;</span><span class="o">][</span><span class="s1">&#39;port&#39;</span><span class="o">]</span> <span class="o">%&gt;</span><span class="sr">/</span>
</pre></div>
</div>
<p>A recipe can be built that does the following:</p>
<ul class="simple">
<li>Builds a <tt class="docutils literal"><span class="pre">.gemrc</span></tt> file based on a <tt class="docutils literal"><span class="pre">gemrc.erb</span></tt> template</li>
<li>Runs a <tt class="docutils literal"><span class="pre">Gem.configuration</span></tt> command</li>
<li>Installs a package using the <tt class="docutils literal"><span class="pre">.gemrc</span></tt> file</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/root/.gemrc&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;gemrc.erb&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;ruby_block[refresh_gemrc]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;refresh_gemrc&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Gem</span><span class="o">.</span><span class="n">configuration</span> <span class="o">=</span> <span class="no">Gem</span><span class="o">::</span><span class="no">ConfigFile</span><span class="o">.</span><span class="n">new</span> <span class="o">[]</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">gem_package</span> <span class="s1">&#39;di-ruby-lvm&#39;</span> <span class="k">do</span>
  <span class="n">gem_binary</span> <span class="s1">&#39;/opt/chef/embedded/bin/gem&#39;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id201">
<h3>Actions<a class="headerlink" href="#id201" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:purge</span></tt></dt>
<dd>Purge a package. This action typically removes the configuration files as well as the package. (Debian platform only; for other platforms, use the <tt class="docutils literal"><span class="pre">:remove</span></tt> action.)</dd>
<dt><tt class="docutils literal"><span class="pre">:reconfig</span></tt></dt>
<dd>Reconfigure a package. This action requires a response file.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version.</dd>
</dl>
</div>
<div class="section" id="id202">
<h3>Properties<a class="headerlink" href="#id202" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following attributes:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">allow_downgrade</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last"><strong>yum_package</strong> resource only. Downgrade a package to satisfy requested version requirements. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">arch</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last"><strong>yum_package</strong> resource only. The architecture of the package to be installed or upgraded. This value can also be passed as part of the package name.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">default_release</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last"><strong>apt_package</strong> resource only. The default release. For example: <tt class="docutils literal"><span class="pre">stable</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">flush_cache</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p>Flush the in-memory cache before or after a Yum operation that installs, upgrades, or removes a package. Default value: <tt class="docutils literal"><span class="pre">[</span> <span class="pre">:before,</span> <span class="pre">:after</span> <span class="pre">]</span></tt>. The value may also be a Hash: <tt class="docutils literal"><span class="pre">(</span> <span class="pre">{</span> <span class="pre">:before</span> <span class="pre">=&gt;</span> <span class="pre">true/false,</span> <span class="pre">:after</span> <span class="pre">=&gt;</span> <span class="pre">true/false</span> <span class="pre">}</span> <span class="pre">)</span></tt>.</p>
<p>Yum automatically synchronizes remote metadata to a local cache. The chef-client creates a copy of the local cache, and then stores it in-memory during the chef-client run. The in-memory cache allows packages to be installed during the chef-client run without the need to continue synchronizing the remote metadata to the local cache while the chef-client run is in-progress.</p>
<p>As an array:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;some-package&#39;</span> <span class="k">do</span>
  <span class="c1">#...</span>
  <span class="n">flush_cache</span> <span class="o">[</span> <span class="ss">:before</span> <span class="o">]</span>
  <span class="c1">#...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and as a Hash:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;some-package&#39;</span> <span class="k">do</span>
  <span class="c1">#...</span>
  <span class="n">flush_cache</span><span class="p">(</span> <span class="p">{</span> <span class="ss">:after</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="p">}</span> <span class="p">)</span>
  <span class="c1">#...</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">flush_cache</span></tt> property does not flush the local Yum cache! Use Yum tools&#8212;<tt class="docutils literal"><span class="pre">yum</span> <span class="pre">clean</span> <span class="pre">headers</span></tt>, <tt class="docutils literal"><span class="pre">yum</span> <span class="pre">clean</span> <span class="pre">packages</span></tt>, <tt class="docutils literal"><span class="pre">yum</span> <span class="pre">clean</span> <span class="pre">all</span></tt>&#8212;to clean the local Yum cache.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">gem_binary</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A property for the <tt class="docutils literal"><span class="pre">gem_package</span></tt> provider that is used to specify a gems binary.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">homebrew_user</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last"><strong>homebrew_package</strong> resource only. The name of the Homebrew owner to be used by the chef-client when executing a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">response_file</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last"><strong>apt_package</strong> and <strong>dpkg_package</strong> resources only. The direct path to the file used to pre-seed a package.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">response_file_variables</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last"><strong>apt_package</strong> and <strong>dpkg_package</strong> resources only. A Hash of response file variables in the form of <tt class="docutils literal"><span class="pre">{&quot;VARIABLE&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;VALUE&quot;}</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p>Optional. The path to a package in the local file system.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The AIX platform requires <tt class="docutils literal"><span class="pre">source</span></tt> to be a local file system path because <tt class="docutils literal"><span class="pre">installp</span></tt> does not retrieve packages using HTTP or FTP.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
<div class="section" id="id203">
<h4>Multiple Packages<a class="headerlink" href="#id203" title="Permalink to this headline">¶</a></h4>
<p>A resource may specify multiple packages and/or versions for platforms that use Yum, Apt, Zypper, or Chocolatey package managers. Specifing multiple packages and/or versions allows a single transaction to:</p>
<ul class="simple">
<li>Download the specified packages and versions via a single HTTP transaction</li>
<li>Update or install multiple packages with a single resource during the chef-client run</li>
</ul>
<p>For example, installing multiple packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p>Upgrading multiple packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>  <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:upgrade</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Removing multiple packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>  <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:remove</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Purging multiple packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>  <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:purge</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Notifications, via an implicit name:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>  <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">log</span> <span class="s1">&#39;call a notification&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span> <span class="ss">:install</span><span class="p">,</span> <span class="s1">&#39;package[package1, package2]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <tt class="docutils literal"><span class="pre">package_name</span></tt> or <tt class="docutils literal"><span class="pre">version</span></tt> properties.</p>
</div>
</div>
</div>
<div class="section" id="id204">
<h3>Providers<a class="headerlink" href="#id204" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Aix</span></tt>, <tt class="docutils literal"><span class="pre">bff_package</span></tt></dt>
<dd>The provider for the AIX platform. Can be used with the <tt class="docutils literal"><span class="pre">options</span></tt> attribute.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Apt</span></tt>, <tt class="docutils literal"><span class="pre">apt_package</span></tt></dt>
<dd>The provider for the Debian and Ubuntu platforms.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Chocolatey</span></tt>, <tt class="docutils literal"><span class="pre">chocolatey_package</span></tt></dt>
<dd><p class="first">The provider for Chocolatey on the Microsoft Windows platform.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>chocolatey_package</strong> resource must be specified as <tt class="docutils literal"><span class="pre">chocolatey_package</span></tt> and cannot be shortened to <tt class="docutils literal"><span class="pre">package</span></tt> in a recipe.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Dpkg</span></tt>, <tt class="docutils literal"><span class="pre">dpkg_package</span></tt></dt>
<dd>The provider for the dpkg platform. Can be used with the <tt class="docutils literal"><span class="pre">options</span></tt> attribute.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::EasyInstall</span></tt>, <tt class="docutils literal"><span class="pre">easy_install_package</span></tt></dt>
<dd>The provider for Python.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Freebsd</span></tt>, <tt class="docutils literal"><span class="pre">freebsd_package</span></tt></dt>
<dd>The provider for the FreeBSD platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Homebrew</span></tt>, <tt class="docutils literal"><span class="pre">homebrew_package</span></tt></dt>
<dd>The provider for the Mac OS X platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Ips</span></tt>, <tt class="docutils literal"><span class="pre">ips_package</span></tt></dt>
<dd>The provider for the ips platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Macports</span></tt>, <tt class="docutils literal"><span class="pre">macports_package</span></tt></dt>
<dd>The provider for the Mac OS X platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Openbsd</span></tt>, <tt class="docutils literal"><span class="pre">openbsd_package</span></tt></dt>
<dd>The provider for the OpenBSD platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Pacman</span></tt>, <tt class="docutils literal"><span class="pre">pacman_package</span></tt></dt>
<dd>The provider for the Arch Linux platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Paludis</span></tt>, <tt class="docutils literal"><span class="pre">paludis_package</span></tt></dt>
<dd>The provider for the Paludis platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Portage</span></tt>, <tt class="docutils literal"><span class="pre">portage_package</span></tt></dt>
<dd>The provider for the Gentoo platform. Can be used with the <tt class="docutils literal"><span class="pre">options</span></tt> attribute.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Rpm</span></tt>, <tt class="docutils literal"><span class="pre">rpm_package</span></tt></dt>
<dd>The provider for the RPM Package Manager platform. Can be used with the <tt class="docutils literal"><span class="pre">options</span></tt> attribute.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Rubygems</span></tt>, <tt class="docutils literal"><span class="pre">gem_package</span></tt></dt>
<dd><p class="first">Can be used with the <tt class="docutils literal"><span class="pre">options</span></tt> attribute.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>gem_package</strong> resource must be specified as <tt class="docutils literal"><span class="pre">gem_package</span></tt> and cannot be shortened to <tt class="docutils literal"><span class="pre">package</span></tt> in a recipe.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Rubygems</span></tt>, <tt class="docutils literal"><span class="pre">chef_gem</span></tt></dt>
<dd>Can be used with the <tt class="docutils literal"><span class="pre">options</span></tt> attribute.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Smartos</span></tt>, <tt class="docutils literal"><span class="pre">smartos_package</span></tt></dt>
<dd>The provider for the SmartOS platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Solaris</span></tt>, <tt class="docutils literal"><span class="pre">solaris_package</span></tt></dt>
<dd>The provider for the Solaris platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Windows</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>The provider for the Microsoft Windows platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Yum</span></tt>, <tt class="docutils literal"><span class="pre">yum_package</span></tt></dt>
<dd>The provider for the Yum package provider.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Zypper</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>The provider for the openSUSE platform.</dd>
</dl>
</div>
<div class="section" id="id205">
<h3>Examples<a class="headerlink" href="#id205" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a gems file for use in recipes</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">chef_gem</span> <span class="s1">&#39;right_aws&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>

<span class="nb">require</span> <span class="s1">&#39;right_aws&#39;</span>
</pre></div>
</div>
<p><strong>Install a gems file from the local file system</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;right_aws&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;/tmp/right_aws-1.11.0.gem&#39;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;tar&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package version</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;tar&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="s1">&#39;1.16.1-1&#39;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package with options</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;debian-archive-keyring&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">options</span> <span class="s1">&#39;--force-yes&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package with a response_file</strong></p>
<p>Use of a <tt class="docutils literal"><span class="pre">response_file</span></tt> is only supported on Debian and Ubuntu at this time. Custom resources must be written to support the use of a <tt class="docutils literal"><span class="pre">response_file</span></tt>, which contains debconf answers to questions normally asked by the package manager on installation. Put the file in <tt class="docutils literal"><span class="pre">/files/default</span></tt> of the cookbook where the package is specified and the chef-client will use the <strong>cookbook_file</strong> resource to retrieve it.</p>
<p>To install a package with a <tt class="docutils literal"><span class="pre">response_file</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;sun-java6-jdk&#39;</span> <span class="k">do</span>
  <span class="n">response_file</span> <span class="s1">&#39;java.seed&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package using a specific provider</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;tar&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">source</span> <span class="s1">&#39;/tmp/tar-1.16.1-1.rpm&#39;</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rpm</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a specified architecture using a named provider</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;glibc-devel&#39;</span> <span class="k">do</span>
  <span class="n">arch</span> <span class="s1">&#39;i386&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Purge a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;tar&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:purge</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Remove a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;tar&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:remove</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Upgrade a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;tar&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:upgrade</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the ignore_failure common attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">gem_package</span> <span class="s1">&#39;syntax&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">ignore_failure</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the provider common attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;some_package&#39;</span> <span class="k">do</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rubygems</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Avoid unnecessary string interpolation</strong></p>
<p>Do this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;mysql-server&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and not this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;mysql-server&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a package in a platform</strong></p>
<p>The following example shows how to use the <strong>package</strong> resource to install an application named <tt class="docutils literal"><span class="pre">app</span></tt> and ensure that the correct packages are installed for the correct platform:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;app_name&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>

<span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="ss">:platform</span><span class="o">]</span>
<span class="k">when</span> <span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span><span class="s1">&#39;debian&#39;</span>
  <span class="n">package</span> <span class="s1">&#39;app_name-doc&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:install</span>
  <span class="k">end</span>
<span class="k">when</span> <span class="s1">&#39;centos&#39;</span>
  <span class="n">package</span> <span class="s1">&#39;app_name-html&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:install</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install sudo, then configure /etc/sudoers/ file</strong></p>
<p>The following example shows how to install sudo and then configure the <tt class="docutils literal"><span class="pre">/etc/sudoers</span></tt> file:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#  the following code sample comes from the ``default`` recipe in the ``sudo`` cookbook: https://github.com/chef-cookbooks/sudo</span>

<span class="n">package</span> <span class="s1">&#39;sudo&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>

<span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;authorization&#39;</span><span class="o">][</span><span class="s1">&#39;sudo&#39;</span><span class="o">][</span><span class="s1">&#39;include_sudoers_d&#39;</span><span class="o">]</span>
  <span class="n">directory</span> <span class="s1">&#39;/etc/sudoers.d&#39;</span> <span class="k">do</span>
    <span class="n">mode</span>        <span class="s1">&#39;0755&#39;</span>
    <span class="n">owner</span>       <span class="s1">&#39;root&#39;</span>
    <span class="n">group</span>       <span class="s1">&#39;root&#39;</span>
    <span class="n">action</span>      <span class="ss">:create</span>
  <span class="k">end</span>

  <span class="n">cookbook_file</span> <span class="s1">&#39;/etc/sudoers.d/README&#39;</span> <span class="k">do</span>
    <span class="n">source</span>      <span class="s1">&#39;README&#39;</span>
    <span class="n">mode</span>        <span class="s1">&#39;0440&#39;</span>
    <span class="n">owner</span>       <span class="s1">&#39;root&#39;</span>
    <span class="n">group</span>       <span class="s1">&#39;root&#39;</span>
    <span class="n">action</span>      <span class="ss">:create</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/etc/sudoers&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;sudoers.erb&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0440&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="n">platform?</span><span class="p">(</span><span class="s1">&#39;freebsd&#39;</span><span class="p">)</span> <span class="p">?</span> <span class="s1">&#39;wheel&#39;</span> <span class="p">:</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="ss">:sudoers_groups</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;authorization&#39;</span><span class="o">][</span><span class="s1">&#39;sudo&#39;</span><span class="o">][</span><span class="s1">&#39;groups&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:sudoers_users</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;authorization&#39;</span><span class="o">][</span><span class="s1">&#39;sudo&#39;</span><span class="o">][</span><span class="s1">&#39;users&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:passwordless</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;authorization&#39;</span><span class="o">][</span><span class="s1">&#39;sudo&#39;</span><span class="o">][</span><span class="s1">&#39;passwordless&#39;</span><span class="o">]</span>
  <span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li>the <strong>package</strong> resource is used to install sudo</li>
<li>the <tt class="docutils literal"><span class="pre">if</span></tt> statement is used to ensure availability of the <tt class="docutils literal"><span class="pre">/etc/sudoers.d</span></tt> directory</li>
<li>the <strong>template</strong> resource tells the chef-client where to find the <tt class="docutils literal"><span class="pre">sudoers</span></tt> template</li>
<li>the <tt class="docutils literal"><span class="pre">variables</span></tt> property is a hash that passes values to template files (that are located in the <tt class="docutils literal"><span class="pre">templates/</span></tt> directory for the cookbook</li>
</ul>
<p><strong>Use a case statement to specify the platform</strong></p>
<p>The following example shows how to use a case statement to tell the chef-client which platforms and packages to install using cURL.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;curl&#39;</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="ss">:platform</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">&#39;redhat&#39;</span><span class="p">,</span> <span class="s1">&#39;centos&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;package_1&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;package_2&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;package_3&#39;</span>
  <span class="k">when</span> <span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span> <span class="s1">&#39;debian&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;package_a&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;package_b&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;package_c&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">node[:platform]</span></tt> for each node is identified by Ohai during every chef-client run. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;curl&#39;</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="ss">:platform</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">&#39;redhat&#39;</span><span class="p">,</span> <span class="s1">&#39;centos&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;zlib-devel&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;openssl-devel&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;libc6-dev&#39;</span>
  <span class="k">when</span> <span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span> <span class="s1">&#39;debian&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;openssl&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;pkg-config&#39;</span>
    <span class="n">package</span> <span class="s1">&#39;subversion&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use symbols to reference attributes</strong></p>
<p>Symbols may be used to reference attributes:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;mysql-server&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="n">node</span><span class="o">[</span><span class="ss">:mysql</span><span class="o">][</span><span class="ss">:version</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p>instead of strings:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;mysql-server&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a whitespace array to simplify a recipe</strong></p>
<p>The following examples show different ways of doing the same thing. The first shows a series of packages that will be upgraded:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="s1">&#39;package-a&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:upgrade</span>
<span class="k">end</span>

<span class="n">package</span> <span class="s1">&#39;package-b&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:upgrade</span>
<span class="k">end</span>

<span class="n">package</span> <span class="s1">&#39;package-c&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:upgrade</span>
<span class="k">end</span>

<span class="n">package</span> <span class="s1">&#39;package-d&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:upgrade</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and the next uses a single <strong>package</strong> resource and a whitespace array (<tt class="docutils literal"><span class="pre">%w</span></tt>):</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="sx">%w{package-a package-b package-c package-d}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">pkg</span><span class="o">|</span>
  <span class="n">package</span> <span class="n">pkg</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:upgrade</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">|pkg|</span></tt> is used to define the name of the resource, but also to ensure that each item in the whitespace array has its own name.</p>
<p><strong>Specify the Homebrew user with a UUID</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">homebrew_package</span> <span class="s1">&#39;emacs&#39;</span> <span class="k">do</span>
  <span class="n">homebrew_user</span> <span class="mi">1001</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify the Homebrew user with a string</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">homebrew_package</span> <span class="s1">&#39;vim&#39;</span> <span class="k">do</span>
  <span class="n">homebrew_user</span> <span class="s1">&#39;user1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="pacman-package">
<h2>pacman_package<a class="headerlink" href="#pacman-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_pacman_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>pacman_package</strong> resource to manage packages (using pacman) on the Arch Linux platform.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id206">
<h3>Syntax<a class="headerlink" href="#id206" title="Permalink to this headline">¶</a></h3>
<p>A <strong>pacman_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>pacman_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">pacman_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>pacman_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">pacman_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Pacman</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">pacman_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id207">
<h3>Actions<a class="headerlink" href="#id207" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:purge</span></tt></dt>
<dd>Purge a package. This action typically removes the configuration files as well as the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version.</dd>
</dl>
</div>
<div class="section" id="id208">
<h3>Properties<a class="headerlink" href="#id208" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id209">
<h3>Providers<a class="headerlink" href="#id209" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Pacman</span></tt>, <tt class="docutils literal"><span class="pre">pacman_package</span></tt></dt>
<dd>The provider for the Arch Linux platform.</dd>
</dl>
</div>
<div class="section" id="id210">
<h3>Examples<a class="headerlink" href="#id210" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">pacman_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="paludis-package">
<h2>paludis_package<a class="headerlink" href="#paludis-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_paludis_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>paludis_package</strong> resource to manage packages for the Paludis platform.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id211">
<h3>Syntax<a class="headerlink" href="#id211" title="Permalink to this headline">¶</a></h3>
<p>A <strong>paludis_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>paludis_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">paludis_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>paludis_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">paludis_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Paludis</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">paludis_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">recursive</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id212">
<h3>Actions<a class="headerlink" href="#id212" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version.</dd>
</dl>
</div>
<div class="section" id="id213">
<h3>Properties<a class="headerlink" href="#id213" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id214">
<h3>Providers<a class="headerlink" href="#id214" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Paludis</span></tt>, <tt class="docutils literal"><span class="pre">paludis_package</span></tt></dt>
<dd>The provider for the Paludis platform.</dd>
</dl>
</div>
<div class="section" id="id215">
<h3>Examples<a class="headerlink" href="#id215" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">paludis_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="perl">
<h2>perl<a class="headerlink" href="#perl" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_perl.rst">[edit on GitHub]</a></p>
<p>Use the <strong>perl</strong> resource to execute scripts using the Perl interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>perl</strong> script resource (which is based on the <strong>script</strong> resource) is different from the <strong>ruby_block</strong> resource because Ruby code that is run with this resource is created as a temporary file and executed like other script resources, rather than run inline.</p>
</div>
<div class="section" id="id216">
<h3>Syntax<a class="headerlink" href="#id216" title="Permalink to this headline">¶</a></h3>
<p>A <strong>perl</strong> resource block executes scripts Perl:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">perl</span> <span class="s1">&#39;extract_module&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    mkdir -p #{extract_path}</span>
<span class="sh">    tar xzf #{src_filename} -C #{extract_path}</span>
<span class="sh">    mv #{extract_path}/*/* #{extract_path}/</span>
<span class="no">    EOH</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">cwd</span></tt> specifies the directory from which the command is run</li>
<li><tt class="docutils literal"><span class="pre">code</span></tt> specifies the command to run</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>perl</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">perl</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">code</span>                       <span class="nb">String</span>
  <span class="n">creates</span>                    <span class="nb">String</span>
  <span class="n">cwd</span>                        <span class="nb">String</span>
  <span class="n">environment</span>                <span class="no">Hash</span>
  <span class="n">flags</span>                      <span class="nb">String</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">path</span>                       <span class="nb">Array</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Script</span><span class="o">::</span><span class="no">Perl</span>
  <span class="n">returns</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Float</span>
  <span class="n">user</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">umask</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :run if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">perl</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">cwd</span></tt> is the location from which the command is run</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">code</span></tt>, <tt class="docutils literal"><span class="pre">creates</span></tt>, <tt class="docutils literal"><span class="pre">cwd</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">flags</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">returns</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt>, and <tt class="docutils literal"><span class="pre">umask</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id217">
<h3>Actions<a class="headerlink" href="#id217" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Prevent a command from running. This action is used to specify that a command is run only when another resource notifies it.</dd>
<dt><tt class="docutils literal"><span class="pre">:run</span></tt></dt>
<dd>Default. Run a script.</dd>
</dl>
</div>
<div class="section" id="id218">
<h3>Properties<a class="headerlink" href="#id218" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">code</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A quoted (&#8221; &#8221;) string of code to be executed.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">creates</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Prevent a command from creating a file when that file already exists.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">cwd</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The current working directory.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">environment</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A Hash of environment variables in the form of <tt class="docutils literal"><span class="pre">({&quot;ENV_VARIABLE&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;VALUE&quot;})</span></tt>. (These variables must exist for a command to be run successfully.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">flags</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One or more command line flags that are passed to the interpreter when a command is invoked.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The group name or group ID that must be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p>An array of paths to use when searching for a command. These paths are not added to the command&#8217;s environment $PATH. The default value uses the system path.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p>For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">perl</span> <span class="s1">&#39;mycommand&#39;</span> <span class="k">do</span>
  <span class="n">environment</span> <span class="s1">&#39;PATH&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/my/path/to/bin:</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PATH&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">returns</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Array</p>
<p class="last">The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Float</p>
<p class="last">The amount of time (in seconds) a command is to wait before timing out. Default value: <tt class="docutils literal"><span class="pre">3600</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The user name or user ID that should be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">umask</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The file mode creation mask, or umask.</p>
</dd>
</dl>
<div class="section" id="id219">
<h4>Guards<a class="headerlink" href="#id219" title="Permalink to this headline">¶</a></h4>
<p>A guard property can be used to evaluate the state of a node during the execution phase of the chef-client run. Based on the results of this evaluation, a guard property is then used to tell the chef-client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p>
<ul class="simple">
<li>A string is executed as a shell command. If the command returns <tt class="docutils literal"><span class="pre">0</span></tt>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <tt class="docutils literal"><span class="pre">true</span></tt> in addition to <tt class="docutils literal"><span class="pre">0</span></tt>.</li>
<li>A block is executed as Ruby code that must return either <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. If the block returns <tt class="docutils literal"><span class="pre">true</span></tt>, the guard property is applied. If the block returns <tt class="docutils literal"><span class="pre">false</span></tt>, the guard property is not applied.</li>
</ul>
<p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for the chef-client to do nothing.</p>
<p><strong>Attributes</strong></p>
<p>The following properties can be used to define a guard that is evaluated during the execution phase of the chef-client run:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">not_if</span></tt></dt>
<dd>Prevent a resource from executing when the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">only_if</span></tt></dt>
<dd>Allow a resource to execute only if the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
</dl>
<p><strong>Arguments</strong></p>
<p>The following arguments can be used with the <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:user</span></tt></dt>
<dd><p class="first">Specify the user that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:group</span></tt></dt>
<dd><p class="first">Specify the group that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:environment</span></tt></dt>
<dd><p class="first">Specify a Hash of environment variables to be set. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/adam&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:cwd</span></tt></dt>
<dd><p class="first">Set the current working directory before running a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam passwd&#39;</span><span class="p">,</span> <span class="ss">:cwd</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:timeout</span></tt></dt>
<dd><p class="first">Set a timeout for a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;sleep 10000&#39;</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="id220">
<h3>Providers<a class="headerlink" href="#id220" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script</span></tt>, <tt class="docutils literal"><span class="pre">script</span></tt></dt>
<dd>When this short name is used, the chef-client will determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script::Perl</span></tt>, <tt class="docutils literal"><span class="pre">perl</span></tt></dt>
<dd>The provider for the Perl command interpreter.</dd>
</dl>
</div>
<div class="section" id="id221">
<h3>Examples<a class="headerlink" href="#id221" title="Permalink to this headline">¶</a></h3>
<p>None.</p>
</div>
</div>
<div class="section" id="portage-package">
<h2>portage_package<a class="headerlink" href="#portage-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_portage_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>portage_package</strong> resource to manage packages for the Gentoo platform.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id222">
<h3>Syntax<a class="headerlink" href="#id222" title="Permalink to this headline">¶</a></h3>
<p>A <strong>portage_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>portage_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">portage_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>portage_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">portage_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Portage</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">portage_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id223">
<h3>Actions<a class="headerlink" href="#id223" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:purge</span></tt></dt>
<dd>Purge a package. This action typically removes the configuration files as well as the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version.</dd>
</dl>
</div>
<div class="section" id="id224">
<h3>Properties<a class="headerlink" href="#id224" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id225">
<h3>Providers<a class="headerlink" href="#id225" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Portage</span></tt>, <tt class="docutils literal"><span class="pre">portage_package</span></tt></dt>
<dd>The provider for the Gentoo platform. Can be used with the <tt class="docutils literal"><span class="pre">options</span></tt> attribute.</dd>
</dl>
</div>
<div class="section" id="id226">
<h3>Examples<a class="headerlink" href="#id226" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">portage_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="powershell-script">
<h2>powershell_script<a class="headerlink" href="#powershell-script" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_powershell_script.rst">[edit on GitHub]</a></p>
<p>Use the <strong>powershell_script</strong> resource to execute a script using the Windows PowerShell interpreter, much like how the <strong>script</strong> and <strong>script</strong>-based resources&#8212;<strong>bash</strong>, <strong>csh</strong>, <strong>perl</strong>, <strong>python</strong>, and <strong>ruby</strong>&#8212;are used. The <strong>powershell_script</strong> is specific to the Microsoft Windows platform and the Windows PowerShell interpreter.</p>
<p>The <strong>powershell_script</strong> resource creates and executes a temporary file (similar to how the <strong>script</strong> resource behaves), rather than running the command inline. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="section" id="id227">
<h3>Syntax<a class="headerlink" href="#id227" title="Permalink to this headline">¶</a></h3>
<p>A <strong>powershell_script</strong> resource block executes a batch script using the Windows PowerShell interpreter. For example, writing to an interpolated path:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;write-to-interpolated-path&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  $stream = [System.IO.StreamWriter] &quot;#{Chef::Config[:file_cache_path]}/powershell-test.txt&quot;</span>
<span class="sh">  $stream.WriteLine(&quot;In #{Chef::Config[:file_cache_path]}...word.&quot;)</span>
<span class="sh">  $stream.close()</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>powershell_script</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">architecture</span>               <span class="no">Symbol</span>
  <span class="n">code</span>                       <span class="nb">String</span>
  <span class="n">command</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">convert_boolean_return</span>     <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">creates</span>                    <span class="nb">String</span>
  <span class="n">cwd</span>                        <span class="nb">String</span>
  <span class="n">environment</span>                <span class="no">Hash</span>
  <span class="n">flags</span>                      <span class="nb">String</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">guard_interpreter</span>          <span class="no">Symbol</span>
  <span class="n">interpreter</span>                <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">PowershellScript</span>
  <span class="n">returns</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Float</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :run if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">powershell_script</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">command</span></tt> is the command to be run and <tt class="docutils literal"><span class="pre">cwd</span></tt> is the location from which the command is run</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">architecture</span></tt>, <tt class="docutils literal"><span class="pre">code</span></tt>, <tt class="docutils literal"><span class="pre">command</span></tt>, <tt class="docutils literal"><span class="pre">convert_boolean_return</span></tt>, <tt class="docutils literal"><span class="pre">creates</span></tt>, <tt class="docutils literal"><span class="pre">cwd</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">flags</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt>, <tt class="docutils literal"><span class="pre">interpreter</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">returns</span></tt>, and <tt class="docutils literal"><span class="pre">timeout</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id228">
<h3>Actions<a class="headerlink" href="#id228" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Inherited from <strong>execute</strong> resource. Prevent a command from running. This action is used to specify that a command is run only when another resource notifies it.</dd>
<dt><tt class="docutils literal"><span class="pre">:run</span></tt></dt>
<dd>Default. Run the script.</dd>
</dl>
</div>
<div class="section" id="id229">
<h3>Properties<a class="headerlink" href="#id229" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">architecture</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol</p>
<p class="last">The architecture of the process under which a script is executed. If a value is not provided, the chef-client defaults to the correct value for the architecture, as determined by Ohai. An exception is raised when anything other than <tt class="docutils literal"><span class="pre">:i386</span></tt> is specified for a 32-bit process. Possible values: <tt class="docutils literal"><span class="pre">:i386</span></tt> (for 32-bit processes) and <tt class="docutils literal"><span class="pre">:x86_64</span></tt> (for 64-bit processes).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">code</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A quoted (&#8221; &#8221;) string of code to be executed.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">command</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the command to be executed. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">convert_boolean_return</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p>Return <tt class="docutils literal"><span class="pre">0</span></tt> if the last line of a command is evaluated to be true or to return <tt class="docutils literal"><span class="pre">1</span></tt> if the last line is evaluated to be false. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
<p>When the <tt class="docutils literal"><span class="pre">guard_intrepreter</span></tt> common attribute is set to <tt class="docutils literal"><span class="pre">:powershell_script</span></tt>, a string command will be evaluated as if this value were set to <tt class="docutils literal"><span class="pre">true</span></tt>. This is because the behavior of this attribute is similar to the value of the <tt class="docutils literal"><span class="pre">&quot;$?&quot;</span></tt> expression common in UNIX interpreters. For example, this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;make_safe_backup&#39;</span> <span class="k">do</span>
  <span class="n">guard_interpreter</span> <span class="ss">:powershell_script</span>
  <span class="n">code</span> <span class="s1">&#39;cp ~/data/nodes.json ~/data/nodes.bak&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;test-path ~/data/nodes.bak&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>is similar to:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;make_safe_backup&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="s1">&#39;cp ~/data/nodes.json ~/data/nodes.bak&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;test -e ~/data/nodes.bak&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">creates</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Inherited from <strong>execute</strong> resource. Prevent a command from creating a file when that file already exists.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">cwd</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Inherited from <strong>execute</strong> resource. The current working directory from which a command is run.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">environment</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">Inherited from <strong>execute</strong> resource. A Hash of environment variables in the form of <tt class="docutils literal"><span class="pre">({&quot;ENV_VARIABLE&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;VALUE&quot;})</span></tt>. (These variables must exist for a command to be run successfully.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">flags</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A string that is passed to the Windows PowerShell command. Default value: <tt class="docutils literal"><span class="pre">-NoLogo,</span> <span class="pre">-NonInteractive,</span> <span class="pre">-NoProfile,</span> <span class="pre">-ExecutionPolicy</span> <span class="pre">RemoteSigned,</span> <span class="pre">-InputFormat</span> <span class="pre">None,</span> <span class="pre">-File</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">Inherited from <strong>execute</strong> resource. The group name or group ID that must be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">guard_interpreter</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol</p>
<p class="last">Default value: <tt class="docutils literal"><span class="pre">:powershell_script</span></tt>. When this property is set to <tt class="docutils literal"><span class="pre">:powershell_script</span></tt>, the 64-bit version of the Windows PowerShell shell will be used to evaluate strings values for the <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> properties. Set this value to <tt class="docutils literal"><span class="pre">:default</span></tt> to use the 32-bit version of the cmd.exe shell.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">interpreter</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The script interpreter to use during code execution. Changing the default value of this property is not supported.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">returns</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Array</p>
<p class="last">Inherited from <strong>execute</strong> resource. The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Float</p>
<p class="last">Inherited from <strong>execute</strong> resource. The amount of time (in seconds) a command is to wait before timing out. Default value: <tt class="docutils literal"><span class="pre">3600</span></tt>.</p>
</dd>
</dl>
<div class="section" id="id230">
<h4>Guards<a class="headerlink" href="#id230" title="Permalink to this headline">¶</a></h4>
<p>A guard property can be used to evaluate the state of a node during the execution phase of the chef-client run. Based on the results of this evaluation, a guard property is then used to tell the chef-client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p>
<ul class="simple">
<li>A string is executed as a shell command. If the command returns <tt class="docutils literal"><span class="pre">0</span></tt>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <tt class="docutils literal"><span class="pre">true</span></tt> in addition to <tt class="docutils literal"><span class="pre">0</span></tt>.</li>
<li>A block is executed as Ruby code that must return either <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. If the block returns <tt class="docutils literal"><span class="pre">true</span></tt>, the guard property is applied. If the block returns <tt class="docutils literal"><span class="pre">false</span></tt>, the guard property is not applied.</li>
</ul>
<p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for the chef-client to do nothing.</p>
<p><strong>Attributes</strong></p>
<p>The following properties can be used to define a guard that is evaluated during the execution phase of the chef-client run:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">not_if</span></tt></dt>
<dd>Prevent a resource from executing when the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">only_if</span></tt></dt>
<dd>Allow a resource to execute only if the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
</dl>
<p><strong>Arguments</strong></p>
<p>The following arguments can be used with the <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:user</span></tt></dt>
<dd><p class="first">Specify the user that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:group</span></tt></dt>
<dd><p class="first">Specify the group that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:environment</span></tt></dt>
<dd><p class="first">Specify a Hash of environment variables to be set. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/adam&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:cwd</span></tt></dt>
<dd><p class="first">Set the current working directory before running a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam passwd&#39;</span><span class="p">,</span> <span class="ss">:cwd</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:timeout</span></tt></dt>
<dd><p class="first">Set a timeout for a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;sleep 10000&#39;</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="id231">
<h3>Examples<a class="headerlink" href="#id231" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Write to an interpolated path</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;write-to-interpolated-path&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  $stream = [System.IO.StreamWriter] &quot;#{Chef::Config[:file_cache_path]}/powershell-test.txt&quot;</span>
<span class="sh">  $stream.WriteLine(&quot;In #{Chef::Config[:file_cache_path]}...word.&quot;)</span>
<span class="sh">  $stream.close()</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Change the working directory</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;cwd-then-write&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  $stream = [System.IO.StreamWriter] &quot;C:/powershell-test2.txt&quot;</span>
<span class="sh">  $pwd = pwd</span>
<span class="sh">  $stream.WriteLine(&quot;This is the contents of: $pwd&quot;)</span>
<span class="sh">  $dirs = dir</span>
<span class="sh">  foreach ($dir in $dirs) {</span>
<span class="sh">    $stream.WriteLine($dir.fullname)</span>
<span class="sh">  }</span>
<span class="sh">  $stream.close()</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Change the working directory in Microsoft Windows</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;cwd-to-win-env-var&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="s1">&#39;%TEMP%&#39;</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  $stream = [System.IO.StreamWriter] &quot;./temp-write-from-chef.txt&quot;</span>
<span class="sh">  $stream.WriteLine(&quot;chef on windows rox yo!&quot;)</span>
<span class="sh">  $stream.close()</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Pass an environment variable to a script</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;read-env-var&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">environment</span> <span class="p">({</span><span class="s1">&#39;foo&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;BAZ&#39;</span><span class="p">})</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  $stream = [System.IO.StreamWriter] &quot;./test-read-env-var.txt&quot;</span>
<span class="sh">  $stream.WriteLine(&quot;FOO is $env:foo&quot;)</span>
<span class="sh">  $stream.close()</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Evaluate for true and/or false</strong></p>
<p>Use the <tt class="docutils literal"><span class="pre">convert_boolean_return</span></tt> attribute to raise an exception when certain conditions are met. For example, the following fragments will run successfully without error:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;false&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="s1">&#39;$false&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;true&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="s1">&#39;$true&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>whereas the following will raise an exception:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;false&#39;</span> <span class="k">do</span>
  <span class="n">convert_boolean_return</span> <span class="kp">true</span>
  <span class="n">code</span> <span class="s1">&#39;$false&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the flags attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">powershell_script</span> <span class="s1">&#39;Install IIS&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  Import-Module ServerManager</span>
<span class="sh">  Add-WindowsFeature Web-Server</span>
<span class="no">  EOH</span>
  <span class="n">flags</span> <span class="s1">&#39;-NoLogo, -NonInteractive, -NoProfile, -ExecutionPolicy Unrestricted, -InputFormat None, -File&#39;</span>
  <span class="n">guard_interpreter</span> <span class="ss">:powershell_script</span>
  <span class="n">not_if</span> <span class="s1">&#39;(Get-WindowsFeature -Name Web-Server).Installed&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Rename computer, join domain, reboot</strong></p>
<p>The following example shows how to rename a computer, join a domain, and then reboot the computer:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">reboot</span> <span class="s1">&#39;Restart Computer&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">powershell_script</span> <span class="s1">&#39;Rename and Join Domain&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    ...your rename and domain join logic here...</span>
<span class="no">  EOH</span>
  <span class="n">not_if</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    $ComputerSystem = gwmi win32_computersystem</span>
<span class="sh">    ($ComputerSystem.Name -like &#39;#{node[&#39;some_attribute_that_has_the_new_name&#39;]}&#39;) -and</span>
<span class="sh">      $ComputerSystem.partofdomain)</span>
<span class="no">  EOH</span>
  <span class="n">notifies</span> <span class="ss">:reboot_now</span><span class="p">,</span> <span class="s1">&#39;reboot[Restart Computer]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li>The <strong>powershell_script</strong> resource block renames a computer, and then joins a domain</li>
<li>The <strong>reboot</strong> resource restarts the computer</li>
<li>The <tt class="docutils literal"><span class="pre">not_if</span></tt> guard prevents the Windows PowerShell script from running when the settings in the <tt class="docutils literal"><span class="pre">not_if</span></tt> guard match the desired state</li>
<li>The <tt class="docutils literal"><span class="pre">notifies</span></tt> statement tells the <strong>reboot</strong> resource block to run if the <strong>powershell_script</strong> block was executed during the chef-client run</li>
</ul>
</div>
</div>
<div class="section" id="python">
<h2>python<a class="headerlink" href="#python" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_python.rst">[edit on GitHub]</a></p>
<p>Use the <strong>python</strong> resource to execute scripts using the Python interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>python</strong> script resource (which is based on the <strong>script</strong> resource) is different from the <strong>ruby_block</strong> resource because Ruby code that is run with this resource is created as a temporary file and executed like other script resources, rather than run inline.</p>
</div>
<div class="section" id="id232">
<h3>Syntax<a class="headerlink" href="#id232" title="Permalink to this headline">¶</a></h3>
<p>A <strong>python</strong> resource block executes scripts using Python:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="s1">&#39;hello world&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    print &quot;Hello world! From Chef and Python.&quot;</span>
<span class="no">    EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">code</span></tt> specifies the command to run</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>python</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">code</span>                       <span class="nb">String</span>
  <span class="n">creates</span>                    <span class="nb">String</span>
  <span class="n">cwd</span>                        <span class="nb">String</span>
  <span class="n">environment</span>                <span class="no">Hash</span>
  <span class="n">flags</span>                      <span class="nb">String</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">path</span>                       <span class="nb">Array</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Script</span><span class="o">::</span><span class="no">Python</span>
  <span class="n">returns</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Float</span>
  <span class="n">user</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">umask</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :run if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">python</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">code</span></tt>, <tt class="docutils literal"><span class="pre">creates</span></tt>, <tt class="docutils literal"><span class="pre">cwd</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">flags</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">returns</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt>, and <tt class="docutils literal"><span class="pre">umask</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id233">
<h3>Actions<a class="headerlink" href="#id233" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Prevent a command from running. This action is used to specify that a command is run only when another resource notifies it.</dd>
<dt><tt class="docutils literal"><span class="pre">:run</span></tt></dt>
<dd>Default. Run a script.</dd>
</dl>
</div>
<div class="section" id="id234">
<h3>Properties<a class="headerlink" href="#id234" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">code</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A quoted (&#8221; &#8221;) string of code to be executed.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">creates</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Prevent a command from creating a file when that file already exists.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">cwd</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The current working directory.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">environment</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A Hash of environment variables in the form of <tt class="docutils literal"><span class="pre">({&quot;ENV_VARIABLE&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;VALUE&quot;})</span></tt>. (These variables must exist for a command to be run successfully.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">flags</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One or more command line flags that are passed to the interpreter when a command is invoked.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The group name or group ID that must be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p>An array of paths to use when searching for a command. These paths are not added to the command&#8217;s environment $PATH. The default value uses the system path.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p>For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="s1">&#39;mycommand&#39;</span> <span class="k">do</span>
  <span class="n">environment</span> <span class="s1">&#39;PATH&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/my/path/to/bin:</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PATH&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">returns</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Array</p>
<p class="last">The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Float</p>
<p class="last">The amount of time (in seconds) a command is to wait before timing out. Default value: <tt class="docutils literal"><span class="pre">3600</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The user name or user ID that should be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">umask</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The file mode creation mask, or umask.</p>
</dd>
</dl>
<div class="section" id="id235">
<h4>Guards<a class="headerlink" href="#id235" title="Permalink to this headline">¶</a></h4>
<p>A guard property can be used to evaluate the state of a node during the execution phase of the chef-client run. Based on the results of this evaluation, a guard property is then used to tell the chef-client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p>
<ul class="simple">
<li>A string is executed as a shell command. If the command returns <tt class="docutils literal"><span class="pre">0</span></tt>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <tt class="docutils literal"><span class="pre">true</span></tt> in addition to <tt class="docutils literal"><span class="pre">0</span></tt>.</li>
<li>A block is executed as Ruby code that must return either <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. If the block returns <tt class="docutils literal"><span class="pre">true</span></tt>, the guard property is applied. If the block returns <tt class="docutils literal"><span class="pre">false</span></tt>, the guard property is not applied.</li>
</ul>
<p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for the chef-client to do nothing.</p>
<p><strong>Attributes</strong></p>
<p>The following properties can be used to define a guard that is evaluated during the execution phase of the chef-client run:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">not_if</span></tt></dt>
<dd>Prevent a resource from executing when the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">only_if</span></tt></dt>
<dd>Allow a resource to execute only if the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
</dl>
<p><strong>Arguments</strong></p>
<p>The following arguments can be used with the <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:user</span></tt></dt>
<dd><p class="first">Specify the user that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:group</span></tt></dt>
<dd><p class="first">Specify the group that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:environment</span></tt></dt>
<dd><p class="first">Specify a Hash of environment variables to be set. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/adam&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:cwd</span></tt></dt>
<dd><p class="first">Set the current working directory before running a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam passwd&#39;</span><span class="p">,</span> <span class="ss">:cwd</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:timeout</span></tt></dt>
<dd><p class="first">Set a timeout for a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;sleep 10000&#39;</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="id236">
<h3>Providers<a class="headerlink" href="#id236" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script</span></tt>, <tt class="docutils literal"><span class="pre">script</span></tt></dt>
<dd>When this short name is used, the chef-client will determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script::Python</span></tt>, <tt class="docutils literal"><span class="pre">python</span></tt></dt>
<dd>The provider for the Python command interpreter.</dd>
</dl>
</div>
<div class="section" id="id237">
<h3>Examples<a class="headerlink" href="#id237" title="Permalink to this headline">¶</a></h3>
<p>None.</p>
</div>
</div>
<div class="section" id="reboot">
<h2>reboot<a class="headerlink" href="#reboot" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_reboot.rst">[edit on GitHub]</a></p>
<p>Use the <strong>reboot</strong> resource to reboot a node, a necessary step with some installations on certain platforms. This resource is supported for use on the Microsoft Windows, Mac OS X, and Linux platforms.</p>
<div class="section" id="id238">
<h3>Syntax<a class="headerlink" href="#id238" title="Permalink to this headline">¶</a></h3>
<p>A <strong>reboot</strong> resource block reboots a node:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">reboot</span> <span class="s1">&#39;app_requires_reboot&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:request_reboot</span>
  <span class="n">reason</span> <span class="s1">&#39;Need to reboot when the run completes successfully.&#39;</span>
  <span class="n">delay_mins</span> <span class="mi">5</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>reboot</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">reboot</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">delay_mins</span>                 <span class="no">Fixnum</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">reason</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">action</span>                     <span class="no">Symbol</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">reboot</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">delay_mins</span></tt> and <tt class="docutils literal"><span class="pre">reason</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id239">
<h3>Actions<a class="headerlink" href="#id239" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:cancel</span></tt></dt>
<dd>Cancel a reboot request.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:reboot_now</span></tt></dt>
<dd>Reboot a node so that the chef-client may continue the installation process.</dd>
<dt><tt class="docutils literal"><span class="pre">:request_reboot</span></tt></dt>
<dd>Reboot a node at the end of a chef-client run.</dd>
</dl>
</div>
<div class="section" id="id240">
<h3>Properties<a class="headerlink" href="#id240" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">delay_mins</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Fixnum</p>
<p class="last">The amount of time (in minutes) to delay a reboot request.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timer is available:</p>
<dl class="last docutils">
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
</dd>
<dt><tt class="docutils literal"><span class="pre">reason</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A string that describes the reboot action.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timer is available:</p>
<dl class="last docutils">
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
</dd>
</dl>
</div>
<div class="section" id="id241">
<h3>Examples<a class="headerlink" href="#id241" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Reboot a node immediately</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">reboot</span> <span class="s1">&#39;now&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">reason</span> <span class="s1">&#39;Cannot continue Chef run without a reboot.&#39;</span>
  <span class="n">delay_mins</span> <span class="mi">2</span>
<span class="k">end</span>

<span class="n">execute</span> <span class="s1">&#39;foo&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;...&#39;</span>
  <span class="n">notifies</span> <span class="ss">:reboot_now</span><span class="p">,</span> <span class="s1">&#39;reboot[now]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reboot a node at the end of a chef-client run</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">reboot</span> <span class="s1">&#39;app_requires_reboot&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:request_reboot</span>
  <span class="n">reason</span> <span class="s1">&#39;Need to reboot when the run completes successfully.&#39;</span>
  <span class="n">delay_mins</span> <span class="mi">5</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Cancel a reboot</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">reboot</span> <span class="s1">&#39;cancel_reboot_request&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:cancel</span>
  <span class="n">reason</span> <span class="s1">&#39;Cancel a previous end-of-run reboot request.&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Rename computer, join domain, reboot</strong></p>
<p>The following example shows how to rename a computer, join a domain, and then reboot the computer:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">reboot</span> <span class="s1">&#39;Restart Computer&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">powershell_script</span> <span class="s1">&#39;Rename and Join Domain&#39;</span> <span class="k">do</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    ...your rename and domain join logic here...</span>
<span class="no">  EOH</span>
  <span class="n">not_if</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    $ComputerSystem = gwmi win32_computersystem</span>
<span class="sh">    ($ComputerSystem.Name -like &#39;#{node[&#39;some_attribute_that_has_the_new_name&#39;]}&#39;) -and</span>
<span class="sh">      $ComputerSystem.partofdomain)</span>
<span class="no">  EOH</span>
  <span class="n">notifies</span> <span class="ss">:reboot_now</span><span class="p">,</span> <span class="s1">&#39;reboot[Restart Computer]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li>The <strong>powershell_script</strong> resource block renames a computer, and then joins a domain</li>
<li>The <strong>reboot</strong> resource restarts the computer</li>
<li>The <tt class="docutils literal"><span class="pre">not_if</span></tt> guard prevents the Windows PowerShell script from running when the settings in the <tt class="docutils literal"><span class="pre">not_if</span></tt> guard match the desired state</li>
<li>The <tt class="docutils literal"><span class="pre">notifies</span></tt> statement tells the <strong>reboot</strong> resource block to run if the <strong>powershell_script</strong> block was executed during the chef-client run</li>
</ul>
</div>
</div>
<div class="section" id="registry-key">
<h2>registry_key<a class="headerlink" href="#registry-key" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_registry_key.rst">[edit on GitHub]</a></p>
<p>Use the <strong>registry_key</strong> resource to create and delete registry keys in Microsoft Windows.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>64-bit versions of Microsoft Windows have a 32-bit compatibility layer in the registry that reflects and redirects certain keys (and their values) into specific locations (or logical views) of the registry hive.</p>
<p>The chef-client can access any reflected or redirected registry key. The machine architecture of the system on which the chef-client is running is used as the default (non-redirected) location. Access to the <tt class="docutils literal"><span class="pre">SysWow64</span></tt> location is redirected must be specified. Typically, this is only necessary to ensure compatibility with 32-bit applications that are running on a 64-bit operating system.</p>
<p>32-bit versions of the chef-client (12.8 and earlier) and 64-bit versions of the chef-client (12.9 and later) generally behave the same in this situation, with one exception: it is only possible to read and write from a redirected registry location using chef-client version 12.9 (and later).</p>
<p class="last">For more information, see: <a class="reference external" href="http://msdn.microsoft.com/en-us/library/windows/desktop/aa384235(v=vs.85).aspx">http://msdn.microsoft.com/en-us/library/windows/desktop/aa384235(v=vs.85).aspx</a>.</p>
</div>
<div class="section" id="id242">
<h3>Syntax<a class="headerlink" href="#id242" title="Permalink to this headline">¶</a></h3>
<p>A <strong>registry_key</strong> resource block creates and deletes registry keys in Microsoft Windows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s2">&quot;HKEY_LOCAL_MACHINE</span><span class="se">\\</span><span class="s2">...</span><span class="se">\\</span><span class="s2">System&quot;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span>
    <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s2">&quot;NewRegistryKeyValue&quot;</span><span class="p">,</span>
    <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:multi_string</span><span class="p">,</span>
    <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="s1">&#39;foo\0bar\0\0&#39;</span><span class="o">]</span>
  <span class="p">}</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Use multiple registry key entries with key values that are based on node attributes:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s1">&#39;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\name_of_registry_key&#39;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;key_name&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:string</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="s1">&#39;C:\Windows\System32\file_name.bmp&#39;</span><span class="p">},</span>
          <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;key_name&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:string</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;node_name&#39;</span><span class="o">][</span><span class="s1">&#39;attribute&#39;</span><span class="o">][</span><span class="s1">&#39;value&#39;</span><span class="o">]</span><span class="p">},</span>
          <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;key_name&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:string</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;node_name&#39;</span><span class="o">][</span><span class="s1">&#39;attribute&#39;</span><span class="o">][</span><span class="s1">&#39;value&#39;</span><span class="o">]</span><span class="p">}</span>
         <span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>registry_key</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">architecture</span>               <span class="no">Symbol</span>
  <span class="n">key</span>                        <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Windows</span><span class="o">::</span><span class="no">Registry</span>
  <span class="n">recursive</span>                  <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">values</span>                     <span class="no">Hash</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul>
<li><p class="first"><tt class="docutils literal"><span class="pre">registry_key</span></tt> is the resource</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">values</span></tt> is a hash that contains at least one registry key to be created or deleted. Each registry key in the hash is grouped by brackets in which the <tt class="docutils literal"><span class="pre">:name</span></tt>, <tt class="docutils literal"><span class="pre">:type</span></tt>, and <tt class="docutils literal"><span class="pre">:data</span></tt> values for that registry key are specified.</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">:type</span></tt> represents the values available for registry keys in Microsoft Windows. Use <tt class="docutils literal"><span class="pre">:binary</span></tt> for REG_BINARY, <tt class="docutils literal"><span class="pre">:string</span></tt> for REG_SZ, <tt class="docutils literal"><span class="pre">:multi_string</span></tt> for REG_MULTI_SZ, <tt class="docutils literal"><span class="pre">:expand_string</span></tt> for REG_EXPAND_SZ, <tt class="docutils literal"><span class="pre">:dword</span></tt> for REG_DWORD, <tt class="docutils literal"><span class="pre">:dword_big_endian</span></tt> for REG_DWORD_BIG_ENDIAN, or <tt class="docutils literal"><span class="pre">:qword</span></tt> for REG_QWORD.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><tt class="docutils literal"><span class="pre">:multi_string</span></tt> must be an array, even if there is only a single string.</p>
</div>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">architecture</span></tt>, <tt class="docutils literal"><span class="pre">key</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">recursive</span></tt> and <tt class="docutils literal"><span class="pre">values</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</p>
</li>
</ul>
<div class="section" id="registry-key-path-separators">
<h4>Registry Key Path Separators<a class="headerlink" href="#registry-key-path-separators" title="Permalink to this headline">¶</a></h4>
<p>A Microsoft Windows registry key can be used as a string in Ruby code, such as when a registry key is used as the name of a recipe. In Ruby, when a registry key is enclosed in a double-quoted string (<tt class="docutils literal"><span class="pre">&quot;</span> <span class="pre">&quot;</span></tt>), the same backslash character (<tt class="docutils literal"><span class="pre">\</span></tt>) that is used to define the registry key path separator is also used in Ruby to define an escape character. Therefore, the registry key path separators must be escaped when they are enclosed in a double-quoted string. For example, the following registry key:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="no">HKCU</span><span class="p">\</span><span class="no">SOFTWARE</span><span class="p">\</span><span class="no">Policies</span><span class="p">\</span><span class="no">Microsoft</span><span class="p">\</span><span class="no">Windows</span><span class="p">\</span><span class="no">CurrentVersion</span><span class="p">\</span><span class="no">Themes</span>
</pre></div>
</div>
<p>may be encloused in a single-quoted string with a single backslash:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="s1">&#39;HKCU\SOFTWARE\path\to\key\Themes&#39;</span>
</pre></div>
</div>
<p>or may be enclosed in a double-quoted string with an extra backslash as an escape character:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="s2">&quot;HKCU</span><span class="se">\\</span><span class="s2">SOFTWARE</span><span class="se">\\</span><span class="s2">path</span><span class="se">\\</span><span class="s2">to</span><span class="se">\\</span><span class="s2">key</span><span class="se">\\</span><span class="s2">Themes&quot;</span>
</pre></div>
</div>
</div>
<div class="section" id="recipe-dsl-methods">
<h4>Recipe DSL Methods<a class="headerlink" href="#recipe-dsl-methods" title="Permalink to this headline">¶</a></h4>
<p>Six methods are present in the Recipe DSL to help verify the registry during a chef-client run on the Microsoft Windows platform&#8212;<tt class="docutils literal"><span class="pre">registry_data_exists?</span></tt>, <tt class="docutils literal"><span class="pre">registry_get_subkeys</span></tt>, <tt class="docutils literal"><span class="pre">registry_get_values</span></tt>, <tt class="docutils literal"><span class="pre">registry_has_subkeys?</span></tt>, <tt class="docutils literal"><span class="pre">registry_key_exists?</span></tt>, and <tt class="docutils literal"><span class="pre">registry_value_exists?</span></tt>&#8212;these helpers ensure the <strong>powershell_script</strong> resource is idempotent.</p>
<p>The recommended order in which registry key-specific methods should be used within a recipe is: <tt class="docutils literal"><span class="pre">key_exists?</span></tt>, <tt class="docutils literal"><span class="pre">value_exists?</span></tt>, <tt class="docutils literal"><span class="pre">data_exists?</span></tt>, <tt class="docutils literal"><span class="pre">get_values</span></tt>, <tt class="docutils literal"><span class="pre">has_subkeys?</span></tt>, and then <tt class="docutils literal"><span class="pre">get_subkeys</span></tt>.</p>
<div class="section" id="registry-data-exists">
<h5>registry_data_exists?<a class="headerlink" href="#registry-data-exists" title="Permalink to this headline">¶</a></h5>
<p>Use the <tt class="docutils literal"><span class="pre">registry_data_exists?</span></tt> method to find out if a Microsoft Windows registry key contains the specified data of the specified type under the value.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method can be used in recipes and from within the <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource.</p>
</div>
<p>The syntax for the <tt class="docutils literal"><span class="pre">registry_data_exists?</span></tt> method is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_data_exists?</span><span class="p">(</span>
  <span class="no">KEY_PATH</span><span class="p">,</span>
  <span class="p">{</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;NAME&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="no">TYPE</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="no">DATA</span> <span class="p">},</span>
  <span class="no">ARCHITECTURE</span>
<span class="p">)</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">KEY_PATH</span></tt> is the path to the registry key value. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <tt class="docutils literal"><span class="pre">HKLM\SECURITY</span></tt> and <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE\SECURITY</span></tt> are both valid and equivalent. The following hives are valid: <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE</span></tt>, <tt class="docutils literal"><span class="pre">HKLM</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_CONFIG</span></tt>, <tt class="docutils literal"><span class="pre">HKCC</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CLASSES_ROOT</span></tt>, <tt class="docutils literal"><span class="pre">HKCR</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_USERS</span></tt>, <tt class="docutils literal"><span class="pre">HKU</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_USER</span></tt>, and <tt class="docutils literal"><span class="pre">HKCU</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">{</span> <span class="pre">:name</span> <span class="pre">=&gt;</span> <span class="pre">'NAME',</span> <span class="pre">:type</span> <span class="pre">=&gt;</span> <span class="pre">TYPE,</span> <span class="pre">:data</span> <span class="pre">=&gt;</span> <span class="pre">DATA</span> <span class="pre">}</span></tt> is a hash that contains the expected name, type, and data of the registry key value</li>
<li><tt class="docutils literal"><span class="pre">:type</span></tt> represents the values available for registry keys in Microsoft Windows. Use <tt class="docutils literal"><span class="pre">:binary</span></tt> for REG_BINARY, <tt class="docutils literal"><span class="pre">:string</span></tt> for REG_SZ, <tt class="docutils literal"><span class="pre">:multi_string</span></tt> for REG_MULTI_SZ, <tt class="docutils literal"><span class="pre">:expand_string</span></tt> for REG_EXPAND_SZ, <tt class="docutils literal"><span class="pre">:dword</span></tt> for REG_DWORD, <tt class="docutils literal"><span class="pre">:dword_big_endian</span></tt> for REG_DWORD_BIG_ENDIAN, or <tt class="docutils literal"><span class="pre">:qword</span></tt> for REG_QWORD.</li>
<li><tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> is one of the following values: <tt class="docutils literal"><span class="pre">:x86_64</span></tt>, <tt class="docutils literal"><span class="pre">:i386</span></tt>, or <tt class="docutils literal"><span class="pre">:machine</span></tt>. In order to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows, the <tt class="docutils literal"><span class="pre">architecture</span></tt> property must be set to <tt class="docutils literal"><span class="pre">:i386</span></tt>. The <tt class="docutils literal"><span class="pre">:x86_64</span></tt> value can be used to force writing to a 64-bit registry location, but this value is less useful than the default (<tt class="docutils literal"><span class="pre">:machine</span></tt>) because the chef-client returns an exception if <tt class="docutils literal"><span class="pre">:x86_64</span></tt> is used and the machine turns out to be a 32-bit machine (whereas with <tt class="docutils literal"><span class="pre">:machine</span></tt>, the chef-client is able to access the registry key on the 32-bit machine).</li>
</ul>
<p>This method will return <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> attribute should only specify <tt class="docutils literal"><span class="pre">:x86_64</span></tt> or <tt class="docutils literal"><span class="pre">:i386</span></tt> when it is necessary to write 32-bit (<tt class="docutils literal"><span class="pre">:i386</span></tt>) or 64-bit (<tt class="docutils literal"><span class="pre">:x86_64</span></tt>) values on a 64-bit machine. <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> will default to <tt class="docutils literal"><span class="pre">:machine</span></tt> unless a specific value is given.</p>
</div>
</div>
<div class="section" id="registry-get-subkeys">
<h5>registry_get_subkeys<a class="headerlink" href="#registry-get-subkeys" title="Permalink to this headline">¶</a></h5>
<p>Use the <tt class="docutils literal"><span class="pre">registry_get_subkeys</span></tt> method to get a list of registry key values that are present for a Microsoft Windows registry key.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method can be used in recipes and from within the <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource.</p>
</div>
<p>The syntax for the <tt class="docutils literal"><span class="pre">registry_get_subkeys</span></tt> method is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subkey_array</span> <span class="o">=</span> <span class="n">registry_get_subkeys</span><span class="p">(</span><span class="no">KEY_PATH</span><span class="p">,</span> <span class="no">ARCHITECTURE</span><span class="p">)</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">KEY_PATH</span></tt> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <tt class="docutils literal"><span class="pre">HKLM\SECURITY</span></tt> and <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE\SECURITY</span></tt> are both valid and equivalent. The following hives are valid: <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE</span></tt>, <tt class="docutils literal"><span class="pre">HKLM</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_CONFIG</span></tt>, <tt class="docutils literal"><span class="pre">HKCC</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CLASSES_ROOT</span></tt>, <tt class="docutils literal"><span class="pre">HKCR</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_USERS</span></tt>, <tt class="docutils literal"><span class="pre">HKU</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_USER</span></tt>, and <tt class="docutils literal"><span class="pre">HKCU</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> is one of the following values: <tt class="docutils literal"><span class="pre">:x86_64</span></tt>, <tt class="docutils literal"><span class="pre">:i386</span></tt>, or <tt class="docutils literal"><span class="pre">:machine</span></tt>. In order to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows, the <tt class="docutils literal"><span class="pre">architecture</span></tt> property must be set to <tt class="docutils literal"><span class="pre">:i386</span></tt>. The <tt class="docutils literal"><span class="pre">:x86_64</span></tt> value can be used to force writing to a 64-bit registry location, but this value is less useful than the default (<tt class="docutils literal"><span class="pre">:machine</span></tt>) because the chef-client returns an exception if <tt class="docutils literal"><span class="pre">:x86_64</span></tt> is used and the machine turns out to be a 32-bit machine (whereas with <tt class="docutils literal"><span class="pre">:machine</span></tt>, the chef-client is able to access the registry key on the 32-bit machine).</li>
</ul>
<p>This returns an array of registry key values.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> attribute should only specify <tt class="docutils literal"><span class="pre">:x86_64</span></tt> or <tt class="docutils literal"><span class="pre">:i386</span></tt> when it is necessary to write 32-bit (<tt class="docutils literal"><span class="pre">:i386</span></tt>) or 64-bit (<tt class="docutils literal"><span class="pre">:x86_64</span></tt>) values on a 64-bit machine. <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> will default to <tt class="docutils literal"><span class="pre">:machine</span></tt> unless a specific value is given.</p>
</div>
</div>
<div class="section" id="registry-get-values">
<h5>registry_get_values<a class="headerlink" href="#registry-get-values" title="Permalink to this headline">¶</a></h5>
<p>Use the <tt class="docutils literal"><span class="pre">registry_get_values</span></tt> method to get the registry key values (name, type, and data) for a Microsoft Windows registry key.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method can be used in recipes and from within the <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource.</p>
</div>
<p>The syntax for the <tt class="docutils literal"><span class="pre">registry_get_values</span></tt> method is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subkey_array</span> <span class="o">=</span> <span class="n">registry_get_values</span><span class="p">(</span><span class="no">KEY_PATH</span><span class="p">,</span> <span class="no">ARCHITECTURE</span><span class="p">)</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">KEY_PATH</span></tt> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <tt class="docutils literal"><span class="pre">HKLM\SECURITY</span></tt> and <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE\SECURITY</span></tt> are both valid and equivalent. The following hives are valid: <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE</span></tt>, <tt class="docutils literal"><span class="pre">HKLM</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_CONFIG</span></tt>, <tt class="docutils literal"><span class="pre">HKCC</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CLASSES_ROOT</span></tt>, <tt class="docutils literal"><span class="pre">HKCR</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_USERS</span></tt>, <tt class="docutils literal"><span class="pre">HKU</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_USER</span></tt>, and <tt class="docutils literal"><span class="pre">HKCU</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> is one of the following values: <tt class="docutils literal"><span class="pre">:x86_64</span></tt>, <tt class="docutils literal"><span class="pre">:i386</span></tt>, or <tt class="docutils literal"><span class="pre">:machine</span></tt>. In order to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows, the <tt class="docutils literal"><span class="pre">architecture</span></tt> property must be set to <tt class="docutils literal"><span class="pre">:i386</span></tt>. The <tt class="docutils literal"><span class="pre">:x86_64</span></tt> value can be used to force writing to a 64-bit registry location, but this value is less useful than the default (<tt class="docutils literal"><span class="pre">:machine</span></tt>) because the chef-client returns an exception if <tt class="docutils literal"><span class="pre">:x86_64</span></tt> is used and the machine turns out to be a 32-bit machine (whereas with <tt class="docutils literal"><span class="pre">:machine</span></tt>, the chef-client is able to access the registry key on the 32-bit machine).</li>
</ul>
<p>This returns an array of registry key values.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> attribute should only specify <tt class="docutils literal"><span class="pre">:x86_64</span></tt> or <tt class="docutils literal"><span class="pre">:i386</span></tt> when it is necessary to write 32-bit (<tt class="docutils literal"><span class="pre">:i386</span></tt>) or 64-bit (<tt class="docutils literal"><span class="pre">:x86_64</span></tt>) values on a 64-bit machine. <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> will default to <tt class="docutils literal"><span class="pre">:machine</span></tt> unless a specific value is given.</p>
</div>
</div>
<div class="section" id="registry-has-subkeys">
<h5>registry_has_subkeys?<a class="headerlink" href="#registry-has-subkeys" title="Permalink to this headline">¶</a></h5>
<p>Use the <tt class="docutils literal"><span class="pre">registry_has_subkeys?</span></tt> method to find out if a Microsoft Windows registry key has one (or more) values.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method can be used in recipes and from within the <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource.</p>
</div>
<p>The syntax for the <tt class="docutils literal"><span class="pre">registry_has_subkeys?</span></tt> method is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_has_subkeys?</span><span class="p">(</span><span class="no">KEY_PATH</span><span class="p">,</span> <span class="no">ARCHITECTURE</span><span class="p">)</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">KEY_PATH</span></tt> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <tt class="docutils literal"><span class="pre">HKLM\SECURITY</span></tt> and <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE\SECURITY</span></tt> are both valid and equivalent. The following hives are valid: <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE</span></tt>, <tt class="docutils literal"><span class="pre">HKLM</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_CONFIG</span></tt>, <tt class="docutils literal"><span class="pre">HKCC</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CLASSES_ROOT</span></tt>, <tt class="docutils literal"><span class="pre">HKCR</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_USERS</span></tt>, <tt class="docutils literal"><span class="pre">HKU</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_USER</span></tt>, and <tt class="docutils literal"><span class="pre">HKCU</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> is one of the following values: <tt class="docutils literal"><span class="pre">:x86_64</span></tt>, <tt class="docutils literal"><span class="pre">:i386</span></tt>, or <tt class="docutils literal"><span class="pre">:machine</span></tt>. In order to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows, the <tt class="docutils literal"><span class="pre">architecture</span></tt> property must be set to <tt class="docutils literal"><span class="pre">:i386</span></tt>. The <tt class="docutils literal"><span class="pre">:x86_64</span></tt> value can be used to force writing to a 64-bit registry location, but this value is less useful than the default (<tt class="docutils literal"><span class="pre">:machine</span></tt>) because the chef-client returns an exception if <tt class="docutils literal"><span class="pre">:x86_64</span></tt> is used and the machine turns out to be a 32-bit machine (whereas with <tt class="docutils literal"><span class="pre">:machine</span></tt>, the chef-client is able to access the registry key on the 32-bit machine).</li>
</ul>
<p>This method will return <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> attribute should only specify <tt class="docutils literal"><span class="pre">:x86_64</span></tt> or <tt class="docutils literal"><span class="pre">:i386</span></tt> when it is necessary to write 32-bit (<tt class="docutils literal"><span class="pre">:i386</span></tt>) or 64-bit (<tt class="docutils literal"><span class="pre">:x86_64</span></tt>) values on a 64-bit machine. <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> will default to <tt class="docutils literal"><span class="pre">:machine</span></tt> unless a specific value is given.</p>
</div>
</div>
<div class="section" id="registry-key-exists">
<h5>registry_key_exists?<a class="headerlink" href="#registry-key-exists" title="Permalink to this headline">¶</a></h5>
<p>Use the <tt class="docutils literal"><span class="pre">registry_key_exists?</span></tt> method to find out if a Microsoft Windows registry key exists at the specified path.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method can be used in recipes and from within the <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource.</p>
</div>
<p>The syntax for the <tt class="docutils literal"><span class="pre">registry_key_exists?</span></tt> method is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key_exists?</span><span class="p">(</span><span class="no">KEY_PATH</span><span class="p">,</span> <span class="no">ARCHITECTURE</span><span class="p">)</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">KEY_PATH</span></tt> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <tt class="docutils literal"><span class="pre">HKLM\SECURITY</span></tt> and <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE\SECURITY</span></tt> are both valid and equivalent. The following hives are valid: <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE</span></tt>, <tt class="docutils literal"><span class="pre">HKLM</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_CONFIG</span></tt>, <tt class="docutils literal"><span class="pre">HKCC</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CLASSES_ROOT</span></tt>, <tt class="docutils literal"><span class="pre">HKCR</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_USERS</span></tt>, <tt class="docutils literal"><span class="pre">HKU</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_USER</span></tt>, and <tt class="docutils literal"><span class="pre">HKCU</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> is one of the following values: <tt class="docutils literal"><span class="pre">:x86_64</span></tt>, <tt class="docutils literal"><span class="pre">:i386</span></tt>, or <tt class="docutils literal"><span class="pre">:machine</span></tt>. In order to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows, the <tt class="docutils literal"><span class="pre">architecture</span></tt> property must be set to <tt class="docutils literal"><span class="pre">:i386</span></tt>. The <tt class="docutils literal"><span class="pre">:x86_64</span></tt> value can be used to force writing to a 64-bit registry location, but this value is less useful than the default (<tt class="docutils literal"><span class="pre">:machine</span></tt>) because the chef-client returns an exception if <tt class="docutils literal"><span class="pre">:x86_64</span></tt> is used and the machine turns out to be a 32-bit machine (whereas with <tt class="docutils literal"><span class="pre">:machine</span></tt>, the chef-client is able to access the registry key on the 32-bit machine).</li>
</ul>
<p>This method will return <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. (Any registry key values that are associated with this registry key are ignored.)</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> attribute should only specify <tt class="docutils literal"><span class="pre">:x86_64</span></tt> or <tt class="docutils literal"><span class="pre">:i386</span></tt> when it is necessary to write 32-bit (<tt class="docutils literal"><span class="pre">:i386</span></tt>) or 64-bit (<tt class="docutils literal"><span class="pre">:x86_64</span></tt>) values on a 64-bit machine. <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> will default to <tt class="docutils literal"><span class="pre">:machine</span></tt> unless a specific value is given.</p>
</div>
</div>
<div class="section" id="registry-value-exists">
<h5>registry_value_exists?<a class="headerlink" href="#registry-value-exists" title="Permalink to this headline">¶</a></h5>
<p>Use the <tt class="docutils literal"><span class="pre">registry_value_exists?</span></tt> method to find out if a registry key value exists. Use <tt class="docutils literal"><span class="pre">registry_data_exists?</span></tt> to test for the type and data of a registry key value.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This method can be used in recipes and from within the <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> blocks in resources. This method is not designed to create or modify a registry key. If a registry key needs to be modified, use the <strong>registry_key</strong> resource.</p>
</div>
<p>The syntax for the <tt class="docutils literal"><span class="pre">registry_value_exists?</span></tt> method is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_value_exists?</span><span class="p">(</span>
  <span class="no">KEY_PATH</span><span class="p">,</span>
  <span class="p">{</span> <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;NAME&#39;</span> <span class="p">},</span>
  <span class="no">ARCHITECTURE</span>
<span class="p">)</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">KEY_PATH</span></tt> is the path to the registry key. The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <tt class="docutils literal"><span class="pre">HKLM\SECURITY</span></tt> and <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE\SECURITY</span></tt> are both valid and equivalent. The following hives are valid: <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE</span></tt>, <tt class="docutils literal"><span class="pre">HKLM</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_CONFIG</span></tt>, <tt class="docutils literal"><span class="pre">HKCC</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CLASSES_ROOT</span></tt>, <tt class="docutils literal"><span class="pre">HKCR</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_USERS</span></tt>, <tt class="docutils literal"><span class="pre">HKU</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_USER</span></tt>, and <tt class="docutils literal"><span class="pre">HKCU</span></tt>.</li>
<li><tt class="docutils literal"><span class="pre">{</span> <span class="pre">:name</span> <span class="pre">=&gt;</span> <span class="pre">'NAME'</span> <span class="pre">}</span></tt> is a hash that contains the name of the registry key value; if either <tt class="docutils literal"><span class="pre">:type</span></tt> or <tt class="docutils literal"><span class="pre">:value</span></tt> are specified in the hash, they are ignored</li>
<li><tt class="docutils literal"><span class="pre">:type</span></tt> represents the values available for registry keys in Microsoft Windows. Use <tt class="docutils literal"><span class="pre">:binary</span></tt> for REG_BINARY, <tt class="docutils literal"><span class="pre">:string</span></tt> for REG_SZ, <tt class="docutils literal"><span class="pre">:multi_string</span></tt> for REG_MULTI_SZ, <tt class="docutils literal"><span class="pre">:expand_string</span></tt> for REG_EXPAND_SZ, <tt class="docutils literal"><span class="pre">:dword</span></tt> for REG_DWORD, <tt class="docutils literal"><span class="pre">:dword_big_endian</span></tt> for REG_DWORD_BIG_ENDIAN, or <tt class="docutils literal"><span class="pre">:qword</span></tt> for REG_QWORD.</li>
<li><tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> is one of the following values: <tt class="docutils literal"><span class="pre">:x86_64</span></tt>, <tt class="docutils literal"><span class="pre">:i386</span></tt>, or <tt class="docutils literal"><span class="pre">:machine</span></tt>. In order to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows, the <tt class="docutils literal"><span class="pre">architecture</span></tt> property must be set to <tt class="docutils literal"><span class="pre">:i386</span></tt>. The <tt class="docutils literal"><span class="pre">:x86_64</span></tt> value can be used to force writing to a 64-bit registry location, but this value is less useful than the default (<tt class="docutils literal"><span class="pre">:machine</span></tt>) because the chef-client returns an exception if <tt class="docutils literal"><span class="pre">:x86_64</span></tt> is used and the machine turns out to be a 32-bit machine (whereas with <tt class="docutils literal"><span class="pre">:machine</span></tt>, the chef-client is able to access the registry key on the 32-bit machine).</li>
</ul>
<p>This method will return <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> attribute should only specify <tt class="docutils literal"><span class="pre">:x86_64</span></tt> or <tt class="docutils literal"><span class="pre">:i386</span></tt> when it is necessary to write 32-bit (<tt class="docutils literal"><span class="pre">:i386</span></tt>) or 64-bit (<tt class="docutils literal"><span class="pre">:x86_64</span></tt>) values on a 64-bit machine. <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> will default to <tt class="docutils literal"><span class="pre">:machine</span></tt> unless a specific value is given.</p>
</div>
</div>
</div>
</div>
<div class="section" id="id243">
<h3>Actions<a class="headerlink" href="#id243" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>Default. Create a registry key. If a registry key already exists (but does not match), update that registry key to match.</dd>
<dt><tt class="docutils literal"><span class="pre">:create_if_missing</span></tt></dt>
<dd>Create a registry key if it does not exist. Also, create a registry key value if it does not exist.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Delete the specified values for a registry key.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete_key</span></tt></dt>
<dd>Delete the specified registry key and all of its subkeys.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be careful when using the <tt class="docutils literal"><span class="pre">:delete_key</span></tt> action with the <tt class="docutils literal"><span class="pre">recursive</span></tt> attribute. This will delete the registry key, all of its values and all of the names, types, and data associated with them. This cannot be undone by the chef-client.</p>
</div>
</div>
<div class="section" id="id244">
<h3>Properties<a class="headerlink" href="#id244" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">architecture</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol</p>
<p>The architecture of the node for which keys are to be created or deleted. Possible values: <tt class="docutils literal"><span class="pre">:i386</span></tt> (for nodes with a 32-bit registry), <tt class="docutils literal"><span class="pre">:x86_64</span></tt> (for nodes with a 64-bit registry), and <tt class="docutils literal"><span class="pre">:machine</span></tt> (to have the chef-client determine the architecture during the chef-client run). Default value: <tt class="docutils literal"><span class="pre">:machine</span></tt>.</p>
<p>In order to read or write 32-bit registry keys on 64-bit machines running Microsoft Windows, the <tt class="docutils literal"><span class="pre">architecture</span></tt> property must be set to <tt class="docutils literal"><span class="pre">:i386</span></tt>. The <tt class="docutils literal"><span class="pre">:x86_64</span></tt> value can be used to force writing to a 64-bit registry location, but this value is less useful than the default (<tt class="docutils literal"><span class="pre">:machine</span></tt>) because the chef-client returns an exception if <tt class="docutils literal"><span class="pre">:x86_64</span></tt> is used and the machine turns out to be a 32-bit machine (whereas with <tt class="docutils literal"><span class="pre">:machine</span></tt>, the chef-client is able to access the registry key on the 32-bit machine).</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> attribute should only specify <tt class="docutils literal"><span class="pre">:x86_64</span></tt> or <tt class="docutils literal"><span class="pre">:i386</span></tt> when it is necessary to write 32-bit (<tt class="docutils literal"><span class="pre">:i386</span></tt>) or 64-bit (<tt class="docutils literal"><span class="pre">:x86_64</span></tt>) values on a 64-bit machine. <tt class="docutils literal"><span class="pre">ARCHITECTURE</span></tt> will default to <tt class="docutils literal"><span class="pre">:machine</span></tt> unless a specific value is given.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">key</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The path to the location in which a registry key is to be created or from which a registry key is to be deleted. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.
The path must include the registry hive, which can be specified either as its full name or as the 3- or 4-letter abbreviation. For example, both <tt class="docutils literal"><span class="pre">HKLM\SECURITY</span></tt> and <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE\SECURITY</span></tt> are both valid and equivalent. The following hives are valid: <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE</span></tt>, <tt class="docutils literal"><span class="pre">HKLM</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_CONFIG</span></tt>, <tt class="docutils literal"><span class="pre">HKCC</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CLASSES_ROOT</span></tt>, <tt class="docutils literal"><span class="pre">HKCR</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_USERS</span></tt>, <tt class="docutils literal"><span class="pre">HKU</span></tt>, <tt class="docutils literal"><span class="pre">HKEY_CURRENT_USER</span></tt>, and <tt class="docutils literal"><span class="pre">HKCU</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">recursive</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p>When creating a key, this value specifies that the required keys for the specified path are to be created. When using the <tt class="docutils literal"><span class="pre">:delete_key</span></tt> action in a recipe, and if the registry key has subkeys, then set the value for this property to <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be careful when using the <tt class="docutils literal"><span class="pre">:delete_key</span></tt> action with the <tt class="docutils literal"><span class="pre">recursive</span></tt> attribute. This will delete the registry key, all of its values and all of the names, types, and data associated with them. This cannot be undone by the chef-client.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">values</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Hash, Array</p>
<p>An array of hashes, where each Hash contains the values that are to be set under a registry key. Each Hash must contain <tt class="docutils literal"><span class="pre">:name</span></tt>, <tt class="docutils literal"><span class="pre">:type</span></tt>, and <tt class="docutils literal"><span class="pre">:data</span></tt> (and must contain no other key values).</p>
<p><tt class="docutils literal"><span class="pre">:type</span></tt> represents the values available for registry keys in Microsoft Windows. Use <tt class="docutils literal"><span class="pre">:binary</span></tt> for REG_BINARY, <tt class="docutils literal"><span class="pre">:string</span></tt> for REG_SZ, <tt class="docutils literal"><span class="pre">:multi_string</span></tt> for REG_MULTI_SZ, <tt class="docutils literal"><span class="pre">:expand_string</span></tt> for REG_EXPAND_SZ, <tt class="docutils literal"><span class="pre">:dword</span></tt> for REG_DWORD, <tt class="docutils literal"><span class="pre">:dword_big_endian</span></tt> for REG_DWORD_BIG_ENDIAN, or <tt class="docutils literal"><span class="pre">:qword</span></tt> for REG_QWORD.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><tt class="docutils literal"><span class="pre">:multi_string</span></tt> must be an array, even if there is only a single string.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="id245">
<h3>Examples<a class="headerlink" href="#id245" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Create a registry key</strong></p>
<p>Use a double-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s2">&quot;HKEY_LOCAL_MACHINE</span><span class="se">\\</span><span class="s2">path-to-key</span><span class="se">\\</span><span class="s2">Policies</span><span class="se">\\</span><span class="s2">System&quot;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span>
    <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;EnableLUA&#39;</span><span class="p">,</span>
    <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:dword</span><span class="p">,</span>
    <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="mi">0</span>
  <span class="p">}</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or a single-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s1">&#39;HKEY_LOCAL_MACHINE\path-to-key\Policies\System&#39;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span>
    <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;EnableLUA&#39;</span><span class="p">,</span>
    <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:dword</span><span class="p">,</span>
    <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="mi">0</span>
  <span class="p">}</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delete a registry key value</strong></p>
<p>Use a double-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s2">&quot;HKEY_LOCAL_MACHINE</span><span class="se">\\</span><span class="s2">SOFTWARE</span><span class="se">\\</span><span class="s2">path</span><span class="se">\\</span><span class="s2">to</span><span class="se">\\</span><span class="s2">key</span><span class="se">\\</span><span class="s2">AU&quot;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span>
    <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;NoAutoRebootWithLoggedOnUsers&#39;</span><span class="p">,</span>
    <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:dword</span><span class="p">,</span>
    <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:delete</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or a single-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s1">&#39;HKEY_LOCAL_MACHINE\SOFTWARE\path\to\key\AU&#39;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span>
    <span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;NoAutoRebootWithLoggedOnUsers&#39;</span><span class="p">,</span>
    <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:dword</span><span class="p">,</span>
    <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span>
    <span class="p">}</span><span class="o">]</span>
  <span class="n">action</span> <span class="ss">:delete</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If <tt class="docutils literal"><span class="pre">:data</span></tt> is not specified, you get an error: <tt class="docutils literal"><span class="pre">Missing</span> <span class="pre">data</span> <span class="pre">key</span> <span class="pre">in</span> <span class="pre">RegistryKey</span> <span class="pre">values</span> <span class="pre">hash</span></tt></p>
</div>
<p><strong>Delete a registry key and its subkeys, recursively</strong></p>
<p>Use a double-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s2">&quot;HKCU</span><span class="se">\\</span><span class="s2">SOFTWARE</span><span class="se">\\</span><span class="s2">Policies</span><span class="se">\\</span><span class="s2">path</span><span class="se">\\</span><span class="s2">to</span><span class="se">\\</span><span class="s2">key</span><span class="se">\\</span><span class="s2">Themes&quot;</span> <span class="k">do</span>
  <span class="n">recursive</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:delete_key</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or a single-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s1">&#39;HKCU\SOFTWARE\Policies\path\to\key\Themes&#39;</span> <span class="k">do</span>
  <span class="n">recursive</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:delete_key</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be careful when using the <tt class="docutils literal"><span class="pre">:delete_key</span></tt> action with the <tt class="docutils literal"><span class="pre">recursive</span></tt> attribute. This will delete the registry key, all of its values and all of the names, types, and data associated with them. This cannot be undone by the chef-client.</p>
</div>
<p><strong>Use re-directed keys</strong></p>
<p>In 64-bit versions of Microsoft Windows, <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE\SOFTWARE\Example</span></tt> is a re-directed key. In the following examples, because <tt class="docutils literal"><span class="pre">HKEY_LOCAL_MACHINE\SOFTWARE\Example</span></tt> is a 32-bit key, the output will be &#8220;Found 32-bit key&#8221; if they are run on a version of Microsoft Windows that is 64-bit:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s2">&quot;HKEY_LOCAL_MACHINE</span><span class="se">\\</span><span class="s2">SOFTWARE</span><span class="se">\\</span><span class="s2">Example&quot;</span> <span class="k">do</span>
  <span class="n">architecture</span> <span class="ss">:i386</span>
  <span class="n">recursive</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s2">&quot;HKEY_LOCAL_MACHINE</span><span class="se">\\</span><span class="s2">SOFTWARE</span><span class="se">\\</span><span class="s2">Example&quot;</span> <span class="k">do</span>
  <span class="n">architecture</span> <span class="ss">:x86_64</span>
  <span class="n">recursive</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:delete_key</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ruby_block</span> <span class="s1">&#39;check 32-bit&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s1">&#39;Found 32-bit key&#39;</span>
  <span class="k">end</span>
  <span class="n">only_if</span> <span class="p">{</span>
    <span class="n">registry_key_exists?</span><span class="p">(</span><span class="s2">&quot;HKEY_LOCAL_MACHINE\SOFTWARE</span><span class="se">\\</span><span class="s2">Example&quot;</span><span class="p">,</span>
    <span class="ss">:i386</span><span class="p">)</span>
  <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ruby_block</span> <span class="s1">&#39;check 64-bit&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="nb">puts</span> <span class="s1">&#39;Found 64-bit key&#39;</span>
  <span class="k">end</span>
  <span class="n">only_if</span> <span class="p">{</span>
    <span class="n">registry_key_exists?</span><span class="p">(</span><span class="s2">&quot;HKEY_LOCAL_MACHINE</span><span class="se">\\</span><span class="s2">SOFTWARE</span><span class="se">\\</span><span class="s2">Example&quot;</span><span class="p">,</span>
    <span class="ss">:x86_64</span><span class="p">)</span>
  <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set proxy settings to be the same as those used by the chef-client</strong></p>
<p>Use a double-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">proxy</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:http_proxy</span><span class="o">]</span><span class="p">)</span>
<span class="n">registry_key</span> <span class="s2">&quot;HKCU\Software\Microsoft\path</span><span class="se">\t</span><span class="s2">o\key\Internet Settings&quot;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;ProxyEnable&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:reg_dword</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">},</span>
          <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;ProxyServer&#39;</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">proxy</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">proxy</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;ProxyOverride&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:reg_string</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="n">local</span><span class="o">&gt;</span><span class="p">},</span>
         <span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or a single-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">proxy</span> <span class="o">=</span> <span class="no">URI</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:http_proxy</span><span class="o">]</span><span class="p">)</span>
<span class="n">registry_key</span> <span class="s1">&#39;HKCU\Software\Microsoft\path\to\key\Internet Settings&#39;</span> <span class="k">do</span>
  <span class="n">values</span> <span class="o">[</span><span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;ProxyEnable&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:reg_dword</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">},</span>
          <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;ProxyServer&#39;</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">proxy</span><span class="o">.</span><span class="n">host</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">proxy</span><span class="o">.</span><span class="n">port</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">},</span>
          <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;ProxyOverride&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:reg_string</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="o">&lt;</span><span class="n">local</span><span class="o">&gt;</span><span class="p">},</span>
         <span class="o">]</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set the name of a registry key to &#8220;(Default)&#8221;</strong></p>
<p>Use a double-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s1">&#39;Set (Default) value&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:create</span>
  <span class="n">key</span> <span class="s2">&quot;HKLM</span><span class="se">\\</span><span class="s2">Software</span><span class="se">\\</span><span class="s2">Test</span><span class="se">\\</span><span class="s2">Key</span><span class="se">\\</span><span class="s2">Path&quot;</span>
  <span class="n">values</span> <span class="o">[</span>
    <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:string</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="s1">&#39;test&#39;</span><span class="p">},</span>
  <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or a single-quoted string:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">registry_key</span> <span class="s1">&#39;Set (Default) value&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:create</span>
  <span class="n">key</span> <span class="s1">&#39;HKLM\Software\Test\Key\Path&#39;</span>
  <span class="n">values</span> <span class="o">[</span>
    <span class="p">{</span><span class="ss">:name</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="ss">:type</span> <span class="o">=&gt;</span> <span class="ss">:string</span><span class="p">,</span> <span class="ss">:data</span> <span class="o">=&gt;</span> <span class="s1">&#39;test&#39;</span><span class="p">},</span>
  <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">:name</span> <span class="pre">=&gt;</span> <span class="pre">''</span></tt> contains an empty string, which will set the name of the registry key to <tt class="docutils literal"><span class="pre">(Default)</span></tt>.</p>
</div>
</div>
<div class="section" id="remote-directory">
<h2>remote_directory<a class="headerlink" href="#remote-directory" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_remote_directory.rst">[edit on GitHub]</a></p>
<p>Use the <strong>remote_directory</strong> resource to incrementally transfer a directory from a cookbook to a node. The directory that is copied from the cookbook should be located under <tt class="docutils literal"><span class="pre">COOKBOOK_NAME/files/default/REMOTE_DIRECTORY</span></tt>. The <strong>remote_directory</strong> resource will obey file specificity.</p>
<div class="section" id="id246">
<h3>Syntax<a class="headerlink" href="#id246" title="Permalink to this headline">¶</a></h3>
<p>A <strong>remote_directory</strong> resource block transfers a directory from a cookbook to a node, and then assigns the permissions needed on that directory. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_directory</span> <span class="s1">&#39;/etc/apache2&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;apache2&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">'/etc/apache2'</span></tt> specifies the directory</li>
<li><tt class="docutils literal"><span class="pre">source</span></tt> specifies a directory in the current cookbook (use the <tt class="docutils literal"><span class="pre">cookbook</span></tt> property to specify a file that is in a different cookbook)</li>
<li><tt class="docutils literal"><span class="pre">owner</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, and <tt class="docutils literal"><span class="pre">mode</span></tt> define the permissions</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>remote_directory</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_directory</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">cookbook</span>                   <span class="nb">String</span>
  <span class="n">files_backup</span>               <span class="nb">Integer</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">files_group</span>                <span class="nb">String</span>
  <span class="n">files_mode</span>                 <span class="nb">String</span>
  <span class="n">files_owner</span>                <span class="nb">String</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">inherits</span>                   <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">mode</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">overwrite</span>                  <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">owner</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">path</span>                       <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Directory</span><span class="o">::</span><span class="no">RemoteDirectory</span>
  <span class="n">purge</span>                      <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">recursive</span>                  <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">rights</span>                     <span class="no">Hash</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">remote_directory</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block; when the <tt class="docutils literal"><span class="pre">path</span></tt> property is not specified, <tt class="docutils literal"><span class="pre">name</span></tt> is also the path to the directory, from the root</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">cookbook</span></tt>, <tt class="docutils literal"><span class="pre">files_backup</span></tt>, <tt class="docutils literal"><span class="pre">files_group</span></tt>, <tt class="docutils literal"><span class="pre">files_mode</span></tt>, <tt class="docutils literal"><span class="pre">files_owner</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">inherits</span></tt>, <tt class="docutils literal"><span class="pre">mode</span></tt>, <tt class="docutils literal"><span class="pre">overwrite</span></tt>, <tt class="docutils literal"><span class="pre">owner</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">recursive</span></tt>, <tt class="docutils literal"><span class="pre">rights</span></tt>, and <tt class="docutils literal"><span class="pre">source</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id247">
<h3>Actions<a class="headerlink" href="#id247" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>Default. Create a directory and/or the contents of that directory. If a directory or its contents already exist (but does not match), update that directory or its contents to match.</dd>
<dt><tt class="docutils literal"><span class="pre">:create_if_missing</span></tt></dt>
<dd>Create a directory and/or the contents of that directory, but only if it does not exist.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Delete a directory, including the contents of that directory.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
</dl>
</div>
<div class="section" id="id248">
<h3>Properties<a class="headerlink" href="#id248" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">cookbook</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The cookbook in which a file is located (if it is not located in the current cookbook). The default value is the current cookbook.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">files_backup</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, FalseClass</p>
<p class="last">The number of backup copies to keep for files in the directory. Default value: <tt class="docutils literal"><span class="pre">5</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">files_group</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Configure group permissions for files. A string or ID that identifies the group owner by group name, including fully qualified group names such as <tt class="docutils literal"><span class="pre">domain\group</span></tt> or <tt class="docutils literal"><span class="pre">group&#64;domain</span></tt>. If this value is not specified, existing groups remain unchanged and new group assignments use the default <tt class="docutils literal"><span class="pre">POSIX</span></tt> group (if available).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">files_mode</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p>The octal mode for a file.</p>
<p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. If the value is specified as a quoted string, it works exactly as if the <tt class="docutils literal"><span class="pre">chmod</span></tt> command was passed. If the value is specified as an integer, prepend a zero (<tt class="docutils literal"><span class="pre">0</span></tt>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <tt class="docutils literal"><span class="pre">'0777'</span></tt> or <tt class="docutils literal"><span class="pre">'777'</span></tt>; for the same rights, plus the sticky bit, use <tt class="docutils literal"><span class="pre">01777</span></tt> or <tt class="docutils literal"><span class="pre">'1777'</span></tt>.</p>
<p class="last">Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. Values up to <tt class="docutils literal"><span class="pre">'0777'</span></tt> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <tt class="docutils literal"><span class="pre">4</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">2</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, and <tt class="docutils literal"><span class="pre">1</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>. This property cannot be used to set <tt class="docutils literal"><span class="pre">:full_control</span></tt>. This property has no effect if not specified, but when it and <tt class="docutils literal"><span class="pre">rights</span></tt> are both specified, the effects are cumulative.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">files_owner</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Configure owner permissions for files. A string or ID that identifies the group owner by user name, including fully qualified user names such as <tt class="docutils literal"><span class="pre">domain\user</span></tt> or <tt class="docutils literal"><span class="pre">user&#64;domain</span></tt>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">Use to configure permissions for directories. A string or ID that identifies the group owner by group name, including fully qualified group names such as <tt class="docutils literal"><span class="pre">domain\group</span></tt> or <tt class="docutils literal"><span class="pre">group&#64;domain</span></tt>. If this value is not specified, existing groups remain unchanged and new group assignments use the default <tt class="docutils literal"><span class="pre">POSIX</span></tt> group (if available).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">inherits</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Microsoft Windows only. Whether a file inherits rights from its parent directory. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">mode</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p>A quoted 3-5 character string that defines the octal mode. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified and if the directory already exists, the existing mode on the directory is used. If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified, the directory does not exist, and the <tt class="docutils literal"><span class="pre">:create</span></tt> action is specified, the chef-client assumes a mask value of <tt class="docutils literal"><span class="pre">'0777'</span></tt>, and then applies the umask for the system on which the directory is to be created to the <tt class="docutils literal"><span class="pre">mask</span></tt> value. For example, if the umask on a system is <tt class="docutils literal"><span class="pre">'022'</span></tt>, the chef-client uses the default value of <tt class="docutils literal"><span class="pre">'0755'</span></tt>.</p>
<p>The behavior is different depending on the platform.</p>
<p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. If the value is specified as a quoted string, it works exactly as if the <tt class="docutils literal"><span class="pre">chmod</span></tt> command was passed. If the value is specified as an integer, prepend a zero (<tt class="docutils literal"><span class="pre">0</span></tt>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <tt class="docutils literal"><span class="pre">'0777'</span></tt> or <tt class="docutils literal"><span class="pre">'777'</span></tt>; for the same rights, plus the sticky bit, use <tt class="docutils literal"><span class="pre">01777</span></tt> or <tt class="docutils literal"><span class="pre">'1777'</span></tt>.</p>
<p class="last">Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. Values up to <tt class="docutils literal"><span class="pre">'0777'</span></tt> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <tt class="docutils literal"><span class="pre">4</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">2</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, and <tt class="docutils literal"><span class="pre">1</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>. This property cannot be used to set <tt class="docutils literal"><span class="pre">:full_control</span></tt>. This property has no effect if not specified, but when it and <tt class="docutils literal"><span class="pre">rights</span></tt> are both specified, the effects are cumulative.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">overwrite</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Overwrite a file when it is different. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">owner</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">Use to configure permissions for directories. A string or ID that identifies the group owner by user name, including fully qualified user names such as <tt class="docutils literal"><span class="pre">domain\user</span></tt> or <tt class="docutils literal"><span class="pre">user&#64;domain</span></tt>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The path to the directory. Using a fully qualified path is recommended, but is not always required. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">purge</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Purge extra files found in the target directory. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">recursive</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Create or delete directories recursively. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>; the chef-client must be able to create the directory structure, including parent directories (if missing), as defined in <tt class="docutils literal"><span class="pre">COOKBOOK_NAME/files/default/REMOTE_DIRECTORY</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">rights</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">Microsoft Windows only. The permissions for users and groups in a Microsoft Windows environment. For example: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">&lt;permissions&gt;,</span> <span class="pre">&lt;principal&gt;,</span> <span class="pre">&lt;options&gt;</span></tt> where <tt class="docutils literal"><span class="pre">&lt;permissions&gt;</span></tt> specifies the rights granted to the principal, <tt class="docutils literal"><span class="pre">&lt;principal&gt;</span></tt> is the group or user name, and <tt class="docutils literal"><span class="pre">&lt;options&gt;</span></tt> is a Hash with one (or more) advanced rights options.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The base name of the source file (and inferred from the <tt class="docutils literal"><span class="pre">path</span></tt> property).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
</dl>
<div class="section" id="id249">
<h4>Recursive Directories<a class="headerlink" href="#id249" title="Permalink to this headline">¶</a></h4>
<p>The <strong>remote_directory</strong> resource can be used to recursively create the path outside of remote directory structures, but the permissions of those outside paths are not managed. This is because the <tt class="docutils literal"><span class="pre">recursive</span></tt> attribute only applies <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">mode</span></tt>, and <tt class="docutils literal"><span class="pre">owner</span></tt> attribute values to the remote directory itself and any inner directories the resource copies.</p>
<p>A directory structure:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>/foo
  /bar
    /baz
</pre></div>
</div>
<p>The following example shows a way create a file in the <tt class="docutils literal"><span class="pre">/baz</span></tt> directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_directory</span> <span class="s2">&quot;/foo/bar/baz&quot;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>But with this example, the <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">mode</span></tt>, and <tt class="docutils literal"><span class="pre">owner</span></tt> attribute values will only be applied to <tt class="docutils literal"><span class="pre">/baz</span></tt>. Which is fine, if that&#8217;s what you want. But most of the time, when the entire <tt class="docutils literal"><span class="pre">/foo/bar/baz</span></tt> directory structure is not there, you must be explicit about each directory. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="sx">%w[ /foo /foo/bar /foo/bar/baz ]</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
  <span class="n">remote_directory</span> <span class="n">path</span> <span class="k">do</span>
    <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
    <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
    <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This approach will create the correct hierarchy&#8212;<tt class="docutils literal"><span class="pre">/foo</span></tt>, then <tt class="docutils literal"><span class="pre">/bar</span></tt> in <tt class="docutils literal"><span class="pre">/foo</span></tt>, and then <tt class="docutils literal"><span class="pre">/baz</span></tt> in <tt class="docutils literal"><span class="pre">/bar</span></tt>&#8212;and also with the correct attribute values for <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">mode</span></tt>, and <tt class="docutils literal"><span class="pre">owner</span></tt>.</p>
<div class="section" id="example">
<h5>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h5>
<p>This section contains a more detailed example of how the chef-client manages recursive directory structures:</p>
<ul class="simple">
<li>A cookbook named <tt class="docutils literal"><span class="pre">cumbria</span></tt> that is used to build a website</li>
<li>A subfolder in the <tt class="docutils literal"><span class="pre">/files/default</span></tt> directory named <tt class="docutils literal"><span class="pre">/website</span></tt></li>
<li>A file named <tt class="docutils literal"><span class="pre">index.html</span></tt>, which is the root page for the website</li>
<li>Directories within <tt class="docutils literal"><span class="pre">/website</span></tt> named <tt class="docutils literal"><span class="pre">/cities</span></tt>, <tt class="docutils literal"><span class="pre">/places</span></tt>, and <tt class="docutils literal"><span class="pre">/football</span></tt>, which contains pages about cities, places, and football teams</li>
<li>A directory named <tt class="docutils literal"><span class="pre">/images</span></tt>, which contains images</li>
</ul>
<p>These files are placed in the <tt class="docutils literal"><span class="pre">/files/default</span></tt> directory in the <tt class="docutils literal"><span class="pre">cumbria</span></tt> cookbook, like this:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>cumbria
  /files
    /default
      /website
        index.html
        /cities
          carisle.html
          kendal.html
          penrith.html
          windermere.html
        /football
          carisle_united.html
        /images
          carisle_united.png
          furness_abbey.png
          hadrians_wall.png
          kendal.png
        /places
          furness_abbey.html
          hadrians_wall.html
</pre></div>
</div>
<p>The <strong>remote_directory</strong> resource can be used to build a website using these files. This website is being run on an Apache web server. The resource would be similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_directory</span> <span class="s2">&quot;/var/www/html&quot;</span> <span class="k">do</span>
  <span class="n">files_mode</span> <span class="s1">&#39;0440&#39;</span>
  <span class="n">files_owner</span> <span class="s1">&#39;yan&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0770&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;hamilton&#39;</span>
  <span class="n">source</span> <span class="s2">&quot;website&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>When the chef-client runs, the <strong>remote_directory</strong> resource will tell the chef-client to copy the directory tree from the cookbook to the file system using the structure defined in cookbook:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>/var
  /www
    /html
      index.html
      /cities
        carisle.html
        kendal.html
        penrith.html
        windermere.html
      /football
        carisle_united.html
      /images
        carisle_united.png
        furness_abbey.png
        hadrians_wall.png
        kendal.png
      /places
        furness_abbey.html
        hadrians_wall.html
</pre></div>
</div>
<p>The chef-client will manage the permissions of the entire directory structure below <tt class="docutils literal"><span class="pre">/html</span></tt>, for a total of 12 files and 4 directories. For example:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>dr-xr-xr-x <span class="m">2</span> root     root <span class="m">4096</span> /var/www/html
dr--r----- <span class="m">1</span> yan      root <span class="m">4096</span> /var/www/html/index.html
drwxrwx--- <span class="m">2</span> hamilton root <span class="m">4096</span> /var/www/html/cities
dr--r----- <span class="m">1</span> yan      root <span class="m">4096</span> /var/www/html/cities/carlisle.html
dr--r----- <span class="m">1</span> yan      root <span class="m">4096</span> /var/www/html/cities/kendal.html
dr--r----- <span class="m">1</span> yan      root <span class="m">4096</span> /var/www/html/cities/penrith.html
dr--r----- <span class="m">1</span> yan      root <span class="m">4096</span> /var/www/html/cities/windermere.html
drwxrwx--- <span class="m">2</span> hamilton root <span class="m">4096</span> /var/www/html/football
dr--r----- <span class="m">1</span> yan      root <span class="m">4096</span> /var/www/html/football/carlisle_united.html
drwxrwx--- <span class="m">2</span> hamilton root <span class="m">4096</span> /var/www/html/images
dr--r----- <span class="m">1</span> yan      root <span class="m">4096</span> /var/www/html/images/carlisle_united/png
dr--r----- <span class="m">1</span> yan      root <span class="m">4096</span> /var/www/html/images/furness_abbey/png
dr--r----- <span class="m">1</span> yan      root <span class="m">4096</span> /var/www/html/images/hadrians_wall.png
dr--r----- <span class="m">1</span> yan      root <span class="m">4096</span> /var/www/html/images/kendal.png
drwxrwx--- <span class="m">2</span> hamilton root <span class="m">4096</span> /var/www/html/places
dr--r----- <span class="m">1</span> yan      root <span class="m">4096</span> /var/www/html/places/furness_abbey.html
dr--r----- <span class="m">1</span> yan      root <span class="m">4096</span> /var/www/html/places/hadrians_wall.html
</pre></div>
</div>
</div>
</div>
<div class="section" id="id250">
<h4>Windows File Security<a class="headerlink" href="#id250" title="Permalink to this headline">¶</a></h4>
<p>To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes.</p>
<p><strong>Access Control Lists (ACLs)</strong></p>
<p>The <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used as many times as necessary; the chef-client will apply them to the file or directory as required. The syntax for the <tt class="docutils literal"><span class="pre">rights</span></tt> property is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="n">permission</span><span class="p">,</span> <span class="n">principal</span><span class="p">,</span> <span class="n">option_type</span> <span class="o">=&gt;</span> <span class="n">value</span>
</pre></div>
</div>
<p>where</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">permission</span></tt></dt>
<dd><p class="first">Use to specify which rights are granted to the <tt class="docutils literal"><span class="pre">principal</span></tt>. The possible values are: <tt class="docutils literal"><span class="pre">:read</span></tt>, <tt class="docutils literal"><span class="pre">:write</span></tt>, <tt class="docutils literal"><span class="pre">read_execute</span></tt>, <tt class="docutils literal"><span class="pre">:modify</span></tt>, and <tt class="docutils literal"><span class="pre">:full_control</span></tt>.</p>
<p>These permissions are cumulative. If <tt class="docutils literal"><span class="pre">:write</span></tt> is specified, then it includes <tt class="docutils literal"><span class="pre">:read</span></tt>. If <tt class="docutils literal"><span class="pre">:full_control</span></tt> is specified, then it includes both <tt class="docutils literal"><span class="pre">:write</span></tt> and <tt class="docutils literal"><span class="pre">:read</span></tt>.</p>
<p class="last">(For those who know the Microsoft Windows API: <tt class="docutils literal"><span class="pre">:read</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>; <tt class="docutils literal"><span class="pre">:write</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>; <tt class="docutils literal"><span class="pre">:read_execute</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt> and <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>; <tt class="docutils literal"><span class="pre">:modify</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>, and <tt class="docutils literal"><span class="pre">DELETE</span></tt>; <tt class="docutils literal"><span class="pre">:full_control</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_ALL</span></tt>, which allows a user to change the owner and other metadata about a file.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">principal</span></tt></dt>
<dd>Use to specify a group or user name. This is identical to what is entered in the login box for Microsoft Windows, such as <tt class="docutils literal"><span class="pre">user_name</span></tt>, <tt class="docutils literal"><span class="pre">domain\user_name</span></tt>, or <tt class="docutils literal"><span class="pre">user_name&#64;fully_qualified_domain_name</span></tt>. The chef-client does not need to know if a principal is a user or a group.</dd>
<dt><tt class="docutils literal"><span class="pre">option_type</span></tt></dt>
<dd><p class="first">A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">:write,</span> <span class="pre">'domain\group_name',</span> <span class="pre">:one_level_deep</span> <span class="pre">=&gt;</span> <span class="pre">true</span></tt>. Possible option types:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:applies_to_children</span></tt></td>
<td>Specify how permissions are applied to children. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to inherit both child directories and files;  <tt class="docutils literal"><span class="pre">false</span></tt> to not inherit any child directories or files; <tt class="docutils literal"><span class="pre">:containers_only</span></tt> to inherit only child directories (and not files); <tt class="docutils literal"><span class="pre">:objects_only</span></tt> to recursively inherit files (and not child directories).</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:applies_to_self</span></tt></td>
<td>Indicates whether a permission is applied to the parent directory. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply to the parent directory or file and its children; <tt class="docutils literal"><span class="pre">false</span></tt> to not apply only to child directories and files.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:one_level_deep</span></tt></td>
<td>Indicates the depth to which permissions will be applied. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply only to the first level of children; <tt class="docutils literal"><span class="pre">false</span></tt> to apply to all children.</td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Administrators&#39;</span><span class="p">,</span><span class="s1">&#39;Everyone&#39;</span><span class="o">]</span>
<span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;Users&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;Sally&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="ss">:containers_only</span><span class="p">,</span> <span class="ss">:applies_to_self</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:one_level_deep</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</pre></div>
</div>
<p>Some other important things to know when using the <tt class="docutils literal"><span class="pre">rights</span></tt> attribute:</p>
<ul class="simple">
<li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li>
<li>If rights are not specified, nothing will be changed. The chef-client does not clear out the rights on a file or directory if rights are not specified.</li>
<li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li>
</ul>
<p>Use the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> property to deny specific rights to specific users. The ordering is independent of using the <tt class="docutils literal"><span class="pre">rights</span></tt> property. For example, it doesn&#8217;t matter if rights are granted to everyone is placed before or after <tt class="docutils literal"><span class="pre">deny_rights</span> <span class="pre">:read,</span> <span class="pre">['Julian',</span> <span class="pre">'Lewis']</span></tt>, both Julian and Lewis will be unable to read the document. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Julian&#39;</span><span class="p">,</span> <span class="s1">&#39;Lewis&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deny_rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Sally&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p><strong>Inheritance</strong></p>
<p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <tt class="docutils literal"><span class="pre">inherits</span></tt> property can be used to specifically tell the chef-client to apply (or not apply) inherited rights from its parent directory.</p>
<p>For example, the following example specifies the rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">inherits</span> <span class="kp">false</span> <span class="c1"># Sauron is the only person who should have any sort of access</span>
<span class="k">end</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> permission were to be used instead, something could slip through unless all users and groups were denied.</p>
<p>Another example also shows how to specify rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;SHIRE\Frodo&#39;</span> <span class="c1"># Who put that there I didn&#39;t put that there</span>
<span class="k">end</span>
</pre></div>
</div>
<p>but then not use the <tt class="docutils literal"><span class="pre">inherits</span></tt> property to deny those rights on a child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span> <span class="c1"># Oops, not specific enough</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Because the <tt class="docutils literal"><span class="pre">inherits</span></tt> property is not specified, the chef-client will default it to <tt class="docutils literal"><span class="pre">true</span></tt>, which will ensure that security settings for existing files remain unchanged.</p>
</div>
</div>
<div class="section" id="id251">
<h3>Examples<a class="headerlink" href="#id251" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Recursively transfer a directory from a remote location</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># create up to 10 backups of the files</span>
<span class="c1"># set the files owner different from the directory</span>
<span class="n">remote_directory</span> <span class="s1">&#39;/tmp/remote_something&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;something&#39;</span>
  <span class="n">files_backup</span> <span class="mi">10</span>
  <span class="n">files_owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">files_group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">files_mode</span> <span class="s1">&#39;0644&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;nobody&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;nobody&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use with the chef_handler lightweight resource</strong></p>
<p>The following example shows how to use the <strong>remote_directory</strong> resource and the <strong>chef_handler</strong> resource to reboot a handler named <tt class="docutils literal"><span class="pre">WindowsRebootHandler</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the</span>
<span class="c1"># ``reboot_handler`` recipe in the ``windows`` cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/windows</span>

<span class="n">remote_directory</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_handler&#39;</span><span class="o">][</span><span class="s1">&#39;handler_path&#39;</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;handlers&#39;</span>
  <span class="n">recursive</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>

<span class="n">chef_handler</span> <span class="s1">&#39;WindowsRebootHandler&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_handler&#39;</span><span class="o">][</span><span class="s1">&#39;handler_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/windows_reboot_handler.rb&quot;</span>
  <span class="n">arguments</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;windows&#39;</span><span class="o">][</span><span class="s1">&#39;allow_pending_reboots&#39;</span><span class="o">]</span>
  <span class="n">supports</span> <span class="ss">:report</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:exception</span> <span class="o">=&gt;</span> <span class="kp">false</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="remote-file">
<h2>remote_file<a class="headerlink" href="#remote-file" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_remote_file.rst">[edit on GitHub]</a></p>
<p>Use the <strong>remote_file</strong> resource to transfer a file from a remote location using file specificity. This resource is similar to the <strong>file</strong> resource.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Fetching files from the <tt class="docutils literal"><span class="pre">files/</span></tt> directory in a cookbook should be done with the <strong>cookbook_file</strong> resource.</p>
</div>
<div class="section" id="id252">
<h3>Syntax<a class="headerlink" href="#id252" title="Permalink to this headline">¶</a></h3>
<p>A <strong>remote_file</strong> resource block manages files by using files that exist remotely. For example, to write the home page for an Apache website:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/var/www/customers/public_html/index.php&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://somesite.com/index.php&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;web_admin&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;web_admin&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">'/var/www/customers/public_html/index.php'</span></tt> is path to the file to be created</li>
<li><tt class="docutils literal"><span class="pre">'http://somesite.com/index.php'</span></tt> specifies the location of the remote file</li>
<li><tt class="docutils literal"><span class="pre">owner</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, and <tt class="docutils literal"><span class="pre">mode</span></tt> define the permissions</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>remote_file</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">atomic_update</span>              <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">backup</span>                     <span class="no">FalseClass</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">checksum</span>                   <span class="nb">String</span>
  <span class="n">force_unlink</span>               <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">ftp_active_mode</span>            <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">headers</span>                    <span class="no">Hash</span>
  <span class="n">inherits</span>                   <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">manage_symlink_source</span>      <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span><span class="p">,</span> <span class="no">NilClass</span>
  <span class="n">mode</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">owner</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">path</span>                       <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">File</span><span class="o">::</span><span class="no">RemoteFile</span>
  <span class="n">rights</span>                     <span class="no">Hash</span>
  <span class="n">source</span>                     <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">use_conditional_get</span>        <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">use_etag</span>                   <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">use_last_modified</span>          <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">verify</span>                     <span class="nb">String</span><span class="p">,</span> <span class="no">Block</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">remote_file</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">atomic_update</span></tt>, <tt class="docutils literal"><span class="pre">backup</span></tt>, <tt class="docutils literal"><span class="pre">checksum</span></tt>, <tt class="docutils literal"><span class="pre">force_unlink</span></tt>, <tt class="docutils literal"><span class="pre">ftp_active_mode</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">headers</span></tt>, <tt class="docutils literal"><span class="pre">inherits</span></tt>, <tt class="docutils literal"><span class="pre">manage_symlink_source</span></tt>, <tt class="docutils literal"><span class="pre">mode</span></tt>, <tt class="docutils literal"><span class="pre">owner</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">rights</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">use_conditional_get</span></tt>, <tt class="docutils literal"><span class="pre">use_etag</span></tt>, <tt class="docutils literal"><span class="pre">use_last_modified</span></tt>, and <tt class="docutils literal"><span class="pre">verify</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id253">
<h3>Actions<a class="headerlink" href="#id253" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd><p class="first">Default. Create a file. If a file already exists (but does not match), update that file to match.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">For a machine on which SELinux is enabled, the chef-client will create files that correctly match the default policy settings only when the cookbook that defines the action also conforms to the same policy.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:create_if_missing</span></tt></dt>
<dd>Create a file only if the file does not exist. When the file exists, nothing happens.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Delete a file.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:touch</span></tt></dt>
<dd>Touch a file. This updates the access (atime) and file modification (mtime) times for a file. (This action may be used with this resource, but is typically only used with the <strong>file</strong> resource.)</dd>
</dl>
</div>
<div class="section" id="id254">
<h3>Properties<a class="headerlink" href="#id254" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">atomic_update</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Perform atomic file updates on a per-resource basis. Set to <tt class="docutils literal"><span class="pre">true</span></tt> for atomic file updates. Set to <tt class="docutils literal"><span class="pre">false</span></tt> for non-atomic file updates. This setting overrides <tt class="docutils literal"><span class="pre">file_atomic_update</span></tt>, which is a global setting found in the client.rb file. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">backup</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> FalseClass, Integer</p>
<p class="last">The number of backups to be kept in <tt class="docutils literal"><span class="pre">/var/chef/backup</span></tt> (for UNIX- and Linux-based platforms) or <tt class="docutils literal"><span class="pre">C:/chef/backup</span></tt> (for the Microsoft Windows platform). Set to <tt class="docutils literal"><span class="pre">false</span></tt> to prevent backups from being kept. Default value: <tt class="docutils literal"><span class="pre">5</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">checksum</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional, see <tt class="docutils literal"><span class="pre">use_conditional_get</span></tt>. The SHA-256 checksum of the file. Use to prevent a file from being re-downloaded. When the local file matches the checksum, the chef-client does not download it.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">force_unlink</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">How the chef-client handles certain situations when the target file turns out not to be a file. For example, when a target file is actually a symlink. Set to <tt class="docutils literal"><span class="pre">true</span></tt> for the chef-client delete the non-file target and replace it with the specified file. Set to <tt class="docutils literal"><span class="pre">false</span></tt> for the chef-client to raise an error. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ftp_active_mode</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Whether the chef-client uses active or passive FTP. Set to <tt class="docutils literal"><span class="pre">true</span></tt> to use active FTP. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">A string or ID that identifies the group owner by group name, including fully qualified group names such as <tt class="docutils literal"><span class="pre">domain\group</span></tt> or <tt class="docutils literal"><span class="pre">group&#64;domain</span></tt>. If this value is not specified, existing groups remain unchanged and new group assignments use the default <tt class="docutils literal"><span class="pre">POSIX</span></tt> group (if available).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">headers()</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p>A Hash of custom headers. Default value: <tt class="docutils literal"><span class="pre">{}</span></tt>. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">headers</span><span class="p">({</span> <span class="s2">&quot;Cookie&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;user=grantmc; pass=p@ssw0rd!&quot;</span> <span class="p">})</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">headers</span><span class="p">({</span> <span class="s2">&quot;Referer&quot;</span> <span class="o">=&gt;</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">header</span><span class="si">}</span><span class="s2">&quot;</span> <span class="p">})</span>
</pre></div>
</div>
<p>or:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">headers</span><span class="p">(</span> <span class="s2">&quot;Authorization&quot;</span><span class="o">=&gt;</span><span class="s2">&quot;Basic </span><span class="si">#{</span> <span class="no">Base64</span><span class="o">.</span><span class="n">encode64</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">username</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="n">password</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="si">}</span><span class="s2">&quot;</span> <span class="p">)</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">inherits</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Microsoft Windows only. Whether a file inherits rights from its parent directory. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">manage_symlink_source</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass, NilClass</p>
<p class="last">Cause the chef-client to detect and manage the source file for a symlink. Possible values: <tt class="docutils literal"><span class="pre">nil</span></tt>, <tt class="docutils literal"><span class="pre">true</span></tt>, or <tt class="docutils literal"><span class="pre">false</span></tt>. When this value is set to <tt class="docutils literal"><span class="pre">nil</span></tt>, the chef-client will manage a symlink&#8217;s source file and emit a warning. When this value is set to <tt class="docutils literal"><span class="pre">true</span></tt>, the chef-client will manage a symlink&#8217;s source file and not emit a warning. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>. The default value will be changed to <tt class="docutils literal"><span class="pre">false</span></tt> in a future version.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">mode</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p>A quoted 3-5 character string that defines the octal mode. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified and if the file already exists, the existing mode on the file is used. If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified, the file does not exist, and the <tt class="docutils literal"><span class="pre">:create</span></tt> action is specified, the chef-client assumes a mask value of <tt class="docutils literal"><span class="pre">'0777'</span></tt> and then applies the umask for the system on which the file is to be created to the <tt class="docutils literal"><span class="pre">mask</span></tt> value. For example, if the umask on a system is <tt class="docutils literal"><span class="pre">'022'</span></tt>, the chef-client uses the default value of <tt class="docutils literal"><span class="pre">'0755'</span></tt>.</p>
<p>The behavior is different depending on the platform.</p>
<p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. If the value is specified as a quoted string, it works exactly as if the <tt class="docutils literal"><span class="pre">chmod</span></tt> command was passed. If the value is specified as an integer, prepend a zero (<tt class="docutils literal"><span class="pre">0</span></tt>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <tt class="docutils literal"><span class="pre">'0777'</span></tt> or <tt class="docutils literal"><span class="pre">'777'</span></tt>; for the same rights, plus the sticky bit, use <tt class="docutils literal"><span class="pre">01777</span></tt> or <tt class="docutils literal"><span class="pre">'1777'</span></tt>.</p>
<p class="last">Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. Values up to <tt class="docutils literal"><span class="pre">'0777'</span></tt> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <tt class="docutils literal"><span class="pre">4</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">2</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, and <tt class="docutils literal"><span class="pre">1</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>. This property cannot be used to set <tt class="docutils literal"><span class="pre">:full_control</span></tt>. This property has no effect if not specified, but when it and <tt class="docutils literal"><span class="pre">rights</span></tt> are both specified, the effects are cumulative.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">owner</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">A string or ID that identifies the group owner by user name, including fully qualified user names such as <tt class="docutils literal"><span class="pre">domain\user</span></tt> or <tt class="docutils literal"><span class="pre">user&#64;domain</span></tt>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The full path to the file, including the file name and its extension. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">rights</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">Microsoft Windows only. The permissions for users and groups in a Microsoft Windows environment. For example: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">&lt;permissions&gt;,</span> <span class="pre">&lt;principal&gt;,</span> <span class="pre">&lt;options&gt;</span></tt> where <tt class="docutils literal"><span class="pre">&lt;permissions&gt;</span></tt> specifies the rights granted to the principal, <tt class="docutils literal"><span class="pre">&lt;principal&gt;</span></tt> is the group or user name, and <tt class="docutils literal"><span class="pre">&lt;options&gt;</span></tt> is a Hash with one (or more) advanced rights options.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p>Required. The location of the source file. The location of the source file may be HTTP (<tt class="docutils literal"><span class="pre">http://</span></tt>), FTP (<tt class="docutils literal"><span class="pre">ftp://</span></tt>), SFTP (<tt class="docutils literal"><span class="pre">sftp://</span></tt>), local (<tt class="docutils literal"><span class="pre">file:///</span></tt>), or UNC (<tt class="docutils literal"><span class="pre">\\host\share\file.tar.gz</span></tt>).</p>
<p>There are many ways to define the location of a source file. By using a path:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="s1">&#39;http://couchdb.apache.org/img/sketch.png&#39;</span>
</pre></div>
</div>
<p>By using FTP:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="s1">&#39;ftp://remote_host/path/to/img/sketch.png&#39;</span>
</pre></div>
</div>
<p>By using SFTP:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="s1">&#39;sftp://username:password@remote_host:22/path/to/img/sketch.png&#39;</span>
</pre></div>
</div>
<p>By using a local path:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="s1">&#39;file:///path/to/img/sketch.png&#39;</span>
</pre></div>
</div>
<p>By using a Microsoft Windows UNC:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="s1">&#39;\\\\path\\to\\img\\sketch.png&#39;</span>
</pre></div>
</div>
<p>By using a node attribute:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p>By using attributes to define paths:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">/Python-</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">.tar.bz2&quot;</span>
</pre></div>
</div>
<p>By defining multiple paths for multiple locations:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="s1">&#39;http://seapower/spring.png&#39;</span><span class="p">,</span> <span class="s1">&#39;http://seapower/has_sprung.png&#39;</span>
</pre></div>
</div>
<p>By defining those same multiple paths as an array:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">[</span><span class="s1">&#39;http://seapower/spring.png&#39;</span><span class="p">,</span> <span class="s1">&#39;http://seapower/has_sprung.png&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p class="last">When multiple paths are specified, the chef-client will attempt to download the files in the order listed, stopping after the first successful download.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">use_conditional_get</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Enable conditional HTTP requests by using a conditional <tt class="docutils literal"><span class="pre">GET</span></tt> (with the If-Modified-Since header) or an opaque identifier (ETag). To use If-Modified-Since headers, <tt class="docutils literal"><span class="pre">use_last_modified</span></tt> must also be set to <tt class="docutils literal"><span class="pre">true</span></tt>. To use ETag headers, <tt class="docutils literal"><span class="pre">use_etag</span></tt> must also be set to <tt class="docutils literal"><span class="pre">true</span></tt>. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">use_etag</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Enable ETag headers. Set to <tt class="docutils literal"><span class="pre">false</span></tt> to disable ETag headers. To use this setting, <tt class="docutils literal"><span class="pre">use_conditional_get</span></tt> must also be set to <tt class="docutils literal"><span class="pre">true</span></tt>. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">use_last_modified</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Enable If-Modified-Since headers. Set to <tt class="docutils literal"><span class="pre">false</span></tt> to disable If-Modified-Since headers. To use this setting, <tt class="docutils literal"><span class="pre">use_conditional_get</span></tt> must also be set to <tt class="docutils literal"><span class="pre">true</span></tt>. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">verify</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Block</p>
<p>A block or a string that returns <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. A string, when <tt class="docutils literal"><span class="pre">true</span></tt> is executed as a system command.</p>
<p>A block is arbitrary Ruby defined within the resource block by using the <tt class="docutils literal"><span class="pre">verify</span></tt> property. When a block is <tt class="docutils literal"><span class="pre">true</span></tt>, the chef-client will continue to update the file as appropriate.</p>
<p>For example, this should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/tmp/baz&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="p">{</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/etc/nginx.conf&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="s1">&#39;nginx -t -c %{path}&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>For releases of the chef-client prior to 12.5 (chef-client 12.4 and earlier) the correct syntax is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/etc/nginx.conf&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="s1">&#39;nginx -t -c %{file}&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p class="last">See GitHub issues <a class="reference external" href="https://github.com/chef/chef/issues/3232">https://github.com/chef/chef/issues/3232</a> and <a class="reference external" href="https://github.com/chef/chef/pull/3693">https://github.com/chef/chef/pull/3693</a> for more information about these differences.</p>
</div>
<p>This should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/tmp/bar&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="p">{</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>And this should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/tmp/foo&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
    <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Whereas, this should return <tt class="docutils literal"><span class="pre">false</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/tmp/turtle&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="s1">&#39;/usr/bin/false&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p class="last">If a string or a block return <tt class="docutils literal"><span class="pre">false</span></tt>, the chef-client run will stop and an error is returned.</p>
</dd>
</dl>
<div class="section" id="id255">
<h4>Atomic File Updates<a class="headerlink" href="#id255" title="Permalink to this headline">¶</a></h4>
<p>Atomic updates are used with <strong>file</strong>-based resources to help ensure that file updates can be made when updating a binary or if disk space runs out.</p>
<p>Atomic updates are enabled by default. They can be managed globally using the <tt class="docutils literal"><span class="pre">file_atomic_update</span></tt> setting in the client.rb file. They can be managed on a per-resource basis using the <tt class="docutils literal"><span class="pre">atomic_update</span></tt> property that is available with the <strong>cookbook_file</strong>, <strong>file</strong>, <strong>remote_file</strong>, and <strong>template</strong> resources.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On certain platforms, and after a file has been moved into place, the chef-client may modify file permissions to support features specific to those platforms. On platforms with SELinux enabled, the chef-client will fix up the security contexts after a file has been moved into the correct location by running the <tt class="docutils literal"><span class="pre">restorecon</span></tt> command. On the Microsoft Windows platform, the chef-client will create files so that ACL inheritance works as expected.</p>
</div>
</div>
<div class="section" id="id256">
<h4>Windows File Security<a class="headerlink" href="#id256" title="Permalink to this headline">¶</a></h4>
<p>To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes.</p>
<p><strong>Access Control Lists (ACLs)</strong></p>
<p>The <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used as many times as necessary; the chef-client will apply them to the file or directory as required. The syntax for the <tt class="docutils literal"><span class="pre">rights</span></tt> property is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="n">permission</span><span class="p">,</span> <span class="n">principal</span><span class="p">,</span> <span class="n">option_type</span> <span class="o">=&gt;</span> <span class="n">value</span>
</pre></div>
</div>
<p>where</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">permission</span></tt></dt>
<dd><p class="first">Use to specify which rights are granted to the <tt class="docutils literal"><span class="pre">principal</span></tt>. The possible values are: <tt class="docutils literal"><span class="pre">:read</span></tt>, <tt class="docutils literal"><span class="pre">:write</span></tt>, <tt class="docutils literal"><span class="pre">read_execute</span></tt>, <tt class="docutils literal"><span class="pre">:modify</span></tt>, and <tt class="docutils literal"><span class="pre">:full_control</span></tt>.</p>
<p>These permissions are cumulative. If <tt class="docutils literal"><span class="pre">:write</span></tt> is specified, then it includes <tt class="docutils literal"><span class="pre">:read</span></tt>. If <tt class="docutils literal"><span class="pre">:full_control</span></tt> is specified, then it includes both <tt class="docutils literal"><span class="pre">:write</span></tt> and <tt class="docutils literal"><span class="pre">:read</span></tt>.</p>
<p class="last">(For those who know the Microsoft Windows API: <tt class="docutils literal"><span class="pre">:read</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>; <tt class="docutils literal"><span class="pre">:write</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>; <tt class="docutils literal"><span class="pre">:read_execute</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt> and <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>; <tt class="docutils literal"><span class="pre">:modify</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>, and <tt class="docutils literal"><span class="pre">DELETE</span></tt>; <tt class="docutils literal"><span class="pre">:full_control</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_ALL</span></tt>, which allows a user to change the owner and other metadata about a file.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">principal</span></tt></dt>
<dd>Use to specify a group or user name. This is identical to what is entered in the login box for Microsoft Windows, such as <tt class="docutils literal"><span class="pre">user_name</span></tt>, <tt class="docutils literal"><span class="pre">domain\user_name</span></tt>, or <tt class="docutils literal"><span class="pre">user_name&#64;fully_qualified_domain_name</span></tt>. The chef-client does not need to know if a principal is a user or a group.</dd>
<dt><tt class="docutils literal"><span class="pre">option_type</span></tt></dt>
<dd><p class="first">A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">:write,</span> <span class="pre">'domain\group_name',</span> <span class="pre">:one_level_deep</span> <span class="pre">=&gt;</span> <span class="pre">true</span></tt>. Possible option types:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:applies_to_children</span></tt></td>
<td>Specify how permissions are applied to children. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to inherit both child directories and files;  <tt class="docutils literal"><span class="pre">false</span></tt> to not inherit any child directories or files; <tt class="docutils literal"><span class="pre">:containers_only</span></tt> to inherit only child directories (and not files); <tt class="docutils literal"><span class="pre">:objects_only</span></tt> to recursively inherit files (and not child directories).</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:applies_to_self</span></tt></td>
<td>Indicates whether a permission is applied to the parent directory. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply to the parent directory or file and its children; <tt class="docutils literal"><span class="pre">false</span></tt> to not apply only to child directories and files.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:one_level_deep</span></tt></td>
<td>Indicates the depth to which permissions will be applied. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply only to the first level of children; <tt class="docutils literal"><span class="pre">false</span></tt> to apply to all children.</td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Administrators&#39;</span><span class="p">,</span><span class="s1">&#39;Everyone&#39;</span><span class="o">]</span>
<span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;Users&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;Sally&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="ss">:containers_only</span><span class="p">,</span> <span class="ss">:applies_to_self</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:one_level_deep</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</pre></div>
</div>
<p>Some other important things to know when using the <tt class="docutils literal"><span class="pre">rights</span></tt> attribute:</p>
<ul class="simple">
<li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li>
<li>If rights are not specified, nothing will be changed. The chef-client does not clear out the rights on a file or directory if rights are not specified.</li>
<li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li>
</ul>
<p>Use the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> property to deny specific rights to specific users. The ordering is independent of using the <tt class="docutils literal"><span class="pre">rights</span></tt> property. For example, it doesn&#8217;t matter if rights are granted to everyone is placed before or after <tt class="docutils literal"><span class="pre">deny_rights</span> <span class="pre">:read,</span> <span class="pre">['Julian',</span> <span class="pre">'Lewis']</span></tt>, both Julian and Lewis will be unable to read the document. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Julian&#39;</span><span class="p">,</span> <span class="s1">&#39;Lewis&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deny_rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Sally&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p><strong>Inheritance</strong></p>
<p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <tt class="docutils literal"><span class="pre">inherits</span></tt> property can be used to specifically tell the chef-client to apply (or not apply) inherited rights from its parent directory.</p>
<p>For example, the following example specifies the rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">inherits</span> <span class="kp">false</span> <span class="c1"># Sauron is the only person who should have any sort of access</span>
<span class="k">end</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> permission were to be used instead, something could slip through unless all users and groups were denied.</p>
<p>Another example also shows how to specify rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;SHIRE\Frodo&#39;</span> <span class="c1"># Who put that there I didn&#39;t put that there</span>
<span class="k">end</span>
</pre></div>
</div>
<p>but then not use the <tt class="docutils literal"><span class="pre">inherits</span></tt> property to deny those rights on a child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span> <span class="c1"># Oops, not specific enough</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Because the <tt class="docutils literal"><span class="pre">inherits</span></tt> property is not specified, the chef-client will default it to <tt class="docutils literal"><span class="pre">true</span></tt>, which will ensure that security settings for existing files remain unchanged.</p>
</div>
<div class="section" id="prevent-re-downloads">
<h4>Prevent Re-downloads<a class="headerlink" href="#prevent-re-downloads" title="Permalink to this headline">¶</a></h4>
<p>To prevent the chef-client from re-downloading files that are already present on a node, use one of the following attributes in a recipe: <tt class="docutils literal"><span class="pre">use_conditional_get</span></tt> (default) or <tt class="docutils literal"><span class="pre">checksum</span></tt>.</p>
<ul class="simple">
<li>The <tt class="docutils literal"><span class="pre">use_conditional_get</span></tt> attribute is the default behavior of the chef-client. If the remote file is located on a server that supports ETag and/or If-Modified-Since headers, the chef-client will use a conditional <tt class="docutils literal"><span class="pre">GET</span></tt> to determine if the file has been updated. If the file has been updated, the chef-client will re-download the file.</li>
<li>The <tt class="docutils literal"><span class="pre">checksum</span></tt> attribute will ask the chef-client to compare the checksum for the local file to the one at the remote location. If they match, the chef-client will not re-download the file. Using a local checksum for comparison requires that the local checksum be the correct checksum.</li>
</ul>
<p>The desired approach just depends on the desired workflow. For example, if a node requires a new file every day, using the checksum approach would require that the local checksum be updated and/or verified every day as well, in order to ensure that the local checksum was the correct one. Using a conditional <tt class="docutils literal"><span class="pre">GET</span></tt> in this scenario will greatly simplify the management required to ensure files are being updated accurately.</p>
</div>
</div>
<div class="section" id="id257">
<h3>Providers<a class="headerlink" href="#id257" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::File::RemoteFile</span></tt>, <tt class="docutils literal"><span class="pre">remote_file</span></tt></dt>
<dd>The default provider for all platforms.</dd>
</dl>
</div>
<div class="section" id="id258">
<h3>Examples<a class="headerlink" href="#id258" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Transfer a file from a URL</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/tmp/testfile&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://www.example.com/tempfiles/testfile&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">checksum</span> <span class="s1">&#39;3a7dac00b1&#39;</span> <span class="c1"># A SHA256 (or portion thereof) of the file.</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Transfer a file only when the source has changed</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;/tmp/couch.png&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://couchdb.apache.org/img/sketch.png&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">http_request</span> <span class="s1">&#39;HEAD http://couchdb.apache.org/img/sketch.png&#39;</span> <span class="k">do</span>
  <span class="n">message</span> <span class="s1">&#39;&#39;</span>
  <span class="n">url</span> <span class="s1">&#39;http://couchdb.apache.org/img/sketch.png&#39;</span>
  <span class="n">action</span> <span class="ss">:head</span>
  <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/tmp/couch.png&#39;</span><span class="p">)</span>
    <span class="n">headers</span> <span class="s1">&#39;If-Modified-Since&#39;</span> <span class="o">=&gt;</span> <span class="no">File</span><span class="o">.</span><span class="n">mtime</span><span class="p">(</span><span class="s1">&#39;/tmp/couch.png&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">httpdate</span>
  <span class="k">end</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;remote_file[/tmp/couch.png]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install a file from a remote location using bash</strong></p>
<p>The following is an example of how to install the <tt class="docutils literal"><span class="pre">foo123</span></tt> module for Nginx. This module adds shell-style functionality to an Nginx configuration file and does the following:</p>
<ul class="simple">
<li>Declares three variables</li>
<li>Gets the Nginx file from a remote location</li>
<li>Installs the file using Bash to the path specified by the <tt class="docutils literal"><span class="pre">src_filepath</span></tt> variable</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample is similar to the ``upload_progress_module``</span>
<span class="c1"># recipe in the ``nginx`` cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/nginx</span>

<span class="n">src_filename</span> <span class="o">=</span> <span class="s2">&quot;foo123-nginx-module-v</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">.tar.gz&quot;</span>
<span class="n">src_filepath</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">src_filename</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">extract_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span>
  <span class="si">}</span><span class="s2">/nginx_foo123_module/</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s1">&#39;src_filepath&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;extract_module&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    mkdir -p #{extract_path}</span>
<span class="sh">    tar xzf #{src_filename} -C #{extract_path}</span>
<span class="sh">    mv #{extract_path}/*/* #{extract_path}/</span>
<span class="no">    EOH</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Store certain settings</strong></p>
<p>The following recipe shows how an attributes file can be used to store certain settings. An attributes file is located in the <tt class="docutils literal"><span class="pre">attributes/</span></tt> directory in the same cookbook as the recipe which calls the attributes file. In this example, the attributes file specifies certain settings for Python that are then used across all nodes against which this recipe will run.</p>
<p>Python packages have versions, installation directories, URLs, and checksum files. An attributes file that exists to support this type of recipe would include settings like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;2.7.1&#39;</span>

<span class="k">if</span> <span class="n">python</span><span class="o">[</span><span class="s1">&#39;install_method&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;package&#39;</span>
  <span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/usr&#39;</span>
<span class="k">else</span>
  <span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/usr/local&#39;</span>
<span class="k">end</span>

<span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;http://www.python.org/ftp/python&#39;</span>
<span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;80e387...85fd61&#39;</span>
</pre></div>
</div>
<p>and then the methods in the recipe may refer to these values. A recipe that is used to install Python will need to do the following:</p>
<ul class="simple">
<li>Identify each package to be installed (implied in this example, not shown)</li>
<li>Define variables for the package <tt class="docutils literal"><span class="pre">version</span></tt> and the <tt class="docutils literal"><span class="pre">install_path</span></tt></li>
<li>Get the package from a remote location, but only if the package does not already exist on the target system</li>
<li>Use the <strong>bash</strong> resource to install the package on the node, but only when the package is not already installed</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#  the following code sample comes from the ``oc-nginx`` cookbook on |github|: https://github.com/cookbooks/oc-nginx</span>

<span class="n">version</span> <span class="o">=</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="n">install_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/lib/python</span><span class="si">#{</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/(^\d+\.\d+)/</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/Python-</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">.tar.bz2&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">/Python-</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">.tar.bz2&quot;</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">install_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;build-and-install-python&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span>
<span class="sh">    tar -jxvf Python-#{version}.tar.bz2</span>
<span class="sh">    (cd Python-#{version} &amp;&amp; ./configure #{configure_options})</span>
<span class="sh">    (cd Python-#{version} &amp;&amp; make &amp;&amp; make install)</span>
<span class="no">  EOF</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">install_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the platform_family? method</strong></p>
<p>The following is an example of using the <tt class="docutils literal"><span class="pre">platform_family?</span></tt> method in the Recipe DSL to create a variable that can be used with other resources in the same recipe. In this example, <tt class="docutils literal"><span class="pre">platform_family?</span></tt> is being used to ensure that a specific binary is used for a specific platform before using the <strong>remote_file</strong> resource to download a file from a remote location, and then using the <strong>execute</strong> resource to install that file by running a command.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">platform_family?</span><span class="p">(</span><span class="s1">&#39;rhel&#39;</span><span class="p">)</span>
  <span class="n">pip_binary</span> <span class="o">=</span> <span class="s1">&#39;/usr/bin/pip&#39;</span>
<span class="k">else</span>
  <span class="n">pip_binary</span> <span class="o">=</span> <span class="s1">&#39;/usr/local/bin/pip&#39;</span>
<span class="k">end</span>

<span class="n">remote_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/distribute_setup.py&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://python-distribute.org/distribute_setup.py&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">pip_binary</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">execute</span> <span class="s1">&#39;install-pip&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">command</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span>
<span class="sh">    # command for installing Python goes here</span>
<span class="no">    EOF</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">pip_binary</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where a command for installing Python might look something like:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#{node[&#39;python&#39;][&#39;binary&#39;]} distribute_setup.py</span>
<span class="c1">#{::File.dirname(pip_binary)}/easy_install pip</span>
</pre></div>
</div>
<p><strong>Specify local Windows file path as a valid URI</strong></p>
<p>When specifying a local Microsoft Windows file path as a valid file URI, an additional forward slash (<tt class="docutils literal"><span class="pre">/</span></tt>) is required. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">remote_file</span> <span class="s1">&#39;file:///c:/path/to/file&#39;</span> <span class="k">do</span>
  <span class="o">...</span>       <span class="c1"># other attributes</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="route">
<h2>route<a class="headerlink" href="#route" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_route.rst">[edit on GitHub]</a></p>
<p>Use the <strong>route</strong> resource to manage the system routing table in a Linux environment.</p>
<div class="section" id="id259">
<h3>Syntax<a class="headerlink" href="#id259" title="Permalink to this headline">¶</a></h3>
<p>A <strong>route</strong> resource block manages the system routing table in a Linux environment:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">route</span> <span class="s1">&#39;10.0.1.10/32&#39;</span> <span class="k">do</span>
  <span class="n">gateway</span> <span class="s1">&#39;10.0.0.20&#39;</span>
  <span class="n">device</span> <span class="s1">&#39;eth1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>route</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">route</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">device</span>                     <span class="nb">String</span>
  <span class="n">gateway</span>                    <span class="nb">String</span>
  <span class="n">netmask</span>                    <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Route</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">target</span>                     <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :add if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">route</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">device</span></tt>, <tt class="docutils literal"><span class="pre">gateway</span></tt>, <tt class="docutils literal"><span class="pre">netmask</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt> and <tt class="docutils literal"><span class="pre">target</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id260">
<h3>Actions<a class="headerlink" href="#id260" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:add</span></tt></dt>
<dd>Default. Add a route.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Delete a route.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
</dl>
</div>
<div class="section" id="id261">
<h3>Properties<a class="headerlink" href="#id261" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">device</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The network interface to which the route applies.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">gateway</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The gateway for the route.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">netmask</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The decimal representation of the network mask. For example: <tt class="docutils literal"><span class="pre">255.255.255.0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">target</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The IP address of the target route. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
</dl>
</div>
<div class="section" id="id262">
<h3>Examples<a class="headerlink" href="#id262" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Add a host route</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">route</span> <span class="s1">&#39;10.0.1.10/32&#39;</span> <span class="k">do</span>
  <span class="n">gateway</span> <span class="s1">&#39;10.0.0.20&#39;</span>
  <span class="n">device</span> <span class="s1">&#39;eth1&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delete a network route</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">route</span> <span class="s1">&#39;10.1.1.0/24&#39;</span> <span class="k">do</span>
  <span class="n">gateway</span> <span class="s1">&#39;10.0.0.20&#39;</span>
  <span class="n">action</span> <span class="ss">:delete</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="rpm-package">
<h2>rpm_package<a class="headerlink" href="#rpm-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_rpm_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>rpm_package</strong> resource to manage packages for the RPM Package Manager platform.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id263">
<h3>Syntax<a class="headerlink" href="#id263" title="Permalink to this headline">¶</a></h3>
<p>A <strong>rpm_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>rpm_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rpm_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>rpm_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rpm_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">allow_downgrade</span>            <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Rpm</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">rpm_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">allow_downgrade</span></tt>, <tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id264">
<h3>Actions<a class="headerlink" href="#id264" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version.</dd>
</dl>
</div>
<div class="section" id="id265">
<h3>Properties<a class="headerlink" href="#id265" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">allow_downgrade</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Downgrade a package to satisfy requested version requirements.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id266">
<h3>Providers<a class="headerlink" href="#id266" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Rpm</span></tt>, <tt class="docutils literal"><span class="pre">rpm_package</span></tt></dt>
<dd>The provider for the RPM Package Manager platform. Can be used with the <tt class="docutils literal"><span class="pre">options</span></tt> attribute.</dd>
</dl>
</div>
<div class="section" id="id267">
<h3>Examples<a class="headerlink" href="#id267" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rpm_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="ruby">
<h2>ruby<a class="headerlink" href="#ruby" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_ruby.rst">[edit on GitHub]</a></p>
<p>Use the <strong>ruby</strong> resource to execute scripts using the Ruby interpreter. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>ruby</strong> script resource (which is based on the <strong>script</strong> resource) is different from the <strong>ruby_block</strong> resource because Ruby code that is run with this resource is created as a temporary file and executed like other script resources, rather than run inline.</p>
</div>
<div class="section" id="id268">
<h3>Syntax<a class="headerlink" href="#id268" title="Permalink to this headline">¶</a></h3>
<p>A <strong>ruby</strong> resource block executes scripts using Ruby:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ruby</span> <span class="s1">&#39;extract_module&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    mkdir -p #{extract_path}</span>
<span class="sh">    tar xzf #{src_filename} -C #{extract_path}</span>
<span class="sh">    mv #{extract_path}/*/* #{extract_path}/</span>
<span class="no">    EOH</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">cwd</span></tt> specifies the directory from which the command is run</li>
<li><tt class="docutils literal"><span class="pre">code</span></tt> specifies the command to run</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>ruby</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ruby</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">code</span>                       <span class="nb">String</span>
  <span class="n">creates</span>                    <span class="nb">String</span>
  <span class="n">cwd</span>                        <span class="nb">String</span>
  <span class="n">environment</span>                <span class="no">Hash</span>
  <span class="n">flags</span>                      <span class="nb">String</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">path</span>                       <span class="nb">Array</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Script</span><span class="o">::</span><span class="no">Ruby</span>
  <span class="n">returns</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Float</span>
  <span class="n">user</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">umask</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :run if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ruby</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">cwd</span></tt> is the location from which the command is run</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">code</span></tt>, <tt class="docutils literal"><span class="pre">creates</span></tt>, <tt class="docutils literal"><span class="pre">cwd</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">flags</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">returns</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt>, and <tt class="docutils literal"><span class="pre">umask</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id269">
<h3>Actions<a class="headerlink" href="#id269" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Prevent a command from running. This action is used to specify that a command is run only when another resource notifies it.</dd>
<dt><tt class="docutils literal"><span class="pre">:run</span></tt></dt>
<dd>Default. Run a script.</dd>
</dl>
</div>
<div class="section" id="id270">
<h3>Properties<a class="headerlink" href="#id270" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">code</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A quoted (&#8221; &#8221;) string of code to be executed.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">creates</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Prevent a command from creating a file when that file already exists.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">cwd</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The current working directory.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">environment</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A Hash of environment variables in the form of <tt class="docutils literal"><span class="pre">({&quot;ENV_VARIABLE&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;VALUE&quot;})</span></tt>. (These variables must exist for a command to be run successfully.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">flags</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One or more command line flags that are passed to the interpreter when a command is invoked.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The group name or group ID that must be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p>An array of paths to use when searching for a command. These paths are not added to the command&#8217;s environment $PATH. The default value uses the system path.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p>For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ruby</span> <span class="s1">&#39;mycommand&#39;</span> <span class="k">do</span>
  <span class="n">environment</span> <span class="s1">&#39;PATH&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/my/path/to/bin:</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PATH&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">returns</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Array</p>
<p class="last">The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Float</p>
<p class="last">The amount of time (in seconds) a command is to wait before timing out. Default value: <tt class="docutils literal"><span class="pre">3600</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The user name or user ID that should be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">umask</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The file mode creation mask, or umask.</p>
</dd>
</dl>
<div class="section" id="id271">
<h4>Guards<a class="headerlink" href="#id271" title="Permalink to this headline">¶</a></h4>
<p>A guard property can be used to evaluate the state of a node during the execution phase of the chef-client run. Based on the results of this evaluation, a guard property is then used to tell the chef-client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p>
<ul class="simple">
<li>A string is executed as a shell command. If the command returns <tt class="docutils literal"><span class="pre">0</span></tt>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <tt class="docutils literal"><span class="pre">true</span></tt> in addition to <tt class="docutils literal"><span class="pre">0</span></tt>.</li>
<li>A block is executed as Ruby code that must return either <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. If the block returns <tt class="docutils literal"><span class="pre">true</span></tt>, the guard property is applied. If the block returns <tt class="docutils literal"><span class="pre">false</span></tt>, the guard property is not applied.</li>
</ul>
<p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for the chef-client to do nothing.</p>
<p><strong>Attributes</strong></p>
<p>The following properties can be used to define a guard that is evaluated during the execution phase of the chef-client run:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">not_if</span></tt></dt>
<dd>Prevent a resource from executing when the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">only_if</span></tt></dt>
<dd>Allow a resource to execute only if the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
</dl>
<p><strong>Arguments</strong></p>
<p>The following arguments can be used with the <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:user</span></tt></dt>
<dd><p class="first">Specify the user that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:group</span></tt></dt>
<dd><p class="first">Specify the group that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:environment</span></tt></dt>
<dd><p class="first">Specify a Hash of environment variables to be set. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/adam&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:cwd</span></tt></dt>
<dd><p class="first">Set the current working directory before running a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam passwd&#39;</span><span class="p">,</span> <span class="ss">:cwd</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:timeout</span></tt></dt>
<dd><p class="first">Set a timeout for a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;sleep 10000&#39;</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span>
</pre></div>
</div>
</dd>
</dl>
</div>
</div>
<div class="section" id="id272">
<h3>Providers<a class="headerlink" href="#id272" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script</span></tt>, <tt class="docutils literal"><span class="pre">script</span></tt></dt>
<dd>When this short name is used, the chef-client will determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script::Ruby</span></tt>, <tt class="docutils literal"><span class="pre">ruby</span></tt></dt>
<dd>The provider for the Ruby command interpreter.</dd>
</dl>
</div>
<div class="section" id="id273">
<h3>Examples<a class="headerlink" href="#id273" title="Permalink to this headline">¶</a></h3>
<p>None.</p>
</div>
</div>
<div class="section" id="ruby-block">
<h2>ruby_block<a class="headerlink" href="#ruby-block" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_ruby_block.rst">[edit on GitHub]</a></p>
<p>Use the <strong>ruby_block</strong> resource to execute Ruby code during a chef-client run. Ruby code in the <tt class="docutils literal"><span class="pre">ruby_block</span></tt> resource is evaluated with other resources during convergence, whereas Ruby code outside of a <tt class="docutils literal"><span class="pre">ruby_block</span></tt> resource is evaluated before other resources, as the recipe is compiled.</p>
<div class="section" id="id274">
<h3>Syntax<a class="headerlink" href="#id274" title="Permalink to this headline">¶</a></h3>
<p>A <strong>ruby_block</strong> resource block executes a block of arbitrary Ruby code. For example, to reload the client.rb file during the chef-client run:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ruby_block</span> <span class="s1">&#39;reload_client_config&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;/etc/chef/client.rb&quot;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>ruby_block</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ruby_block</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">block</span>                      <span class="no">Block</span>
  <span class="n">block_name</span>                 <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">RubyBlock</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :run if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">ruby_block</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">block</span></tt> is the block of Ruby code to be executed</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">block</span></tt>, <tt class="docutils literal"><span class="pre">block_name</span></tt>, and <tt class="docutils literal"><span class="pre">provider</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id275">
<h3>Actions<a class="headerlink" href="#id275" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>The same as <tt class="docutils literal"><span class="pre">:run</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:run</span></tt></dt>
<dd>Default. Run a Ruby block.</dd>
</dl>
</div>
<div class="section" id="id276">
<h3>Properties<a class="headerlink" href="#id276" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">block</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Block</p>
<p class="last">A block of Ruby code.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">block_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of the Ruby block. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="id277">
<h3>Examples<a class="headerlink" href="#id277" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Re-read configuration data</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ruby_block</span> <span class="s1">&#39;reload_client_config&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;/etc/chef/client.rb&#39;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install repositories from a file, trigger a command, and force the internal cache to reload</strong></p>
<p>The following example shows how to install new Yum repositories from a file, where the installation of the repository triggers a creation of the Yum cache that forces the internal cache for the chef-client to reload:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;create-yum-cache&#39;</span> <span class="k">do</span>
 <span class="n">command</span> <span class="s1">&#39;yum -q makecache&#39;</span>
 <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;reload-internal-yum-cache&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Yum</span><span class="o">::</span><span class="no">YumCache</span><span class="o">.</span><span class="n">instance</span><span class="o">.</span><span class="n">reload</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">cookbook_file</span> <span class="s1">&#39;/etc/yum.repos.d/custom.repo&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;custom&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[create-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:create</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload-internal-yum-cache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use an if statement with the platform recipe DSL method</strong></p>
<p>The following example shows how an if statement can be used with the <tt class="docutils literal"><span class="pre">platform?</span></tt> method in the Recipe DSL to run code specific to Microsoft Windows. The code is defined using the <strong>ruby_block</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``client`` recipe</span>
<span class="c1"># in the following cookbook: https://github.com/chef-cookbooks/mysql</span>

<span class="k">if</span> <span class="n">platform?</span><span class="p">(</span><span class="s1">&#39;windows&#39;</span><span class="p">)</span>
  <span class="n">ruby_block</span> <span class="s1">&#39;copy libmysql.dll into ruby path&#39;</span> <span class="k">do</span>
    <span class="n">block</span> <span class="k">do</span>
      <span class="nb">require</span> <span class="s1">&#39;fileutils&#39;</span>
      <span class="no">FileUtils</span><span class="o">.</span><span class="n">cp</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;client&#39;</span><span class="o">][</span><span class="s1">&#39;lib_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="se">\\</span><span class="s2">libmysql.dll&quot;</span><span class="p">,</span>
        <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;client&#39;</span><span class="o">][</span><span class="s1">&#39;ruby_dir&#39;</span><span class="o">]</span>
    <span class="k">end</span>
    <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;client&#39;</span><span class="o">][</span><span class="s1">&#39;ruby_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="se">\\</span><span class="s2">libmysql.dll&quot;</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Stash a file in a data bag</strong></p>
<p>The following example shows how to use the <strong>ruby_block</strong> resource to stash a BitTorrent file in a data bag so that it can be distributed to nodes in the organization.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``seed`` recipe</span>
<span class="c1"># in the following cookbook: https://github.com/mattray/bittorrent-cookbook</span>

<span class="n">ruby_block</span> <span class="s1">&#39;share the torrent file&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="n">f</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;bittorrent&#39;</span><span class="o">][</span><span class="s1">&#39;torrent&#39;</span><span class="o">]</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span>
    <span class="c1">#read the .torrent file and base64 encode it</span>
    <span class="n">enc</span> <span class="o">=</span> <span class="no">Base64</span><span class="o">.</span><span class="n">encode64</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
      <span class="s1">&#39;id&#39;</span><span class="o">=&gt;</span><span class="n">bittorrent_item_id</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;bittorrent&#39;</span><span class="o">][</span><span class="s1">&#39;file&#39;</span><span class="o">]</span><span class="p">),</span>
      <span class="s1">&#39;seed&#39;</span><span class="o">=&gt;</span><span class="n">node</span><span class="o">.</span><span class="n">ipaddress</span><span class="p">,</span>
      <span class="s1">&#39;torrent&#39;</span><span class="o">=&gt;</span><span class="n">enc</span>
    <span class="p">}</span>
    <span class="n">item</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">DataBagItem</span><span class="o">.</span><span class="n">new</span>
    <span class="n">item</span><span class="o">.</span><span class="n">data_bag</span><span class="p">(</span><span class="s1">&#39;bittorrent&#39;</span><span class="p">)</span>
    <span class="n">item</span><span class="o">.</span><span class="n">raw_data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">item</span><span class="o">.</span><span class="n">save</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">subscribes</span> <span class="ss">:create</span><span class="p">,</span> <span class="s2">&quot;bittorrent_torrent[</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;bittorrent&#39;</span><span class="o">][</span><span class="s1">&#39;torrent&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Update the /etc/hosts file</strong></p>
<p>The following example shows how the <strong>ruby_block</strong> resource can be used to update the <tt class="docutils literal"><span class="pre">/etc/hosts</span></tt> file:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``ec2`` recipe</span>
<span class="c1"># in the following cookbook: https://github.com/chef-cookbooks/dynect</span>

<span class="n">ruby_block</span> <span class="s1">&#39;edit etc hosts&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="n">rc</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Util</span><span class="o">::</span><span class="no">FileEdit</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;/etc/hosts&#39;</span><span class="p">)</span>
    <span class="n">rc</span><span class="o">.</span><span class="n">search_file_replace_line</span><span class="p">(</span><span class="sr">/^127\.0\.0\.1 localhost$/</span><span class="p">,</span>
       <span class="s1">&#39;127.0.0.1 #{new_fqdn} #{new_hostname} localhost&#39;</span><span class="p">)</span>
    <span class="n">rc</span><span class="o">.</span><span class="n">write_file</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set environment variables</strong></p>
<p>The following example shows how to use variables within a Ruby block to set environment variables using rbenv.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="o">[</span><span class="ss">:rbenv</span><span class="o">][</span><span class="ss">:root</span><span class="o">]</span> <span class="o">=</span> <span class="n">rbenv_root</span>
<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="o">[</span><span class="ss">:ruby_build</span><span class="o">][</span><span class="ss">:bin_path</span><span class="o">]</span> <span class="o">=</span> <span class="n">rbenv_binary_path</span>

<span class="n">ruby_block</span> <span class="s1">&#39;initialize&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;RBENV_ROOT&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">[</span><span class="ss">:rbenv</span><span class="o">][</span><span class="ss">:root</span><span class="o">]</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PATH&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:rbenv</span><span class="o">][</span><span class="ss">:root</span><span class="o">]</span><span class="si">}</span><span class="s2">/bin:</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:ruby_build</span><span class="o">][</span><span class="ss">:bin_path</span><span class="o">]</span><span class="si">}</span><span class="s2">:</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PATH&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set JAVA_HOME</strong></p>
<p>The following example shows how to use a variable within a Ruby block to set the <tt class="docutils literal"><span class="pre">java_home</span></tt> environment variable:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">ruby_block</span> <span class="s1">&#39;set-env-java-home&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;JAVA_HOME&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="n">java_home</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run specific blocks of Ruby code on specific platforms</strong></p>
<p>The following example shows how the <tt class="docutils literal"><span class="pre">platform?</span></tt> method and an if statement can be used in a recipe along with the <tt class="docutils literal"><span class="pre">ruby_block</span></tt> resource to run certain blocks of Ruby code on certain platforms:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">platform?</span><span class="p">(</span><span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span> <span class="s1">&#39;debian&#39;</span><span class="p">,</span> <span class="s1">&#39;redhat&#39;</span><span class="p">,</span> <span class="s1">&#39;centos&#39;</span><span class="p">,</span> <span class="s1">&#39;fedora&#39;</span><span class="p">,</span> <span class="s1">&#39;scientific&#39;</span><span class="p">,</span> <span class="s1">&#39;amazon&#39;</span><span class="p">)</span>
  <span class="n">ruby_block</span> <span class="s1">&#39;update-java-alternatives&#39;</span> <span class="k">do</span>
    <span class="n">block</span> <span class="k">do</span>
      <span class="k">if</span> <span class="n">platform?</span><span class="p">(</span><span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span> <span class="s1">&#39;debian&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">version</span> <span class="o">==</span> <span class="mi">6</span>
        <span class="n">run_context</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">RunContext</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">r</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Resource</span><span class="o">::</span><span class="no">Execute</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;update-java-alternatives&#39;</span><span class="p">,</span> <span class="n">run_context</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">command</span> <span class="s1">&#39;update-java-alternatives -s java-6-openjdk&#39;</span>
        <span class="n">r</span><span class="o">.</span><span class="n">returns</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">]</span>
        <span class="n">r</span><span class="o">.</span><span class="n">run_action</span><span class="p">(</span><span class="ss">:create</span><span class="p">)</span>
      <span class="k">else</span>

        <span class="nb">require</span> <span class="s1">&#39;fileutils&#39;</span>
        <span class="n">arch</span> <span class="o">=</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;kernel&#39;</span><span class="o">][</span><span class="s1">&#39;machine&#39;</span><span class="o">]</span> <span class="o">=~</span> <span class="sr">/x86_64/</span> <span class="p">?</span> <span class="s1">&#39;x86_64&#39;</span> <span class="p">:</span> <span class="s1">&#39;i386&#39;</span>
        <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;glob is </span><span class="si">#{</span><span class="n">java_home_parent</span><span class="si">}</span><span class="s2">/java*</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">*openjdk*&quot;</span><span class="p">)</span>
        <span class="n">jdk_home</span> <span class="o">=</span> <span class="no">Dir</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">java_home_parent</span><span class="si">}</span><span class="s2">/java*</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">*openjdk{,[-\.]</span><span class="si">#{</span><span class="n">arch</span><span class="si">}</span><span class="s2">}&quot;</span><span class="p">)</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>
        <span class="no">Chef</span><span class="o">::</span><span class="no">Log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;jdk_home is </span><span class="si">#{</span><span class="n">jdk_home</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span> <span class="n">java_home</span>
          <span class="no">FileUtils</span><span class="o">.</span><span class="n">rm_f</span> <span class="n">java_home</span>
        <span class="k">end</span>
        <span class="no">FileUtils</span><span class="o">.</span><span class="n">ln_sf</span> <span class="n">jdk_home</span><span class="p">,</span> <span class="n">java_home</span>

        <span class="n">cmd</span> <span class="o">=</span> <span class="no">Chef</span><span class="o">::</span><span class="no">ShellOut</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
              <span class="sx">%Q[ update-alternatives --install /usr/bin/java java </span><span class="si">#{</span><span class="n">java_home</span><span class="si">}</span><span class="sx">/bin/java 1;</span>
<span class="sx">              update-alternatives --set java </span><span class="si">#{</span><span class="n">java_home</span><span class="si">}</span><span class="sx">/bin/java ]</span>
              <span class="p">)</span><span class="o">.</span><span class="n">run_command</span>
           <span class="k">unless</span> <span class="n">cmd</span><span class="o">.</span><span class="n">exitstatus</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">cmd</span><span class="o">.</span><span class="n">exitstatus</span> <span class="o">==</span> <span class="mi">2</span>
          <span class="no">Chef</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">fatal!</span><span class="p">(</span><span class="s1">&#39;Failed to update-alternatives for openjdk!&#39;</span><span class="p">)</span>
        <span class="k">end</span>
      <span class="k">end</span>
    <span class="k">end</span>
    <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reload the configuration</strong></p>
<p>The following example shows how to reload the configuration of a chef-client using the <strong>remote_file</strong> resource to:</p>
<ul class="simple">
<li>using an if statement to check whether the plugins on a node are the latest versions</li>
<li>identify the location from which Ohai plugins are stored</li>
<li>using the <tt class="docutils literal"><span class="pre">notifies</span></tt> property and a <strong>ruby_block</strong> resource to trigger an update (if required) and to then reload the client.rb file.</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;node[:ohai][:plugin_path]&#39;</span> <span class="k">do</span>
  <span class="n">owner</span> <span class="s1">&#39;chef&#39;</span>
  <span class="n">recursive</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">ruby_block</span> <span class="s1">&#39;reload_config&#39;</span> <span class="k">do</span>
  <span class="n">block</span> <span class="k">do</span>
    <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s1">&#39;/etc/chef/client.rb&#39;</span><span class="p">)</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="ss">:ohai</span><span class="o">].</span><span class="n">key?</span><span class="p">(</span><span class="ss">:plugins</span><span class="p">)</span>
  <span class="n">node</span><span class="o">[</span><span class="ss">:ohai</span><span class="o">][</span><span class="ss">:plugins</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">plugin</span><span class="o">|</span>
    <span class="n">remote_file</span> <span class="n">node</span><span class="o">[</span><span class="ss">:ohai</span><span class="o">][</span><span class="ss">:plugin_path</span><span class="o">]</span> <span class="o">+</span><span class="s2">&quot;/</span><span class="si">#{</span><span class="n">plugin</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
      <span class="n">source</span> <span class="n">plugin</span>
      <span class="n">owner</span> <span class="s1">&#39;chef&#39;</span>
              <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;ruby_block[reload_config]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="script">
<h2>script<a class="headerlink" href="#script" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_script.rst">[edit on GitHub]</a></p>
<p>Use the <strong>script</strong> resource to execute scripts using a specified interpreter, such as Bash, csh, Perl, Python, or Ruby. This resource may also use any of the actions and properties that are available to the <strong>execute</strong> resource. Commands that are executed with this resource are (by their nature) not idempotent, as they are typically unique to the environment in which they are run. Use <tt class="docutils literal"><span class="pre">not_if</span></tt> and <tt class="docutils literal"><span class="pre">only_if</span></tt> to guard this resource for idempotence.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <strong>script</strong> resource is different from the <strong>ruby_block</strong> resource because Ruby code that is run with this resource is created as a temporary file and executed like other script resources, rather than run inline.</p>
</div>
<p>This resource is the base resource for several other resources used for scripting on specific platforms. For more information about specific resources for specific platforms, see the following topics:</p>
<ul class="simple">
<li><a class="reference internal" href="resource_bash.html"><em>bash</em></a></li>
<li><a class="reference internal" href="resource_csh.html"><em>csh</em></a></li>
<li><a class="reference internal" href="resource_ksh.html"><em>ksh</em></a></li>
<li><a class="reference internal" href="resource_perl.html"><em>perl</em></a></li>
<li><a class="reference internal" href="resource_python.html"><em>python</em></a></li>
<li><a class="reference internal" href="resource_ruby.html"><em>ruby</em></a></li>
</ul>
<div class="section" id="id278">
<h3>Syntax<a class="headerlink" href="#id278" title="Permalink to this headline">¶</a></h3>
<p>A <strong>script</strong> resource block typically executes scripts using a specified interpreter, such as Bash, csh, Perl, Python, or Ruby:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">script</span> <span class="s1">&#39;extract_module&#39;</span> <span class="k">do</span>
  <span class="n">interpreter</span> <span class="s2">&quot;bash&quot;</span>
  <span class="n">cwd</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    mkdir -p #{extract_path}</span>
<span class="sh">    tar xzf #{src_filename} -C #{extract_path}</span>
<span class="sh">    mv #{extract_path}/*/* #{extract_path}/</span>
<span class="no">    EOH</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">interpreter</span></tt> specifies the command shell to use</li>
<li><tt class="docutils literal"><span class="pre">cwd</span></tt> specifies the directory from which the command is run</li>
<li><tt class="docutils literal"><span class="pre">code</span></tt> specifies the command to run</li>
</ul>
<p>It is more common to use the <strong>script</strong>-based resource that is specific to the command shell. Chef has shell-specific resources for Bash, csh, Perl, Python, and Ruby.</p>
<p>The same command as above, but run using the <strong>bash</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;extract_module&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    mkdir -p #{extract_path}</span>
<span class="sh">    tar xzf #{src_filename} -C #{extract_path}</span>
<span class="sh">    mv #{extract_path}/*/* #{extract_path}/</span>
<span class="no">    EOH</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>script</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">script</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">code</span>                       <span class="nb">String</span>
  <span class="n">creates</span>                    <span class="nb">String</span>
  <span class="n">cwd</span>                        <span class="nb">String</span>
  <span class="n">environment</span>                <span class="no">Hash</span>
  <span class="n">flags</span>                      <span class="nb">String</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">interpreter</span>                <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">path</span>                       <span class="nb">Array</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Script</span>
  <span class="n">returns</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Float</span>
  <span class="n">user</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">umask</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :run if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">script</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">cwd</span></tt> is the location from which the command is run</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">code</span></tt>, <tt class="docutils literal"><span class="pre">creates</span></tt>, <tt class="docutils literal"><span class="pre">cwd</span></tt>, <tt class="docutils literal"><span class="pre">environment</span></tt>, <tt class="docutils literal"><span class="pre">flags</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">interpreter</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">returns</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt>, and <tt class="docutils literal"><span class="pre">umask</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id279">
<h3>Actions<a class="headerlink" href="#id279" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Prevent a command from running. This action is used to specify that a command is run only when another resource notifies it.</dd>
<dt><tt class="docutils literal"><span class="pre">:run</span></tt></dt>
<dd>Default. Run a script.</dd>
</dl>
</div>
<div class="section" id="id280">
<h3>Properties<a class="headerlink" href="#id280" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following attributes:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">code</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A quoted (&#8221; &#8221;) string of code to be executed.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">creates</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Prevent a command from creating a file when that file already exists.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">cwd</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The current working directory.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">environment</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A Hash of environment variables in the form of <tt class="docutils literal"><span class="pre">({&quot;ENV_VARIABLE&quot;</span> <span class="pre">=&gt;</span> <span class="pre">&quot;VALUE&quot;})</span></tt>. (These variables must exist for a command to be run successfully.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">flags</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One or more command line flags that are passed to the interpreter when a command is invoked.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The group name or group ID that must be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">interpreter</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The script interpreter to use during code execution.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p>An array of paths to use when searching for a command. These paths are not added to the command&#8217;s environment $PATH. The default value uses the system path.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p>For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">script</span> <span class="s1">&#39;mycommand&#39;</span> <span class="k">do</span>
  <span class="n">environment</span> <span class="s1">&#39;PATH&#39;</span> <span class="o">=&gt;</span> <span class="s2">&quot;/my/path/to/bin:</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;PATH&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">returns</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Array</p>
<p class="last">The return value for a command. This may be an array of accepted values. An exception is raised when the return value(s) do not match. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Float</p>
<p class="last">The amount of time (in seconds) a command is to wait before timing out. Default value: <tt class="docutils literal"><span class="pre">3600</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The user name or user ID that should be changed before running a command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">umask</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The file mode creation mask, or umask.</p>
</dd>
</dl>
<div class="section" id="id281">
<h4>Guards<a class="headerlink" href="#id281" title="Permalink to this headline">¶</a></h4>
<p>A guard property can be used to evaluate the state of a node during the execution phase of the chef-client run. Based on the results of this evaluation, a guard property is then used to tell the chef-client if it should continue executing a resource. A guard property accepts either a string value or a Ruby block value:</p>
<ul class="simple">
<li>A string is executed as a shell command. If the command returns <tt class="docutils literal"><span class="pre">0</span></tt>, the guard is applied. If the command returns any other value, then the guard property is not applied. String guards in a <strong>powershell_script</strong> run Windows PowerShell commands and may return <tt class="docutils literal"><span class="pre">true</span></tt> in addition to <tt class="docutils literal"><span class="pre">0</span></tt>.</li>
<li>A block is executed as Ruby code that must return either <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. If the block returns <tt class="docutils literal"><span class="pre">true</span></tt>, the guard property is applied. If the block returns <tt class="docutils literal"><span class="pre">false</span></tt>, the guard property is not applied.</li>
</ul>
<p>A guard property is useful for ensuring that a resource is idempotent by allowing that resource to test for the desired state as it is being executed, and then if the desired state is present, for the chef-client to do nothing.</p>
<p><strong>Attributes</strong></p>
<p>The following properties can be used to define a guard that is evaluated during the execution phase of the chef-client run:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">not_if</span></tt></dt>
<dd>Prevent a resource from executing when the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">only_if</span></tt></dt>
<dd>Allow a resource to execute only if the condition returns <tt class="docutils literal"><span class="pre">true</span></tt>.</dd>
</dl>
<p><strong>Arguments</strong></p>
<p>The following arguments can be used with the <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:user</span></tt></dt>
<dd><p class="first">Specify the user that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:user</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:group</span></tt></dt>
<dd><p class="first">Specify the group that a command will run as. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:group</span> <span class="o">=&gt;</span> <span class="s1">&#39;adam&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:environment</span></tt></dt>
<dd><p class="first">Specify a Hash of environment variables to be set. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam /etc/passwd&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="s1">&#39;HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/home/adam&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:cwd</span></tt></dt>
<dd><p class="first">Set the current working directory before running a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;grep adam passwd&#39;</span><span class="p">,</span> <span class="ss">:cwd</span> <span class="o">=&gt;</span> <span class="s1">&#39;/etc&#39;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">:timeout</span></tt></dt>
<dd><p class="first">Set a timeout for a command. For example:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">not_if</span> <span class="s1">&#39;sleep 10000&#39;</span><span class="p">,</span> <span class="ss">:timeout</span> <span class="o">=&gt;</span> <span class="mi">10</span>
</pre></div>
</div>
</dd>
</dl>
</div>
<div class="section" id="guard-interpreter">
<h4>Guard Interpreter<a class="headerlink" href="#guard-interpreter" title="Permalink to this headline">¶</a></h4>
<p>Any resource that passes a string command may also specify the interpreter that will be used to evaluate that string command. This is done by using the <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property to specify a <strong>script</strong>-based resource.</p>
<p><strong>Attributes</strong></p>
<p>The <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property may be set to any of the following values:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:bash</span></tt></dt>
<dd>Evaluates a string command using the <strong>bash</strong> resource.</dd>
<dt><tt class="docutils literal"><span class="pre">:batch</span></tt></dt>
<dd>Evaluates a string command using the <strong>batch</strong> resource. Default value (within a <strong>batch</strong> resource block): <tt class="docutils literal"><span class="pre">:batch</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">:csh</span></tt></dt>
<dd>Evaluates a string command using the <strong>csh</strong> resource.</dd>
<dt><tt class="docutils literal"><span class="pre">:default</span></tt></dt>
<dd>Default. Executes the default interpreter as identified by the chef-client.</dd>
<dt><tt class="docutils literal"><span class="pre">:perl</span></tt></dt>
<dd>Evaluates a string command using the <strong>perl</strong> resource.</dd>
<dt><tt class="docutils literal"><span class="pre">:powershell_script</span></tt></dt>
<dd>Evaluates a string command using the <strong>powershell_script</strong> resource. Default value (within a <strong>batch</strong> resource block): <tt class="docutils literal"><span class="pre">:powershell_script</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">:python</span></tt></dt>
<dd>Evaluates a string command using the <strong>python</strong> resource.</dd>
<dt><tt class="docutils literal"><span class="pre">:ruby</span></tt></dt>
<dd>Evaluates a string command using the <strong>ruby</strong> resource.</dd>
</dl>
<p><strong>Inheritance</strong></p>
<p>The <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property is set to <tt class="docutils literal"><span class="pre">:default</span></tt> by default for the <strong>bash</strong>, <strong>csh</strong>, <strong>perl</strong>, <strong>python</strong>, and <strong>ruby</strong> resources. When the <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property is set to <tt class="docutils literal"><span class="pre">:default</span></tt>, <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard statements <strong>do not inherit</strong> properties that are defined by the <strong>script</strong>-based resource.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The <strong>batch</strong> and <strong>powershell_script</strong> resources inherit properties by default. The <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property is set to <tt class="docutils literal"><span class="pre">:batch</span></tt> or <tt class="docutils literal"><span class="pre">:powershell_script</span></tt> automatically when using a <tt class="docutils literal"><span class="pre">not_if</span></tt> or <tt class="docutils literal"><span class="pre">only_if</span></tt> guard statement within a <strong>batch</strong> or <strong>powershell_script</strong> resource, respectively.</p>
</div>
<p>For example, the <tt class="docutils literal"><span class="pre">not_if</span></tt> guard statement in the following resource example <strong>does not inherit</strong> the <tt class="docutils literal"><span class="pre">environment</span></tt> property:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;javatooling&#39;</span> <span class="k">do</span>
  <span class="n">environment</span> <span class="s1">&#39;JAVA_HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/lib/java/jdk1.7/home&#39;</span>
  <span class="n">code</span> <span class="s1">&#39;java-based-daemon-ctl.sh -start&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;java-based-daemon-ctl.sh -test-started&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and requires adding the <tt class="docutils literal"><span class="pre">environment</span></tt> property to the <tt class="docutils literal"><span class="pre">not_if</span></tt> guard statement so that it may use the <tt class="docutils literal"><span class="pre">JAVA_HOME</span></tt> path as part of its evaluation:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;javatooling&#39;</span> <span class="k">do</span>
  <span class="n">environment</span> <span class="s1">&#39;JAVA_HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/lib/java/jdk1.7/home&#39;</span>
  <span class="n">code</span> <span class="s1">&#39;java-based-daemon-ctl.sh -start&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;java-based-daemon-ctl.sh -test-started&#39;</span><span class="p">,</span> <span class="ss">:environment</span> <span class="o">=&gt;</span> <span class="s1">&#39;JAVA_HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/lib/java/jdk1.7/home&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>To inherit properties, add the <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property to the resource block and set it to the appropriate value:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">:bash</span></tt> for <strong>bash</strong></li>
<li><tt class="docutils literal"><span class="pre">:csh</span></tt> for <strong>csh</strong></li>
<li><tt class="docutils literal"><span class="pre">:perl</span></tt> for <strong>perl</strong></li>
<li><tt class="docutils literal"><span class="pre">:python</span></tt> for <strong>python</strong></li>
<li><tt class="docutils literal"><span class="pre">:ruby</span></tt> for <strong>ruby</strong></li>
</ul>
<p>For example, using the same example as from above, but this time adding the <tt class="docutils literal"><span class="pre">guard_interpreter</span></tt> property and setting it to <tt class="docutils literal"><span class="pre">:bash</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;javatooling&#39;</span> <span class="k">do</span>
  <span class="n">guard_interpreter</span> <span class="ss">:bash</span>
  <span class="n">environment</span> <span class="s1">&#39;JAVA_HOME&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/lib/java/jdk1.7/home&#39;</span>
  <span class="n">code</span> <span class="s1">&#39;java-based-daemon-ctl.sh -start&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;java-based-daemon-ctl.sh -test-started&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">not_if</span></tt> statement now inherits the <tt class="docutils literal"><span class="pre">environment</span></tt> property and will use the <tt class="docutils literal"><span class="pre">JAVA_HOME</span></tt> path as part of its evaluation.</p>
<p><strong>Example</strong></p>
<p>For example, the following code block will ensure the command is evaluated using the default intepreter as identified by the chef-client:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">guard_interpreter</span> <span class="ss">:default</span>
  <span class="c1"># code</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id282">
<h3>Providers<a class="headerlink" href="#id282" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script</span></tt>, <tt class="docutils literal"><span class="pre">script</span></tt></dt>
<dd>When this short name is used, the chef-client will determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script::Bash</span></tt>, <tt class="docutils literal"><span class="pre">bash</span></tt></dt>
<dd>The provider for the Bash command interpreter.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script::Csh</span></tt>, <tt class="docutils literal"><span class="pre">csh</span></tt></dt>
<dd>The provider for the csh command interpreter.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script::Perl</span></tt>, <tt class="docutils literal"><span class="pre">perl</span></tt></dt>
<dd>The provider for the Perl command interpreter.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script::Python</span></tt>, <tt class="docutils literal"><span class="pre">python</span></tt></dt>
<dd>The provider for the Python command interpreter.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Script::Ruby</span></tt>, <tt class="docutils literal"><span class="pre">ruby</span></tt></dt>
<dd>The provider for the Ruby command interpreter.</dd>
</dl>
</div>
<div class="section" id="id283">
<h3>Examples<a class="headerlink" href="#id283" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Use a named provider to run a script</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;install_something&#39;</span> <span class="k">do</span>
  <span class="n">user</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">cwd</span> <span class="s1">&#39;/tmp&#39;</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  wget http://www.example.com/tarball.tar.gz</span>
<span class="sh">  tar -zxf tarball.tar.gz</span>
<span class="sh">  cd tarball</span>
<span class="sh">  ./configure</span>
<span class="sh">  make</span>
<span class="sh">  make install</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Run a script</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">script</span> <span class="s1">&#39;install_something&#39;</span> <span class="k">do</span>
  <span class="n">interpreter</span> <span class="s1">&#39;bash&#39;</span>
  <span class="n">user</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">cwd</span> <span class="s1">&#39;/tmp&#39;</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">  wget http://www.example.com/tarball.tar.gz</span>
<span class="sh">  tar -zxf tarball.tar.gz</span>
<span class="sh">  cd tarball</span>
<span class="sh">  ./configure</span>
<span class="sh">  make</span>
<span class="sh">  make install</span>
<span class="no">  EOH</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or something like:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">bash</span> <span class="s1">&#39;openvpn-server-key&#39;</span> <span class="k">do</span>
  <span class="n">environment</span><span class="p">(</span><span class="s1">&#39;KEY_CN&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;server&#39;</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span>
<span class="sh">    openssl req -batch -days #{node[&#39;openvpn&#39;][&#39;key&#39;][&#39;expire&#39;]} \</span>
<span class="sh">      -nodes -new -newkey rsa:#{key_size} -keyout #{key_dir}/server.key \</span>
<span class="sh">      -out #{key_dir}/server.csr -extensions server \</span>
<span class="sh">      -config #{key_dir}/openssl.cnf</span>
<span class="no">  EOF</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;#{key_dir}/server.crt&#39;</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">code</span></tt> contains the OpenSSL command to be run. The <tt class="docutils literal"><span class="pre">not_if</span></tt> property tells the chef-client not to run the command if the file already exists.</p>
<p><strong>Install a file from a remote location using bash</strong></p>
<p>The following is an example of how to install the <tt class="docutils literal"><span class="pre">foo123</span></tt> module for Nginx. This module adds shell-style functionality to an Nginx configuration file and does the following:</p>
<ul class="simple">
<li>Declares three variables</li>
<li>Gets the Nginx file from a remote location</li>
<li>Installs the file using Bash to the path specified by the <tt class="docutils literal"><span class="pre">src_filepath</span></tt> variable</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample is similar to the ``upload_progress_module``</span>
<span class="c1"># recipe in the ``nginx`` cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/nginx</span>

<span class="n">src_filename</span> <span class="o">=</span> <span class="s2">&quot;foo123-nginx-module-v</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">.tar.gz&quot;</span>
<span class="n">src_filepath</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">src_filename</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">extract_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span>
  <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="s1">&#39;file_cache_path&#39;</span><span class="o">]</span>
  <span class="si">}</span><span class="s2">/nginx_foo123_module/</span><span class="si">#{</span>
  <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
<span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s1">&#39;src_filepath&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;foo123&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;extract_module&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">src_filepath</span><span class="p">)</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">    mkdir -p #{extract_path}</span>
<span class="sh">    tar xzf #{src_filename} -C #{extract_path}</span>
<span class="sh">    mv #{extract_path}/*/* #{extract_path}/</span>
<span class="no">    EOH</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">extract_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Install an application from git using bash</strong></p>
<p>The following example shows how Bash can be used to install a plug-in for rbenv named <tt class="docutils literal"><span class="pre">ruby-build</span></tt>, which is located in git version source control. First, the application is synchronized, and then Bash changes its working directory to the location in which <tt class="docutils literal"><span class="pre">ruby-build</span></tt> is located, and then runs a command.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span> <span class="n">git</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/ruby-build&quot;</span> <span class="k">do</span>
   <span class="n">repository</span> <span class="s1">&#39;git://github.com/sstephenson/ruby-build.git&#39;</span>
   <span class="n">reference</span> <span class="s1">&#39;master&#39;</span>
   <span class="n">action</span> <span class="ss">:sync</span>
 <span class="k">end</span>

 <span class="n">bash</span> <span class="s1">&#39;install_ruby_build&#39;</span> <span class="k">do</span>
   <span class="n">cwd</span> <span class="s1">&#39;#{Chef::Config[:file_cache_path]}/ruby-build&#39;</span>
   <span class="n">user</span> <span class="s1">&#39;rbenv&#39;</span>
   <span class="n">group</span> <span class="s1">&#39;rbenv&#39;</span>
   <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOH</span>
<span class="sh">     ./install.sh</span>
<span class="no">     EOH</span>
   <span class="n">environment</span> <span class="s1">&#39;PREFIX&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;/usr/local&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>To read more about <tt class="docutils literal"><span class="pre">ruby-build</span></tt>, see here: <a class="reference external" href="https://github.com/sstephenson/ruby-build">https://github.com/sstephenson/ruby-build</a>.</p>
<p><strong>Store certain settings</strong></p>
<p>The following recipe shows how an attributes file can be used to store certain settings. An attributes file is located in the <tt class="docutils literal"><span class="pre">attributes/</span></tt> directory in the same cookbook as the recipe which calls the attributes file. In this example, the attributes file specifies certain settings for Python that are then used across all nodes against which this recipe will run.</p>
<p>Python packages have versions, installation directories, URLs, and checksum files. An attributes file that exists to support this type of recipe would include settings like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;2.7.1&#39;</span>

<span class="k">if</span> <span class="n">python</span><span class="o">[</span><span class="s1">&#39;install_method&#39;</span><span class="o">]</span> <span class="o">==</span> <span class="s1">&#39;package&#39;</span>
  <span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/usr&#39;</span>
<span class="k">else</span>
  <span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/usr/local&#39;</span>
<span class="k">end</span>

<span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;http://www.python.org/ftp/python&#39;</span>
<span class="n">default</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;80e387...85fd61&#39;</span>
</pre></div>
</div>
<p>and then the methods in the recipe may refer to these values. A recipe that is used to install Python will need to do the following:</p>
<ul class="simple">
<li>Identify each package to be installed (implied in this example, not shown)</li>
<li>Define variables for the package <tt class="docutils literal"><span class="pre">version</span></tt> and the <tt class="docutils literal"><span class="pre">install_path</span></tt></li>
<li>Get the package from a remote location, but only if the package does not already exist on the target system</li>
<li>Use the <strong>bash</strong> resource to install the package on the node, but only when the package is not already installed</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#  the following code sample comes from the ``oc-nginx`` cookbook on |github|: https://github.com/cookbooks/oc-nginx</span>

<span class="n">version</span> <span class="o">=</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;version&#39;</span><span class="o">]</span>
<span class="n">install_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;prefix_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/lib/python</span><span class="si">#{</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="sr">/(^\d+\.\d+)/</span><span class="p">)</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">remote_file</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span><span class="si">}</span><span class="s2">/Python-</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">.tar.bz2&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;url&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">/Python-</span><span class="si">#{</span><span class="n">version</span><span class="si">}</span><span class="s2">.tar.bz2&quot;</span>
  <span class="n">checksum</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;python&#39;</span><span class="o">][</span><span class="s1">&#39;checksum&#39;</span><span class="o">]</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">install_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>

<span class="n">bash</span> <span class="s1">&#39;build-and-install-python&#39;</span> <span class="k">do</span>
  <span class="n">cwd</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Config</span><span class="o">[</span><span class="ss">:file_cache_path</span><span class="o">]</span>
  <span class="n">code</span> <span class="o">&lt;&lt;-</span><span class="no">EOF</span>
<span class="sh">    tar -jxvf Python-#{version}.tar.bz2</span>
<span class="sh">    (cd Python-#{version} &amp;&amp; ./configure #{configure_options})</span>
<span class="sh">    (cd Python-#{version} &amp;&amp; make &amp;&amp; make install)</span>
<span class="no">  EOF</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="o">::</span><span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="n">install_path</span><span class="p">)</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="service">
<h2>service<a class="headerlink" href="#service" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_service.rst">[edit on GitHub]</a></p>
<p>Use the <strong>service</strong> resource to manage a service.</p>
<div class="section" id="id284">
<h3>Syntax<a class="headerlink" href="#id284" title="Permalink to this headline">¶</a></h3>
<p>A <strong>service</strong> resource block manages the state of a service. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s2">&quot;tomcat&quot;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
<span class="k">end</span>
</pre></div>
</div>
<p>will start the Apache Tomcat service.</p>
<p>The full syntax for all of the properties that are available to the <strong>service</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">init_command</span>               <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">pattern</span>                    <span class="nb">String</span>
  <span class="n">priority</span>                   <span class="nb">Integer</span><span class="p">,</span> <span class="nb">String</span><span class="p">,</span> <span class="no">Hash</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span>
  <span class="n">reload_command</span>             <span class="nb">String</span>
  <span class="n">restart_command</span>            <span class="nb">String</span>
  <span class="n">service_name</span>               <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">start_command</span>              <span class="nb">String</span>
  <span class="n">status_command</span>             <span class="nb">String</span>
  <span class="n">stop_command</span>               <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">supports</span>                   <span class="no">Hash</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span> <span class="c1"># Microsoft Windows only</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :nothing if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">service</span></tt> is the resource; depending on the platform, more specific providers are run: <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Debian</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Upstart</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Freebsd</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Gentoo</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Redhat</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Solaris</span></tt>, <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Windows</span></tt>, or <tt class="docutils literal"><span class="pre">Chef::Provider::Service::Macosx</span></tt></li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block; when the <tt class="docutils literal"><span class="pre">path</span></tt> property is not specified, <tt class="docutils literal"><span class="pre">name</span></tt> is also the path to the directory, from the root</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">init_command</span></tt>, <tt class="docutils literal"><span class="pre">pattern</span></tt>, <tt class="docutils literal"><span class="pre">priority</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">reload_command</span></tt>, <tt class="docutils literal"><span class="pre">restart_command</span></tt>, <tt class="docutils literal"><span class="pre">service_name</span></tt>, <tt class="docutils literal"><span class="pre">start_command</span></tt>, <tt class="docutils literal"><span class="pre">status_command</span></tt>, <tt class="docutils literal"><span class="pre">stop_command</span></tt>, <tt class="docutils literal"><span class="pre">supports</span></tt>, and <tt class="docutils literal"><span class="pre">timeout</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id285">
<h3>Actions<a class="headerlink" href="#id285" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:disable</span></tt></dt>
<dd>Disable a service. This action is equivalent to a <tt class="docutils literal"><span class="pre">Disabled</span></tt> startup type on the Microsoft Windows platform. This action is not supported when using System Resource Controller (SRC) on the AIX platform because System Resource Controller (SRC) does not have a standard mechanism for enabling and disabling services on system boot.</dd>
<dt><tt class="docutils literal"><span class="pre">:enable</span></tt></dt>
<dd>Enable a service at boot. This action is equivalent to an <tt class="docutils literal"><span class="pre">Automatic</span></tt> startup type on the Microsoft Windows platform. This action is not supported when using System Resource Controller (SRC) on the AIX platform because System Resource Controller (SRC) does not have a standard mechanism for enabling and disabling services on system boot.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Default. Do nothing with a service.</dd>
<dt><tt class="docutils literal"><span class="pre">:reload</span></tt></dt>
<dd>Reload the configuration for this service.</dd>
<dt><tt class="docutils literal"><span class="pre">:restart</span></tt></dt>
<dd>Restart a service.</dd>
<dt><tt class="docutils literal"><span class="pre">:start</span></tt></dt>
<dd>Start a service, and keep it running until stopped or disabled.</dd>
<dt><tt class="docutils literal"><span class="pre">:stop</span></tt></dt>
<dd>Stop a service.</dd>
</dl>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To mange a Microsoft Windows service with a <tt class="docutils literal"><span class="pre">Manual</span></tt> startup type, the <strong>windows_service</strong> resource must be used.</p>
</div>
</div>
<div class="section" id="id286">
<h3>Properties<a class="headerlink" href="#id286" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">init_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The path to the init script that is associated with the service. Use <tt class="docutils literal"><span class="pre">init_command</span></tt> to prevent the need to specify overrides for the <tt class="docutils literal"><span class="pre">start_command</span></tt>, <tt class="docutils literal"><span class="pre">stop_command</span></tt>, and <tt class="docutils literal"><span class="pre">restart_command</span></tt> properties. When this property is not specified, the chef-client will use the default init command for the service provider being used.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">pattern</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The pattern to look for in the process table. Default value: <tt class="docutils literal"><span class="pre">service_name</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">priority</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String, Hash</p>
<p class="last">Debian platform only. The relative priority of the program for start and shutdown ordering. May be an integer or a Hash. An integer is used to define the start run levels; stop run levels are then 100-integer. A Hash is used to define values for specific run levels. For example, <tt class="docutils literal"><span class="pre">{</span> <span class="pre">2</span> <span class="pre">=&gt;</span> <span class="pre">[:start,</span> <span class="pre">20],</span> <span class="pre">3</span> <span class="pre">=&gt;</span> <span class="pre">[:stop,</span> <span class="pre">55]</span> <span class="pre">}</span></tt> will set a priority of twenty for run level two and a priority of fifty-five for run level three.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">reload_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The command used to tell a service to reload its configuration.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">restart_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The command used to restart a service.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">service_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of the service. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">start_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The command used to start a service.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">status_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The command used to check the run status for a service.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">stop_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The command used to stop a service.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">supports</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A list of properties that controls how the chef-client is to attempt to manage a service: <tt class="docutils literal"><span class="pre">:restart</span></tt>, <tt class="docutils literal"><span class="pre">:reload</span></tt>, <tt class="docutils literal"><span class="pre">:status</span></tt>. For <tt class="docutils literal"><span class="pre">:restart</span></tt>, the init script or other service provider can use a restart command; if <tt class="docutils literal"><span class="pre">:restart</span></tt> is not specified, the chef-client attempts to stop and then start a service. For <tt class="docutils literal"><span class="pre">:reload</span></tt>, the init script or other service provider can use a reload command. For <tt class="docutils literal"><span class="pre">:status</span></tt>, the init script or other service provider can use a status command to determine if the service is running; if <tt class="docutils literal"><span class="pre">:status</span></tt> is not specified, the chef-client attempts to match the <tt class="docutils literal"><span class="pre">service_name</span></tt> against the process table as a regular expression, unless a pattern is specified as a parameter property. Default value: <tt class="docutils literal"><span class="pre">{</span> <span class="pre">:restart</span> <span class="pre">=&gt;</span> <span class="pre">false,</span> <span class="pre">:reload</span> <span class="pre">=&gt;</span> <span class="pre">false,</span> <span class="pre">:status</span> <span class="pre">=&gt;</span> <span class="pre">false</span> <span class="pre">}</span></tt> for all platforms (except for the Red Hat platform family, which defaults to <tt class="docutils literal"><span class="pre">{</span> <span class="pre">:restart</span> <span class="pre">=&gt;</span> <span class="pre">false,</span> <span class="pre">:reload</span> <span class="pre">=&gt;</span> <span class="pre">false,</span> <span class="pre">:status</span> <span class="pre">=&gt;</span> <span class="pre">true</span> <span class="pre">}</span></tt>.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">Microsoft Windows platform only. The amount of time (in seconds) to wait before timing out. Default value: <tt class="docutils literal"><span class="pre">60</span></tt>.</p>
</dd>
</dl>
</div>
<div class="section" id="id287">
<h3>Providers<a class="headerlink" href="#id287" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>The <strong>service</strong> resource does not have service-specific short names. This is because the chef-client identifies the platform at the start of every chef-client run based on data collected by Ohai. The chef-client looks up the platform, and then determines the correct provider for that platform. In certain situations, such as when more than one init system is available on a node, a specific provider may need to be identified by using the <tt class="docutils literal"><span class="pre">provider</span></tt> attribute and the long name for that provider.</p>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init</span></tt>, <tt class="docutils literal"><span class="pre">service</span></tt></dt>
<dd>When this short name is used, the chef-client will determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Aix</span></tt>, <tt class="docutils literal"><span class="pre">service</span></tt></dt>
<dd>Default on the AIX platform. The provider that is used to start, stop, and restart services with System Resource Controller (SRC).</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Service::AixInit</span></tt></dt>
<dd>Use the long name&#8212;<tt class="docutils literal"><span class="pre">Chef::Provider::Service::AixInit</span></tt>&#8212;in a recipe to manage services with BSD-based init systems on the AIX platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Debian</span></tt>, <tt class="docutils literal"><span class="pre">service</span></tt></dt>
<dd>The provider for the Debian and Ubuntu platforms.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Freebsd</span></tt>, <tt class="docutils literal"><span class="pre">service</span></tt></dt>
<dd>The provider for the FreeBSD platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Gentoo</span></tt>, <tt class="docutils literal"><span class="pre">service</span></tt></dt>
<dd>The provider for the Gentoo platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Init::Redhat</span></tt>, <tt class="docutils literal"><span class="pre">service</span></tt></dt>
<dd>The provider for the Red Hat and CentOS platforms.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Simple</span></tt></dt>
<dd>A provider that is used to create custom service providers by defining the custom provider as a sub-class of this provider. This provider should not be used in recipes as a value of the <tt class="docutils literal"><span class="pre">provider</span></tt> attribute.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Solaris</span></tt>, <tt class="docutils literal"><span class="pre">service</span></tt></dt>
<dd>The provider for the Solaris platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Systemd</span></tt>, <tt class="docutils literal"><span class="pre">systemd</span></tt></dt>
<dd>The provider that is used when systemd is available on the platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Upstart</span></tt>, <tt class="docutils literal"><span class="pre">service</span></tt></dt>
<dd>The provider that is used when Upstart is available on the platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Windows</span></tt>, <tt class="docutils literal"><span class="pre">service</span></tt></dt>
<dd>The provider for the Microsoft Windows platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Service::Macosx</span></tt>, <tt class="docutils literal"><span class="pre">service</span></tt></dt>
<dd>The provider for the Mac OS X platform.</dd>
</dl>
</div>
<div class="section" id="id288">
<h3>Examples<a class="headerlink" href="#id288" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Start a service</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;example_service&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Start a service, enable it</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;example_service&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a pattern</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;samba&#39;</span> <span class="k">do</span>
  <span class="n">pattern</span> <span class="s1">&#39;smbd&#39;</span>
  <span class="n">action</span> <span class="o">[</span><span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the :nothing common action</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;memcached&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:stop</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the supports common attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;apache&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the supports and providers common attributes</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;some_service&#39;</span> <span class="k">do</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Upstart</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Manage a service, depending on the node platform</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;example_service&#39;</span> <span class="k">do</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">&#39;centos&#39;</span><span class="p">,</span><span class="s1">&#39;redhat&#39;</span><span class="p">,</span><span class="s1">&#39;fedora&#39;</span>
    <span class="n">service_name</span> <span class="s1">&#39;redhat_name&#39;</span>
  <span class="k">else</span>
    <span class="n">service_name</span> <span class="s1">&#39;other_name&#39;</span>
  <span class="k">end</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="o">[</span> <span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Change a service provider, depending on the node platform</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;example_service&#39;</span> <span class="k">do</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">&#39;ubuntu&#39;</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform_version&#39;</span><span class="o">].</span><span class="n">to_f</span> <span class="o">&gt;=</span> <span class="mi">9</span><span class="o">.</span><span class="mi">10</span>
      <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Upstart</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="o">[</span><span class="ss">:enable</span><span class="p">,</span> <span class="ss">:start</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reload a service using a template</strong></p>
<p>To reload a service based on a template, use the <strong>template</strong> and <strong>service</strong> resources together in the same recipe, similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
<span class="k">end</span>

<span class="n">service</span> <span class="s1">&#39;apache&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
  <span class="n">subscribes</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;template[/tmp/somefile]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">subscribes</span></tt> notification is used to reload the service using the template specified by the <strong>template</strong> resource.</p>
<p><strong>Enable a service after a restart or reload</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;apache&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:enable</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Set an IP address using variables and a template</strong></p>
<p>The following example shows how the <strong>template</strong> resource can be used in a recipe to combine settings stored in an attributes file, variables within a recipe, and a template to set the IP addresses that are used by the Nginx service. The attributes file contains the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/etc/nginx&#39;</span>
</pre></div>
</div>
<p>The recipe then does the following to:</p>
<ul class="simple">
<li>Declare two variables at the beginning of the recipe, one for the remote IP address and the other for the authorized IP address</li>
<li>Use the <strong>service</strong> resource to restart and reload the Nginx service</li>
<li>Load a template named <tt class="docutils literal"><span class="pre">authorized_ip.erb</span></tt> from the <tt class="docutils literal"><span class="pre">/templates</span></tt> directory that is used to set the IP address values based on the variables specified in the recipe</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;remote_ip_var&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;remote_addr&#39;</span>
<span class="n">node</span><span class="o">.</span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;authorized_ips&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;127.0.0.1/32&#39;</span><span class="o">]</span>

<span class="n">service</span> <span class="s1">&#39;nginx&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;authorized_ip&#39;</span> <span class="k">do</span>
  <span class="n">path</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/authorized_ip&quot;</span>
  <span class="n">source</span> <span class="s1">&#39;modules/authorized_ip.erb&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="ss">:remote_ip_var</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;remote_ip_var&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:authorized_ips</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;authorized_ips&#39;</span><span class="o">]</span>
  <span class="p">)</span>

  <span class="n">notifies</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;service[nginx]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">variables</span></tt> property tells the template to use the variables set at the beginning of the recipe and the <tt class="docutils literal"><span class="pre">source</span></tt> property is used to call a template file located in the cookbook&#8217;s <tt class="docutils literal"><span class="pre">/templates</span></tt> directory. The template file looks similar to:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">geo</span> <span class="vg">$&lt;</span><span class="sx">%= @remote_ip_var %&gt; $authorized_ip {</span>
<span class="sx">  default no;</span>
<span class="sx">  &lt;% @authorized_ips.each do |ip| %&gt;</span>
<span class="sx">  &lt;%=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> yes;&quot;</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;% end %&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Use a cron timer to manage a service</strong></p>
<p>The following example shows how to install the crond application using two resources and a variable:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``cron`` cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/cron</span>

<span class="n">cron_package</span> <span class="o">=</span> <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">&#39;redhat&#39;</span><span class="p">,</span> <span class="s1">&#39;centos&#39;</span><span class="p">,</span> <span class="s1">&#39;scientific&#39;</span><span class="p">,</span> <span class="s1">&#39;fedora&#39;</span><span class="p">,</span> <span class="s1">&#39;amazon&#39;</span>
    <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform_version&#39;</span><span class="o">].</span><span class="n">to_f</span> <span class="o">&gt;=</span> <span class="mi">6</span><span class="o">.</span><span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;cronie&#39;</span> <span class="p">:</span> <span class="s1">&#39;vixie-cron&#39;</span>
  <span class="k">else</span>
    <span class="s1">&#39;cron&#39;</span>
  <span class="k">end</span>

<span class="n">package</span> <span class="n">cron_package</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>

<span class="n">service</span> <span class="s1">&#39;crond&#39;</span> <span class="k">do</span>
  <span class="k">case</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span>
  <span class="k">when</span> <span class="s1">&#39;redhat&#39;</span><span class="p">,</span> <span class="s1">&#39;centos&#39;</span><span class="p">,</span> <span class="s1">&#39;scientific&#39;</span><span class="p">,</span> <span class="s1">&#39;fedora&#39;</span><span class="p">,</span> <span class="s1">&#39;amazon&#39;</span>
    <span class="n">service_name</span> <span class="s1">&#39;crond&#39;</span>
  <span class="k">when</span> <span class="s1">&#39;debian&#39;</span><span class="p">,</span> <span class="s1">&#39;ubuntu&#39;</span><span class="p">,</span> <span class="s1">&#39;suse&#39;</span>
    <span class="n">service_name</span> <span class="s1">&#39;cron&#39;</span>
  <span class="k">end</span>
  <span class="n">action</span> <span class="o">[</span><span class="ss">:start</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">cron_package</span></tt> is a variable that is used to identify which platforms apply to which install packages</li>
<li>the <strong>package</strong> resource uses the <tt class="docutils literal"><span class="pre">cron_package</span></tt> variable to determine how to install the crond application on various nodes (with various platforms)</li>
<li>the <strong>service</strong> resource enables the crond application on nodes that have Red Hat, CentOS, Red Hat Enterprise Linux, Fedora, or Amazon Web Services (AWS), and the cron service on nodes that run Debian, Ubuntu, or openSUSE</li>
</ul>
<p><strong>Restart a service, and then notify a different service</strong></p>
<p>The following example shows how start a service named <tt class="docutils literal"><span class="pre">example_service</span></tt> and immediately notify the Nginx service to restart.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;example_service&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
  <span class="n">provider</span> <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Init</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[nginx]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where by using the default <tt class="docutils literal"><span class="pre">provider</span></tt> for the <strong>service</strong>, the recipe is telling the chef-client to determine the specific provider to be used during the chef-client run based on the platform of the node on which the recipe will run.</p>
<p><strong>Stop a service, do stuff, and then restart it</strong></p>
<p>The following example shows how to use the <strong>execute</strong>, <strong>service</strong>, and <strong>mount</strong> resources together to ensure that a node running on Amazon EC2 is running MySQL. This example does the following:</p>
<ul class="simple">
<li>Checks to see if the Amazon EC2 node has MySQL</li>
<li>If the node has MySQL, stops MySQL</li>
<li>Installs MySQL</li>
<li>Mounts the node</li>
<li>Restarts MySQL</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1"># the following code sample comes from the ``server_ec2``</span>
<span class="c1"># recipe in the following cookbook:</span>
<span class="c1"># https://github.com/chef-cookbooks/mysql</span>

<span class="k">if</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">attribute?</span><span class="p">(</span><span class="s1">&#39;ec2&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">))</span>

  <span class="n">service</span> <span class="s1">&#39;mysql&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:stop</span>
  <span class="k">end</span>

  <span class="n">execute</span> <span class="s1">&#39;install-mysql&#39;</span> <span class="k">do</span>
    <span class="n">command</span> <span class="s2">&quot;mv </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="n">not_if</span> <span class="k">do</span> <span class="no">FileTest</span><span class="o">.</span><span class="n">directory?</span><span class="p">(</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">)</span> <span class="k">end</span>
  <span class="k">end</span>

  <span class="o">[</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span><span class="p">,</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">dir</span><span class="o">|</span>
    <span class="n">directory</span> <span class="n">dir</span> <span class="k">do</span>
      <span class="n">owner</span> <span class="s1">&#39;mysql&#39;</span>
      <span class="n">group</span> <span class="s1">&#39;mysql&#39;</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">mount</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;data_dir&#39;</span><span class="o">]</span> <span class="k">do</span>
    <span class="n">device</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;mysql&#39;</span><span class="o">][</span><span class="s1">&#39;ec2_path&#39;</span><span class="o">]</span>
    <span class="n">fstype</span> <span class="s1">&#39;none&#39;</span>
    <span class="n">options</span> <span class="s1">&#39;bind,rw&#39;</span>
    <span class="n">action</span> <span class="o">[</span><span class="ss">:mount</span><span class="p">,</span> <span class="ss">:enable</span><span class="o">]</span>
  <span class="k">end</span>

  <span class="n">service</span> <span class="s1">&#39;mysql&#39;</span> <span class="k">do</span>
    <span class="n">action</span> <span class="ss">:start</span>
  <span class="k">end</span>

<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li>the two <strong>service</strong> resources are used to stop, and then restart the MySQL service</li>
<li>the <strong>execute</strong> resource is used to install MySQL</li>
<li>the <strong>mount</strong> resource is used to mount the node and enable MySQL</li>
</ul>
<p><strong>Control a service using the execute resource</strong></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is an example of something that should NOT be done. Use the <strong>service</strong> resource to control a service, not the <strong>execute</strong> resource.</p>
</div>
<p>Do something like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="s1">&#39;tomcat&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:start</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and NOT something like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;start-tomcat&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;/etc/init.d/tomcat6 start&#39;</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p>There is no reason to use the <strong>execute</strong> resource to control a service because the <strong>service</strong> resource exposes the <tt class="docutils literal"><span class="pre">start_command</span></tt> property directly, which gives a recipe full control over the command issued in a much cleaner, more direct manner.</p>
<p><strong>Enable a service on AIX using the mkitab command</strong></p>
<p>The <strong>service</strong> resource does not support using the <tt class="docutils literal"><span class="pre">:enable</span></tt> and <tt class="docutils literal"><span class="pre">:disable</span></tt> actions with resources that are managed using System Resource Controller (SRC). This is because System Resource Controller (SRC) does not have a standard mechanism for enabling and disabling services on system boot.</p>
<p>One approach for enabling or disabling services that are managed by System Resource Controller (SRC) is to use the <strong>execute</strong> resource to invoke <tt class="docutils literal"><span class="pre">mkitab</span></tt>, and then use that command to enable or disable the service.</p>
<p>The following example shows how to install a service:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s2">&quot;install </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> in SRC&quot;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s2">&quot;mkssys -s </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"></span>
<span class="s2">                  -p </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;bin&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"></span>
<span class="s2">                  -u root</span>
<span class="s2">                  -S</span>
<span class="s2">                  -n 15</span>
<span class="s2">                  -f 9</span>
<span class="s2">                  -o </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;log_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/client.log</span>
<span class="s2">                  -e </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;log_dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/client.log -a &#39;</span>
<span class="s2">                  -i </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;interval&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"></span>
<span class="s2">                  -s </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;splay&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
  <span class="n">not_if</span> <span class="s2">&quot;lssrc -s </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
  <span class="n">action</span> <span class="ss">:run</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then enable it using the <tt class="docutils literal"><span class="pre">mkitab</span></tt> command:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s2">&quot;enable </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s2">&quot;mkitab &#39;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">:2:once:/usr/bin/startsrc</span>
<span class="s2">                  -s </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2"> &gt; /dev/console 2&gt;&amp;1&#39;&quot;</span>
  <span class="n">not_if</span> <span class="s2">&quot;lsitab </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;chef_client&#39;</span><span class="o">][</span><span class="s1">&#39;svc_name&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="smartos-package">
<h2>smartos_package<a class="headerlink" href="#smartos-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_smartos_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>smartos_package</strong> resource to manage packages for the SmartOS platform.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id289">
<h3>Syntax<a class="headerlink" href="#id289" title="Permalink to this headline">¶</a></h3>
<p>A <strong>smartos_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>smartos_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">smartos_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>smartos_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">smartos_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Smartos</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">smartos_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id290">
<h3>Actions<a class="headerlink" href="#id290" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version.</dd>
</dl>
</div>
<div class="section" id="id291">
<h3>Properties<a class="headerlink" href="#id291" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id292">
<h3>Providers<a class="headerlink" href="#id292" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Smartos</span></tt>, <tt class="docutils literal"><span class="pre">smartos_package</span></tt></dt>
<dd>The provider for the SmartOS platform.</dd>
</dl>
</div>
<div class="section" id="id293">
<h3>Examples<a class="headerlink" href="#id293" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">smartos_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="solaris-package">
<h2>solaris_package<a class="headerlink" href="#solaris-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_solaris_package.rst">[edit on GitHub]</a></p>
<p>The <strong>solaris_package</strong> resource is used to manage packages for the Solaris platform.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id294">
<h3>Syntax<a class="headerlink" href="#id294" title="Permalink to this headline">¶</a></h3>
<p>A <strong>solaris_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>solaris_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">solaris_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>solaris_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">solaris_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Solaris</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">solaris_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id295">
<h3>Actions<a class="headerlink" href="#id295" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
</dl>
</div>
<div class="section" id="id296">
<h3>Properties<a class="headerlink" href="#id296" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The name of the package. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded.</p>
</dd>
</dl>
</div>
<div class="section" id="id297">
<h3>Providers<a class="headerlink" href="#id297" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Solaris</span></tt>, <tt class="docutils literal"><span class="pre">solaris_package</span></tt></dt>
<dd>The provider for the Solaris platform.</dd>
</dl>
</div>
<div class="section" id="id298">
<h3>Examples<a class="headerlink" href="#id298" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">solaris_package</span> <span class="s1">&#39;name of package&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="subversion">
<h2>subversion<a class="headerlink" href="#subversion" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_subversion.rst">[edit on GitHub]</a></p>
<p>Use the <strong>subversion</strong> resource to manage source control resources that exist in a Subversion repository.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This resource is often used in conjunction with the <strong>deploy</strong> resource.</p>
</div>
<div class="section" id="id299">
<h3>Syntax<a class="headerlink" href="#id299" title="Permalink to this headline">¶</a></h3>
<p>A <strong>subversion</strong> resource block manages source control resources that exist in a Subversion repository:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subversion</span> <span class="s1">&#39;CouchDB Edge&#39;</span> <span class="k">do</span>
  <span class="n">repository</span> <span class="s1">&#39;http://svn.apache.org/repos/asf/couchdb/trunk&#39;</span>
  <span class="n">revision</span> <span class="s1">&#39;HEAD&#39;</span>
  <span class="n">destination</span> <span class="s1">&#39;/opt/mysources/couch&#39;</span>
  <span class="n">action</span> <span class="ss">:sync</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>subversion</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subversion</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">destination</span>                <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Scm</span><span class="o">::</span><span class="no">Subversion</span>
  <span class="n">repository</span>                 <span class="nb">String</span>
  <span class="n">revision</span>                   <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">svn_arguments</span>              <span class="nb">String</span>
  <span class="n">svn_info_args</span>              <span class="nb">String</span>
  <span class="n">svn_password</span>               <span class="nb">String</span>
  <span class="n">svn_username</span>               <span class="nb">String</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span>
  <span class="n">user</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :sync if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">subversion</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block and also (when the <tt class="docutils literal"><span class="pre">destination</span></tt> property is not specified) the location in which the source files will be placed and/or synchronized with the files under source control management</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">destination</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">repository</span></tt>, <tt class="docutils literal"><span class="pre">revision</span></tt>, <tt class="docutils literal"><span class="pre">svn_arguments</span></tt>, <tt class="docutils literal"><span class="pre">svn_info_args</span></tt>, <tt class="docutils literal"><span class="pre">svn_password</span></tt>, <tt class="docutils literal"><span class="pre">svn_username</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">user</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id300">
<h3>Actions<a class="headerlink" href="#id300" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:checkout</span></tt></dt>
<dd>Clone or check out the source. When a checkout is available, this provider does nothing.</dd>
<dt><tt class="docutils literal"><span class="pre">:export</span></tt></dt>
<dd>Export the source, excluding or removing any version control artifacts.</dd>
<dt><tt class="docutils literal"><span class="pre">:force_export</span></tt></dt>
<dd>Export the source, excluding or removing any version control artifacts and force an export of the source that is overwriting the existing copy (if it exists).</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:sync</span></tt></dt>
<dd>Default. Update the source to the specified version, or get a new clone or checkout. This action causes a hard reset of the index and working tree, discarding any uncommitted changes.</dd>
</dl>
</div>
<div class="section" id="id301">
<h3>Properties<a class="headerlink" href="#id301" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">destination</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The location path to which the source is to be cloned, checked out, or exported. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The system group that is responsible for the checked-out code.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">repository</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The URI for the Subversion repository.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">revision</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">A branch, tag, or commit to be synchronized with git. This can be symbolic, like <tt class="docutils literal"><span class="pre">HEAD</span></tt> or it can be a source control management-specific revision identifier. Default value: <tt class="docutils literal"><span class="pre">HEAD</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">svn_arguments</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The extra arguments that are passed to the Subversion command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">svn_info_args</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Use when the <tt class="docutils literal"><span class="pre">svn</span> <span class="pre">info</span></tt> command is used by the chef-client and arguments need to be passed. The <tt class="docutils literal"><span class="pre">svn_arguments</span></tt> command does not work when the <tt class="docutils literal"><span class="pre">svn</span> <span class="pre">info</span></tt> command is used.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">svn_password</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The password for a user that has access to the Subversion repository.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">svn_username</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The user name for a user that has access to the Subversion repository.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The amount of time (in seconds) to wait for a command to execute before timing out. When this property is specified using the <strong>deploy</strong> resource, the value of the <tt class="docutils literal"><span class="pre">timeout</span></tt> property is passed from the <strong>deploy</strong> resource to the <strong>subversion</strong> resource.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The system user that is responsible for the checked-out code.</p>
</dd>
</dl>
</div>
<div class="section" id="id302">
<h3>Examples<a class="headerlink" href="#id302" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Get the latest version of an application</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subversion</span> <span class="s1">&#39;CouchDB Edge&#39;</span> <span class="k">do</span>
  <span class="n">repository</span> <span class="s1">&#39;http://svn.apache.org/repos/asf/couchdb/trunk&#39;</span>
  <span class="n">revision</span> <span class="s1">&#39;HEAD&#39;</span>
  <span class="n">destination</span> <span class="s1">&#39;/opt/mysources/couch&#39;</span>
  <span class="n">action</span> <span class="ss">:sync</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="systemd-unit">
<h2>systemd_unit<a class="headerlink" href="#systemd-unit" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_systemd_unit.rst">[edit on GitHub]</a></p>
<p>Use the <strong>systemd_unit</strong> resource to create, manage, and run <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd.html#Concepts">systemd units</a>.</p>
<p><em>New in Chef Client 12.11.</em></p>
<div class="section" id="id303">
<h3>Syntax<a class="headerlink" href="#id303" title="Permalink to this headline">¶</a></h3>
<p>A <strong>systemd_unit</strong> resource describes the configuration behavior for systemd units. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">systemd_unit</span> <span class="s1">&#39;sysstat-collect.timer&#39;</span> <span class="k">do</span>
  <span class="n">enabled</span> <span class="kp">true</span>
  <span class="n">content</span> <span class="s1">&#39;[Unit]\nDescription=Run system activity accounting tool every 10 minutes\n\n[Timer]\nOnCalendar=*:00/10\n\n[Install]\nWantedBy=sysstat.service&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>systemd_unit</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">systemd_unit</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">enabled</span>                <span class="no">Boolean</span>
  <span class="n">active</span>                 <span class="no">Boolean</span>
  <span class="n">masked</span>                 <span class="no">Boolean</span>
  <span class="n">static</span>                 <span class="no">Boolean</span>
  <span class="n">user</span>                   <span class="nb">String</span>
  <span class="n">content</span>                <span class="nb">String</span> <span class="ow">or</span> <span class="no">Hash</span>
  <span class="n">triggers_reload</span>        <span class="no">Boolean</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the unit</li>
<li><tt class="docutils literal"><span class="pre">active</span></tt> specifies if the service unit type should be started</li>
<li><tt class="docutils literal"><span class="pre">user</span></tt> is the user account that systemd units run under. If not specified, systemd units will run under the system account.</li>
<li><tt class="docutils literal"><span class="pre">content</span></tt> describes the behavior of the unit</li>
</ul>
</div>
<div class="section" id="id304">
<h3>Actions<a class="headerlink" href="#id304" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>Create a unit file, if it does not already exist.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Delete a unit file, if it exists.</dd>
<dt><tt class="docutils literal"><span class="pre">:enable</span></tt></dt>
<dd>Ensure the unit will be started after the next system boot.</dd>
<dt><tt class="docutils literal"><span class="pre">:disable</span></tt></dt>
<dd>Ensure the unit will not be started after the next system boot.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Default. Do nothing with the unit.</dd>
<dt><tt class="docutils literal"><span class="pre">:mask</span></tt></dt>
<dd>Ensure the unit will not start, even to satisfy dependencies.</dd>
<dt><tt class="docutils literal"><span class="pre">:unmask</span></tt></dt>
<dd>Stop the unit from being masked and cause it to start as specified.</dd>
<dt><tt class="docutils literal"><span class="pre">:start</span></tt></dt>
<dd>Start a unit based in its systemd unit file.</dd>
<dt><tt class="docutils literal"><span class="pre">:stop</span></tt></dt>
<dd>Stop a running unit.</dd>
<dt><tt class="docutils literal"><span class="pre">:restart</span></tt></dt>
<dd>Restart a unit.</dd>
<dt><tt class="docutils literal"><span class="pre">:reload</span></tt></dt>
<dd>Reload the configuration file for a unit.</dd>
<dt><tt class="docutils literal"><span class="pre">:try_restart</span></tt></dt>
<dd>Try to restart a unit if the unit is running.</dd>
<dt><tt class="docutils literal"><span class="pre">:reload_or_restart</span></tt></dt>
<dd>For units that are services, this action reloads the configuration of the service without restarting, if possible; otherwise, it will restart the service so the new configuration is applied.</dd>
<dt><tt class="docutils literal"><span class="pre">:reload_or_try_restart</span></tt></dt>
<dd>For units that are services, this action reloads the configuration of the service without restarting, if possible; otherwise, it will try to restart the service so the new configuration is applied.</dd>
</dl>
</div>
<div class="section" id="id305">
<h3>Properties<a class="headerlink" href="#id305" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">enabled</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Specifies whether the unit is enabled or disabled.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">active</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Specifies whether the unit is started or stopped.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">masked</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Specifies whether the unit is masked or not.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">static</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Specifies whether the unit is static or not. Static units cannot be enabled or disabled.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The user account that the systemd unit process is run under. The path to the unit for that user would be something like
<tt class="docutils literal"><span class="pre">/etc/systemd/user/sshd.service</span></tt>. If no user account is specified, the systemd unit will run under a <tt class="docutils literal"><span class="pre">system</span></tt> account, with the path to the unit being something like <tt class="docutils literal"><span class="pre">/etc/systemd/system/sshd.service</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">content</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String, Hash</p>
<p class="last">A string or hash that contains a systemd <a class="reference external" href="https://www.freedesktop.org/software/systemd/man/systemd.unit.html">unit file</a> definition that describes the properties of systemd-managed entities, such as services, sockets, devices, and so on.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">triggers_reload</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Specifies whether to trigger a daemon reload when creating or deleting a unit. Default is true.</p>
</dd>
</dl>
</div>
<div class="section" id="id306">
<h3>Providers<a class="headerlink" href="#id306" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::SystemdUnit</span></tt>, <tt class="docutils literal"><span class="pre">systemd_unit</span></tt></dt>
<dd>The provider for systemd_unit.</dd>
</dl>
</div>
</div>
<div class="section" id="template">
<h2>template<a class="headerlink" href="#template" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_template.rst">[edit on GitHub]</a></p>
<p>A cookbook template is an Embedded Ruby (ERB) template that is used to dynamically generate static text files. Templates may contain Ruby expressions and statements, and are a great way to manage configuration files. Use the <strong>template</strong> resource to add cookbook templates to recipes; place the corresponding Embedded Ruby (ERB) template file in a cookbook&#8217;s <tt class="docutils literal"><span class="pre">/templates</span></tt> directory.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The chef-client uses Erubis for templates, which is a fast, secure, and extensible implementation of embedded Ruby. Erubis should be familiar to members of the Ruby on Rails, Merb, or Puppet communities. For more information about Erubis, see: <a class="reference external" href="http://www.kuwata-lab.com/erubis/">http://www.kuwata-lab.com/erubis/</a>.</p>
</div>
<p>Use the <strong>template</strong> resource to manage the contents of a file using an Embedded Ruby (ERB) template by transferring files from a sub-directory of <tt class="docutils literal"><span class="pre">COOKBOOK_NAME/templates/</span></tt> to a specified path located on a host that is running the chef-client. This resource includes actions and properties from the <strong>file</strong> resource. Template files managed by the <strong>template</strong> resource follow the same file specificity rules as the <strong>remote_file</strong> and <strong>file</strong> resources.</p>
<div class="section" id="id307">
<h3>Syntax<a class="headerlink" href="#id307" title="Permalink to this headline">¶</a></h3>
<p>A <strong>template</strong> resource block typically declares the location in which a file is to be created, the source template that will be used to create the file, and the permissions needed on that file. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/motd&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;motd.erb&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">'/etc/motd'</span></tt> specifies the location in which the file is created</li>
<li><tt class="docutils literal"><span class="pre">'motd.erb'</span></tt> specifies the name of a template that exists in in the <tt class="docutils literal"><span class="pre">/templates</span></tt> folder of a cookbook</li>
<li><tt class="docutils literal"><span class="pre">owner</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, and <tt class="docutils literal"><span class="pre">mode</span></tt> define the permissions</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>template</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">atomic_update</span>              <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">backup</span>                     <span class="no">FalseClass</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">cookbook</span>                   <span class="nb">String</span>
  <span class="n">force_unlink</span>               <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">group</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">helper</span><span class="p">(</span><span class="ss">:method</span><span class="p">)</span>            <span class="no">Method</span> <span class="p">{</span> <span class="nb">String</span> <span class="p">}</span> <span class="c1"># see Helpers below</span>
  <span class="n">helpers</span><span class="p">(</span><span class="n">module</span><span class="p">)</span>            <span class="no">Module</span> <span class="c1"># see Helpers below</span>
  <span class="n">inherits</span>                   <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">local</span>                      <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">manage_symlink_source</span>      <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span><span class="p">,</span> <span class="no">NilClass</span>
  <span class="n">mode</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">owner</span>                      <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">path</span>                       <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">File</span><span class="o">::</span><span class="no">Template</span>
  <span class="n">rights</span>                     <span class="no">Hash</span>
  <span class="n">sensitive</span>                  <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">source</span>                     <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">variables</span>                  <span class="no">Hash</span>
  <span class="n">verify</span>                     <span class="nb">String</span><span class="p">,</span> <span class="no">Block</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">template</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block, typically the path to the location in which a file is created <em>and also</em> the name of the file to be managed. For example: <tt class="docutils literal"><span class="pre">/var/www/html/index.html</span></tt>, where <tt class="docutils literal"><span class="pre">/var/www/html/</span></tt> is the fully qualified path to the location and <tt class="docutils literal"><span class="pre">index.html</span></tt> is the name of the file</li>
<li><tt class="docutils literal"><span class="pre">source</span></tt> is the template file that will be used to create the file on the node, for example: <tt class="docutils literal"><span class="pre">index.html.erb</span></tt>; the template file is located in the <tt class="docutils literal"><span class="pre">/templates</span></tt> directory of a cookbook</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">atomic_update</span></tt>, <tt class="docutils literal"><span class="pre">backup</span></tt>, <tt class="docutils literal"><span class="pre">cookbook</span></tt>, <tt class="docutils literal"><span class="pre">force_unlink</span></tt>, <tt class="docutils literal"><span class="pre">group</span></tt>, <tt class="docutils literal"><span class="pre">helper</span></tt>, <tt class="docutils literal"><span class="pre">helpers</span></tt>, <tt class="docutils literal"><span class="pre">inherits</span></tt>, <tt class="docutils literal"><span class="pre">local</span></tt>, <tt class="docutils literal"><span class="pre">manage_symlink_source</span></tt>, <tt class="docutils literal"><span class="pre">mode</span></tt>, <tt class="docutils literal"><span class="pre">owner</span></tt>, <tt class="docutils literal"><span class="pre">path</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">rights</span></tt>, <tt class="docutils literal"><span class="pre">sensitive</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">variables</span></tt>, and <tt class="docutils literal"><span class="pre">verify</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id308">
<h3>Actions<a class="headerlink" href="#id308" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>Default. Create a file. If a file already exists (but does not match), update that file to match.</dd>
<dt><tt class="docutils literal"><span class="pre">:create_if_missing</span></tt></dt>
<dd>Create a file only if the file does not exist. When the file exists, nothing happens.</dd>
<dt><tt class="docutils literal"><span class="pre">:delete</span></tt></dt>
<dd>Delete a file.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:touch</span></tt></dt>
<dd>Touch a file. This updates the access (atime) and file modification (mtime) times for a file. (This action may be used with this resource, but is typically only used with the <strong>file</strong> resource.)</dd>
</dl>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">For a machine on which SELinux is enabled, the chef-client will create files that correctly match the default policy settings only when the cookbook that defines the action also conforms to the same policy.</p>
</div>
</div>
<div class="section" id="id309">
<h3>Properties<a class="headerlink" href="#id309" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">atomic_update</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Perform atomic file updates on a per-resource basis. Set to <tt class="docutils literal"><span class="pre">true</span></tt> for atomic file updates. Set to <tt class="docutils literal"><span class="pre">false</span></tt> for non-atomic file updates. This setting overrides <tt class="docutils literal"><span class="pre">file_atomic_update</span></tt>, which is a global setting found in the client.rb file. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">backup</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> FalseClass, Integer</p>
<p class="last">The number of backups to be kept in <tt class="docutils literal"><span class="pre">/var/chef/backup</span></tt> (for UNIX- and Linux-based platforms) or <tt class="docutils literal"><span class="pre">C:/chef/backup</span></tt> (for the Microsoft Windows platform). Set to <tt class="docutils literal"><span class="pre">false</span></tt> to prevent backups from being kept. Default value: <tt class="docutils literal"><span class="pre">5</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">cookbook</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The cookbook in which a file is located (if it is not located in the current cookbook). The default value is the current cookbook.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">force_unlink</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">How the chef-client handles certain situations when the target file turns out not to be a file. For example, when a target file is actually a symlink. Set to <tt class="docutils literal"><span class="pre">true</span></tt> for the chef-client delete the non-file target and replace it with the specified file. Set to <tt class="docutils literal"><span class="pre">false</span></tt> for the chef-client to raise an error. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">A string or ID that identifies the group owner by group name, including fully qualified group names such as <tt class="docutils literal"><span class="pre">domain\group</span></tt> or <tt class="docutils literal"><span class="pre">group&#64;domain</span></tt>. If this value is not specified, existing groups remain unchanged and new group assignments use the default <tt class="docutils literal"><span class="pre">POSIX</span></tt> group (if available).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">helper</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Method</p>
<p class="last">Define a helper method inline. For example: <tt class="docutils literal"><span class="pre">helper(:hello_world)</span> <span class="pre">{</span> <span class="pre">&quot;hello</span> <span class="pre">world&quot;</span> <span class="pre">}</span></tt> or <tt class="docutils literal"><span class="pre">helper(:app)</span> <span class="pre">{</span> <span class="pre">node[&quot;app&quot;]</span> <span class="pre">}</span></tt> or <tt class="docutils literal"><span class="pre">helper(:app_conf)</span> <span class="pre">{</span> <span class="pre">|setting|</span> <span class="pre">node[&quot;app&quot;][setting]</span> <span class="pre">}</span></tt>. Default value: <tt class="docutils literal"><span class="pre">{}</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">helpers</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Module</p>
<p class="last">Define a helper module inline or in a library. For example, an inline module: <tt class="docutils literal"><span class="pre">helpers</span> <span class="pre">do</span></tt>, which is then followed by a block of Ruby code. And for a library module: <tt class="docutils literal"><span class="pre">helpers(MyHelperModule)</span></tt>. Default value: <tt class="docutils literal"><span class="pre">[]</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">inherits</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Microsoft Windows only. Whether a file inherits rights from its parent directory. Default value: <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">local</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Load a template from a local path. By default, the chef-client loads templates from a cookbook&#8217;s <tt class="docutils literal"><span class="pre">/templates</span></tt> directory. When this property is set to <tt class="docutils literal"><span class="pre">true</span></tt>, use the <tt class="docutils literal"><span class="pre">source</span></tt> property to specify the path to a template on the local node. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">manage_symlink_source</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass, NilClass</p>
<p class="last">Cause the chef-client to detect and manage the source file for a symlink. Possible values: <tt class="docutils literal"><span class="pre">nil</span></tt>, <tt class="docutils literal"><span class="pre">true</span></tt>, or <tt class="docutils literal"><span class="pre">false</span></tt>. When this value is set to <tt class="docutils literal"><span class="pre">nil</span></tt>, the chef-client will manage a symlink&#8217;s source file and emit a warning. When this value is set to <tt class="docutils literal"><span class="pre">true</span></tt>, the chef-client will manage a symlink&#8217;s source file and not emit a warning. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>. The default value will be changed to <tt class="docutils literal"><span class="pre">false</span></tt> in a future version.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">mode</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p>A quoted 3-5 character string that defines the octal mode. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified and if the file already exists, the existing mode on the file is used. If <tt class="docutils literal"><span class="pre">mode</span></tt> is not specified, the file does not exist, and the <tt class="docutils literal"><span class="pre">:create</span></tt> action is specified, the chef-client assumes a mask value of <tt class="docutils literal"><span class="pre">'0777'</span></tt> and then applies the umask for the system on which the file is to be created to the <tt class="docutils literal"><span class="pre">mask</span></tt> value. For example, if the umask on a system is <tt class="docutils literal"><span class="pre">'022'</span></tt>, the chef-client uses the default value of <tt class="docutils literal"><span class="pre">'0755'</span></tt>.</p>
<p>The behavior is different depending on the platform.</p>
<p>UNIX- and Linux-based systems: A quoted 3-5 character string that defines the octal mode that is passed to chmod. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. If the value is specified as a quoted string, it works exactly as if the <tt class="docutils literal"><span class="pre">chmod</span></tt> command was passed. If the value is specified as an integer, prepend a zero (<tt class="docutils literal"><span class="pre">0</span></tt>) to the value to ensure that it is interpreted as an octal number. For example, to assign read, write, and execute rights for all users, use <tt class="docutils literal"><span class="pre">'0777'</span></tt> or <tt class="docutils literal"><span class="pre">'777'</span></tt>; for the same rights, plus the sticky bit, use <tt class="docutils literal"><span class="pre">01777</span></tt> or <tt class="docutils literal"><span class="pre">'1777'</span></tt>.</p>
<p class="last">Microsoft Windows: A quoted 3-5 character string that defines the octal mode that is translated into rights for Microsoft Windows security. For example: <tt class="docutils literal"><span class="pre">'755'</span></tt>, <tt class="docutils literal"><span class="pre">'0755'</span></tt>, or <tt class="docutils literal"><span class="pre">00755</span></tt>. Values up to <tt class="docutils literal"><span class="pre">'0777'</span></tt> are allowed (no sticky bits) and mean the same in Microsoft Windows as they do in UNIX, where <tt class="docutils literal"><span class="pre">4</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">2</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, and <tt class="docutils literal"><span class="pre">1</span></tt> equals <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>. This property cannot be used to set <tt class="docutils literal"><span class="pre">:full_control</span></tt>. This property has no effect if not specified, but when it and <tt class="docutils literal"><span class="pre">rights</span></tt> are both specified, the effects are cumulative.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">owner</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">A string or ID that identifies the group owner by user name, including fully qualified user names such as <tt class="docutils literal"><span class="pre">domain\user</span></tt> or <tt class="docutils literal"><span class="pre">user&#64;domain</span></tt>. If this value is not specified, existing owners remain unchanged and new owner assignments use the current user (when necessary).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">path</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p>The full path to the file, including the file name and its extension.</p>
<p class="last">Microsoft Windows: A path that begins with a forward slash (<tt class="docutils literal"><span class="pre">/</span></tt>) will point to the root of the current working directory of the chef-client process. This path can vary from system to system. Therefore, using a path that begins with a forward slash (<tt class="docutils literal"><span class="pre">/</span></tt>) is not recommended.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">rights</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, String</p>
<p class="last">Microsoft Windows only. The permissions for users and groups in a Microsoft Windows environment. For example: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">&lt;permissions&gt;,</span> <span class="pre">&lt;principal&gt;,</span> <span class="pre">&lt;options&gt;</span></tt> where <tt class="docutils literal"><span class="pre">&lt;permissions&gt;</span></tt> specifies the rights granted to the principal, <tt class="docutils literal"><span class="pre">&lt;principal&gt;</span></tt> is the group or user name, and <tt class="docutils literal"><span class="pre">&lt;options&gt;</span></tt> is a Hash with one (or more) advanced rights options.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">sensitive</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Ensure that sensitive resource data is not logged by the chef-client. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The location of a template file. By default, the chef-client looks for a template file in the <tt class="docutils literal"><span class="pre">/templates</span></tt> directory of a cookbook. When the <tt class="docutils literal"><span class="pre">local</span></tt> property is set to <tt class="docutils literal"><span class="pre">true</span></tt>, use to specify the path to a template on the local node. This property may also be used to distribute specific files to specific platforms. See &#8220;File Specificity&#8221; below for more information. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">variables</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p>A Hash of variables that are passed into a Ruby template file.</p>
<p>The <tt class="docutils literal"><span class="pre">variables</span></tt> property of the <strong>template</strong> resource can be used to reference a partial template file by using a Hash. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/file/name.txt&#39;</span> <span class="k">do</span>
  <span class="n">variables</span> <span class="ss">partials</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;partial_name_1.txt.erb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span>
    <span class="s1">&#39;partial_name_2.txt.erb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;message&#39;</span><span class="p">,</span>
    <span class="s1">&#39;partial_name_3.txt.erb&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;message&#39;</span>
  <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where each of the partial template files can then be combined using normal Ruby template patterns within a template file, such as:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="sx">% @partials.each </span><span class="k">do</span> <span class="o">|</span><span class="n">partial</span><span class="p">,</span> <span class="n">message</span><span class="o">|</span> <span class="sx">%&gt;</span>
<span class="sx">  Here is &lt;%= partial %&gt;</span>
  <span class="o">&lt;</span><span class="sx">%= render partial, :variables =</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:message</span> <span class="o">=&gt;</span> <span class="n">message</span><span class="p">}</span> <span class="sx">%&gt;</span>
<span class="sx">&lt;% end %&gt;</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">verify</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Block</p>
<p>A block or a string that returns <tt class="docutils literal"><span class="pre">true</span></tt> or <tt class="docutils literal"><span class="pre">false</span></tt>. A string, when <tt class="docutils literal"><span class="pre">true</span></tt> is executed as a system command.</p>
<p>A block is arbitrary Ruby defined within the resource block by using the <tt class="docutils literal"><span class="pre">verify</span></tt> property. When a block is <tt class="docutils literal"><span class="pre">true</span></tt>, the chef-client will continue to update the file as appropriate.</p>
<p>For example, this should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/baz&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="p">{</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/nginx.conf&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="s1">&#39;nginx -t -c %{path}&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>For releases of the chef-client prior to 12.5 (chef-client 12.4 and earlier) the correct syntax is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/nginx.conf&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="s1">&#39;nginx -t -c %{file}&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p class="last">See GitHub issues <a class="reference external" href="https://github.com/chef/chef/issues/3232">https://github.com/chef/chef/issues/3232</a> and <a class="reference external" href="https://github.com/chef/chef/pull/3693">https://github.com/chef/chef/pull/3693</a> for more information about these differences.</p>
</div>
<p>This should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/bar&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="p">{</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>And this should return <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/foo&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="k">do</span> <span class="o">|</span><span class="n">path</span><span class="o">|</span>
    <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Whereas, this should return <tt class="docutils literal"><span class="pre">false</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/turtle&#39;</span> <span class="k">do</span>
  <span class="n">verify</span> <span class="s1">&#39;/usr/bin/false&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p class="last">If a string or a block return <tt class="docutils literal"><span class="pre">false</span></tt>, the chef-client run will stop and an error is returned.</p>
</dd>
</dl>
<div class="section" id="id310">
<h4>Atomic File Updates<a class="headerlink" href="#id310" title="Permalink to this headline">¶</a></h4>
<p>Atomic updates are used with <strong>file</strong>-based resources to help ensure that file updates can be made when updating a binary or if disk space runs out.</p>
<p>Atomic updates are enabled by default. They can be managed globally using the <tt class="docutils literal"><span class="pre">file_atomic_update</span></tt> setting in the client.rb file. They can be managed on a per-resource basis using the <tt class="docutils literal"><span class="pre">atomic_update</span></tt> property that is available with the <strong>cookbook_file</strong>, <strong>file</strong>, <strong>remote_file</strong>, and <strong>template</strong> resources.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">On certain platforms, and after a file has been moved into place, the chef-client may modify file permissions to support features specific to those platforms. On platforms with SELinux enabled, the chef-client will fix up the security contexts after a file has been moved into the correct location by running the <tt class="docutils literal"><span class="pre">restorecon</span></tt> command. On the Microsoft Windows platform, the chef-client will create files so that ACL inheritance works as expected.</p>
</div>
</div>
<div class="section" id="id311">
<h4>Windows File Security<a class="headerlink" href="#id311" title="Permalink to this headline">¶</a></h4>
<p>To support Microsoft Windows security, the <strong>template</strong>, <strong>file</strong>, <strong>remote_file</strong>, <strong>cookbook_file</strong>, <strong>directory</strong>, and <strong>remote_directory</strong> resources support the use of inheritance and access control lists (ACLs) within recipes.</p>
<p><strong>Access Control Lists (ACLs)</strong></p>
<p>The <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used in a recipe to manage access control lists (ACLs), which allow permissions to be given to multiple users and groups. Use the <tt class="docutils literal"><span class="pre">rights</span></tt> property can be used as many times as necessary; the chef-client will apply them to the file or directory as required. The syntax for the <tt class="docutils literal"><span class="pre">rights</span></tt> property is as follows:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="n">permission</span><span class="p">,</span> <span class="n">principal</span><span class="p">,</span> <span class="n">option_type</span> <span class="o">=&gt;</span> <span class="n">value</span>
</pre></div>
</div>
<p>where</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">permission</span></tt></dt>
<dd><p class="first">Use to specify which rights are granted to the <tt class="docutils literal"><span class="pre">principal</span></tt>. The possible values are: <tt class="docutils literal"><span class="pre">:read</span></tt>, <tt class="docutils literal"><span class="pre">:write</span></tt>, <tt class="docutils literal"><span class="pre">read_execute</span></tt>, <tt class="docutils literal"><span class="pre">:modify</span></tt>, and <tt class="docutils literal"><span class="pre">:full_control</span></tt>.</p>
<p>These permissions are cumulative. If <tt class="docutils literal"><span class="pre">:write</span></tt> is specified, then it includes <tt class="docutils literal"><span class="pre">:read</span></tt>. If <tt class="docutils literal"><span class="pre">:full_control</span></tt> is specified, then it includes both <tt class="docutils literal"><span class="pre">:write</span></tt> and <tt class="docutils literal"><span class="pre">:read</span></tt>.</p>
<p class="last">(For those who know the Microsoft Windows API: <tt class="docutils literal"><span class="pre">:read</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>; <tt class="docutils literal"><span class="pre">:write</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>; <tt class="docutils literal"><span class="pre">:read_execute</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt> and <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>; <tt class="docutils literal"><span class="pre">:modify</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_WRITE</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_READ</span></tt>, <tt class="docutils literal"><span class="pre">GENERIC_EXECUTE</span></tt>, and <tt class="docutils literal"><span class="pre">DELETE</span></tt>; <tt class="docutils literal"><span class="pre">:full_control</span></tt> corresponds to <tt class="docutils literal"><span class="pre">GENERIC_ALL</span></tt>, which allows a user to change the owner and other metadata about a file.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">principal</span></tt></dt>
<dd>Use to specify a group or user name. This is identical to what is entered in the login box for Microsoft Windows, such as <tt class="docutils literal"><span class="pre">user_name</span></tt>, <tt class="docutils literal"><span class="pre">domain\user_name</span></tt>, or <tt class="docutils literal"><span class="pre">user_name&#64;fully_qualified_domain_name</span></tt>. The chef-client does not need to know if a principal is a user or a group.</dd>
<dt><tt class="docutils literal"><span class="pre">option_type</span></tt></dt>
<dd><p class="first">A hash that contains advanced rights options. For example, the rights to a directory that only applies to the first level of children might look something like: <tt class="docutils literal"><span class="pre">rights</span> <span class="pre">:write,</span> <span class="pre">'domain\group_name',</span> <span class="pre">:one_level_deep</span> <span class="pre">=&gt;</span> <span class="pre">true</span></tt>. Possible option types:</p>
<table border="1" class="last docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:applies_to_children</span></tt></td>
<td>Specify how permissions are applied to children. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to inherit both child directories and files;  <tt class="docutils literal"><span class="pre">false</span></tt> to not inherit any child directories or files; <tt class="docutils literal"><span class="pre">:containers_only</span></tt> to inherit only child directories (and not files); <tt class="docutils literal"><span class="pre">:objects_only</span></tt> to recursively inherit files (and not child directories).</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:applies_to_self</span></tt></td>
<td>Indicates whether a permission is applied to the parent directory. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply to the parent directory or file and its children; <tt class="docutils literal"><span class="pre">false</span></tt> to not apply only to child directories and files.</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:one_level_deep</span></tt></td>
<td>Indicates the depth to which permissions will be applied. Possible values: <tt class="docutils literal"><span class="pre">true</span></tt> to apply only to the first level of children; <tt class="docutils literal"><span class="pre">false</span></tt> to apply to all children.</td>
</tr>
</tbody>
</table>
</dd>
</dl>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Administrators&#39;</span><span class="p">,</span><span class="s1">&#39;Everyone&#39;</span><span class="o">]</span>
<span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;Users&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;Sally&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="ss">:containers_only</span><span class="p">,</span> <span class="ss">:applies_to_self</span> <span class="o">=&gt;</span> <span class="kp">false</span><span class="p">,</span> <span class="ss">:one_level_deep</span> <span class="o">=&gt;</span> <span class="kp">true</span>
</pre></div>
</div>
<p>Some other important things to know when using the <tt class="docutils literal"><span class="pre">rights</span></tt> attribute:</p>
<ul class="simple">
<li>Only inherited rights remain. All existing explicit rights on the object are removed and replaced.</li>
<li>If rights are not specified, nothing will be changed. The chef-client does not clear out the rights on a file or directory if rights are not specified.</li>
<li>Changing inherited rights can be expensive. Microsoft Windows will propagate rights to all children recursively due to inheritance. This is a normal aspect of Microsoft Windows, so consider the frequency with which this type of action is necessary and take steps to control this type of action if performance is the primary consideration.</li>
</ul>
<p>Use the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> property to deny specific rights to specific users. The ordering is independent of using the <tt class="docutils literal"><span class="pre">rights</span></tt> property. For example, it doesn&#8217;t matter if rights are granted to everyone is placed before or after <tt class="docutils literal"><span class="pre">deny_rights</span> <span class="pre">:read,</span> <span class="pre">['Julian',</span> <span class="pre">'Lewis']</span></tt>, both Julian and Lewis will be unable to read the document. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">resource</span> <span class="s1">&#39;x.txt&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;Everyone&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;domain\group&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;group_name_or_user_name&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;user_name&#39;</span><span class="p">,</span> <span class="ss">:applies_to_children</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Julian&#39;</span><span class="p">,</span> <span class="s1">&#39;Lewis&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">deny_rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="o">[</span><span class="s1">&#39;Sally&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p><strong>Inheritance</strong></p>
<p>By default, a file or directory inherits rights from its parent directory. Most of the time this is the preferred behavior, but sometimes it may be necessary to take steps to more specifically control rights. The <tt class="docutils literal"><span class="pre">inherits</span></tt> property can be used to specifically tell the chef-client to apply (or not apply) inherited rights from its parent directory.</p>
<p>For example, the following example specifies the rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the following example specifies how to use inheritance to deny access to the child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">inherits</span> <span class="kp">false</span> <span class="c1"># Sauron is the only person who should have any sort of access</span>
<span class="k">end</span>
</pre></div>
</div>
<p>If the <tt class="docutils literal"><span class="pre">deny_rights</span></tt> permission were to be used instead, something could slip through unless all users and groups were denied.</p>
<p>Another example also shows how to specify rights for a directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor&#39;</span> <span class="k">do</span>
  <span class="n">rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span>
  <span class="n">rights</span> <span class="ss">:full_control</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Sauron&#39;</span>
  <span class="n">rights</span> <span class="ss">:write</span><span class="p">,</span> <span class="s1">&#39;SHIRE\Frodo&#39;</span> <span class="c1"># Who put that there I didn&#39;t put that there</span>
<span class="k">end</span>
</pre></div>
</div>
<p>but then not use the <tt class="docutils literal"><span class="pre">inherits</span></tt> property to deny those rights on a child directory:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">directory</span> <span class="s1">&#39;C:\mordor\mount_doom&#39;</span> <span class="k">do</span>
  <span class="n">deny_rights</span> <span class="ss">:read</span><span class="p">,</span> <span class="s1">&#39;MORDOR\Minions&#39;</span> <span class="c1"># Oops, not specific enough</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Because the <tt class="docutils literal"><span class="pre">inherits</span></tt> property is not specified, the chef-client will default it to <tt class="docutils literal"><span class="pre">true</span></tt>, which will ensure that security settings for existing files remain unchanged.</p>
</div>
</div>
<div class="section" id="using-templates">
<h3>Using Templates<a class="headerlink" href="#using-templates" title="Permalink to this headline">¶</a></h3>
<p>To use a template, two things must happen:</p>
<ol class="arabic simple">
<li>A template resource must be added to a recipe</li>
<li>An Embedded Ruby (ERB) template must be added to a cookbook</li>
</ol>
<p>For example, the following template file and template resource settings can be used to manage a configuration file named <tt class="docutils literal"><span class="pre">/etc/sudoers</span></tt>. Within a cookbook that uses sudo, the following resource could be added to <tt class="docutils literal"><span class="pre">/recipes/default.rb</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/sudoers&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;sudoers.erb&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0440&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">variables</span><span class="p">({</span>
    <span class="ss">sudoers_groups</span><span class="p">:</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;authorization&#39;</span><span class="o">][</span><span class="s1">&#39;sudo&#39;</span><span class="o">][</span><span class="s1">&#39;groups&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">sudoers_users</span><span class="p">:</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;authorization&#39;</span><span class="o">][</span><span class="s1">&#39;sudo&#39;</span><span class="o">][</span><span class="s1">&#39;users&#39;</span><span class="o">]</span>
  <span class="p">})</span>
<span class="k">end</span>
</pre></div>
</div>
<p>And then create a template called <tt class="docutils literal"><span class="pre">sudoers.erb</span></tt> and save it to <tt class="docutils literal"><span class="pre">templates/default/sudoers.erb</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># /etc/sudoers</span>
<span class="c1">#</span>
<span class="c1"># Generated by Chef for &lt;%= node[&#39;fqdn&#39;] %&gt;</span>
<span class="c1">#</span>

<span class="no">Defaults</span>        <span class="o">!</span><span class="n">lecture</span><span class="p">,</span><span class="n">tty_tickets</span><span class="p">,</span><span class="o">!</span><span class="n">fqdn</span>

<span class="c1"># User privilege specification</span>
<span class="n">root</span>          <span class="no">ALL</span><span class="o">=</span><span class="p">(</span><span class="no">ALL</span><span class="p">)</span> <span class="no">ALL</span>

<span class="o">&lt;</span><span class="sx">% @sudoers_users.each </span><span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="o">-</span><span class="sx">%&gt;</span>
<span class="sx">&lt;%= user %&gt;</span>   <span class="no">ALL</span><span class="o">=</span><span class="p">(</span><span class="no">ALL</span><span class="p">)</span> <span class="o">&lt;</span><span class="sx">%= &quot;NOPASSWD:&quot; if @passwordless %&gt;ALL</span>
<span class="sx">&lt;% end -%&gt;</span>

<span class="sx"># Members of the sysadmin group may gain root privileges</span>
<span class="sx">%sysadmin     ALL=</span><span class="p">(</span><span class="no">ALL</span><span class="p">)</span> <span class="o">&lt;</span><span class="sx">%= &quot;NOPASSWD:&quot; if @passwordless %&gt;ALL</span>

<span class="sx">&lt;% @sudoers_groups.each do |group| -%&gt;</span>
<span class="sx"># Members of the group &#39;&lt;%=</span> <span class="n">group</span> <span class="sx">%&gt;&#39; may gain root privileges</span>
<span class="sx">%&lt;%= group %&gt;</span> <span class="no">ALL</span><span class="o">=</span><span class="p">(</span><span class="no">ALL</span><span class="p">)</span> <span class="o">&lt;%=</span> <span class="s2">&quot;NOPASSWD:&quot;</span> <span class="k">if</span> <span class="vi">@passwordless</span> <span class="sx">%&gt;ALL</span>
<span class="sx">&lt;% end -%&gt;</span>
</pre></div>
</div>
<p>And then set the default attributes in <tt class="docutils literal"><span class="pre">attributes/default.rb</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;authorization&#39;</span><span class="o">][</span><span class="s1">&#39;sudo&#39;</span><span class="o">][</span><span class="s1">&#39;groups&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span> <span class="s1">&#39;sysadmin&#39;</span><span class="p">,</span> <span class="s1">&#39;wheel&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span> <span class="o">]</span>
<span class="n">default</span><span class="o">[</span><span class="s1">&#39;authorization&#39;</span><span class="o">][</span><span class="s1">&#39;sudo&#39;</span><span class="o">][</span><span class="s1">&#39;users&#39;</span><span class="o">]</span>  <span class="o">=</span> <span class="o">[</span> <span class="s1">&#39;jerry&#39;</span><span class="p">,</span> <span class="s1">&#39;greg&#39;</span><span class="o">]</span>
</pre></div>
</div>
<div class="section" id="id312">
<h4>File Specificity<a class="headerlink" href="#id312" title="Permalink to this headline">¶</a></h4>
<p>A cookbook is frequently designed to work across many platforms and is often required to distribute a specific template to a specific platform. A cookbook can be designed to support the distribution of templates across platforms, while ensuring that the correct template ends up on each system.</p>
<p>The pattern for template specificity depends on two things: the lookup path and the source. The first pattern that matches is used:</p>
<ol class="arabic simple">
<li>/host-$fqdn/$source</li>
<li>/$platform-$platform_version/$source</li>
<li>/$platform/$source</li>
<li>/default/$source</li>
<li>/$source</li>
</ol>
<p>Use an array with the <tt class="docutils literal"><span class="pre">source</span></tt> property to define an explicit lookup path. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/test&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="o">[</span><span class="s1">&#39;#{node.chef_environment}.erb&#39;</span><span class="p">,</span> <span class="s1">&#39;default.erb&#39;</span><span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example emulates the entire file specificity pattern by defining it as an explicit path:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/test&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="sx">%W{</span>
<span class="sx">    host-</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;fqdn&#39;</span><span class="o">]</span><span class="si">}</span><span class="sx">/test.erb</span>
<span class="sx">    </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span><span class="si">}</span><span class="sx">-</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform_version&#39;</span><span class="o">]</span><span class="si">}</span><span class="sx">/test.erb</span>
<span class="sx">    </span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;platform&#39;</span><span class="o">]</span><span class="si">}</span><span class="sx">/test.erb</span>
<span class="sx">    default/test.erb</span>
<span class="sx">  }</span>
<span class="k">end</span>
</pre></div>
</div>
<p>A cookbook may have a <tt class="docutils literal"><span class="pre">/templates</span></tt> directory structure like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="sr">/templates/</span>
  <span class="n">windows</span><span class="o">-</span><span class="mi">6</span><span class="o">.</span><span class="mi">2</span>
  <span class="n">windows</span><span class="o">-</span><span class="mi">6</span><span class="o">.</span><span class="mi">1</span>
  <span class="n">windows</span><span class="o">-</span><span class="mi">6</span><span class="o">.</span><span class="mi">0</span>
  <span class="n">windows</span>
  <span class="n">default</span>
</pre></div>
</div>
<p>and a resource that looks something like the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;C:\path\to\file\text_file.txt&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;text_file.txt&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This resource would be matched in the same order as the <tt class="docutils literal"><span class="pre">/templates</span></tt> directory structure. For a node named <tt class="docutils literal"><span class="pre">host-node-desktop</span></tt> that is running Windows 7, the second item would be the matching item and the location:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="sr">/templates</span>
<span class="sr">  windows-6.2/</span><span class="n">text_file</span><span class="o">.</span><span class="n">txt</span>
  <span class="n">windows</span><span class="o">-</span><span class="mi">6</span><span class="o">.</span><span class="mi">1</span><span class="o">/</span><span class="n">text_file</span><span class="o">.</span><span class="n">txt</span>
  <span class="n">windows</span><span class="o">-</span><span class="mi">6</span><span class="o">.</span><span class="mi">0</span><span class="o">/</span><span class="n">text_file</span><span class="o">.</span><span class="n">txt</span>
  <span class="n">windows</span><span class="o">/</span><span class="n">text_file</span><span class="o">.</span><span class="n">txt</span>
  <span class="n">default</span><span class="o">/</span><span class="n">text_file</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</div>
<div class="section" id="helpers">
<h4>Helpers<a class="headerlink" href="#helpers" title="Permalink to this headline">¶</a></h4>
<p>A helper is a method or a module that can be used to extend a template. There are three approaches:</p>
<ul class="simple">
<li>An inline helper method</li>
<li>An inline helper module</li>
<li>A cookbook library module</li>
</ul>
<p>Use the <tt class="docutils literal"><span class="pre">helper</span></tt> attribute in a recipe to define an inline helper method. Use the <tt class="docutils literal"><span class="pre">helpers</span></tt> attribute to define an inline helper module or a cookbook library module.</p>
<div class="section" id="inline-methods">
<h5>Inline Methods<a class="headerlink" href="#inline-methods" title="Permalink to this headline">¶</a></h5>
<p>A template helper method is always defined inline on a per-resource basis. A simple example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/path&#39;</span> <span class="k">do</span>
  <span class="n">helper</span><span class="p">(</span><span class="ss">:hello_world</span><span class="p">)</span> <span class="p">{</span> <span class="s1">&#39;hello world&#39;</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Another way to define an inline helper method is to reference a node object so that repeated calls to one (or more) cookbook attributes can be done efficiently:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/path&#39;</span> <span class="k">do</span>
  <span class="n">helper</span><span class="p">(</span><span class="ss">:app</span><span class="p">)</span> <span class="p">{</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;app&#39;</span><span class="o">]</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>An inline helper method can also take arguments:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/path&#39;</span> <span class="k">do</span>
  <span class="n">helper</span><span class="p">(</span><span class="ss">:app_conf</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">setting</span><span class="o">|</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;app&#39;</span><span class="o">][</span><span class="n">setting</span><span class="o">]</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Once declared, a template can then use the helper methods to build a file. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="no">Say</span> <span class="ss">hello</span><span class="p">:</span> <span class="o">&lt;%=</span> <span class="n">hello_world</span> <span class="o">%&gt;</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;app&#39;</span><span class="o">][</span><span class="s1">&#39;listen_port&#39;</span><span class="o">]</span> <span class="ss">is</span><span class="p">:</span> <span class="o">&lt;%=</span> <span class="n">app</span><span class="o">[</span><span class="s1">&#39;listen_port&#39;</span><span class="o">]</span> <span class="o">%&gt;</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;app&#39;</span><span class="o">][</span><span class="s1">&#39;log_location&#39;</span><span class="o">]</span> <span class="ss">is</span><span class="p">:</span> <span class="o">&lt;%=</span> <span class="n">app_conf</span><span class="p">(</span><span class="s1">&#39;log_location&#39;</span><span class="p">)</span> <span class="o">%&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="inline-modules">
<h5>Inline Modules<a class="headerlink" href="#inline-modules" title="Permalink to this headline">¶</a></h5>
<p>A template helper module can be defined inline on a per-resource basis. This approach can be useful when a template requires more complex information. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/path&#39;</span> <span class="k">do</span>
  <span class="n">helpers</span> <span class="k">do</span>

    <span class="k">def</span> <span class="nf">hello_world</span>
      <span class="s1">&#39;hello world&#39;</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">app</span>
      <span class="n">node</span><span class="o">[</span><span class="s1">&#39;app&#39;</span><span class="o">]</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">app_conf</span><span class="p">(</span><span class="n">setting</span><span class="p">)</span>
      <span class="n">node</span><span class="o">[</span><span class="s1">&#39;app&#39;</span><span class="o">][</span><span class="s1">&#39;setting&#39;</span><span class="o">]</span>
    <span class="k">end</span>

  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">hello_world</span></tt>, <tt class="docutils literal"><span class="pre">app</span></tt>, and <tt class="docutils literal"><span class="pre">app_conf(setting)</span></tt> methods comprise the module that extends a template.</p>
</div>
<div class="section" id="library-modules">
<h5>Library Modules<a class="headerlink" href="#library-modules" title="Permalink to this headline">¶</a></h5>
<p>A template helper module can be defined in a library. This is useful when extensions need to be reused across recipes or to make it easier to manage code that would otherwise be defined inline on a per-recipe basis.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/path/to/template.erb&#39;</span> <span class="k">do</span>
  <span class="n">helpers</span><span class="p">(</span><span class="no">MyHelperModule</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="host-notation">
<h4>Host Notation<a class="headerlink" href="#host-notation" title="Permalink to this headline">¶</a></h4>
<p>The naming of folders within cookbook directories must literally match the host notation used for template specificity matching. For example, if a host is named <tt class="docutils literal"><span class="pre">foo.example.com</span></tt>, then the folder must be named <tt class="docutils literal"><span class="pre">host-foo.example.com</span></tt>.</p>
</div>
<div class="section" id="partial-templates">
<h4>Partial Templates<a class="headerlink" href="#partial-templates" title="Permalink to this headline">¶</a></h4>
<p>A template can be built in a way that allows it to contain references to one (or more) smaller template files. (These smaller template files are also referred to as partials.) A partial can be referenced from a template file in one of the following ways:</p>
<ul class="simple">
<li>By using the <tt class="docutils literal"><span class="pre">render</span></tt> method in the template file</li>
<li>By using the <strong>template</strong> resource and the <tt class="docutils literal"><span class="pre">variables</span></tt> property.</li>
</ul>
<div class="section" id="render-method">
<h5>render Method<a class="headerlink" href="#render-method" title="Permalink to this headline">¶</a></h5>
<p>Use the <tt class="docutils literal"><span class="pre">render</span></tt> method in a template to reference a partial template file:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="sx">%= render &quot;partial_name.txt.erb&quot;, :option =</span><span class="o">&gt;</span> <span class="p">{}</span> <span class="o">%&gt;</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">partial_name</span></tt> is the name of the partial template file and <tt class="docutils literal"><span class="pre">:option</span></tt> is one (or more) of the following:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Option</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:cookbook</span></tt></td>
<td>By default, a partial template file is assumed to be located in the cookbook that contains the top-level template. Use this option to specify the path to a different cookbook</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:local</span></tt></td>
<td>Indicates that the name of the partial template file should be interpreted as a path to a file in the local file system or looked up in a cookbook using the normal rules for template files. Set to <tt class="docutils literal"><span class="pre">true</span></tt> to interpret as a path to a file in the local file system and to <tt class="docutils literal"><span class="pre">false</span></tt> to use the normal rules for template files</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">:source</span></tt></td>
<td>By default, a partial template file is identified by its file name. Use this option to specify a different name or a local path to use (instead of the name of the partial template file)</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">:variables</span></tt></td>
<td>A hash of <tt class="docutils literal"><span class="pre">variable_name</span> <span class="pre">=&gt;</span> <span class="pre">value</span></tt> that will be made available to the partial template file. When this option is used, any variables that are defined in the top-level template that are required by the partial template file must have them defined explicitly using this option</td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="sx">%= render &quot;simple.txt.erb&quot;, :variables =</span><span class="o">&gt;</span> <span class="p">{</span><span class="ss">:user</span> <span class="o">=&gt;</span> <span class="no">Etc</span><span class="o">.</span><span class="n">getlogin</span> <span class="p">},</span> <span class="ss">:local</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="o">%&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="transfer-frequency">
<h4>Transfer Frequency<a class="headerlink" href="#transfer-frequency" title="Permalink to this headline">¶</a></h4>
<p>The chef-client caches a template when it is first requested. On each subsequent request for that template, the chef-client compares that request to the template located on the Chef server. If the templates are the same, no transfer occurs.</p>
</div>
<div class="section" id="variables">
<h4>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h4>
<p>A template is an Embedded Ruby (ERB) template. An Embedded Ruby (ERB) template allows Ruby code to be embedded inside a text file within specially formatted tags. Ruby code can be embedded using expressions and statements. An expression is delimited by <tt class="docutils literal"><span class="pre">&lt;%=</span></tt> and <tt class="docutils literal"><span class="pre">%&gt;</span></tt>. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="o">&lt;%=</span> <span class="s2">&quot;my name is </span><span class="si">#{</span><span class="vg">$ruby</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">%&gt;</span>
</pre></div>
</div>
<p>A statement is delimited by a modifier, such as <tt class="docutils literal"><span class="pre">if</span></tt>, <tt class="docutils literal"><span class="pre">elseif</span></tt>, and <tt class="docutils literal"><span class="pre">else</span></tt>. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="kp">false</span>
   <span class="c1"># this won&#39;t happen</span>
<span class="k">elsif</span> <span class="kp">nil</span>
   <span class="c1"># this won&#39;t either</span>
<span class="k">else</span>
   <span class="c1"># code here will run though</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Using a Ruby expression is the most common approach for defining template variables because this is how all variables that are sent to a template are referenced. Whenever a template needs to use an <tt class="docutils literal"><span class="pre">each</span></tt>, <tt class="docutils literal"><span class="pre">if</span></tt>, or <tt class="docutils literal"><span class="pre">end</span></tt>, use a Ruby statement.</p>
<p>When a template is rendered, Ruby expressions and statements are evaluated by the chef-client. The variables listed in the <strong>template</strong> resource&#8217;s <tt class="docutils literal"><span class="pre">variables</span></tt> parameter and in the node object are evaluated. The chef-client then passes these variables to the template, where they will be accessible as instance variables within the template. The node object can be accessed just as if it were part of a recipe, using the same syntax.</p>
<p>For example, a simple template resource like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;fqdn&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;latte&#39;</span>
<span class="n">template</span> <span class="s1">&#39;/tmp/foo&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;foo.erb&#39;</span>
  <span class="n">variables</span><span class="p">({</span>
    <span class="ss">:x_men</span> <span class="o">=&gt;</span> <span class="s1">&#39;are keen&#39;</span>
  <span class="p">})</span>
<span class="k">end</span>
</pre></div>
</div>
<p>And a simple Embedded Ruby (ERB) template like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="no">The</span> <span class="n">node</span> <span class="o">&lt;</span><span class="sx">%= node[:fqdn] %&gt; thinks the x-men &lt;%=</span> <span class="vi">@x_men</span> <span class="o">%&gt;</span>
</pre></div>
</div>
<p>Would render something like:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="no">The</span> <span class="n">node</span> <span class="n">latte</span> <span class="n">thinks</span> <span class="n">the</span> <span class="n">x</span><span class="o">-</span><span class="n">men</span> <span class="n">are</span> <span class="n">keen</span>
</pre></div>
</div>
<p>Even though this is a very simple example, the full capabilities of Ruby can be used to tackle even the most complex and demanding template requirements.</p>
</div>
</div>
<div class="section" id="id313">
<h3>Examples<a class="headerlink" href="#id313" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Configure a file from a template</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/config.conf&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;config.conf.erb&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Configure a file from a local template</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/config.conf&#39;</span> <span class="k">do</span>
  <span class="n">local</span> <span class="kp">true</span>
  <span class="n">source</span> <span class="s1">&#39;/tmp/config.conf.erb&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Configure a file using a variable map</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/config.conf&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;config.conf.erb&#39;</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="ss">:config_var</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;configs&#39;</span><span class="o">][</span><span class="s1">&#39;config_var&#39;</span><span class="o">]</span>
  <span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the not_if condition</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and using the presence of an attribute value on the node to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="n">node</span><span class="o">[</span><span class="ss">:some_value</span><span class="o">]</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and then Ruby code to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="k">do</span>
    <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and using a Ruby block (with curly braces) to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="p">{</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span> <span class="p">)}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">not_if</span></tt> condition to create a file based on a template and using a string to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">not_if</span> <span class="s1">&#39;test -f /etc/passwd&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use the only_if condition</strong></p>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">only_if</span></tt> condition to create a file based on a template and using the presence of an attribute on the node to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">only_if</span> <span class="p">{</span> <span class="n">node</span><span class="o">[</span><span class="ss">:some_value</span><span class="o">]</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">only_if</span></tt> condition to create a file based on a template, and then use Ruby to specify a condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">only_if</span> <span class="k">do</span> <span class="o">!</span> <span class="no">File</span><span class="o">.</span><span class="n">exist?</span><span class="p">(</span><span class="s1">&#39;/etc/passwd&#39;</span><span class="p">)</span> <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The following example shows how to use the <tt class="docutils literal"><span class="pre">only_if</span></tt> condition to create a file based on a template and using a string to specify the condition:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">only_if</span> <span class="s1">&#39;test -f /etc/passwd&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a whitespace array (%w)</strong></p>
<p>The following example shows how to use a Ruby whitespace array to define a list of configuration tools, and then use that list of tools within the <strong>template</strong> resource to ensure that all of these configuration tools are using the same RSA key:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="sx">%w{openssl.cnf pkitool vars Rakefile}</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
  <span class="n">template</span> <span class="s2">&quot;/etc/openvpn/easy-rsa/</span><span class="si">#{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">do</span>
    <span class="n">source</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">f</span><span class="si">}</span><span class="s2">.erb&quot;</span>
    <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
    <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
    <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use a relative path</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="no">ENV</span><span class="o">[</span><span class="s1">&#39;HOME&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/chef-getting-started.txt&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;chef-getting-started.txt.erb&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delay notifications</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/nagios3/configures-nagios.conf&#39;</span> <span class="k">do</span>
  <span class="c1"># other parameters</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test-nagios-config]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Notify immediately</strong></p>
<p>By default, notifications are <tt class="docutils literal"><span class="pre">:delayed</span></tt>, that is they are queued up as they are triggered, and then executed at the very end of a chef-client run. To run an action immediately, use <tt class="docutils literal"><span class="pre">:immediately</span></tt>:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/nagios3/configures-nagios.conf&#39;</span> <span class="k">do</span>
  <span class="c1"># other parameters</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test-nagios-config]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and then the chef-client would immediately run the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test-nagios-config&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;nagios3 --verify-config&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Notify multiple resources</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/chef/server.rb&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;server.rb.erb&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[chef-solr]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[chef-solr-indexer]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[chef-server]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Reload a service</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/tmp/somefile&#39;</span> <span class="k">do</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">source</span> <span class="s1">&#39;somefile.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;service[apache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Restart a service when a template is modified</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/www/configures-apache.conf&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[apache]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Send notifications to multiple resources</strong></p>
<p>To send notifications to multiple resources, just use multiple attributes. Multiple attributes will get sent to the notified resources in the order specified.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s1">&#39;/etc/netatalk/netatalk.conf&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[afpd]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[cnid]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>

<span class="n">service</span> <span class="s1">&#39;afpd&#39;</span>
<span class="n">service</span> <span class="s1">&#39;cnid&#39;</span>
</pre></div>
</div>
<p><strong>Execute a command using a template</strong></p>
<p>The following example shows how to set up IPv4 packet forwarding using the <strong>execute</strong> resource to run a command named <tt class="docutils literal"><span class="pre">forward_ipv4</span></tt> that uses a template defined by the <strong>template</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;forward_ipv4&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;echo &gt; /proc/.../ipv4/ip_forward&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/etc/file_name.conf&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;routing/file_name.conf.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[forward_ipv4]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">command</span></tt> property for the <strong>execute</strong> resource contains the command that is to be run and the <tt class="docutils literal"><span class="pre">source</span></tt> property for the <strong>template</strong> resource specifies which template to use. The <tt class="docutils literal"><span class="pre">notifies</span></tt> property for the <strong>template</strong> specifies that the <tt class="docutils literal"><span class="pre">execute[forward_ipv4]</span></tt> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of the chef-client run.</p>
<p><strong>Set an IP address using variables and a template</strong></p>
<p>The following example shows how the <strong>template</strong> resource can be used in a recipe to combine settings stored in an attributes file, variables within a recipe, and a template to set the IP addresses that are used by the Nginx service. The attributes file contains the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;dir&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;/etc/nginx&#39;</span>
</pre></div>
</div>
<p>The recipe then does the following to:</p>
<ul class="simple">
<li>Declare two variables at the beginning of the recipe, one for the remote IP address and the other for the authorized IP address</li>
<li>Use the <strong>service</strong> resource to restart and reload the Nginx service</li>
<li>Load a template named <tt class="docutils literal"><span class="pre">authorized_ip.erb</span></tt> from the <tt class="docutils literal"><span class="pre">/templates</span></tt> directory that is used to set the IP address values based on the variables specified in the recipe</li>
</ul>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">node</span><span class="o">.</span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;remote_ip_var&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;remote_addr&#39;</span>
<span class="n">node</span><span class="o">.</span><span class="n">default</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;authorized_ips&#39;</span><span class="o">]</span> <span class="o">=</span> <span class="o">[</span><span class="s1">&#39;127.0.0.1/32&#39;</span><span class="o">]</span>

<span class="n">service</span> <span class="s1">&#39;nginx&#39;</span> <span class="k">do</span>
  <span class="n">supports</span> <span class="ss">:status</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:restart</span> <span class="o">=&gt;</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">:reload</span> <span class="o">=&gt;</span> <span class="kp">true</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;authorized_ip&#39;</span> <span class="k">do</span>
  <span class="n">path</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;dir&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">/authorized_ip&quot;</span>
  <span class="n">source</span> <span class="s1">&#39;modules/authorized_ip.erb&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="ss">:remote_ip_var</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;remote_ip_var&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:authorized_ips</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;nginx&#39;</span><span class="o">][</span><span class="s1">&#39;authorized_ips&#39;</span><span class="o">]</span>
  <span class="p">)</span>

  <span class="n">notifies</span> <span class="ss">:reload</span><span class="p">,</span> <span class="s1">&#39;service[nginx]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">variables</span></tt> property tells the template to use the variables set at the beginning of the recipe and the <tt class="docutils literal"><span class="pre">source</span></tt> property is used to call a template file located in the cookbook&#8217;s <tt class="docutils literal"><span class="pre">/templates</span></tt> directory. The template file looks similar to:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">geo</span> <span class="vg">$&lt;</span><span class="sx">%= @remote_ip_var %&gt; $authorized_ip {</span>
<span class="sx">  default no;</span>
<span class="sx">  &lt;% @authorized_ips.each do |ip| %&gt;</span>
<span class="sx">  &lt;%=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">ip</span><span class="si">}</span><span class="s2"> yes;&quot;</span> <span class="sx">%&gt;</span>
<span class="sx">  &lt;% end %&gt;</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Add a rule to an IP table</strong></p>
<p>The following example shows how to add a rule named <tt class="docutils literal"><span class="pre">test_rule</span></tt> to an IP table using the <strong>execute</strong> resource to run a command using a template that is defined by the <strong>template</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">execute</span> <span class="s1">&#39;test_rule&#39;</span> <span class="k">do</span>
  <span class="n">command</span> <span class="s1">&#39;command_to_run</span>
<span class="s1">    --option value</span>
<span class="s1">    ...</span>
<span class="s1">    --option value</span>
<span class="s1">    --source #{node[:name_of_node][:ipsec][:local][:subnet]}</span>
<span class="s1">    -j test_rule&#39;</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">template</span> <span class="s1">&#39;/etc/file_name.local&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;routing/file_name.local.erb&#39;</span>
  <span class="n">notifies</span> <span class="ss">:run</span><span class="p">,</span> <span class="s1">&#39;execute[test_rule]&#39;</span><span class="p">,</span> <span class="ss">:delayed</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where the <tt class="docutils literal"><span class="pre">command</span></tt> property for the <strong>execute</strong> resource contains the command that is to be run and the <tt class="docutils literal"><span class="pre">source</span></tt> property for the <strong>template</strong> resource specifies which template to use. The <tt class="docutils literal"><span class="pre">notifies</span></tt> property for the <strong>template</strong> specifies that the <tt class="docutils literal"><span class="pre">execute[test_rule]</span></tt> (which is defined by the <strong>execute</strong> resource) should be queued up and run at the end of the chef-client run.</p>
<p><strong>Apply proxy settings consistently across a Chef organization</strong></p>
<p>The following example shows how a template can be used to apply consistent proxy settings for all nodes of the same type:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:dir</span><span class="o">]</span><span class="si">}</span><span class="s2">/sites-available/site_proxy.conf&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;site_proxy.matching_node.conf.erb&#39;</span>
  <span class="n">owner</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">group</span> <span class="s1">&#39;root&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="ss">:ssl_certificate</span> <span class="o">=&gt;</span>    <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:dir</span><span class="o">]</span><span class="si">}</span><span class="s2">/shared/certificates/site_proxy.crt&quot;</span><span class="p">,</span>
    <span class="ss">:ssl_key</span> <span class="o">=&gt;</span>            <span class="s2">&quot;</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:dir</span><span class="o">]</span><span class="si">}</span><span class="s2">/shared/certificates/site_proxy.key&quot;</span><span class="p">,</span>
    <span class="ss">:listen_port</span> <span class="o">=&gt;</span>        <span class="n">node</span><span class="o">[</span><span class="ss">:site</span><span class="o">][</span><span class="ss">:matching_node_proxy</span><span class="o">][</span><span class="ss">:listen_port</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:server_name</span> <span class="o">=&gt;</span>        <span class="n">node</span><span class="o">[</span><span class="ss">:site</span><span class="o">][</span><span class="ss">:matching_node_proxy</span><span class="o">][</span><span class="ss">:server_name</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:fqdn</span> <span class="o">=&gt;</span>               <span class="n">node</span><span class="o">[</span><span class="ss">:fqdn</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:server_options</span> <span class="o">=&gt;</span>     <span class="n">node</span><span class="o">[</span><span class="ss">:site</span><span class="o">][</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:server</span><span class="o">][</span><span class="ss">:options</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:proxy_options</span> <span class="o">=&gt;</span>      <span class="n">node</span><span class="o">[</span><span class="ss">:site</span><span class="o">][</span><span class="ss">:matching_node</span><span class="o">][</span><span class="ss">:proxy</span><span class="o">][</span><span class="ss">:options</span><span class="o">]</span>
  <span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">matching_node</span></tt> represents a type of node (like Nginx) and <tt class="docutils literal"><span class="pre">site_proxy</span></tt> represents the type of proxy being used for that type of node (like Nexus).</p>
<p><strong>Get template settings from a local file</strong></p>
<p>The <strong>template</strong> resource can be used to render a template based on settings contained in a local file on disk or to get the settings from a template in a cookbook. Most of the time, the settings are retrieved from a template in a cookbook. The following example shows how the <strong>template</strong> resource can be used to retrieve these settings from a local file.</p>
<p>The following example is based on a few assumptions:</p>
<ul class="simple">
<li>The environment is a Ruby on Rails application that needs render a file named <tt class="docutils literal"><span class="pre">database.yml</span></tt></li>
<li>Information about the application&#8212;the user, their password, the server&#8212;is stored in a data bag on the Chef server</li>
<li>The application is already deployed to the system and that only requirement in this example is to render the <tt class="docutils literal"><span class="pre">database.yml</span></tt> file</li>
</ul>
<p>The application source tree looks something like:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>myapp/
-&gt; config/
   -&gt; database.yml.erb
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">There should not be a file named <tt class="docutils literal"><span class="pre">database.yml</span></tt> (without the <tt class="docutils literal"><span class="pre">.erb</span></tt>), as the <tt class="docutils literal"><span class="pre">database.yml</span></tt> file is what will be rendered using the <strong>template</strong> resource.</p>
</div>
<p>The deployment of the app will end up in <tt class="docutils literal"><span class="pre">/srv</span></tt>, so the full path to this template would be something like <tt class="docutils literal"><span class="pre">/srv/myapp/current/config/database.yml.erb</span></tt>.</p>
<p>The content of the template itself may look like this:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="sx">%= @rails_env %&gt;:</span>
<span class="sx">   adapter: &lt;%=</span> <span class="vi">@adapter</span> <span class="sx">%&gt;</span>
<span class="sx">   host: &lt;%= @host %&gt;</span>
   <span class="ss">database</span><span class="p">:</span> <span class="o">&lt;</span><span class="sx">%= @database %&gt;</span>
<span class="sx">   username: &lt;%=</span> <span class="vi">@username</span> <span class="sx">%&gt;</span>
<span class="sx">   password: &lt;%= @password %&gt;</span>
   <span class="ss">encoding</span><span class="p">:</span> <span class="s1">&#39;utf8&#39;</span>
   <span class="ss">reconnect</span><span class="p">:</span> <span class="kp">true</span>
</pre></div>
</div>
<p>The recipe will be similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">search</span><span class="p">(</span><span class="ss">:node</span><span class="p">,</span> <span class="s2">&quot;role:myapp_database_master AND chef_environment:</span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">chef_environment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">db_master</span> <span class="o">=</span> <span class="n">results</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span>

<span class="n">template</span> <span class="s1">&#39;/srv/myapp/shared/database.yml&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;/srv/myapp/current/config/database.yml.erb&#39;</span>
  <span class="n">local</span> <span class="kp">true</span>
  <span class="n">variables</span><span class="p">(</span>
    <span class="ss">:rails_env</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">.</span><span class="n">chef_environment</span><span class="p">,</span>
    <span class="ss">:adapter</span> <span class="o">=&gt;</span> <span class="n">db_master</span><span class="o">[</span><span class="s1">&#39;myapp&#39;</span><span class="o">][</span><span class="s1">&#39;db_adapter&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:host</span> <span class="o">=&gt;</span> <span class="n">db_master</span><span class="o">[</span><span class="s1">&#39;fqdn&#39;</span><span class="o">]</span><span class="p">,</span>
    <span class="ss">:database</span> <span class="o">=&gt;</span> <span class="s2">&quot;myapp_</span><span class="si">#{</span><span class="n">node</span><span class="o">.</span><span class="n">chef_environment</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="ss">:username</span> <span class="o">=&gt;</span> <span class="s2">&quot;myapp&quot;</span><span class="p">,</span>
    <span class="ss">:password</span> <span class="o">=&gt;</span> <span class="s2">&quot;SUPERSECRET&quot;</span><span class="p">,</span>
  <span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where:</p>
<ul class="simple">
<li>the <tt class="docutils literal"><span class="pre">search</span></tt> method in the Recipe DSL is used to find the first node that is the database master (of which there should only be one)</li>
<li>the <tt class="docutils literal"><span class="pre">:adapter</span></tt> variable property may also require an attribute to have been set on a role, which then determines the correct adapter</li>
</ul>
<p>The template will render similar to the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="ss">production</span><span class="p">:</span>
  <span class="ss">adapter</span><span class="p">:</span> <span class="n">mysql</span>
  <span class="ss">host</span><span class="p">:</span> <span class="n">domU</span><span class="o">-</span><span class="mi">12</span><span class="o">-</span><span class="mi">31</span><span class="o">-</span><span class="mi">39</span><span class="o">-</span><span class="mi">14</span><span class="o">-</span><span class="no">F1</span><span class="o">-</span><span class="no">C3</span><span class="o">.</span><span class="n">compute</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">internal</span>
  <span class="ss">database</span><span class="p">:</span> <span class="n">myapp_production</span>
  <span class="ss">username</span><span class="p">:</span> <span class="n">myapp</span>
  <span class="ss">password</span><span class="p">:</span> <span class="no">SUPERSECRET</span>
  <span class="ss">encoding</span><span class="p">:</span> <span class="n">utf8</span>
  <span class="ss">reconnect</span><span class="p">:</span> <span class="kp">true</span>
</pre></div>
</div>
<p>This example showed how to use the <strong>template</strong> resource to render a template based on settings contained in a local file. Some other issues that should be considered when using this type of approach include:</p>
<ul class="simple">
<li>Should the <tt class="docutils literal"><span class="pre">database.yml</span></tt> file be in a <tt class="docutils literal"><span class="pre">.gitignore</span></tt> file?</li>
<li>How do developers run the application locally?</li>
<li>Does this work with chef-solo?</li>
</ul>
<p><strong>Pass values from recipe to template</strong></p>
<p>The following example shows how pass a value to a template using the <tt class="docutils literal"><span class="pre">variables</span></tt> property in the <strong>template</strong> resource. The template file is similar to:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="o">[</span><span class="n">tcpout</span><span class="o">]</span>
<span class="n">defaultGroup</span> <span class="o">=</span> <span class="n">splunk_indexers_</span><span class="o">&lt;</span><span class="sx">%= node[&#39;splunk&#39;][&#39;receiver_port&#39;] %&gt;</span>
<span class="sx">disabled=</span><span class="kp">false</span>

<span class="o">[</span><span class="ss">tcpout</span><span class="p">:</span><span class="n">splunk_indexers_</span><span class="o">&lt;</span><span class="sx">%= node[&#39;splunk&#39;][&#39;receiver_port&#39;] %&gt;]</span>
<span class="sx">server=</span><span class="o">&lt;</span><span class="sx">% @splunk_servers.map </span><span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span> <span class="o">-</span><span class="sx">%&gt;&lt;%= s[&#39;ipaddress&#39;] %&gt;</span><span class="ss">:&lt;</span><span class="sx">%= s[&#39;splunk&#39;][&#39;receiver_port&#39;] %&gt; &lt;% end.join(&#39;, &#39;) -%&gt;</span>
<span class="sx">&lt;% @outputs_conf.each_pair do |name, value| -%&gt;</span>
<span class="sx">&lt;%=</span> <span class="nb">name</span> <span class="sx">%&gt; = &lt;%= value %&gt;</span>
<span class="o">&lt;</span><span class="sx">% end </span><span class="o">-%&gt;</span>
</pre></div>
</div>
<p>The recipe then uses the <tt class="docutils literal"><span class="pre">variables</span></tt> attribute to find the values for <tt class="docutils literal"><span class="pre">splunk_servers</span></tt> and <tt class="docutils literal"><span class="pre">outputs_conf</span></tt>, before passing them into the template:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">template</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">splunk_dir</span><span class="si">}</span><span class="s2">/etc/system/local/outputs.conf&quot;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;outputs.conf.erb&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
  <span class="n">variables</span> <span class="ss">:splunk_servers</span> <span class="o">=&gt;</span> <span class="n">splunk_servers</span><span class="p">,</span> <span class="ss">:outputs_conf</span> <span class="o">=&gt;</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;splunk&#39;</span><span class="o">][</span><span class="s1">&#39;outputs_conf&#39;</span><span class="o">]</span>
  <span class="n">notifies</span> <span class="ss">:restart</span><span class="p">,</span> <span class="s1">&#39;service[splunk]&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>This example can be found in the <tt class="docutils literal"><span class="pre">client.rb</span></tt> recipe and the <tt class="docutils literal"><span class="pre">outputs.conf.erb</span></tt> template files that are located in the <a class="reference external" href="https://github.com/chef-cookbooks/chef-splunk/">chef-splunk cookbook</a>  that is maintained by Chef.</p>
</div>
</div>
<div class="section" id="user">
<h2>user<a class="headerlink" href="#user" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_user.rst">[edit on GitHub]</a></p>
<p>Use the <strong>user</strong> resource to add users, update existing users, remove users, and to lock/unlock user passwords.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">System attributes are collected by Ohai at the start of every chef-client run. By design, the actions available to the <strong>user</strong> resource are processed <strong>after</strong> the start of the chef-client run. This means that system attributes added or modified by the <strong>user</strong> resource during the chef-client run must be reloaded before they can be available to the chef-client. These system attributes can be reloaded in two ways: by picking up the values at the start of the (next) chef-client run or by using the <a class="reference external" href="https://docs.chef.io/resource_ohai.html">ohai resource</a> to reload the system attributes during the current chef-client run.</p>
</div>
<div class="section" id="id315">
<h3>Syntax<a class="headerlink" href="#id315" title="Permalink to this headline">¶</a></h3>
<p>A <strong>user</strong> resource block manages users on a node:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="s1">&#39;a user&#39;</span> <span class="k">do</span>
  <span class="n">comment</span> <span class="s1">&#39;A random user&#39;</span>
  <span class="n">uid</span> <span class="s1">&#39;1234&#39;</span>
  <span class="n">gid</span> <span class="s1">&#39;1234&#39;</span>
  <span class="n">home</span> <span class="s1">&#39;/home/random&#39;</span>
  <span class="n">shell</span> <span class="s1">&#39;/bin/bash&#39;</span>
  <span class="n">password</span> <span class="s1">&#39;$1$JJsvHslasdfjVEroftprNn4JHtDi&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>user</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">comment</span>                    <span class="nb">String</span>
  <span class="n">force</span>                      <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span> <span class="c1"># see description</span>
  <span class="n">gid</span>                        <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">home</span>                       <span class="nb">String</span>
  <span class="n">iterations</span>                 <span class="nb">Integer</span>
  <span class="n">manage_home</span>                <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">non_unique</span>                 <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">password</span>                   <span class="nb">String</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">User</span>
  <span class="n">salt</span>                       <span class="nb">String</span>
  <span class="n">shell</span>                      <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="nb">system</span>                     <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">uid</span>                        <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">username</span>                   <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">user</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">comment</span></tt>, <tt class="docutils literal"><span class="pre">force</span></tt>, <tt class="docutils literal"><span class="pre">gid</span></tt>, <tt class="docutils literal"><span class="pre">home</span></tt>, <tt class="docutils literal"><span class="pre">iterations</span></tt>, <tt class="docutils literal"><span class="pre">manage_home</span></tt>, <tt class="docutils literal"><span class="pre">non_unique</span></tt>, <tt class="docutils literal"><span class="pre">password</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">salt</span></tt>, <tt class="docutils literal"><span class="pre">shell</span></tt>, <tt class="docutils literal"><span class="pre">system</span></tt>, <tt class="docutils literal"><span class="pre">uid</span></tt>, and <tt class="docutils literal"><span class="pre">username</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id316">
<h3>Actions<a class="headerlink" href="#id316" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:create</span></tt></dt>
<dd>Default. Create a user with given properties. If a user already exists (but does not match), update that user to match.</dd>
<dt><tt class="docutils literal"><span class="pre">:lock</span></tt></dt>
<dd>Lock a user&#8217;s password.</dd>
<dt><tt class="docutils literal"><span class="pre">:manage</span></tt></dt>
<dd>Manage an existing user. This action does nothing if the user does not exist.</dd>
<dt><tt class="docutils literal"><span class="pre">:modify</span></tt></dt>
<dd>Modify an existing user. This action raises an exception if the user does not exist.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a user.</dd>
<dt><tt class="docutils literal"><span class="pre">:unlock</span></tt></dt>
<dd>Unlock a user&#8217;s password.</dd>
</dl>
</div>
<div class="section" id="id317">
<h3>Properties<a class="headerlink" href="#id317" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">comment</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) comments about the user.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">force</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p>Force the removal of a user. May be used only with the <tt class="docutils literal"><span class="pre">:remove</span></tt> action.</p>
<div class="last admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Using this property may leave the system in an inconsistent state. For example, a user account will be removed even if the user is logged in. A user&#8217;s home directory will be removed, even if that directory is shared by multiple users.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">gid</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The identifier for the group.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">group</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The <tt class="docutils literal"><span class="pre">group</span></tt> property is an alias of the <tt class="docutils literal"><span class="pre">gid</span></tt> property.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">home</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The location of the home directory.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">iterations</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">Mac OS X platform only, 10.8 (or higher). The number of iterations for a password with a SALTED-SHA512-PBKDF2 shadow hash.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">manage_home</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p>Manage a user&#8217;s home directory.</p>
<p>With the <tt class="docutils literal"><span class="pre">:create</span></tt> action, a user&#8217;s home directory is created based on <tt class="docutils literal"><span class="pre">HOME_DIR</span></tt>. If the home directory is missing, it is created unless <tt class="docutils literal"><span class="pre">CREATE_HOME</span></tt> in <tt class="docutils literal"><span class="pre">/etc/login.defs</span></tt> is set to <tt class="docutils literal"><span class="pre">no</span></tt>. When created, a skeleton set of files and sub-directories is also created in the home directory.</p>
<p class="last">With the <tt class="docutils literal"><span class="pre">:modify</span></tt> action, a user&#8217;s home directory is moved to <tt class="docutils literal"><span class="pre">HOME_DIR</span></tt>. If the home directory is missing, it is created unless <tt class="docutils literal"><span class="pre">CREATE_HOME</span></tt> in <tt class="docutils literal"><span class="pre">/etc/login.defs</span></tt> is set to <tt class="docutils literal"><span class="pre">no</span></tt>. The contents of the user&#8217;s home directory are moved to the new location.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">non_unique</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Create a duplicate (non-unique) user account.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">password</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The password shadow hash. This property requires that <tt class="docutils literal"><span class="pre">ruby-shadow</span></tt> be installed. This is part of the Debian package: <tt class="docutils literal"><span class="pre">libshadow-ruby1.8</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">salt</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Mac OS X platform only, 10.7 or higher. The salt value for a password shadow hash. Mac OS X version 10.7 uses SALTED-SHA512 and version 10.8 (and higher) uses SALTED-SHA512-PBKDF2 to calculate password shadow hashes.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">shell</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The login shell.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">system</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Create a system user. This property may be used with <tt class="docutils literal"><span class="pre">useradd</span></tt> as the provider to create a system user which passes the <tt class="docutils literal"><span class="pre">-r</span></tt> flag to <tt class="docutils literal"><span class="pre">useradd</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">uid</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The numeric user identifier.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">username</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of the user. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
</dl>
</div>
<div class="section" id="password-shadow-hash">
<h3>Password Shadow Hash<a class="headerlink" href="#password-shadow-hash" title="Permalink to this headline">¶</a></h3>
<p>There are a number of encryption options and tools that can be used to create a password shadow hash. In general, using a strong encryption method like SHA-512 and the <tt class="docutils literal"><span class="pre">passwd</span></tt> command in the OpenSSL toolkit is a good approach, however the encryption options and tools that are available may be different from one distribution to another. The following examples show how the command line can be used to create a password shadow hash. When using the <tt class="docutils literal"><span class="pre">passwd</span></tt> command in the OpenSSL tool:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>openssl passwd -1 <span class="s2">&quot;theplaintextpassword&quot;</span>
</pre></div>
</div>
<p>When using <tt class="docutils literal"><span class="pre">mkpasswd</span></tt>:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>mkpasswd -m sha-512
</pre></div>
</div>
<p>For more information:</p>
<ul class="simple">
<li><a class="reference external" href="http://www.openssl.org/docs/apps/passwd.html">http://www.openssl.org/docs/apps/passwd.html</a></li>
<li>Check the local documentation or package repository for the distribution that is being used. For example, on Ubuntu 9.10-10.04, the <tt class="docutils literal"><span class="pre">mkpasswd</span></tt> package is required and on Ubuntu 10.10+ the <tt class="docutils literal"><span class="pre">whois</span></tt> package is required.</li>
</ul>
</div>
<div class="section" id="id318">
<h3>Providers<a class="headerlink" href="#id318" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::User::Useradd</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd>The default provider for the <strong>user</strong> resource.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::User::Pw</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd>The provider for the FreeBSD platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::User::Dscl</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd>The provider for the Mac OS X platform.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::User::Windows</span></tt>, <tt class="docutils literal"><span class="pre">user</span></tt></dt>
<dd>The provider for all Microsoft Windows platforms.</dd>
</dl>
</div>
<div class="section" id="id319">
<h3>Examples<a class="headerlink" href="#id319" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Create a user named &#8220;random&#8221;</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="s1">&#39;random&#39;</span> <span class="k">do</span>
  <span class="n">manage_home</span> <span class="kp">true</span>
  <span class="n">comment</span> <span class="s1">&#39;User Random&#39;</span>
  <span class="n">uid</span> <span class="s1">&#39;1234&#39;</span>
  <span class="n">gid</span> <span class="s1">&#39;1234&#39;</span>
  <span class="n">home</span> <span class="s1">&#39;/home/random&#39;</span>
  <span class="n">shell</span> <span class="s1">&#39;/bin/bash&#39;</span>
  <span class="n">password</span> <span class="s1">&#39;$1$JJsvHslV$szsCjVEroftprNn4JHtDi&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a system user</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="s1">&#39;systemguy&#39;</span> <span class="k">do</span>
  <span class="n">comment</span> <span class="s1">&#39;system guy&#39;</span>
  <span class="nb">system</span> <span class="kp">true</span>
  <span class="n">shell</span> <span class="s1">&#39;/bin/false&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Create a system user with a variable</strong></p>
<p>The following example shows how to create a system user. In this instance, the <tt class="docutils literal"><span class="pre">home</span></tt> value is calculated and stored in a variable called <tt class="docutils literal"><span class="pre">user_home</span></tt> which sets the user&#8217;s <tt class="docutils literal"><span class="pre">home</span></tt> attribute.</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user_home</span> <span class="o">=</span> <span class="s2">&quot;/home/</span><span class="si">#{</span><span class="n">node</span><span class="o">[</span><span class="s1">&#39;cookbook_name&#39;</span><span class="o">][</span><span class="s1">&#39;user&#39;</span><span class="o">]</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">user</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;cookbook_name&#39;</span><span class="o">][</span><span class="s1">&#39;user&#39;</span><span class="o">]</span> <span class="k">do</span>
  <span class="n">gid</span> <span class="n">node</span><span class="o">[</span><span class="s1">&#39;cookbook_name&#39;</span><span class="o">][</span><span class="s1">&#39;group&#39;</span><span class="o">]</span>
  <span class="n">shell</span> <span class="s1">&#39;/bin/bash&#39;</span>
  <span class="n">home</span> <span class="n">user_home</span>
  <span class="nb">system</span> <span class="kp">true</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use SALTED-SHA512 passwords</strong></p>
<p>Mac OS X 10.7 calculates the password shadow hash using SALTED-SHA512. The length of the shadow hash value is 68 bytes, the salt value is the first 4 bytes, with the remaining 64 being the shadow hash itself. The following code will calculate password shadow hashes for Mac OS X 10.7:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;my_awesome_password&#39;</span>
<span class="n">salt</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Random</span><span class="o">.</span><span class="n">random_bytes</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">encoded_password</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Digest</span><span class="o">::</span><span class="no">SHA512</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(</span><span class="n">salt</span> <span class="o">+</span> <span class="n">password</span><span class="p">)</span>
<span class="n">shadow_hash</span> <span class="o">=</span> <span class="n">salt</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span> <span class="o">+</span> <span class="n">encoded_password</span>
</pre></div>
</div>
<p>Use the calculated password shadow hash with the <strong>user</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="s1">&#39;my_awesome_user&#39;</span> <span class="k">do</span>
  <span class="n">password</span> <span class="s1">&#39;c9b3bd....d843&#39;</span>  <span class="c1"># Length: 136</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Use SALTED-SHA512-PBKDF2 passwords</strong></p>
<p>Mac OS X 10.8 (and higher) calculates the password shadow hash using SALTED-SHA512-PBKDF2. The length of the shadow hash value is 128 bytes, the salt value is 32 bytes, and an integer specifies the number of iterations. The following code will calculate password shadow hashes for Mac OS X 10.8 (and higher):</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">password</span> <span class="o">=</span> <span class="s1">&#39;my_awesome_password&#39;</span>
<span class="n">salt</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Random</span><span class="o">.</span><span class="n">random_bytes</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="n">iterations</span> <span class="o">=</span> <span class="mi">25000</span> <span class="c1"># Any value above 20k should be fine.</span>

<span class="n">shadow_hash</span> <span class="o">=</span> <span class="no">OpenSSL</span><span class="o">::</span><span class="no">PKCS5</span><span class="o">::</span><span class="n">pbkdf2_hmac</span><span class="p">(</span>
  <span class="n">password</span><span class="p">,</span>
  <span class="n">salt</span><span class="p">,</span>
  <span class="n">iterations</span><span class="p">,</span>
  <span class="mi">128</span><span class="p">,</span>
  <span class="no">OpenSSL</span><span class="o">::</span><span class="no">Digest</span><span class="o">::</span><span class="no">SHA512</span><span class="o">.</span><span class="n">new</span>
<span class="p">)</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
<span class="n">salt_value</span> <span class="o">=</span> <span class="n">salt</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;H*&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span>
</pre></div>
</div>
<p>Use the calculated password shadow hash with the <strong>user</strong> resource:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">user</span> <span class="s1">&#39;my_awesome_user&#39;</span> <span class="k">do</span>
  <span class="n">password</span> <span class="s1">&#39;cbd1a....fc843&#39;</span>  <span class="c1"># Length: 256</span>
  <span class="n">salt</span> <span class="s1">&#39;bd1a....fc83&#39;</span>        <span class="c1"># Length: 64</span>
  <span class="n">iterations</span> <span class="mi">25000</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="windows-package">
<h2>windows_package<a class="headerlink" href="#windows-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_windows_package.rst">[edit on GitHub]</a></p>
<p>Use the <strong>windows_package</strong> resource to manage Microsoft Installer Package (MSI) packages for the Microsoft Windows platform.</p>
<div class="section" id="id320">
<h3>Syntax<a class="headerlink" href="#id320" title="Permalink to this headline">¶</a></h3>
<p>A <strong>windows_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>windows_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>windows_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">checksum</span>                   <span class="nb">String</span>
  <span class="n">installer_type</span>             <span class="no">Symbol</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Windows</span>
  <span class="n">remote_file_attributes</span>     <span class="no">Hash</span>
  <span class="n">returns</span>                    <span class="nb">Integer</span><span class="p">,</span> <span class="nb">Array</span> <span class="n">of</span> <span class="n">integers</span>
  <span class="n">source</span>                     <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">windows_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">checksum</span></tt>, <tt class="docutils literal"><span class="pre">installer_type</span></tt>, <tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">remote_file_attributes</span></tt>, <tt class="docutils literal"><span class="pre">returns</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, and <tt class="docutils literal"><span class="pre">timeout</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id321">
<h3>Actions<a class="headerlink" href="#id321" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
</dl>
</div>
<div class="section" id="id322">
<h3>Properties<a class="headerlink" href="#id322" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">checksum</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p>The SHA-256 checksum of the file. Use to prevent a file from being re-downloaded. When the local file matches the checksum, the chef-client does not download it. Use when a URL is specified by the <tt class="docutils literal"><span class="pre">source</span></tt> property.</p>
<p class="last">New in Chef client 12.6.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">installer_type</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol</p>
<p class="last">A symbol that specifies the type of package. Possible values: <tt class="docutils literal"><span class="pre">:custom</span></tt> (such as installing a non-.msi file that embeds an .msi-based installer), <tt class="docutils literal"><span class="pre">:inno</span></tt> (Inno Setup), <tt class="docutils literal"><span class="pre">:installshield</span></tt> (InstallShield), <tt class="docutils literal"><span class="pre">:msi</span></tt> (Microsoft Installer Package (MSI)), <tt class="docutils literal"><span class="pre">:nsis</span></tt> (Nullsoft Scriptable Install System (NSIS)), <tt class="docutils literal"><span class="pre">:wise</span></tt> (Wise).</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">remote_file_attributes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A package at a remote location define as a Hash of properties that modifes the properties of the <strong>remote_file</strong> resource.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">returns</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> Integer, Array of integers</p>
<p class="last">A comma-delimited list of return codes that indicate the success or failure of the command that was run remotely. This code signals a successful <tt class="docutils literal"><span class="pre">:install</span></tt> action. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p>Optional. The path to a package in the local file system. The location of the package may be at a URL. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
<p>If the <tt class="docutils literal"><span class="pre">source</span></tt> property is not specified, the package name MUST be exactly the same as the display name found in <strong>Add/Remove programs</strong> or exacty the same as the <tt class="docutils literal"><span class="pre">DisplayName</span></tt> property in the appropriate registry key:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="no">HKEY_LOCAL_MACHINE</span><span class="p">\</span><span class="no">Software</span><span class="p">\</span><span class="no">Microsoft</span><span class="p">\</span><span class="no">Windows</span><span class="p">\</span><span class="no">CurrentVersion</span><span class="p">\</span><span class="no">Uninstall</span>
<span class="no">HKEY_CURRENT_USER</span><span class="p">\</span><span class="no">Software</span><span class="p">\</span><span class="no">Microsoft</span><span class="p">\</span><span class="no">Windows</span><span class="p">\</span><span class="no">CurrentVersion</span><span class="p">\</span><span class="no">Uninstall</span>
<span class="no">HKEY_LOCAL_MACHINE</span><span class="p">\</span><span class="no">Software</span><span class="p">\</span><span class="no">Wow6464Node</span><span class="p">\</span><span class="no">Microsoft</span><span class="p">\</span><span class="no">Windows</span><span class="p">\</span><span class="no">CurrentVersion</span><span class="p">\</span><span class="no">Uninstall</span>
</pre></div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If there are multiple versions of a package installed with the same display name, all of those packages will be removed unless a version is provided in the <tt class="docutils literal"><span class="pre">version</span></tt> property or unless it can be discovered in the installer file specified by the <tt class="docutils literal"><span class="pre">source</span></tt> property.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out. Default value: <tt class="docutils literal"><span class="pre">600</span></tt> (seconds).</p>
</dd>
</dl>
</div>
<div class="section" id="id323">
<h3>Providers<a class="headerlink" href="#id323" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Windows</span></tt>, <tt class="docutils literal"><span class="pre">windows_package</span></tt></dt>
<dd>The provider for the Microsoft Windows platform.</dd>
</dl>
</div>
<div class="section" id="id324">
<h3>Examples<a class="headerlink" href="#id324" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;7zip&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">source</span> <span class="s1">&#39;C:\7z920.msi&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify a URL for the source attribute</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;7zip&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://www.7-zip.org/a/7z938-x64.msi&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Specify path and checksum</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;7zip&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://www.7-zip.org/a/7z938-x64.msi&#39;</span>
  <span class="n">checksum</span> <span class="s1">&#39;7c8e873991c82ad9cfc123415254ea6101e9a645e12977dcd518979e50fdedf3&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Modify remote_file resource attributes</strong></p>
<p>The <strong>windows_package</strong> resource may specify a package at a remote location using the <tt class="docutils literal"><span class="pre">remote_file_attributes</span></tt> property. This uses the <strong>remote_file</strong> resource to download the contents at the specified URL and passes in a Hash that modifes the properties of the <a class="reference external" href="https://docs.chef.io/resource_remote_file.html">remote_file resource</a>.</p>
<p>For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;7zip&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://www.7-zip.org/a/7z938-x64.msi&#39;</span>
  <span class="n">remote_file_attributes</span> <span class="p">({</span>
    <span class="ss">:path</span> <span class="o">=&gt;</span> <span class="s1">&#39;C:\\7zip.msi&#39;</span><span class="p">,</span>
    <span class="ss">:checksum</span> <span class="o">=&gt;</span> <span class="s1">&#39;7c8e873991c82ad9cfc123415254ea6101e9a645e12977dcd518979e50fdedf3&#39;</span>
  <span class="p">})</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Download a nsis (Nullsoft) package resource</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;Mercurial 3.6.1 (64-bit)&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;http://mercurial.selenic.com/release/windows/Mercurial-3.6.1-x64.exe&#39;</span>
  <span class="n">checksum</span> <span class="s1">&#39;febd29578cb6736163d232708b834a2ddd119aa40abc536b2c313fc5e1b5831d&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Download a custom package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_package</span> <span class="s1">&#39;Microsoft Visual C++ 2005 Redistributable&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;https://download.microsoft.com/download/6/B/B/6BB661D6-A8AE-4819-B79F-236472F6070C/vcredist_x86.exe&#39;</span>
  <span class="n">installer_type</span> <span class="ss">:custom</span>
  <span class="n">options</span> <span class="s1">&#39;/Q&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="windows-service">
<h2>windows_service<a class="headerlink" href="#windows-service" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_windows_service.rst">[edit on GitHub]</a></p>
<p>Use the <strong>windows_service</strong> resource to manage a service on the Microsoft Windows platform.</p>
<div class="section" id="id325">
<h3>Syntax<a class="headerlink" href="#id325" title="Permalink to this headline">¶</a></h3>
<p>A <strong>windows_service</strong> resource block manages the state of a service on a machine that is running Microsoft Windows. For example:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_service</span> <span class="s1">&#39;BITS&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:configure_startup</span>
  <span class="n">startup_type</span> <span class="ss">:manual</span>
<span class="k">end</span>
</pre></div>
</div>
<p>The full syntax for all of the properties that are available to the <strong>windows_service</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_service</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">init_command</span>               <span class="nb">String</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">pattern</span>                    <span class="nb">String</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Service</span><span class="o">::</span><span class="no">Windows</span>
  <span class="n">reload_command</span>             <span class="nb">String</span>
  <span class="n">restart_command</span>            <span class="nb">String</span>
  <span class="n">run_as_password</span>            <span class="nb">String</span>
  <span class="n">run_as_user</span>                <span class="nb">String</span>
  <span class="n">service_name</span>               <span class="nb">String</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">start_command</span>              <span class="nb">String</span>
  <span class="n">startup_type</span>               <span class="no">Symbol</span>
  <span class="n">status_command</span>             <span class="nb">String</span>
  <span class="n">stop_command</span>               <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">supports</span>                   <span class="no">Hash</span>
  <span class="n">timeout</span>                    <span class="nb">Integer</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :nothing if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">windows_service</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies the steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">init_command</span></tt>, <tt class="docutils literal"><span class="pre">pattern</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">reload_command</span></tt>, <tt class="docutils literal"><span class="pre">restart_command</span></tt>, <tt class="docutils literal"><span class="pre">run_as_password</span></tt>, <tt class="docutils literal"><span class="pre">run_as_user</span></tt>, <tt class="docutils literal"><span class="pre">service_name</span></tt>, <tt class="docutils literal"><span class="pre">start_command</span></tt>, <tt class="docutils literal"><span class="pre">startup_type</span></tt>, <tt class="docutils literal"><span class="pre">status_command</span></tt>, <tt class="docutils literal"><span class="pre">stop_command</span></tt>, <tt class="docutils literal"><span class="pre">supports</span></tt>, and <tt class="docutils literal"><span class="pre">timeout</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id326">
<h3>Actions<a class="headerlink" href="#id326" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:configure_startup</span></tt></dt>
<dd>Configure a service based on the value of the <tt class="docutils literal"><span class="pre">startup_type</span></tt> property.</dd>
<dt><tt class="docutils literal"><span class="pre">:disable</span></tt></dt>
<dd>Disable a service. This action is equivalent to a <tt class="docutils literal"><span class="pre">Disabled</span></tt> startup type on the Microsoft Windows platform.</dd>
<dt><tt class="docutils literal"><span class="pre">:enable</span></tt></dt>
<dd>Enable a service at boot. This action is equivalent to an <tt class="docutils literal"><span class="pre">Automatic</span></tt> startup type on the Microsoft Windows platform.</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Default. Do nothing with a service.</dd>
<dt><tt class="docutils literal"><span class="pre">:reload</span></tt></dt>
<dd>Reload the configuration for this service.</dd>
<dt><tt class="docutils literal"><span class="pre">:restart</span></tt></dt>
<dd>Restart a service.</dd>
<dt><tt class="docutils literal"><span class="pre">:start</span></tt></dt>
<dd>Start a service, and keep it running until stopped or disabled.</dd>
<dt><tt class="docutils literal"><span class="pre">:stop</span></tt></dt>
<dd>Stop a service.</dd>
</dl>
</div>
<div class="section" id="id327">
<h3>Properties<a class="headerlink" href="#id327" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">init_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The path to the init script that is associated with the service. This is typically <tt class="docutils literal"><span class="pre">/etc/init.d/SERVICE_NAME</span></tt>. The <tt class="docutils literal"><span class="pre">init_command</span></tt> property can be used to prevent the need to specify  overrides for the <tt class="docutils literal"><span class="pre">start_command</span></tt>, <tt class="docutils literal"><span class="pre">stop_command</span></tt>, and <tt class="docutils literal"><span class="pre">restart_command</span></tt> attributes. Default value: <tt class="docutils literal"><span class="pre">nil</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">pattern</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The pattern to look for in the process table. Default value: <tt class="docutils literal"><span class="pre">service_name</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">reload_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The command used to tell a service to reload its configuration.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">restart_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The command used to restart a service.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">run_as_password</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The password for the user specified by <tt class="docutils literal"><span class="pre">run_as_user</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">run_as_user</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The user under which a Microsoft Windows service runs.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">service_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The name of the service. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">start_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The command used to start a service.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">startup_type</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol</p>
<p class="last">Use to specify the startup type for a Microsoft Windows service. Possible values: <tt class="docutils literal"><span class="pre">:automatic</span></tt>, <tt class="docutils literal"><span class="pre">:disabled</span></tt>, or <tt class="docutils literal"><span class="pre">:manual</span></tt>. Default value: <tt class="docutils literal"><span class="pre">:automatic</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">status_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The command used to check the run status for a service.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">stop_command</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">The command used to stop a service.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">supports</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">A list of properties that controls how the chef-client is to attempt to manage a service: <tt class="docutils literal"><span class="pre">:restart</span></tt>, <tt class="docutils literal"><span class="pre">:reload</span></tt>, <tt class="docutils literal"><span class="pre">:status</span></tt>. For <tt class="docutils literal"><span class="pre">:restart</span></tt>, the init script or other service provider can use a restart command; if <tt class="docutils literal"><span class="pre">:restart</span></tt> is not specified, the chef-client attempts to stop and then start a service. For <tt class="docutils literal"><span class="pre">:reload</span></tt>, the init script or other service provider can use a reload command. For <tt class="docutils literal"><span class="pre">:status</span></tt>, the init script or other service provider can use a status command to determine if the service is running; if <tt class="docutils literal"><span class="pre">:status</span></tt> is not specified, the chef-client attempts to match the <tt class="docutils literal"><span class="pre">service_name</span></tt> against the process table as a regular expression, unless a pattern is specified as a parameter property. Default value: <tt class="docutils literal"><span class="pre">{</span> <span class="pre">:restart</span> <span class="pre">=&gt;</span> <span class="pre">false,</span> <span class="pre">:reload</span> <span class="pre">=&gt;</span> <span class="pre">false,</span> <span class="pre">:status</span> <span class="pre">=&gt;</span> <span class="pre">false</span> <span class="pre">}</span></tt> for all platforms (except for the Red Hat platform family, which defaults to <tt class="docutils literal"><span class="pre">{</span> <span class="pre">:restart</span> <span class="pre">=&gt;</span> <span class="pre">false,</span> <span class="pre">:reload</span> <span class="pre">=&gt;</span> <span class="pre">false,</span> <span class="pre">:status</span> <span class="pre">=&gt;</span> <span class="pre">true</span> <span class="pre">}</span></tt>.)</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out. Default value: <tt class="docutils literal"><span class="pre">60</span></tt>.</p>
</dd>
</dl>
</div>
<div class="section" id="id328">
<h3>Examples<a class="headerlink" href="#id328" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Start a service manually</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">windows_service</span> <span class="s1">&#39;BITS&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:configure_startup</span>
  <span class="n">startup_type</span> <span class="ss">:manual</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="yum-package">
<h2>yum_package<a class="headerlink" href="#yum-package" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_yum.rst">[edit on GitHub]</a></p>
<p>Use the <strong>yum_package</strong> resource to install, upgrade, and remove packages with Yum for the Red Hat and CentOS platforms. The <strong>yum_package</strong> resource is able to resolve <tt class="docutils literal"><span class="pre">provides</span></tt> data for packages much like Yum can do when it is run from the command line. This allows a variety of options for installing packages, like minimum versions, virtual provides, and library names.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Support for using file names to install packages (as in <tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;/bin/sh&quot;</span></tt>) is not available because the volume of data required to parse for this is excessive.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In many cases, it is better to use the <strong>package</strong> resource instead of this one. This is because when the <strong>package</strong> resource is used in a recipe, the chef-client will use details that are collected by Ohai at the start of the chef-client run to determine the correct package application. Using the <strong>package</strong> resource allows a recipe to be authored in a way that allows it to be used across many platforms.</p>
</div>
<div class="section" id="id329">
<h3>Syntax<a class="headerlink" href="#id329" title="Permalink to this headline">¶</a></h3>
<p>A <strong>yum_package</strong> resource block manages a package on a node, typically by installing it. The simplest use of the <strong>yum_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;package_name&#39;</span>
</pre></div>
</div>
<p>which will install the named package using all of the default options and the default action (<tt class="docutils literal"><span class="pre">:install</span></tt>).</p>
<p>The full syntax for all of the properties that are available to the <strong>yum_package</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
  <span class="n">allow_downgrade</span>            <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
  <span class="n">arch</span>                       <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">flush_cache</span>                <span class="nb">Array</span>
  <span class="n">notifies</span>                   <span class="c1"># see description</span>
  <span class="n">options</span>                    <span class="nb">String</span>
  <span class="n">package_name</span>               <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span> <span class="c1"># defaults to &#39;name&#39; if not specified</span>
  <span class="n">provider</span>                   <span class="no">Chef</span><span class="o">::</span><span class="no">Provider</span><span class="o">::</span><span class="no">Package</span><span class="o">::</span><span class="no">Yum</span>
  <span class="n">source</span>                     <span class="nb">String</span>
  <span class="n">subscribes</span>                 <span class="c1"># see description</span>
  <span class="n">timeout</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
  <span class="n">version</span>                    <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
  <span class="n">action</span>                     <span class="no">Symbol</span> <span class="c1"># defaults to :install if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">yum_package</span></tt> tells the chef-client to manage a package</li>
<li><tt class="docutils literal"><span class="pre">'name'</span></tt> is the name of the package</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">allow_downgrade</span></tt>, <tt class="docutils literal"><span class="pre">arch</span></tt>, <tt class="docutils literal"><span class="pre">flush_cache</span></tt>, <tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">package_name</span></tt>, <tt class="docutils literal"><span class="pre">provider</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt>, and <tt class="docutils literal"><span class="pre">version</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id330">
<h3>Actions<a class="headerlink" href="#id330" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:install</span></tt></dt>
<dd>Default. Install a package. If a version is specified, install the specified version of the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:lock</span></tt></dt>
<dd><p class="first">Locks the yum package to a specific version.</p>
<p class="last">New in Chef client 12.16.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">:nothing</span></tt></dt>
<dd>Define this resource block to do nothing until notified by another resource to take action. When this resource is notified, this resource block is either run immediately or it is queued up to be run at the end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:purge</span></tt></dt>
<dd>Purge a package. This action typically removes the configuration files as well as the package.</dd>
<dt><tt class="docutils literal"><span class="pre">:remove</span></tt></dt>
<dd>Remove a package.</dd>
<dt><tt class="docutils literal"><span class="pre">:unlock</span></tt></dt>
<dd><p class="first">Unlocks the yum package so that it can be upgraded to a newer version.</p>
<p class="last">New in Chef client 12.16.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">:upgrade</span></tt></dt>
<dd>Install a package and/or ensure that a package is the latest version. This action will ignore the <tt class="docutils literal"><span class="pre">version</span></tt> attribute.</dd>
</dl>
</div>
<div class="section" id="id331">
<h3>Properties<a class="headerlink" href="#id331" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">allow_downgrade</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Downgrade a package to satisfy requested version requirements.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">arch</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String</p>
<p class="last">The architecture of the package to be installed or upgraded. This value can also be passed as part of the package name.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">flush_cache</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Array</p>
<p>Flush the in-memory cache before or after a Yum operation that installs, upgrades, or removes a package. Default value: <tt class="docutils literal"><span class="pre">[</span> <span class="pre">:before,</span> <span class="pre">:after</span> <span class="pre">]</span></tt>. The value may also be a Hash: <tt class="docutils literal"><span class="pre">(</span> <span class="pre">{</span> <span class="pre">:before</span> <span class="pre">=&gt;</span> <span class="pre">true/false,</span> <span class="pre">:after</span> <span class="pre">=&gt;</span> <span class="pre">true/false</span> <span class="pre">}</span> <span class="pre">)</span></tt>.</p>
<p>Yum automatically synchronizes remote metadata to a local cache. The chef-client creates a copy of the local cache, and then stores it in-memory during the chef-client run. The in-memory cache allows packages to be installed during the chef-client run without the need to continue synchronizing the remote metadata to the local cache while the chef-client run is in-progress.</p>
<p>As an array:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;some-package&#39;</span> <span class="k">do</span>
  <span class="c1">#...</span>
  <span class="n">flush_cache</span> <span class="o">[</span> <span class="ss">:before</span> <span class="o">]</span>
  <span class="c1">#...</span>
<span class="k">end</span>
</pre></div>
</div>
<p>and as a Hash:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;some-package&#39;</span> <span class="k">do</span>
  <span class="c1">#...</span>
  <span class="n">flush_cache</span><span class="p">(</span> <span class="p">{</span> <span class="ss">:after</span> <span class="o">=&gt;</span> <span class="kp">true</span> <span class="p">}</span> <span class="p">)</span>
  <span class="c1">#...</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The <tt class="docutils literal"><span class="pre">flush_cache</span></tt> property does not flush the local Yum cache! Use Yum tools&#8212;<tt class="docutils literal"><span class="pre">yum</span> <span class="pre">clean</span> <span class="pre">headers</span></tt>, <tt class="docutils literal"><span class="pre">yum</span> <span class="pre">clean</span> <span class="pre">packages</span></tt>, <tt class="docutils literal"><span class="pre">yum</span> <span class="pre">clean</span> <span class="pre">all</span></tt>&#8212;to clean the local Yum cache.</p>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">ignore_failure</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> TrueClass, FalseClass</p>
<p class="last">Continue running a recipe if a resource fails for any reason. Default value: <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">notifies</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may notify another resource to take action when its state changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> that resource should take, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action. A resource may notifiy more than one resource; use a <tt class="docutils literal"><span class="pre">notifies</span></tt> statement for each resource to be notified.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">notifies</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">notifies</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">options</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">One (or more) additional options that are passed to the command.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">package_name</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">One of the following: the name of a package, the name of a package and its architecture, the name of a dependency. Default value: the <tt class="docutils literal"><span class="pre">name</span></tt> of the resource block See &#8220;Syntax&#8221; section above for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">provider</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Chef Class</p>
<p class="last">Optional. Explicitly specifies a provider. See &#8220;Providers&#8221; section below for more information.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retries</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The number of times to catch exceptions and retry the resource. Default value: <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">retry_delay</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Integer</p>
<p class="last">The retry delay (in seconds). Default value: <tt class="docutils literal"><span class="pre">2</span></tt>.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">source</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Optional. The path to a package in the local file system.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">subscribes</span></tt></dt>
<dd><p class="first"><strong>Ruby Type:</strong> Symbol, &#8216;Chef::Resource[String]&#8217;</p>
<p>A resource may listen to another resource, and then take action if the state of the resource being listened to changes. Specify a <tt class="docutils literal"><span class="pre">'resource[name]'</span></tt>, the <tt class="docutils literal"><span class="pre">:action</span></tt> to be taken, and then the <tt class="docutils literal"><span class="pre">:timer</span></tt> for that action.</p>
<p>A timer specifies the point during the chef-client run at which a notification is run. The following timers are available:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">:before</span></tt></dt>
<dd>Specifies that the action on a notified resource should be run before processing the resource block in which the notification is located.</dd>
<dt><tt class="docutils literal"><span class="pre">:delayed</span></tt></dt>
<dd>Default. Specifies that a notification should be queued up, and then executed at the very end of the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">:immediate</span></tt>, <tt class="docutils literal"><span class="pre">:immediately</span></tt></dt>
<dd>Specifies that a notification should be run immediately, per resource notified.</dd>
</dl>
<p>The syntax for <tt class="docutils literal"><span class="pre">subscribes</span></tt> is:</p>
<div class="last highlight-ruby"><div class="highlight"><pre><span></span><span class="n">subscribes</span> <span class="ss">:action</span><span class="p">,</span> <span class="s1">&#39;resource[name]&#39;</span><span class="p">,</span> <span class="ss">:timer</span>
</pre></div>
</div>
</dd>
<dt><tt class="docutils literal"><span class="pre">timeout</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Integer</p>
<p class="last">The amount of time (in seconds) to wait before timing out.</p>
</dd>
<dt><tt class="docutils literal"><span class="pre">version</span></tt></dt>
<dd><p class="first"><strong>Ruby Types:</strong> String, Array</p>
<p class="last">The version of a package to be installed or upgraded. This attribute is ignored when using the <tt class="docutils literal"><span class="pre">:upgrade</span></tt> action.</p>
</dd>
</dl>
<div class="section" id="id332">
<h4>Multiple Packages<a class="headerlink" href="#id332" title="Permalink to this headline">¶</a></h4>
<p>A resource may specify multiple packages and/or versions for platforms that use Yum, Apt, Zypper, or Chocolatey package managers. Specifing multiple packages and/or versions allows a single transaction to:</p>
<ul class="simple">
<li>Download the specified packages and versions via a single HTTP transaction</li>
<li>Update or install multiple packages with a single resource during the chef-client run</li>
</ul>
<p>For example, installing multiple packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>
</pre></div>
</div>
<p>Upgrading multiple packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>  <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:upgrade</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Removing multiple packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>  <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:remove</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Purging multiple packages:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>  <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:purge</span>
<span class="k">end</span>
</pre></div>
</div>
<p>Notifications, via an implicit name:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">package</span> <span class="o">[</span><span class="s1">&#39;package1&#39;</span><span class="p">,</span> <span class="s1">&#39;package2&#39;</span><span class="o">]</span>  <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:nothing</span>
<span class="k">end</span>

<span class="n">log</span> <span class="s1">&#39;call a notification&#39;</span> <span class="k">do</span>
  <span class="n">notifies</span> <span class="ss">:install</span><span class="p">,</span> <span class="s1">&#39;package[package1, package2]&#39;</span><span class="p">,</span> <span class="ss">:immediately</span>
<span class="k">end</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Notifications and subscriptions do not need to be updated when packages and versions are added or removed from the <tt class="docutils literal"><span class="pre">package_name</span></tt> or <tt class="docutils literal"><span class="pre">version</span></tt> properties.</p>
</div>
</div>
</div>
<div class="section" id="id333">
<h3>Providers<a class="headerlink" href="#id333" title="Permalink to this headline">¶</a></h3>
<p>Where a resource represents a piece of the system (and its desired state), a provider defines the steps that are needed to bring that piece of the system from its current state into the desired state.</p>
<p>The chef-client will determine the correct provider based on configuration data collected by Ohai at the start of the chef-client run. This configuration data is then mapped to a platform and an associated list of providers.</p>
<p>Generally, it&#8217;s best to let the chef-client choose the provider, and this is (by far) the most common approach. However, in some cases, specifying a provider may be desirable. There are two approaches:</p>
<ul class="simple">
<li>Use a more specific short name&#8212;<tt class="docutils literal"><span class="pre">yum_package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">package</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, <tt class="docutils literal"><span class="pre">script</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt> instead of <tt class="docutils literal"><span class="pre">bash</span> <span class="pre">&quot;foo&quot;</span> <span class="pre">do</span></tt>, and so on&#8212;when available</li>
<li>Use the <tt class="docutils literal"><span class="pre">provider</span></tt> property within the resource block to specify the long name of the provider as a property of a resource. For example: <tt class="docutils literal"><span class="pre">provider</span> <span class="pre">Chef::Provider::Long::Name</span></tt></li>
</ul>
<p>This resource has the following providers:</p>
<dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package</span></tt>, <tt class="docutils literal"><span class="pre">package</span></tt></dt>
<dd>When this short name is used, the chef-client will attempt to determine the correct provider during the chef-client run.</dd>
<dt><tt class="docutils literal"><span class="pre">Chef::Provider::Package::Yum</span></tt>, <tt class="docutils literal"><span class="pre">yum_package</span></tt></dt>
<dd>The provider for the Yum package provider.</dd>
</dl>
</div>
<div class="section" id="id334">
<h3>Examples<a class="headerlink" href="#id334" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Install an exact version</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm = 10.35.58-8.el5&#39;</span>
</pre></div>
</div>
<p><strong>Install a minimum version</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm &gt;= 10.35.58-8.el5&#39;</span>
</pre></div>
</div>
<p><strong>Install a minimum version using the default action</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm&#39;</span>
</pre></div>
</div>
<p><strong>To install a package</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>To install a partial minimum version</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm &gt;= 10&#39;</span>
</pre></div>
</div>
<p><strong>To install a specific architecture</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm&#39;</span> <span class="k">do</span>
  <span class="n">arch</span> <span class="s1">&#39;i386&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm.x86_64&#39;</span>
</pre></div>
</div>
<p><strong>To install a specific version-release</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;netpbm&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="s1">&#39;10.35.58-8.el5&#39;</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>To install a specific version (even when older than the current)</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_package</span> <span class="s1">&#39;tzdata&#39;</span> <span class="k">do</span>
  <span class="n">version</span> <span class="s1">&#39;2011b-1.el5&#39;</span>
  <span class="n">allow_downgrade</span> <span class="kp">true</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Handle cookbook_file and yum_package resources in the same recipe</strong></p>
<p>When a <strong>cookbook_file</strong> resource and a <strong>yum_package</strong> resource are both called from within the same recipe, use the <tt class="docutils literal"><span class="pre">flush_cache</span></tt> attribute to dump the in-memory Yum cache, and then use the repository immediately to ensure that the correct package is installed:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">cookbook_file</span> <span class="s1">&#39;/etc/yum.repos.d/custom.repo&#39;</span> <span class="k">do</span>
  <span class="n">source</span> <span class="s1">&#39;custom&#39;</span>
  <span class="n">mode</span> <span class="s1">&#39;0755&#39;</span>
<span class="k">end</span>

<span class="n">yum_package</span> <span class="s1">&#39;only-in-custom-repo&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:install</span>
  <span class="n">flush_cache</span> <span class="o">[</span> <span class="ss">:before</span> <span class="o">]</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="yum-repository">
<h2>yum_repository<a class="headerlink" href="#yum-repository" title="Permalink to this headline">¶</a></h2>
<p><a class="reference external" href="https://github.com/chef/chef-web-docs/blob/master/chef_master/source/resource_yum_repository.rst">[edit on GitHub]</a></p>
<p>Use the <strong>yum_repository</strong> resource to manage a Yum repository configuration file located at <tt class="docutils literal"><span class="pre">/etc/yum.repos.d/repositoryid.repo</span></tt> on the local machine. This configuration file specifies which repositories to reference, how to handle cached data, etc.</p>
<p>New in Chef client 12.14.</p>
<div class="section" id="id335">
<h3>Syntax<a class="headerlink" href="#id335" title="Permalink to this headline">¶</a></h3>
<p>A <strong>yum_repository</strong> resource creates a Yum repository configuration file to make individual Yum repositories available for use. The <strong>yum_repository</strong> resource can be as simple as the following:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_repository</span> <span class="s1">&#39;zenoss&#39;</span> <span class="k">do</span>
  <span class="n">description</span> <span class="s2">&quot;Zenoss Stable repo&quot;</span>
  <span class="n">baseurl</span> <span class="s2">&quot;http://dev.zenoss.com/yum/stable/&quot;</span>
  <span class="n">gpgkey</span> <span class="s1">&#39;http://dev.zenoss.com/yum/RPM-GPG-KEY-zenoss&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">'baseurl'</span></tt> is the URL to the directory where the Yum repository&#8217;s &#8216;repodata&#8217; directory lives</li>
<li><tt class="docutils literal"><span class="pre">'gpgkey'</span></tt> is the GPG key for the repository</li>
</ul>
<p>The full syntax for all of the properties that are available to the <strong>yum_repository</strong> resource is:</p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_repository</span> <span class="s1">&#39;name&#39;</span> <span class="k">do</span>
   <span class="n">baseurl</span>                 <span class="nb">String</span>
   <span class="n">cost</span>                    <span class="nb">String</span>
   <span class="n">clean_headers</span>           <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">clean_metadata</span>          <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">description</span>             <span class="nb">String</span>
   <span class="n">enabled</span>                 <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">enablegroups</span>            <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">exclude</span>                 <span class="nb">String</span>
   <span class="n">failovermethod</span>          <span class="nb">String</span>
   <span class="n">fastestmirror_enabled</span>   <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">gpgcheck</span>                <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">gpgkey</span>                  <span class="nb">String</span><span class="p">,</span> <span class="nb">Array</span>
   <span class="n">http_caching</span>            <span class="nb">String</span>
   <span class="n">include_config</span>          <span class="nb">String</span>
   <span class="n">includepkgs</span>             <span class="nb">String</span>
   <span class="n">keepalive</span>               <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">make_cache</span>              <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">max_retries</span>             <span class="nb">String</span><span class="p">,</span> <span class="nb">Integer</span>
   <span class="n">metadata_expire</span>         <span class="nb">String</span>
   <span class="n">mirrorexpire</span>            <span class="nb">String</span>
   <span class="n">mirrorlist</span>              <span class="nb">String</span>
   <span class="n">mirror_expire</span>           <span class="nb">String</span>
   <span class="n">mirrorlist_expire</span>       <span class="nb">String</span>
   <span class="n">options</span>                 <span class="no">Hash</span>
   <span class="n">priority</span>                <span class="nb">String</span>
   <span class="n">proxy</span>                   <span class="nb">String</span>
   <span class="n">proxy_username</span>          <span class="nb">String</span>
   <span class="n">proxy_password</span>          <span class="nb">String</span>
   <span class="n">username</span>                <span class="nb">String</span>
   <span class="n">password</span>                <span class="nb">String</span>
   <span class="n">repo_gpgcheck</span>           <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">report_instanceid</span>       <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">repositoryid</span>            <span class="nb">String</span>
   <span class="n">sensitive</span>               <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">skip_if_unavailable</span>     <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">source</span>                  <span class="nb">String</span>
   <span class="n">sslcacert</span>               <span class="nb">String</span>
   <span class="n">sslclientcert</span>           <span class="nb">String</span>
   <span class="n">sslclientkey</span>            <span class="nb">String</span>
   <span class="n">sslverify</span>               <span class="no">TrueClass</span><span class="p">,</span> <span class="no">FalseClass</span>
   <span class="n">timeout</span>                 <span class="nb">String</span>
   <span class="n">action</span>                  <span class="no">Symbol</span> <span class="c1"># default is :create if not specified</span>
<span class="k">end</span>
</pre></div>
</div>
<p>where</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">yum_repository</span></tt> is the resource</li>
<li><tt class="docutils literal"><span class="pre">name</span></tt> is the name of the resource block</li>
<li><tt class="docutils literal"><span class="pre">action</span></tt> identifies which steps the chef-client will take to bring the node into the desired state</li>
<li><tt class="docutils literal"><span class="pre">baseurl</span></tt>, <tt class="docutils literal"><span class="pre">cost</span></tt>, <tt class="docutils literal"><span class="pre">clean_headers</span></tt>, <tt class="docutils literal"><span class="pre">clean_metadata</span></tt>, <tt class="docutils literal"><span class="pre">description</span></tt>, <tt class="docutils literal"><span class="pre">enabled</span></tt>, <tt class="docutils literal"><span class="pre">enablegroups</span></tt>, <tt class="docutils literal"><span class="pre">exclude</span></tt>, <tt class="docutils literal"><span class="pre">failovermethod</span></tt>, <tt class="docutils literal"><span class="pre">fastestmirror_enabled</span></tt>, <tt class="docutils literal"><span class="pre">gpgcheck</span></tt>, <tt class="docutils literal"><span class="pre">gpgkey</span></tt>, <tt class="docutils literal"><span class="pre">http_caching</span></tt>, <tt class="docutils literal"><span class="pre">include_config</span></tt>, <tt class="docutils literal"><span class="pre">includepkgs</span></tt>, <tt class="docutils literal"><span class="pre">keepalive</span></tt>, <tt class="docutils literal"><span class="pre">make_cache</span></tt>, <tt class="docutils literal"><span class="pre">max_retries</span></tt>, <tt class="docutils literal"><span class="pre">metadata_expire</span></tt>, <tt class="docutils literal"><span class="pre">mirrorexpire</span></tt>, <tt class="docutils literal"><span class="pre">mirrorlist</span></tt>, <tt class="docutils literal"><span class="pre">mirror_expire</span></tt>, <tt class="docutils literal"><span class="pre">mirrorlist_expire</span></tt>, <tt class="docutils literal"><span class="pre">options</span></tt>, <tt class="docutils literal"><span class="pre">priority</span></tt>, <tt class="docutils literal"><span class="pre">proxy</span></tt>, <tt class="docutils literal"><span class="pre">proxy_username</span></tt>, <tt class="docutils literal"><span class="pre">proxy_password</span></tt>, <tt class="docutils literal"><span class="pre">username</span></tt>, <tt class="docutils literal"><span class="pre">password</span></tt>, <tt class="docutils literal"><span class="pre">repo_gpgcheck</span></tt>, <tt class="docutils literal"><span class="pre">report_instanceid</span></tt>, <tt class="docutils literal"><span class="pre">repositoryid</span></tt>, <tt class="docutils literal"><span class="pre">sensitive</span></tt>, <tt class="docutils literal"><span class="pre">skip_if_unavailable</span></tt>, <tt class="docutils literal"><span class="pre">source</span></tt>, <tt class="docutils literal"><span class="pre">sslcacert</span></tt>, <tt class="docutils literal"><span class="pre">sslclientcert</span></tt>, <tt class="docutils literal"><span class="pre">sslclientkey</span></tt>, <tt class="docutils literal"><span class="pre">sslverify</span></tt>, <tt class="docutils literal"><span class="pre">timeout</span></tt> are properties of this resource, with the Ruby type shown. See &#8220;Properties&#8221; section below for more information about all of the properties that may be used with this resource.</li>
</ul>
</div>
<div class="section" id="id336">
<h3>Actions<a class="headerlink" href="#id336" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following actions:</p>
<dl class="docutils">
<dt>:add</dt>
<dd><p class="first">Alias for <tt class="docutils literal"><span class="pre">:create</span></tt>.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This action will be deprecated in the future.</p>
</div>
</dd>
<dt>:create</dt>
<dd>Creates a repository file and builds the repository listing.</dd>
<dt>:delete</dt>
<dd>Deletes the repository file.</dd>
<dt>:makecache</dt>
<dd>Updates the yum cache.</dd>
<dt>:remove</dt>
<dd><p class="first">Alias for <tt class="docutils literal"><span class="pre">delete</span></tt>.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This action will be deprecated in the future.</p>
</div>
</dd>
</dl>
</div>
<div class="section" id="id337">
<h3>Properties<a class="headerlink" href="#id337" title="Permalink to this headline">¶</a></h3>
<p>This resource has the following properties:</p>
<dl class="docutils">
<dt>baseurl</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">URL to the directory where the Yum repository&#8217;s &#8216;repodata&#8217; directory lives. Can be an <a class="reference external" href="http://">http://</a>, <a class="reference external" href="https://">https://</a> or <a class="reference external" href="ftp://">ftp://</a> URL. You can specify multiple URLs in one baseurl statement.</p>
</dd>
<dt>cost</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Relative cost of accessing this repository. Useful for weighing one repo&#8217;s packages as greater/less than any other. Default is &#8216;1000&#8217;.</p>
</dd>
<dt>clean_headers</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Specifies whether you want to purge the package data files that are downloaded from a Yum repository and held in a cache directory.  Default is <tt class="docutils literal"><span class="pre">false</span></tt>. (Deprecated)</p>
</dd>
<dt>clean_metadata</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Specifies whether you want to purge all of the packages downloaded from a Yum repository and held in a cache directory. Default is <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt>description</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Descriptive name for the repository channel and maps to the &#8216;name&#8217; parameter in a repository .conf. This value must be specified.</p>
</dd>
<dt>enabled</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Specifies whether or not Yum should use this repository.</p>
</dd>
<dt>enablegroups</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Specifies whether Yum will allow the use of package groups for this repository. Default is <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt>exclude</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">List of packages to exclude from updates or installs. This should be a space separated list. Shell globs using wildcards (eg. * and ?) are allowed.</p>
</dd>
<dt>failovermethod</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Method to determine how to switch to a new server if the current one fails, which can either be <tt class="docutils literal"><span class="pre">roundrobin</span></tt> or <tt class="docutils literal"><span class="pre">priority</span></tt>. <tt class="docutils literal"><span class="pre">roundrobin</span></tt> randomly selects a URL out of the list of URLs to start with and proceeds through each of them as it encounters a failure contacting the host. <tt class="docutils literal"><span class="pre">priority</span></tt> starts from the first <tt class="docutils literal"><span class="pre">baseurl</span></tt> listed and reads through them sequentially.</p>
</dd>
<dt>fastestmirror_enabled</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Specifies whether to use the fastest mirror from a repository configuration when more than one mirror is listed in that configuration.</p>
</dd>
<dt>gpgcheck</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Specifies whether or not Yum should perform a GPG signature check on the packages received from a repository. Default is <tt class="docutils literal"><span class="pre">true</span></tt> in Chef client 12.15.</p>
</dd>
<dt>gpgkey</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String, Array</p>
<p>URL pointing to the ASCII-armored GPG key file for the repository. This is used if Yum needs a public key to verify a package and the required key hasn&#8217;t been imported into the RPM database. If this option is set, Yum will automatically import the key from the specified URL.</p>
<p class="last">Multiple URLs may be specified in the same manner as the baseurl option. If a GPG key is required to install a package from a repository, all keys specified for that repository will be installed.</p>
</dd>
<dt>http_caching</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p>Determines how upstream HTTP caches are instructed to handle any HTTP downloads that Yum does. This option can take the following values:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">all</span></tt> means that all HTTP downloads should be cached.</li>
<li><tt class="docutils literal"><span class="pre">packages</span></tt> means that only RPM package downloads should be cached, but not repository metadata downloads.</li>
<li><tt class="docutils literal"><span class="pre">none</span></tt> means that no HTTP downloads should be cached.</li>
</ul>
<p class="last">The default is <tt class="docutils literal"><span class="pre">all</span></tt>. This is recommended unless you are experiencing caching related issues.</p>
</dd>
<dt>include_config</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">An external configuration file using the format <tt class="docutils literal"><span class="pre">url://to/some/location</span></tt>.</p>
</dd>
<dt>includepkgs</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Inverse of exclude property. This is a list of packages you want to use from a repository. If this option lists only one package then that is all Yum will ever see from the repository. Default is an empty list.</p>
</dd>
<dt>keepalive</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Determines whether or not HTTP/1.1 <tt class="docutils literal"><span class="pre">keep-alive</span></tt> should be used with this repository.</p>
</dd>
<dt>make_cache</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Determines whether package files downloaded by Yum stay in cache directories. By using cached data, you can carry out certain operations without a network connection. Default is <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt>max_retries</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String, Integer</p>
<p class="last">Number of times any attempt to retrieve a file should retry before returning an error. Setting this to &#8216;0&#8217; makes Yum try forever. Default is &#8216;10&#8217;.</p>
</dd>
<dt>metadata_expire</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p>Time (in seconds) after which the metadata will expire. If the current metadata downloaded is less than the value specified, then Yum will not update the metadata against the repository. If you find that Yum is not downloading information on updates as often as you would like lower the value of this option. You can also change from the default of using seconds to using days, hours or minutes by appending a &#8216;d&#8217;, &#8216;h&#8217; or &#8216;m&#8217; respectively. The default is six hours to compliment yum-updates running once per hour. It is also possible to use the word <tt class="docutils literal"><span class="pre">never</span></tt>, meaning that the metadata will never expire.</p>
<div class="last admonition note">
<p class="first admonition-title">Note</p>
<p class="last">When using a metalink file, the metalink must always be newer than the metadata for the repository due to the validation, so this timeout also applies to the metalink file.</p>
</div>
</dd>
<dt>mirrorexpire</dt>
<dd><strong>Ruby Type:</strong> String</dd>
<dt>mirrorlist</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">URL to a file containing a list of baseurls. This can be used instead of or with the baseurl option. Substitution variables, described below, can be used with this option.</p>
</dd>
<dt>mirror_expire</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Time (in seconds) after which the mirrorlist locally cached will expire. If the current mirrorlist is less than this many seconds old then Yum will not download another copy of the mirrorlist, it has the same extra format as metadata_expire. If you find that Yum is not downloading the mirrorlists as often as you would like lower the value of this option.</p>
</dd>
<dt>mirrorlist_expire</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Specifies the time (in seconds) after which the mirrorlist locally cached will expire. If the current mirrorlist is less than the value specified, then Yum will not download another copy of the mirrorlist.</p>
</dd>
<dt>mode</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String, Array</p>
<p class="last">Permissions mode of .repo file on disk. This is useful for scenarios where secrets are in the repo file. If this value is set to &#8216;600&#8217;, normal users will not be able to use Yum search, Yum info, etc. Default is <tt class="docutils literal"><span class="pre">0644</span></tt>.</p>
</dd>
<dt>options</dt>
<dd><p class="first"><strong>Ruby Type:</strong> Hash</p>
<p class="last">Specifies the repository options.</p>
</dd>
<dt>priority</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Assigns a priority to a repository where the priority value is between &#8216;1&#8217; and &#8216;99&#8217; inclusive. Priorities are used to enforce ordered protection of repositories. Packages from repositories with a lower priority (higher numerical value) will never be used to upgrade packages that were installed from a repository with a higher priority (lower numerical value). The repositories with the lowest numerical priority number have the highest priority. The default priority for repositories is 99.</p>
</dd>
<dt>proxy</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">URL to the proxy server that Yum should use.</p>
</dd>
<dt>proxy_username</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Username to use for proxy.</p>
</dd>
<dt>proxy_password</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Password for this proxy.</p>
</dd>
<dt>username</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Username to use for basic authentication to a repository.</p>
</dd>
<dt>password</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Password to use with the username for basic authentication.</p>
</dd>
<dt>repo_gpgcheck</dt>
<dd><blockquote class="first">
<div><strong>Ruby Type:</strong> TrueClass, FalseClass</div></blockquote>
<p class="last">Determines whether or not Yum should perform a GPG signature check on the repodata from this repository.</p>
</dd>
<dt>report_instanceid</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Determines whether to report the instance ID when using Amazon Linux AMIs and repositories.</p>
</dd>
<dt>repositoryid</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Specifies a unique name for each repository, one word. Defaults to name attribute.</p>
</dd>
<dt>sensitive</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Determines whether the content of repository file is hidden from chef run output. Default is <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt>skip_if_unavailable</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Determines whether Yum will continue running if this repository cannot be contacted for any reason. This should be set carefully as all repos are consulted for any given command. Default is <tt class="docutils literal"><span class="pre">false</span></tt>.</p>
</dd>
<dt>source</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Use a custom template source instead of the default one.</p>
</dd>
<dt>sslcacert</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Path to the directory containing the databases of the certificate authorities Yum should use to verify SSL certificates. Defaults to &#8216;none&#8217;, which uses the system default.</p>
</dd>
<dt>sslclientcert</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Path to the SSL client certificate Yum should use to connect to repos/remote sites. Defaults to &#8216;none&#8217;.</p>
</dd>
<dt>sslclientkey</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Path to the SSL client key Yum should use to connect to repos/remote sites. Defaults to &#8216;none&#8217;.</p>
</dd>
<dt>sslverify</dt>
<dd><p class="first"><strong>Ruby Type:</strong> TrueClass, FalseClass</p>
<p class="last">Determines whether Yum will verify SSL certificates/hosts. Defaults to <tt class="docutils literal"><span class="pre">true</span></tt>.</p>
</dd>
<dt>timeout</dt>
<dd><p class="first"><strong>Ruby Type:</strong> String</p>
<p class="last">Number of seconds to wait for a connection before timing out. Defaults to 30 seconds. This may be too short of a time for extremely overloaded sites.</p>
</dd>
</dl>
</div>
<div class="section" id="id338">
<h3>Examples<a class="headerlink" href="#id338" title="Permalink to this headline">¶</a></h3>
<p>The following examples demonstrate various approaches for using resources in recipes. If you want to see examples of how Chef uses resources in recipes, take a closer look at the cookbooks that Chef authors and maintains: <a class="reference external" href="https://github.com/chef-cookbooks">https://github.com/chef-cookbooks</a>.</p>
<p><strong>Add internal company repository</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_repository</span> <span class="s1">&#39;OurCo&#39;</span> <span class="k">do</span>
  <span class="n">description</span> <span class="s1">&#39;OurCo yum repository&#39;</span>
  <span class="n">mirrorlist</span> <span class="s1">&#39;http://artifacts.ourco.org/mirrorlist?repo=ourco-6&amp;arch=$basearch&#39;</span>
  <span class="n">gpgkey</span> <span class="s1">&#39;http://artifacts.ourco.org/pub/yum/RPM-GPG-KEY-OURCO-6&#39;</span>
  <span class="n">action</span> <span class="ss">:create</span>
<span class="k">end</span>
</pre></div>
</div>
<p><strong>Delete a repository</strong></p>
<div class="highlight-ruby"><div class="highlight"><pre><span></span><span class="n">yum_repository</span> <span class="s1">&#39;CentOS-Media&#39;</span> <span class="k">do</span>
  <span class="n">action</span> <span class="ss">:delete</span>
<span class="k">end</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>


          <div class="footer" role="contentinfo">
                &copy; Copyright: This work is licensed under a Creative Commons Attribution 3.0 Unported License.
              This page is about: current version of Chef.
            <a href="/feedback.html">Provide feedback on Chef documentation</a>.
            </div>

<!-- Start of Async Google Analytics Code -->
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-6369228-7', 'auto', {'legacyCookieDomain': '.chef.io', 'allowLinker': true});
  ga('send', 'pageview');

  var trackOutboundLink = function(url) {
    if (ga.q) {
     document.location = url;
    } else {
      ga('send', 'event', 'outbound', 'click', url, {'hitCallback':
        function () {
          document.location = url;
        }
      });
    }
  };
</script>
<!-- End of Async Google Analytics Code -->

<!-- Start of Marketo Analytics Code -->
<script type="text/javascript">
(function() {
  var didInit = false;
  function initMunchkin() {
    if(didInit === false) {
      didInit = true;
      Munchkin.init('255-VFB-268');
    }
  }
  var s = document.createElement('script');
  s.type = 'text/javascript';
  s.async = true;
  s.src = document.location.protocol + '//munchkin.marketo.net/munchkin.js';
  s.onreadystatechange = function() {
    if (this.readyState == 'complete' || this.readyState == 'loaded') {
      initMunchkin();
    }
  };
  s.onload = initMunchkin;
  document.getElementsByTagName('head')[0].appendChild(s);
})();
</script>
<!-- End of Marketo Analytics Code -->

<!-- Start of DemandBase Analytics Code -->
<script type="text/javascript">
	(function(d,b,a,s,e){ var t = b.createElement(a),
		fs = b.getElementsByTagName(a)[0]; t.async=1; t.id=e;
		t.src=('https:'==document.location.protocol ? 'https://' : 'http://') + s;
		fs.parentNode.insertBefore(t, fs); })
	(window,document,'script','scripts.demandbase.com/zH7sZrWR.min.js','demandbase_js_lib');
</script>
<!-- End of DemandBase Analytics Code -->

<!-- Start of Segment Analytics Code -->
<script type="text/javascript">
  !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t){var e=document.createElement("script");e.type="text/javascript";e.async=!0;e.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(e,n)};analytics.SNIPPET_VERSION="4.0.0";
  analytics.load("RtyoRfLf1ZETiJcIfkKND3Wq1K1LhYHx");
  analytics.page();
  }}();
</script>
<!-- End of Segment Analytics Code -->


        </div>
      </div>

      <div class="clearer"></div>
    </div>

  </div>
  </body>
</html>